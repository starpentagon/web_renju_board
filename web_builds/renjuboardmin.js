"use strict";function CRenjuBoardApi(){}function CCommand(t,e,o){this.m_nType=void 0===t?ECommand.Unknown:t,this.m_oValue=void 0===e?null:e,this.m_nCount=void 0===o?0:o}function CPos(){X=0,Y=0}function CColor(t,e,o,r){this.r=t,this.g=e,this.b=o,this.a=void 0===r?255:r}function Common_ValuetoXY(t){var e=new CPos;return e.X=255&t,e.Y=t>>8&255,e}function Common_XYtoValue(t,e){return(e<<8)+t}function Common_CopyArray(t){for(var e=[],o=0,r=t.length;o<r;o++)e.push(t[o]);return e}function Common_FindPosition(t){if(void 0!==t.offsetParent){for(var e=0,o=0;t;t=t.offsetParent)e+=t.offsetLeft,o+=t.offsetTop;return{X:e,Y:o}}return{X:t.x,Y:t.y}}function Common_PosValueToString(t,e,o){var r=Common_ValuetoXY(t);return Common_XYtoString(r.X,r.Y,e,o)}function Common_XYtoString(t,e,o,r){var i=Common_X_to_String(t,o);return i+=r+1-e}function Common_X_to_String(t,e){var o=Math.max(0,Math.min(t-1,e-1));return o<8?String.fromCharCode("A".charCodeAt(0)+o):o<=24?String.fromCharCode("A".charCodeAt(0)+o+1):o<33?String.fromCharCode("A".charCodeAt(0)+o-25,"A".charCodeAt(0)+o-25):o<50?String.fromCharCode("A".charCodeAt(0)+o-24,"A".charCodeAt(0)+o-24):String.fromCharCode("A".charCodeAt(0)+o-50,"A".charCodeAt(0)+o-50,"A".charCodeAt(0)+o-50)}function Common_StringToXY(t,e,o){if(!t||!t.IsLatinLetter)return null;var r=(t=t.toUpperCase()).length,i=1,a=1,n="";if(r>=3&&t.IsLatinLetter(0)&&t.charAt(0)===t.charAt(1)&&t.charAt(0)===t.charAt(2))n=t.substr(3),i=t.charCodeAt(0)-"A".charCodeAt(0)+50;else if(r>=2&&t.IsLatinLetter(0)&&t.charAt(0)===t.charAt(1))n=t.substr(2),i="I".charCodeAt(0)<t.charCodeAt(0)?t.charCodeAt(0)-"A".charCodeAt(0)+24:t.charCodeAt(0)-"A".charCodeAt(0)+25;else{if(!(r>=1&&t.IsLatinLetter(0)))return null;n=t.substr(1),i="I".charCodeAt(0)<t.charCodeAt(0)?t.charCodeAt(0)-"A".charCodeAt(0)-1:t.charCodeAt(0)-"A".charCodeAt(0)}return a=parseInt(n),isNaN(a)&&(a=1),a=o-a,a>=o||a<0||i<0||i>=e?null:{X:i,Y:a}}function Common_IsInt(t){if("string"!=typeof t)return!1;for(var e=0;e<t.length;e++){var o=t.charCodeAt(e);if(o<48||o>57)return!1}return!0}function Common_SortIncrease(t,e){return t>e?1:e>t?-1:0}function Common_UTF8_Decode(t){for(var e="",o=0,r=0,i=0,a=0,n=t.length;o<n;)(r=t.charCodeAt(o))<128?(e+=String.fromCharCode(r),o++):r>191&&r<224?(i=t.charCodeAt(o+1),e+=String.fromCharCode((31&r)<<6|63&i),o+=2):(i=t.charCodeAt(o+1),a=t.charCodeAt(o+2),e+=String.fromCharCode((15&r)<<12|(63&i)<<6|63&a),o+=3);return e}function Common_UTF8_Encode(t){for(var e="",o=0,r=0,i=0,a=0,n=t.length;o<n;)(r=t.charCodeAt(o))<128?(e+=String.fromCharCode(r),o++):r>191&&r<224?(i=t.charCodeAt(o+1),e+=String.fromCharCode((31&r)<<6|63&i),o+=2):(i=t.charCodeAt(o+1),a=t.charCodeAt(o+2),e+=String.fromCharCode((15&r)<<12|(63&i)<<6|63&a),o+=3);return e}function Common_EncodeString(t,e){for(var o=Encodings[e],r=t.length,i="",a=0;a<r;a++)for(var n=0;n<256;n++)if(o.charCodeAt(n)===t.charCodeAt(a)){i+=String.fromCharCode(n);break}return i}function CommonExtend(t,e){var o=function(){};o.prototype=e.prototype,t.prototype=new o,t.prototype.constructor=t,t.superclass=e.prototype}function CCommon(){}function CGameTree(t){this.m_oSettings=new CLocalSetting(this),this.m_oSound=new CBoardSound,this.m_oDrawing=t,this.m_oInterfaceState=new CInterfaceState,this.m_oBoard=new CLogicBoard,this.m_oDrawingBoard=null,this.m_oDrawingNavigator=null,this.m_oFirstNode=new CNode(this),this.m_oCurNode=this.m_oFirstNode,this.m_oStartNode=this.m_oFirstNode,this.m_oGameCurNode=null,this.m_nBlackPassCount=0,this.m_nWhitePassCount=0,this.m_nNextMove=BOARD_BLACK,this.m_nMovesCount=0,this.m_nCurNodeDepth=0,this.m_sApplication="",this.m_sCharset="",this.m_sGameAnnotator="",this.m_sBlackRating="",this.m_sBlackTeam="",this.m_sCopyright="",this.m_sDateTime="",this.m_sGameEvent="",this.m_sGameName="",this.m_sGameInfo="",this.m_sOverTime="",this.m_sBlack="Black",this.m_sGamePlace="",this.m_sWhite="White",this.m_sResult="",this.m_sGameRound="",this.m_sRules="",this.m_sGameSource="",this.m_nTimeLimit=0,this.m_sGameTranscriber="",this.m_sWhiteRating="",this.m_sWhiteTeam="",this.m_bEventEnable=!0,this.m_eShowVariants=EShowVariants.Next,this.m_nEditingFlags=4294967295,this.m_nAutoPlayTimer=null,this.m_dAutoPlaySpeed=.75,this.m_nAutoPlayOldTime=-1,this.m_bTutorModeAuto=!1,this.m_nTutorMode=BOARD_EMPTY,this.m_nTutorInterval=300,this.m_sTutorText="",this.m_nTutorId=null,this.m_pTutorRightCallback=null,this.m_pTutorWrongCallback=null,this.m_pTutorResetCallback=null,this.m_nGifId=null,this.m_oHandler=null,this.m_bModified=!1,this.m_bKifuMode=!1,this.m_nKifuEditFlags=0}function CGifWriter(){this.m_pStream=null,this.m_bFirstFrame=!0,this.m_pPixels=null,this.m_pColorTable=null,this.m_oColorMap={},this.m_nTranspIndex=0,this.m_sComment=String.fromCharCode(71,101,110,101,114,97,116,101,100,32,98,121,32,103,111,98,97,110,46,111,114,103),this.m_nDelay=0,this.m_pIndexedPixels=null,this.m_nW=0,this.m_nH=0,this.m_nRepeat=0,this.m_nFrameIndex=0}function CLZWEncoder(t,e,o,r){this.m_nW=t,this.m_nH=e,this.m_pData=o,this.m_nInitCodeSize=Math.max(2,r),this.m_nRemaining=0,this.m_nCurPixel=0,this.m_aHashTable=[],this.m_nInitBits=0,this.m_bClear=!1,this.m_nBits=0,this.m_nMaxCode=0,this.m_nEofCode=0,this.m_nFreeEntry=0,this.m_nCurAccum=0,this.m_nCurBits=0,this.m_aMasks=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],this.m_nCount=0,this.m_aAccum=[]}function CBoardPoint(t,e){this.m_eValue=void 0===t?BOARD_EMPTY:t,this.m_nNum=void 0===e?-1:e}function CAreaScoreCounter(){this.m_oArea={},this.m_nOwner=BOARD_EMPTY}function CLogicBoard(t,e){this.m_nW=void 0===t?15:t,this.m_nH=void 0===e?15:e,this.m_aBoard=null,this.private_InitBoard(),this.m_aBoardScores=[],this.m_oArea=new CAreaScoreCounter}function CKifuLogicBoard(){CKifuLogicBoard.superclass.constructor.call(this,1,1),this.m_aRepetitions=null}function CStreamWriter(){this.m_pData=null,this.m_pImageData=null,this.m_nLength=0,this.m_nPos=0,this.Init()}function CStreamReader(t,e){this.m_pData=t,this.m_nSize=e,this.m_nPos=0}function CMove(t,e){this.m_nValue=t,this.m_nType=e}function CNodeIdCounter(){this.m_nCounter=0}function CNode(t){this.m_sId=g_oIdCounter.Get_NextId(),this.m_oGameTree=t,this.m_oHandler=t?t.Get_Handler():null,this.m_aNext=[],this.m_nNextCur=-1,this.m_oPrev=null,this.m_aCommands=[],this.m_oMove=new CMove(0,BOARD_EMPTY),this.m_sComment="",this.m_oNavInfo={X:-1,Y:-1,Num:-1},this.m_bLoaded=!1,this.m_oColorMap={},this.m_nMoveNumber=-1,this.m_bOrigin=!1}function CSgfReader(t){this.m_oGameTree=t,this.m_sSGF=[],this.m_nPos=0,this.m_nVariantDepth=0,this.m_arrVariant=[],this.m_bValidNode=!0,this.m_nLength=0,this.m_oViewPort={X0:100,Y0:100,X1:-1,Y1:-1},this.m_eEncoding=ESgfEncoding.None,this.m_oColorTable=null}function CFileReaderBase(t){this.m_oGameTree=t,this.m_sFile=[],this.m_nPos=0,this.m_nSize=0}function CSgfWriter(){this.m_sFile=null,this.m_oGameTree=null,this.m_oColorTable=null}function CDrawingBoard(t){this.m_oDrawing=t,this.m_oGameTree=null,this.m_oLogicBoard=null,this.m_eMode=EBoardMode.Move,this.m_bRulers=g_oGlobalSettings.Is_Rulers(),this.m_dKoeffOffsetY=0,this.m_dKoeffOffsetX=0,this.m_dKoeffCellW=0,this.m_dKoeffCellH=0,this.m_dKoeffDiam=0,this.m_oBoardPosition={},this.m_oCreateWoodyId=null,this.m_bBlackWhiteLastMark=!1,this.m_oImageData={W:0,H:0,W2:0,H2:0,StoneDiam:0,ShadowOff:0,HandiRad:2,Lines:null,Handi:null,Board:null,BlackStone:null,WhiteStones:new Array,WhiteStones2:new Array(361),BlackTarget:null,WhiteTarget:null,ResizeBoard:null,X_Black:null,X_White:null,Tr_Black:null,Tr_White:null,Tr_Hint:null,Sq_Black:null,Sq_White:null,Ter_Black:null,Ter_White:null,Ter_Black2:null,Ter_White2:null,LastMove:null,Cr_Black:null,Cr_White:null,RcolorTarget:null,GcolorTarget:null,BcolorTarget:null,AcolorTarget:null},this.m_oVariantsColor=new CColor(255,0,0,128),this.HtmlElement={Control:null,Board:{Control:null},Lines:{Control:null},Stones:{Control:null},Colors:{Control:null},Shadow:{Control:null},Variants:{Control:null},Marks:{Control:null},Select:{Control:null},Target:{Control:null},Event:{Control:null},LinkedControls:[]},this.m_oTarget=new CBoardTarget(this.m_oImageData,this),this.m_oColorMarks={},this.m_oMarks={},this.m_oLastMoveMark=-1,this.m_oHints={},this.m_oViewPort={X0:0,Y0:0,X1:18,Y1:18},this.m_oViewPortSelection={Start:!1,StartX:-1,StartY:-1,EndX:-1,EndY:-1},this.m_oEventsCatcher=null,this.m_oPresentation=null,this.m_bMouseDown=!1;var e=this;this.private_OnMouseMove=function(t){check_MouseMoveEvent(t);var o=e.private_UpdateMousePos(global_mouseEvent.X,global_mouseEvent.Y);o=e.private_GetBoardPosByXY(o.X,o.Y),e.private_MoveTarget(o.X,o.Y,global_mouseEvent,!1),e.private_HandleMouseMove(o.X,o.Y,global_mouseEvent)},this.private_OnMouseOut=function(t){check_MouseMoveEvent(t),!0===e.m_bMouseDown&&(e.m_bMouseDown=!1,e.private_OnMouseUp(t)),e.private_HideTarget()},this.private_OnMouseDown=function(t){check_MouseDownEvent(t,!0),e.m_bMouseDown=!0,e.HtmlElement.Event.Control.HtmlElement.focus();var o=e.private_UpdateMousePos(global_mouseEvent.X,global_mouseEvent.Y);return o=e.private_GetBoardPosByXY(o.X,o.Y),e.private_HandleMouseDown(o.X,o.Y,global_mouseEvent),t.preventDefault(),!1},this.private_OnMouseUp=function(t){check_MouseMoveEvent(t),e.m_bMouseDown=!1;var o=e.private_UpdateMousePos(global_mouseEvent.X,global_mouseEvent.Y);o=e.private_GetBoardPosByXY(o.X,o.Y),e.private_HandleMouseUp(o.X,o.Y,global_mouseEvent)},this.private_OnMouseWheel=function(t){if(e.m_bMouseLock)return!1;var o=0;return o=void 0!=t.wheelDelta?t.wheelDelta:-t.detail,o<0?e.m_oGameTree.Step_Forward(1):e.m_oGameTree.Step_Backward(1),t.preventDefault&&t.preventDefault(),!1},this.private_OnKeyDown=function(t){check_KeyboardEvent(t);var o=!1;return 16===global_keyboardEvent.KeyCode&&EBoardMode.AddRemove===e.Get_Mode()?(global_mouseEvent.ShiftKey=!0,e.private_UpdateTargetType(),o=!0):16!==global_keyboardEvent.KeyCode&&17!==global_keyboardEvent.KeyCode||EBoardMode.AddMarkColor!==e.Get_Mode()?!0===(o=e.private_HandleKeyDown(global_keyboardEvent))&&112<=global_keyboardEvent.KeyCode&&global_keyboardEvent.KeyCode<=121?e.private_UpdateTargetType():!0===o&&e.private_HideTarget():(16===global_keyboardEvent.KeyCode?global_mouseEvent.ShiftKey=!0:17===global_keyboardEvent.KeyCode&&(global_mouseEvent.CtrlKey=!0),e.private_UpdateTargetType(),o=!0),!0===o&&t.preventDefault(),!o},this.private_OnKeyUp=function(t){check_KeyboardEvent(t),16===global_keyboardEvent.KeyCode&&EBoardMode.AddRemove===e.Get_Mode()?(global_mouseEvent.ShiftKey=!1,e.private_UpdateTargetType()):16!==global_keyboardEvent.KeyCode&&17!==global_keyboardEvent.KeyCode||EBoardMode.AddMarkColor!==e.Get_Mode()||(16===global_keyboardEvent.KeyCode?global_mouseEvent.ShiftKey=!1:17===global_keyboardEvent.KeyCode&&(global_mouseEvent.CtrlKey=!1),e.private_UpdateTargetType())},this.private_OnKeyPress=function(t){},this.private_StartDrawingTimer=function(){return setTimeout(function(){e.private_CreateTrueColorBoard(),e.private_CreateLines(),e.private_CreateTrueColorStones(),e.private_CreateShadows(),e.private_CreateMarks(),e.private_OnResize(),e.m_oImageData.ResizeBoard=e.Get_FullImage(!0)},20)},this.private_OnDragover=function(t){return t.preventDefault(),!1},this.private_OnDrop=function(t){if(t.preventDefault(),t.dataTransfer.files.length>0&&FileReader){var o=t.dataTransfer.files[0],r=o.name.split(".").pop().toLowerCase(),i=new FileReader;i.onload=function(t){e.m_oGameTree.Load_Sgf(t.target.result,null,null,r)},i.readAsText(o),e.Focus()}},this.private_OnContextMenu=function(t){return t.preventDefault(),!1}}function CBoardTarget(t,e){this.m_oDrawingBoard=e,this.m_nLogicX=-1,this.m_nLogicY=-1,this.m_oHtmlElement=null,this.m_eType=EBoardTargetType.Unknown,this.m_nSize=-1,this.m_oImageData=t}function CDrawingButtonBase(t){this.m_oDrawing=t,this.m_oGameTree=t?t.Get_GameTree():null,this.m_nState=EDrawingButtonState.Normal,this.m_nState2=EDrawingButtonState2.AutoPlayStopped,this.m_bSelected=!1,this.m_oImageData={Disabled:null,Normal:null,Hover:null,Active:null,Selected:null},this.HtmlElement={Control:null,Canvas:{Control:null}},this.m_oNormaBColor=new CColor(0,0,0,51),this.m_oNormaFColor=new CColor(255,255,255,255),this.m_oHoverBColor=new CColor(0,0,0,102),this.m_oHoverFColor=new CColor(255,255,255,255),this.m_oActiveBColor=new CColor(0,0,0,153),this.m_oActiveFColor=new CColor(255,255,255,255),this.m_oDisabledBColor=new CColor(0,0,0,0),this.m_oDisabledFColor=new CColor(140,140,140,255),this.m_oSelectedBColor=new CColor(0,0,0,77),this.m_nW=0,this.m_nH=0,this.m_nLoadReady=0;var e=this;this.private_OnMouseDown=function(t){EDrawingButtonState.Disabled!==e.m_nState&&(check_MouseDownEvent(t,!0),e.m_nState=EDrawingButtonState.Active,e.private_UpdateState(),t.stopImmediatePropagation(),e.private_ClickTransformIn())},this.private_OnMouseUp=function(t){if(EDrawingButtonState.Disabled!==e.m_nState){if(global_mouseEvent.Sender!==t.target)return;e.m_nState=EDrawingButtonState.Hover,e.private_UpdateState(),e.private_HandleMouseDown(),t.stopImmediatePropagation()}e.private_OnFocus(),e.private_ClickTransformOut()},this.private_OnMouseOver=function(t){EDrawingButtonState.Disabled!==e.m_nState&&(EDrawingButtonState.Active!==e.m_nState&&(e.m_nState=EDrawingButtonState.Hover),e.private_UpdateState())},this.private_OnMouseOut=function(t){EDrawingButtonState.Disabled!==e.m_nState&&(e.m_nState=e.m_bSelected?EDrawingButtonState.Selected:EDrawingButtonState.Normal,e.private_UpdateState(),e.private_ClickTransformOut())},this.private_OnFocus=function(){!e.m_oGameTree||e instanceof CDrawingButtonGameInfo||e.m_oGameTree.Focus()},this.private_OnDragStart=function(t){t.dataTransfer.effectAllowed="all",t.dataTransfer.setData("text/sgf","(;SZ[19];)")}}function CDrawingButtonBackwardToStart(t){CDrawingButtonBackwardToStart.superclass.constructor.call(this,t),this.m_oImage=this.private_AddImageToLoad("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3wwTDRIczM2u5QAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAA80lEQVRYw+3XMYqFMBQF0JshlYgg8hqXIELERrfgAmaVA65DYQrTuASbIIKIVSBTDQy/m59A/od3+8AhvNxHBACM44hXyQdeLAxiEIMY9HYgIvoehsG1beve4oaklOi6ztV17aKDpJTo+96VZYk8z5GmaTzQL4aIsO87tNbiuq44oEfMsiziPM84MxQS4w0KjfEGKaUcEeG+b6zr+uWL8QZprYUxBkmSoKqqzyzL4oKstZimSRhjUBQFmqZxvijvoQ6NCvLsQ6KCFeMjSinlojb1X9S2bTiOA880tQy9XK21mOdZPHte8EeRQQxiEIMY9L/8AMSPglq/uMNKAAAAAElFTkSuQmCC"),this.m_oImageDisabled=this.private_AddImageToLoad("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3wwTDRcMrA1KxAAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAA6UlEQVRYw+3XPQqEMBAF4Jdgr52VYBpvIlZWoodUUll5Ae+gjYKVnb1gttrFakGdJYGd1Al8+XvDAI4NAQDDMDgDkq6dEIMYxKC/A3lXF+z7bvq+h1IKaZqKb3PvBK73i122bWt83/9UAqtXprU24zhiXVccx2H3DWmtzTzPiKIIZVkKKaU90BlTVZWw+suoMCQgSsxjUNd1ZpomBEFAgnkMyrJMKKWwbRvqujZOJHVRFCKOYyzLQoIiedSUKLJvT4UiDcYzqmkaYz2p36gkSRCGIe4k9U+Ka57nt9sr7ssYxCAGMYhBF8cLoc5sGgK/ZxQAAAAASUVORK5CYII=")}function CDrawingButtonBackward5(t){CDrawingButtonBackward5.superclass.constructor.call(this,t),this.m_oImage=this.private_AddImageToLoad("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3wwTDRwVK5I7zwAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAAcUlEQVRYw+3VwQnAIAyFYVu6UJbqDB0vh9xFcA7xHALpCAptpbXvO77TDwENAQAAfkBECjPvvfujYoyuql5r9Z59SIyqekrJW/uwmJyzt3bETBuzfv7NedXJEDVV1F1fx3Y1iIgWESlmdvTsAAAAszsB2vBQahKN40YAAAAASUVORK5CYII="),this.m_oImageDisabled=this.private_AddImageToLoad("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3wwTDSMBaZbFjgAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAA80lEQVRYw+3XvQqDMBQF4HNtcBOsc0fBB9DB53dScHB1cepWcMkWxNulFilU1Cb9457xLPlIokkIt7Rti08mSRIAgIcvi4AEJCAB/QXIGMPDMPCsOj7pn+VkDaS15qIo0DQNmO9jH+b9ipytgLTWXFUVmBlxHIOIpv4y79+yZBNmHEekaYowDGmpXxu1F1OWJZgZWZYhiiJa6p3OkEvMZpBrzO//h4IgoDzPQUSo6xp93/NS/5YZco3atWQuUbv3kCvUS5t6PnjXdfej47HfErLxDDLGsOd5UErRmn7pGaRsfKq+79OWXi5oAhKQgAQkIIu5AvJV2EqdOHDMAAAAAElFTkSuQmCC")}function CDrawingButtonBackward(t){CDrawingButtonBackward.superclass.constructor.call(this,t),this.m_oImage=this.private_AddImageToLoad("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3wwTDSUz9xsziAAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAAxUlEQVRYw+3VIQ7DMAwF0J+ppHABQSEhISVBPdLOsKvsEr1NSKQoKi0oq0IqdbQabN0lquwTPNnfthiGATXVA5UVgxjEIAbdDqSUmqWUrypAxpit7/unc+7Ttm1ZkDFm67oOADCOI3LO5UB7TAgBMUZRbGS/mBCCKBZqaswp0BWYe92hlJLw3gMArLWw1m7FO3QF6vTIqFEkGaJEkYV6j9Ja4+jraCg3JKUklmWZ13V9H30dDfXaTtMk+Q4xiEEMYhCD/lhfy3RcBznfWwkAAAAASUVORK5CYII="),this.m_oImageDisabled=this.private_AddImageToLoad("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3wwTDSgeB2oRsAAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAAx0lEQVRYw+3XMQqEMBAF0D8h2AniGbyBFp7fSiGFrY1HsEkXxL/VwtY6bkTmHyA8kskPEQBYlgVPicPDYiADGchArwOllLjvOx8BijFyGAbM8wySeUExRk7TBJJomgYikg/0xRzHgbZtUVWVnF3La2DGcQRJdF2Huq4l21BrYy6B7sC8q4fKspS+7yEiCCFg2zZm36E7UJePTBulMkOaKLWh/kWt63r66RDtb1BKic45eO9P1YDXvrZFUYj1kIEMZCADGeiP+QAy+XDf76BlKwAAAABJRU5ErkJggg==")}function CDrawingButtonForward(t){CDrawingButtonForward.superclass.constructor.call(this,t),this.m_oImage=this.private_AddImageToLoad("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3wwTDSkJnaKlNgAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAAxUlEQVRYw+3WIQ7DIBQG4L8NBiQCVVODqeFU21V6he0QPUsNhqQh2AossrsDvKVseb8n+QL8D4Zt29BTRnQWBjGIQQz6WZDW+mGMydQgUbNISgnn3EspBe/9FWMcbt2hUgpSSgCAZVkwz/N1+5EdxzGEEMhRTZc6hECOam4ZNYqk9pSo/xyM1trLWgsA8N6jZQyMPWGaQdSYJtA3MNUgKSWmaSLHVL9lpRTs+/4UQqzneeouWpZzflNj+IPGIAYxiEEMqsgHyjhf9O2e3l4AAAAASUVORK5CYII="),this.m_oImageDisabled=this.private_AddImageToLoad("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3wwTDSgxrLss6QAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAAyUlEQVRYw+3VsQqDUAwF0JvycBPEbxBcBR38ficFB1cXP8HFTSS3U3/Al9LXNtkDB5KbyLquSKXqusYDiZWDHOQgB30t6LounufJJEAksSwLhmHAcRz8OEhEUFUVSGKaJlPU7ZEVRSFt20JVTVFRS12WpXRdB1XFOI4mqOiUvVAkTVAmsbdE/eZh3Ped8zxDRND3PfI8l4+BLDHRIGtMFOgdmKjXsW2bOQYAwt3X0TQNVBVZlollysLtxhAk2dg7yEEOcpCD/gn0BPdVbmFsgto0AAAAAElFTkSuQmCC")}function CDrawingButtonForward5(t){CDrawingButtonForward5.superclass.constructor.call(this,t),this.m_oImage=this.private_AddImageToLoad("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3wwTDSQ2nmr2RgAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAAZUlEQVRYw+3VMQrAIAyFYelhe84M7kHwHMU5S3qAVnCxpOH/xrfkQdCUAgBIRETOWuu1mm83xnAzc1X1lXy71pqb2WP4LP9E7/11+CynVPpSR5o/KdTKKPOblxXudIQ7rgAABHQDS2dNsnKXx6sAAAAASUVORK5CYII="),this.m_oImageDisabled=this.private_AddImageToLoad("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3wwTDSQYQrz7iQAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAAxElEQVRYw+2VPQuDMBCG30j/QIduHQP5AQr6/5cQyBAQBxenbl0C2b0uOhQSxI8ULfdM4eXgHnJHAjAMwzAXoe/751JN13XUti1N9fdYvpfbfFBKvZaKnXPw3sNaSwAesbyqKrFHqFhTLKUEEcEYgxDCO5ZPsr8RqutalGWJcRy/mqfyLWy6Xq01WWshhEDTNJjHlMqzC+WU2rWAOaSKsz0//zGyUy11TpnVQrllVi/1MAzRpqk8O6lP9MjPlWEYhmGuzgcvy8ThfV4IDQAAAABJRU5ErkJggg==")}function CDrawingButtonForwardToEnd(t){CDrawingButtonForwardToEnd.superclass.constructor.call(this,t),this.m_oImage=this.private_AddImageToLoad("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3wwTDRAjSJ3hWgAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAABBElEQVRYw+3WwYmFMBAG4D8PvUgIiKYJERQv2oJXYatcsA4Pqxh42EQQIQQPImRr2DyzesgUMHyZyUwCPCxI3/ePwXRdh9fTKuRBHuRBHnRFVFVl2rY1nPOffwHleW7qujZBEFx+mD9npJQijmOkaYowDM0wDOQ8z/taprWGEIKs6wrOOZqmubRSVi1TSmGeZyco60vtCvXRlLlAfTz2Siksy/K97zs45yiKwtwKYowhy7KvKIogpYQQgtwGYoyhLEuTJAmklLhiBbyehLEGucJYgSilKIrCCcbq6dBaY9s2HMeBcRwvxViBAOD9fhM4isBF0mmayG17yP8YPciDPMiDHMcvBCGFxBHbK9gAAAAASUVORK5CYII="),this.m_oImageDisabled=this.private_AddImageToLoad("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3wwTDQ4kArhLJgAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAA9UlEQVRYw+3WsY6FIBAF0CtQWNjTEWw0Uf+/9x/URBsNVnQmdhqZ1+wPLMo+s2H6S85MYALwskrGcXwNpixLsLdNKIIiKIIi6IkyxlDbtnSe59+ArLU0TROFaEb8NuCcg7UWxhgcx0FN0yRfBTHGUNd1QkS0LAsAPIoSPiHOOX4Qj6OEbzAUStwJh0CJux1xzlFVVbLvO83zjCzLiDH2vT10XReGYaBt25DnObTWtybE7mK6rqN1XaG1xhN3iL0J4w0KhfECOefQ930QjPemllIiTVMURfEoxvvZSykTKWWQ74cIcahSKlFKxQ9aBEVQBEXQv6wPn1Z3S2AlDhEAAAAASUVORK5CYII=")}function CDrawingButtonNextVariant(t){CDrawingButtonNextVariant.superclass.constructor.call(this,t)}function CDrawingButtonPrevVariant(t){CDrawingButtonPrevVariant.superclass.constructor.call(this,t)}function CDrawingButtonEditModeMove(t){CDrawingButtonEditModeMove.superclass.constructor.call(this,t)}function CDrawingButtonEditModeAddRem(t){CDrawingButtonEditModeAddRem.superclass.constructor.call(this,t)}function CDrawingButtonEditModeTr(t){CDrawingButtonEditModeTr.superclass.constructor.call(this,t)}function CDrawingButtonEditModeSq(t){CDrawingButtonEditModeSq.superclass.constructor.call(this,t)}function CDrawingButtonEditModeCr(t){CDrawingButtonEditModeCr.superclass.constructor.call(this,t)}function CDrawingButtonEditModeX(t){CDrawingButtonEditModeX.superclass.constructor.call(this,t)}function CDrawingButtonEditModeText(t){CDrawingButtonEditModeText.superclass.constructor.call(this,t)}function CDrawingButtonEditModeNum(t){CDrawingButtonEditModeNum.superclass.constructor.call(this,t)}function CDrawingButtonAutoPlay(t){CDrawingButtonAutoPlay.superclass.constructor.call(this,t)}function CDrawingButtonClose(t){CDrawingButtonClose.superclass.constructor.call(this,t)}function CDrawingButtonGameInfo(t){CDrawingButtonGameInfo.superclass.constructor.call(this,t)}function CDrawingButtonOK(t){CDrawingButtonOK.superclass.constructor.call(this,t)}function CDrawingButtonCancel(t){CDrawingButtonCancel.superclass.constructor.call(this,t)}function CDrawingButtonSettings(t){CDrawingButtonSettings.superclass.constructor.call(this,t),this.m_oTransformCanvas=null}function CDrawingButtonPass(t){CDrawingButtonPass.superclass.constructor.call(this,t)}function CDrawingButtonAbout(t){CDrawingButtonAbout.superclass.constructor.call(this,t)}function CDrawingButtonTabComments(t){CDrawingButtonTabComments.superclass.constructor.call(this,t)}function CDrawingButtonTabNavigator(t){CDrawingButtonTabNavigator.superclass.constructor.call(this,t)}function CDrawingButtonBoardMode(t){CDrawingButtonBoardMode.superclass.constructor.call(this,t);var e=t.Get_MainDiv(),o=this;this.m_nWidth=373,this.m_nHeight=40;var r=document.createElement("div");r.id=e.id+"ButtonBoardModeToolbarWrapper",r.style.position="absolute",r.style.top="100px",r.style.left="100px",r.style.width=this.m_nWidth+"px",r.style.height=this.m_nHeight+"px",r.style.background="rgb(217, 217, 217)",r.style.display="block",r.style.border="1px solid rgb(166, 166, 166)",r.style.boxShadow="0px 1px 15px rgba(0,0,0,0.8)",r.style.opacity=0,r.style.overflowY="hidden",r.style.boxSizing="border-box",r.onclick=function(){o.Hide_Toolbar()},e.appendChild(r);var i=document.createElement("div");i.id=e.id+"ButtonBoardModeToolbar",i.style.position="absolute",i.style.top="1px",i.style.left="1px",i.style.right="1px",i.style.bottom="1px",r.appendChild(i),this.m_oButtonMove=new CDrawingButtonEditModeMove(t),this.m_oButtonAddRem=new CDrawingButtonEditModeAddRem(t),this.m_oButtonTr=new CDrawingButtonEditModeTr(t),this.m_oButtonSq=new CDrawingButtonEditModeSq(t),this.m_oButtonCr=new CDrawingButtonEditModeCr(t),this.m_oButtonX=new CDrawingButtonEditModeX(t),this.m_oButtonText=new CDrawingButtonEditModeText(t),this.m_oButtonNum=new CDrawingButtonEditModeNum(t),this.m_oButtonColor=new CDrawingButtonEditModeColor(t);var a=new CDrawingToolbar(t);a.Add_Control(this.m_oButtonMove,36,1,EToolbarFloat.Left),a.Add_Control(this.m_oButtonAddRem,36,1,EToolbarFloat.Left),a.Add_Control(this.m_oButtonTr,36,1,EToolbarFloat.Left),a.Add_Control(this.m_oButtonSq,36,1,EToolbarFloat.Left),a.Add_Control(this.m_oButtonCr,36,1,EToolbarFloat.Left),a.Add_Control(this.m_oButtonX,36,1,EToolbarFloat.Left),a.Add_Control(this.m_oButtonText,36,1,EToolbarFloat.Left),a.Add_Control(this.m_oButtonNum,36,1,EToolbarFloat.Left),a.Add_Control(this.m_oButtonColor,36,1,EToolbarFloat.Left),a.Init(i.id,t.Get_GameTree()),a.Update_Size(),r.style.display="none",this.m_oToolbarElement=r,this.m_nTransitionId=null,this.m_nTop=0,r.style.transitionProperty="opacity,top,height",r.style.transitionDuration="1s",r.style.transitionTimingFunction="cubic-bezier(0,0,0,1)",r.style.transitionDelay="0s",this.m_eMode=null,this.m_nShowToolbarId=null}function CDrawingButtonEditModeColor(t){CDrawingButtonEditModeText.superclass.constructor.call(this,t)}function CDrawingButtonToolbarCustomize(t,e){CDrawingButtonEditModeText.superclass.constructor.call(this,t),this.m_oImage=this.private_AddImageToLoad("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAICAYAAADJEc7MAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3wwVDQAZ4Th1ZQAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAAkUlEQVQY033PsRHDIAwF0A+nitILUHCnhoapklW8QrZhBBo1NDRULEEak3OwsSpO0pOEijG+QgifWityzgoP4Zzr1lqklN5ERLsxBswMAH2FmbkfPSCiXbfWNhEZRTBzf0IigtbapgGglKJWeEalFAUANBqORPfe/84eg2b0Bxf4FgGAnv9zPnuFLhvnzaf3Jb5oPFaLEyr1tgAAAABJRU5ErkJggg=="),this.m_oTransformCanvas=null,this.m_oMultiLevelToolbar=e;var o=t.Get_MainDiv(),r=window.g_oLocalization?window.g_oLocalization.gameRoom.toolbarCustomization.mainNavigation:"Main navigation",i=window.g_oLocalization?window.g_oLocalization.gameRoom.toolbarCustomization.treeNavigation:"Tree navigation",a=window.g_oLocalization?window.g_oLocalization.gameRoom.toolbarCustomization.generalToolbar:"General toolbar",n=window.g_oLocalization?window.g_oLocalization.gameRoom.toolbarCustomization.autoplay:"Autoplay toolbar",s=window.g_oLocalization?window.g_oLocalization.gameRoom.toolbarCustomization.timelinePanel:"Timeline panel",l=window.g_oLocalization?window.g_oLocalization.gameRoom.toolbarCustomization.kifuMode:"Kifu mode";this.m_nWidth=160,this.m_nHeight=134,g_oTextMeasurer&&(g_oTextMeasurer.SetFont('16px "Times New Roman", Times, serif'),this.m_nWidth=33+Math.max(g_oTextMeasurer.Measure(r),g_oTextMeasurer.Measure(i),g_oTextMeasurer.Measure(a),g_oTextMeasurer.Measure(n),g_oTextMeasurer.Measure(s),g_oTextMeasurer.Measure(l))+7);var m=document.createElement("div");m.id=o.id+"ToolbarCustomizeWrapper",m.style.position="absolute",m.style.top="100px",m.style.left="100px",m.style.width=this.m_nWidth+"px",m.style.height=this.m_nHeight+"px",m.style.background="rgb(255, 255, 255)",m.style.display="block",m.style.border="1px solid rgb(166, 166, 166)",m.style.boxShadow="0px 1px 15px rgba(0,0,0,0.8)",m.style.overflowY="hidden",o.appendChild(m),m.style.transitionProperty="height",m.style.transitionDuration="0.2s",m.style.transitionDelay="0s",m.style.display="none",this.m_oContextMenuElement=m,this.m_nTransitionId=null,this.m_nShowId=null;var _=document.createElement("ul");_.style.padding="5px 0",_.style.margin="2px 0 0",_.style.listStyle="none",_.style.fontSize="16px",_.style.backgroundClip="padding-box",_.style.lineHeight="20px",this.m_oMainNavigationCheckElement=this.private_CreateListItem(_,r,function(){t.Toggle_MultiLevelToolbarMainNavigation()},g_oGlobalSettings.Is_MultiLevelToolbarMainNavigation()),this.m_oTreeNavigationCheckElement=this.private_CreateListItem(_,i,function(){t.Toggle_MultiLevelToolbarTreeNavigation()},g_oGlobalSettings.Is_MultiLevelToolbarTreeNavigation()),this.m_oGeneralCheckElement=this.private_CreateListItem(_,a,function(){t.Toggle_MultiLevelToolbarGeneral()},g_oGlobalSettings.Is_MultiLevelToolbarGeneral()),this.m_oAutoPlayCheckElement=this.private_CreateListItem(_,n,function(){t.Toggle_MultiLevelToolbarAutoPlay()},g_oGlobalSettings.Is_MultiLevelToolbarAutoPlay()),this.m_oTimelineCheckElement=this.private_CreateListItem(_,s,function(){t.Toggle_MultiLevelToolbarTimeline()},g_oGlobalSettings.Is_MultiLevelToolbarTimeline()),this.m_oKifuModeCheckElement=this.private_CreateListItem(_,l,function(){t.Toggle_MultiLevelToolbarKifuMode()},g_oGlobalSettings.Is_MultiLevelToolbarKifuMode()),m.appendChild(_)}function CDrawingButtonFileMenu(t){CDrawingButtonFileMenu.superclass.constructor.call(this,t);var e=t.Get_MainDiv(),o=t.Get_GameTree(),r=document.createElement("div");r.style.position="absolute",r.style.top="40px",r.style.width="200px",r.style.backgroundColor="white",r.style.borderWidth="1px",r.style.borderColor="#b3b3b3",r.style.borderStyle="solid",r.style.padding="0px",r.style.boxShadow="0px 0px 2px 0px rgba(0,0,0,0.3)",r.style.opacity="1",r.style.zIndex="10",r.style.overflowX="hidden",r.style.overflowY="hidden",r.style.maxHeight="calc(100vh - 90px)",r.style.transitionProperty="height",r.style.transitionDuration="0.2s",r.style.transitionDelay="0s",this.m_oMainDiv=e,this.m_oMenuElement=r,this.m_nHeight=r.clientHeight,this.m_nWidth=r.clientWidth,this.m_nTransitionId=null,this.m_nShowId=null,this.m_oGameTree=o,this.InitDefaultMenu(!1),e.appendChild(r),r.style.display="none"}function CDrawingButtonKifuWindow(t){CDrawingButtonKifuWindow.superclass.constructor.call(this,t)}function CDrawingButtonKifuMode(t){CDrawingButtonKifuWindow.superclass.constructor.call(this,t)}function CDrawingButtonSimpleText(t,e,o){CDrawingButtonSimpleText.superclass.constructor.call(this,null),this.m_oNormaBColor=new CColor(234,234,234,255),this.m_oNormaFColor=new CColor(172,172,172,255),this.m_oHoverBColor=new CColor(227,240,252,255),this.m_oHoverFColor=new CColor(126,180,234,255),this.m_oActiveBColor=new CColor(207,230,252,255),this.m_oActiveFColor=new CColor(86,157,229,255),this.m_oDisabledBColor=new CColor(239,239,239,255),this.m_oDisabledFColor=new CColor(217,217,217,255),this.m_sText=t||"",this.m_sHint=o||"",this.m_fHandler=e||null}function CDrawingComments(t){this.m_oDrawing=t,this.m_oGameTree=null,this.HtmlElement={Control:null,TextArea:{Control:null}};var e=this;this.private_OnValueChange=function(){e.private_OnChangeComment()}}function CDrawingPlayerInfo(t){this.m_oDrawing=t,this.m_nPlayer=BOARD_EMPTY,this.m_oGameTree=null,this.HtmlElement={Control:null,NameDiv:null,PassCountDiv:null,Image:null},this.m_oImage=null,this.m_sName="",this.m_sRank="",this.m_dPassCount=0}function CDrawingViewerTitle(t){this.m_oDrawing=t,this.m_oGameTree=null,this.HtmlElement={Control:null,TitleDiv:null},this.m_sTitle="White vs. Black"}function CControlBounds(){this.L=0,this.T=0,this.R=0,this.B=0,this.isAbsL=!1,this.isAbsT=!1,this.isAbsR=!1,this.isAbsB=!1,this.AbsW=-1,this.AbsH=-1}function CControlContainer(){this.Bounds=new CControlBounds,this.Anchor=g_anchor_left|g_anchor_top,this.Name=null,this.Parent=null,this.TabIndex=null,this.HtmlElement=null,this.AbsolutePosition=new CControlBounds,this.Controls=new Array,this.width=0,this.height=0,this.Type=0,this.DrawingElement=null,this.RMin=400}function CreateControlContainer(t){var e=new CControlContainer;return e.Name=t,e.HtmlElement=document.getElementById(t),e}function CreateControlContainerByElement(t){var e=new CControlContainer;return e.HtmlElement=t,e}function CControlContainerBoardAndBottomButtons(){this.Parent=null,this.HtmlElement=null,this.H=0,this.Controls=new Array}function CSettingsBase(){this.m_oBoardPr={bTrueColorBoard:!0,bTrueColorStones:!0,oBoardColor:new CColor(231,188,95,255),bShellWhiteStones:!0,bShadows:!0,oWhiteColor:new CColor(255,255,255,255),oBlackColor:new CColor(0,0,0,255),oLinesColor:new CColor(0,0,0,255),bDarkBoard:!1},this.m_oNavigatorPr={bTrueColorBoard:!0,bTrueColorStones:!0,oBoardColor:new CColor(231,188,95,255),bShadows:!0,oWhiteColor:new CColor(255,255,255,255),oBlackColor:new CColor(0,0,0,255),oLinesColor:new CColor(0,0,0,255),bDarkBoard:!1}}function CSettings(){CSettings.superclass.constructor.call(this),this.m_bSound=!0,this.m_bLoadUnfinishedFilesOnLastNode=!1,this.m_bRulers=!1,this.m_bCycleThroughVariants=!1,this.m_eNavigatorLabels=ESettingsNavigatorLabels.MoveNumbers,this.m_eLoadShowVariants=ESettingsLoadShowVariants.FromFile,this.m_bShowTarget=!0,this.m_bMultiLevelToolbarMainNavigation=!0,this.m_bMultiLevelToolbarTreeNavigation=!0,this.m_bMultiLevelToolbarGeneral=!0,this.m_bMultiLevelToolbarAutoPlay=!0,this.m_bMultiLevelToolbarTimeline=!0,this.m_bMultiLevelToolbarKifuMode=!0}function CLocalSetting(t){CLocalSetting.superclass.constructor.call(this),this.m_oBoardPr={bTrueColorBoard:null,bTrueColorStones:null,oBoardColor:null,bShellWhiteStones:null,bShadows:null,oWhiteColor:null,oBlackColor:null,oLinesColor:null,bDarkBoard:null},this.m_oNavigatorPr={bTrueColorBoard:null,bTrueColorStones:null,oBoardColor:null,bShadows:null,oWhiteColor:null,oBlackColor:null,oLinesColor:null,bDarkBoard:null},this.m_oGameTree=t,this.m_bShowTarget=null,this.m_bEmbedding=!1}function CDrawing(t){this.m_oGameTree=t,t&&t.Set_Drawing(this),this.m_oMainDiv=null,this.m_oMainControl=null,this.m_oDisableElement=null,this.m_oControl=null,this.m_aElements=[],this.m_oButtons={BackwardToStart:[],Backward_5:[],Backward:[],Forward:[],Forward_5:[],ForwardToEnd:[],NextVariant:[],PrevVariant:[],Pass:null,BoardModeMove:[],BoardModeEditor:[],BoardModeTr:[],BoardModeSq:[],BoardModeCr:[],BoardModeX:[],BoardModeText:[],BoardModeNum:[],BoardModeColor:[],ToolbarCustomize:null,Menu:null,KifuMode:null,EditorControl:null},this.m_oWindows={Kifu:null},this.m_oAddLabelElement=null,this.m_oBoard=null,this.m_oNavigator=null,this.m_oTimeLine=null,this.m_oAutoPlayButton=null,this.m_oAutoPlaySlider=null,this.m_oSelectBoardModeButton=null,this.m_oBlackInfo=null,this.m_oWhiteInfo=null,this.m_oViewerTitle=null,this.m_aComments=[];var e=this;this.m_bNeedUpdateSize=!0,this.m_eTemplateType=EDrawingTemplate.None,this.m_bMixedTemplate=!1,this.m_nMixedTemplateIndex=-1,this.m_nMixedRightSide=400,this.m_nMixedBotSize=200,this.m_nMinWidth=-1,this.m_nViewerTitleH=0,this.m_nViewerToolbarH=0,this.m_nVerEditorTitleH=0,this.m_nVerEditorToolbarH=0,this.m_nVerEditorComNavH=0,this.m_arrStateHandlers=[],this.m_nAnimationFrameTimer=null,this.private_OnMainDivClick=function(){e.m_oSelectBoardModeButton&&e.m_oSelectBoardModeButton.Hide_Toolbar(),e.m_oButtons.ToolbarCustomize&&e.m_oButtons.ToolbarCustomize.Hide_ContextMenu(!1),e.m_oButtons.Menu&&e.m_oButtons.Menu.Hide_Menu(!1),e.m_oButtons.EditorControl&&e.m_oButtons.EditorControl.Hide_Menu(!1)},this.private_OnTimerDraw=function(){null!==e.m_nAnimationFrameTimer&&(Common_CancelAnimationFrame(e.m_nAnimationFrameTimer),e.m_nAnimationFrameTimer=null),e.m_nAnimationFrameTimer=Common_RequestAnimationFrame(e.private_OnTimerDraw),e.m_oNavigator&&e.m_oNavigator.Need_Redraw()&&e.m_oNavigator.Draw(),e.m_bNeedUpdateSize&&e.private_UpdateSize(!1)},this.private_OnTimerDraw()}function CDrawingFullInfo(){this.m_oGameTree=null,this.HtmlElement={Control:null}}function CMouseEventHandler(){this.X=0,this.Y=0,this.Button=g_mouse_button_left,this.Type=g_mouse_event_type_move,this.AltKey=!1,this.CtrlKey=!1,this.ShiftKey=!1,this.Sender=null,this.LastClickTime=-1,this.ClickCount=0,this.WheelDelta=0,this.IsPressed=!1,this.LastX=0,this.LastY=0,this.KoefPixToMM=1,this.IsLocked=!1,this.buttonObject=null,this.LockMouse=function(){return!this.IsLocked&&(this.IsLocked=!0,!0)},this.UnLockMouse=function(){return!!this.IsLocked&&(this.IsLocked=!1,!0)}}function CKeyboardEvent(){this.AltKey=!1,this.CtrlKey=!1,this.ShiftKey=!1,this.Sender=null,this.CharCode=0,this.KeyCode=0}function check_KeyboardEvent(t){global_keyboardEvent.AltKey=t.altKey,void 0!==t.metaKey?global_keyboardEvent.CtrlKey=t.ctrlKey||t.metaKey:global_keyboardEvent.CtrlKey=t.ctrlKey,global_keyboardEvent.ShiftKey=t.shiftKey,global_keyboardEvent.Sender=t.srcElement?t.srcElement:t.target,global_keyboardEvent.CharCode=t.charCode,global_keyboardEvent.KeyCode=t.keyCode,global_keyboardEvent.Which=t.which}function check_MouseMoveEvent(t){return!global_mouseEvent.IsLocked&&(t.pageX||t.pageY?(global_mouseEvent.X=t.pageX,global_mouseEvent.Y=t.pageY):(t.clientX||t.clientY)&&(global_mouseEvent.X=t.clientX,global_mouseEvent.Y=t.clientY),global_mouseEvent.AltKey=t.altKey,global_mouseEvent.ShiftKey=t.shiftKey,global_mouseEvent.CtrlKey=t.ctrlKey||t.metaKey,global_mouseEvent.Type=g_mouse_event_type_move,global_mouseEvent.IsLocked||(global_mouseEvent.Sender=t.srcElement?t.srcElement:t.target),(Math.abs(global_mouseEvent.X-global_mouseEvent.LastX)>3||Math.abs(global_mouseEvent.Y-global_mouseEvent.LastY)>3)&&(global_mouseEvent.LastClickTime=-1,global_mouseEvent.ClickCount=0),!0)}function check_MouseDownEvent(t,e){if(t.pageX||t.pageY?(global_mouseEvent.X=t.pageX,global_mouseEvent.Y=t.pageY):(t.clientX||t.clientY)&&(global_mouseEvent.X=t.clientX,global_mouseEvent.Y=t.clientY),global_mouseEvent.LastX=global_mouseEvent.X,global_mouseEvent.LastY=global_mouseEvent.Y,global_mouseEvent.AltKey=t.altKey,global_mouseEvent.ShiftKey=t.shiftKey,global_mouseEvent.CtrlKey=t.ctrlKey||t.metaKey,global_mouseEvent.Type=g_mouse_event_type_down,global_mouseEvent.Button=t.button,global_mouseEvent.Sender=t.srcElement?t.srcElement:t.target,e){var o=(new Date).getTime();0==global_mouseEvent.ClickCount?(global_mouseEvent.ClickCount=1,global_mouseEvent.LastClickTime=o):500>o-global_mouseEvent.LastClickTime?(global_mouseEvent.LastClickTime=o,global_mouseEvent.ClickCount++):(global_mouseEvent.ClickCount=1,global_mouseEvent.LastClickTime=o)}else global_mouseEvent.LastClickTime=-1,global_mouseEvent.ClickCount=1;window.g_bIsMouseUpLockedSend=!1}function InitCaptureEvents(){window.onmousemove=function(t){return Window_OnMouseMove(t)},window.onmouseup=function(t){return Window_OnMouseUp(t)}}function Window_OnMouseMove(t){global_mouseEvent.IsLocked&&void 0!=global_mouseEvent.Sender&&null!=global_mouseEvent.Sender&&void 0!=global_mouseEvent.Sender.onmousemove&&null!=global_mouseEvent.Sender.onmousemove&&global_mouseEvent.Sender.onmousemove(t)}function Window_OnMouseUp(t){!1===window.g_bIsMouseUpLockedSend&&(window.g_bIsMouseUpLockedSend=!0,global_mouseEvent.IsLocked&&global_mouseEvent.Sender&&void 0!=global_mouseEvent.Sender.onmouseup&&null!=global_mouseEvent.Sender.onmouseup&&global_mouseEvent.Sender.onmouseup(t,!0),global_mouseEvent.Sender=null)}function CInterfaceState(){this.Backward=!0,this.Forward=!0,this.NextVariant=!0,this.PrevVariant=!0,this.BoardMode=EBoardMode.Move,this.TimelinePos=0,this.AutoPlaySpeed=null}function CDrawingMark(t,e,o,r){this.m_oPos={X:void 0===t?0:t,Y:void 0==e?0:e},this.m_nType=void 0===o?EDrawingMark.Tr:o,this.m_sText=void 0===r?"":r}function CDrawingNavigator(t){function e(){if(r.m_bMouseLock)r.m_nHorScrollBlurTimerId=null;else{var t=parseFloat(r.HtmlElement.HorScroll.style.opacity),o=parseFloat(r.HtmlElement.HorScrollBG.style.opacity);t=Math.max(t-i,0),o=Math.max(o-i,0),r.HtmlElement.HorScroll.style.opacity=t,r.HtmlElement.HorScrollBG.style.opacity=o,r.m_nHorScrollBlurTimerId=t>.001?setTimeout(e,10):null}}function o(){if(r.m_bMouseLock)r.m_nHorScrollBlurTimerId=null;else{var t=parseFloat(r.HtmlElement.VerScroll.style.opacity),e=parseFloat(r.HtmlElement.VerScrollBG.style.opacity);t=Math.max(t-i,0),e=Math.max(e-i,0),r.HtmlElement.VerScroll.style.opacity=t,r.HtmlElement.VerScrollBG.style.opacity=e,r.m_nVerScrollBlurTimerId=t>.001?setTimeout(o,10):null}}this.m_oDrawing=t,this.m_oGameTree=null,this.m_oMap=new CNavigatorMap,this.m_bNeedRedrawCurrent=!0,this.m_bNeedRedrawMap=!0,this.m_bNeedRedrawGameCurrent=!0,this.HtmlElement={Control:null,Board:{Control:null},Selection:{Control:null},Current:{Control:null},Lines:{Control:null},Shadows:{Control:null},Nodes:{Control:null},Events:{Control:null},HorScroll:null,VerScroll:null,HorScrollBG:null,VerScrollBG:null,ScrollW:0,ScrollH:0},this.m_oCreateWoodyId=null,this.m_oImageData={W:0,H:0,Board:null,Black:null,White:null,BlackT:null,WhiteT:null,Hor_Start:null,Hor_Start2:null,Hor:null,Hor2:null,Hor_End:null,Ver:null,Ver2:null,Ver3:null,Hor_Start_T:null,Hor_Start2_T:null,Hor_Start2_T_2:null,Hor_Start2_T_3:null,Hor_T:null,Hor2_T:null,Hor2_T_2:null,Hor2_T_3:null,Hor_End_T:null,Ver_T:null,Ver2_T:null,Ver2_T_2:null,Ver2_T_3:null,Ver3_T:null,Triangle:null,Triangle_T:null,Triangle_B:null,Triangle_W:null,Triangle_BT:null,Triangle_WT:null,Target:null,Current:null,GameCurrent:null,Shadow:null,ShadowOff:0},this.m_oOffset={X:0,Y:0},this.m_bMouseLock=!1,this.m_bNavigatorScroll=!0,this.m_oLastDrawMap={W:0,H:0,X:0,Y:0},this.m_nHorScrollTimerId=null,this.m_nVerScrollTimerId=null,this.m_nHorScrollBlurTimerId=null,this.m_nVerScrollBlurTimerId=null;var r=this,i=.01;this.private_StartDrawingTimer=function(){return setTimeout(function(){r.private_CreateTrueColorBoard()},20)},this.private_OnMouseDown=function(t){if(!r.m_bMouseLock){r.m_oGameTree&&r.m_oGameTree.Focus(),check_MouseDownEvent(t,!0);var e=r.private_UpdateMousePos(global_mouseEvent.X,global_mouseEvent.Y),o=r.m_oMap.Get(e.X,e.Y);o.Is_Node()&&r.m_oGameTree&&r.m_oGameTree.GoTo_Node(o)}},this.private_OnMouseMove=function(t){if(!r.m_bMouseLock){check_MouseMoveEvent(t);var e=r.private_UpdateMousePos(global_mouseEvent.X,global_mouseEvent.Y);r.private_UpdateTarget(e.X,e.Y)}},this.private_OnMouseOut=function(t){r.m_bMouseLock||r.private_UpdateTarget(-1,-1)},this.private_OnMouseWheel=function(t){if(r.m_bMouseLock)return!1;var e=0;e=void 0!=t.wheelDelta?t.wheelDelta>0?-45:45:t.detail>0?45:-45,t.preventDefault&&t.preventDefault();var i=e,a=20+24*(r.m_oMap.Get_Height()+1)-r.HtmlElement.Board.Control.HtmlElement.height;return r.m_oOffset.Y-=i,r.m_oOffset.Y=Math.min(0,Math.max(r.m_oOffset.Y,-a)),r.private_DrawMap(),r.private_OnMouseMove(t),r.private_UpdateScrollsPos(),r.private_ClearVerScrollBlurTimer(),r.HtmlElement.VerScrollBG.style.opacity=.3,r.HtmlElement.VerScroll.style.opacity=.5,r.m_nVerScrollBlurTimerId=setTimeout(o,500),!1},this.private_OnFocus=function(){r.m_oGameTree&&r.m_oGameTree.Focus()},this.private_ClearHorScrollTimer=function(){null!==r.m_nHorScrollTimerId&&(clearTimeout(r.m_nHorScrollTimerId),r.m_nHorScrollTimerId=null)},this.private_ClearHorScrollBlurTimer=function(){null!==r.m_nHorScrollBlurTimerId&&(clearTimeout(r.m_nHorScrollBlurTimerId),r.m_nHorScrollBlurTimerId=null)},this.private_OnMouseDownHorScrollBG=function(t){function e(t){var o=-r.m_oOffset.X;o!==m?(o=o<m?Math.min(m,o+l):Math.max(m,o-l),r.m_oOffset.X=-o,r.private_DrawMap(),r.private_UpdateScrollsPos(),r.m_nHorScrollTimerId=o!==m?setTimeout(e,!0===t?300:30):null):r.m_nHorScrollTimerId=null}r.private_ClearHorScrollTimer(),check_MouseDownEvent(t,!0);var o=Common_FindPosition(r.HtmlElement.HorScrollBG),i=global_mouseEvent.X-o.X,a=r.m_oMap.Get_Width()+1,n=r.HtmlElement.ScrollW,s=r.m_oImageData.W-4;i-=n/2;var l=200,m=(i=Math.max(0,Math.min(s-n,i)))/(s-n)*(20+24*a-s);e(!0)},this.private_OnMouseUpHorScrollBG=function(t){r.private_ClearHorScrollTimer()},this.private_OnMouseOverHorScrollBG=function(){r.private_ClearHorScrollBlurTimer(),r.HtmlElement.HorScrollBG.style.opacity=.3,r.HtmlElement.HorScroll.style.opacity=.5},this.private_OnMouseOutHorScrollBG=function(){r.private_ClearHorScrollTimer(),r.m_nHorScrollBlurTimerId=setTimeout(e,10)},this.private_ClearVerScrollTimer=function(){null!==r.m_nVerScrollTimerId&&(clearTimeout(r.m_nVerScrollTimerId),r.m_nVerScrollTimerId=null)},this.private_ClearVerScrollBlurTimer=function(){null!==r.m_nVerScrollBlurTimerId&&(clearTimeout(r.m_nVerScrollBlurTimerId),r.m_nVerScrollBlurTimerId=null)},this.private_OnMouseDownVerScrollBG=function(t){function e(t){var o=-r.m_oOffset.Y;o!==m?(o=o<m?Math.min(m,o+l):Math.max(m,o-l),r.m_oOffset.Y=-o,r.private_DrawMap(),r.private_UpdateScrollsPos(),r.m_nVerScrollTimerId=o!==m?setTimeout(e,!0===t?300:30):null):r.m_nVerScrollTimerId=null}r.private_ClearVerScrollTimer(),check_MouseDownEvent(t,!0);var o=Common_FindPosition(r.HtmlElement.VerScrollBG),i=global_mouseEvent.Y-o.Y,a=r.m_oMap.Get_Height()+1,n=r.HtmlElement.ScrollH,s=r.m_oImageData.H-4;i-=n/2;var l=48,m=(i=Math.max(0,Math.min(s-n,i)))/(s-n)*(20+24*a-s);e(!0)},this.private_OnMouseUpVerScrollBG=function(t){r.private_ClearVerScrollTimer()},this.private_OnMouseOverVerScrollBG=function(){r.private_ClearVerScrollBlurTimer(),r.HtmlElement.VerScrollBG.style.opacity=.3,r.HtmlElement.VerScroll.style.opacity=.5},this.private_OnMouseOutVerScrollBG=function(){r.private_ClearVerScrollTimer(),r.m_nVerScrollBlurTimerId=setTimeout(o,10)},this.private_OnMouseOverHorScroll=function(){r.private_ClearHorScrollBlurTimer(),r.HtmlElement.HorScroll.style.opacity=.7,r.HtmlElement.HorScrollBG.style.opacity=.3},this.private_OnMouseOutHorScroll=function(){r.private_ClearHorScrollTimer(),r.m_nHorScrollBlurTimerId=setTimeout(e,10)},this.private_OnMouseOverVerScroll=function(){r.private_ClearVerScrollBlurTimer(),r.HtmlElement.VerScroll.style.opacity=.7,r.HtmlElement.VerScrollBG.style.opacity=.3},this.private_OnMouseOutVerScroll=function(){r.HtmlElement.VerScroll.style.opacity=.5,r.m_nVerScrollBlurTimerId=setTimeout(o,10)},this.private_OnDragStartScroll=function(){r.m_bMouseLock=!0},this.private_OnDragEndScroll=function(){r.m_bMouseLock=!1;var t=global_mouseEvent.X,i=global_mouseEvent.Y,a=Common_FindPosition(r.HtmlElement.HorScrollBG),n=a.X,s=a.Y,l=r.HtmlElement.HorScrollBG.clientWidth,m=r.HtmlElement.HorScrollBG.clientHeight;(t<n||t>n+l||i<s||i>s+m)&&(r.m_nHorScrollBlurTimerId=setTimeout(e,10));var _=Common_FindPosition(r.HtmlElement.VerScrollBG),h=_.X,d=_.Y,p=r.HtmlElement.VerScrollBG.clientWidth,u=r.HtmlElement.VerScrollBG.clientHeight;(t<h||t>h+p||i<d||i>d+u)&&(r.m_nVerScrollBlurTimerId=setTimeout(o,10))},this.private_OnDragHorScroll=function(t,e){t-=2;var o=r.m_oMap.Get_Width()+1,i=r.HtmlElement.ScrollW,a=r.m_oImageData.W,n=t/(a-4-i)*(20+24*o-a);r.m_oOffset.X=-n,r.private_DrawMap()},this.private_OnDragVerScroll=function(t,e){e-=2;var o=r.m_oMap.Get_Height()+1,i=r.HtmlElement.ScrollH,a=r.m_oImageData.H,n=e/(a-4-i)*(20+24*o-a);r.m_oOffset.Y=-n,r.private_DrawMap()}}function CNavigatorElement(t,e,o){this.m_nType=t,this.m_oPrev=e,this.m_oNext=o}function CNavigatorMap(){this.m_oMap=[],this.m_oGameTree=null,this.m_nMove=0}function CPresentation(t){this.m_oGameTree=t,t&&t.Set_Drawing(this),this.m_oControl=null,this.m_aElements=[],this.HtmlElement={MessageElement:null,TextElement:null,PrevButton:null,NextButton:null,NextSgf:null,PrevSgf:null,BoardDisabler:null},this.m_nCurSlide=0,this.m_nSlidesCount=0,this.m_nSlideState=0}function CDrawingSlider(t,e){this.m_oDrawing=t,this.m_oGameTree=null,this.m_nType=e||EDrawingSliderType.Unknown,this.HtmlElement={Control:null,Left:null,Right:null,Slider:null},this.m_oBackColor=new CColor(217,217,217,255),this.m_oLeftColor=new CColor(80,80,80,255),this.m_oRightColor=new CColor(190,190,190,255),this.m_oSliderColor=new CColor(80,80,80,255),this.m_oSliderFocusColor=new CColor(130,130,130,255),this.m_nW=0,this.m_dPos=0,this.m_nSize=0,this.m_nOffsetY=17,this.m_nOffsetX=17,this.m_bPosLock=!1;var o=this;this.private_OnDrag=function(t,e){var r=o.m_nW-o.m_nSize;0!==r&&(o.private_UpdatePos((t-o.m_nOffsetX)/r,!1),o.private_HandleOnChange(!1))},this.private_OnDragStart=function(t,e){o.m_bPosLock=!0,o.private_HandleOnChange(!1)},this.private_OnDragEnd=function(t,e){o.m_bPosLock=!1;var r=o.m_nW-o.m_nSize;0!==r&&(o.private_UpdatePos((t-o.m_nOffsetX)/r,!1),o.private_HandleOnChange(!0))}}function CBoardSound(){this.PlaceStone=null,this.NewMessage=null,this.Tick=null,this.TickLast3=null,this.Beep=null,this.BeepBeep=null,this.Challenger=null,this.PrevCountDownTime=null,this.m_bIE=!1,this.m_bOn=!0}function CDrawingToolbar(t){this.m_oDrawing=t,this.m_oGameTree=null,this.HtmlElement={Control:null},this.m_oBColor=new CColor(217,217,217,255),this.m_aControls=[],this.m_aDrawingControls=[]}function CDrawingNavigatorCommentsTabs(t){this.m_oDrawing=t,this.m_oGameTree=null,this.HtmlElement={Control:null,Comments:{Control:null},Navgiator:{Control:null}},this.m_oBColor=new CColor(217,217,217,255),this.m_oNavigatorButton=null,this.m_oCommentsButton=null,this.m_oNavigatorDiv=null,this.m_oCommentsDiv=null,this.m_aControls=[]}function CDrawingToolbarItem(t,e,o,r){this.m_oControl=t,this.m_nW=e,this.m_nSpace=o,this.m_eAlign=r}function CDrawingMultiLevelToolbar(t){this.m_oDrawing=t,this.HtmlElement={Control:null,SettingsControl:null,SettingsElement:null,GeneralControl:null,GeneralElement:null,AutoPlayControl:null,AutoPlayElement:null,TimelineControl:null,TimelineElement:null,GeneralNavigationElement:null,GeneralNavigationControl:null,TreeNavigationControl:null,TreeNavigationElement:null,KifuModeElement:null,KifuModeControl:null},this.m_bGeneralNavigation=g_oGlobalSettings.Is_MultiLevelToolbarMainNavigation(),this.m_bTreeNavigation=g_oGlobalSettings.Is_MultiLevelToolbarTreeNavigation(),this.m_bGeneralToolbar=g_oGlobalSettings.Is_MultiLevelToolbarGeneral(),this.m_bAutoPlayToolbar=g_oGlobalSettings.Is_MultiLevelToolbarAutoPlay(),this.m_bTimelimeToolbar=g_oGlobalSettings.Is_MultiLevelToolbarTimeline(),this.m_bKifuModeToolbar=g_oGlobalSettings.Is_MultiLevelToolbarKifuMode(),this.m_nW=-1,this.m_nH=-1,this.m_nLineHeight=36,this.m_nLineSpace=1,this.m_nSettingsWidth=110,this.m_oSettingsToolbar=new CDrawingToolbar(t),this.m_oSettingsToolbar.Add_Control(new CDrawingButtonAbout(t),36,1,EToolbarFloat.Left),this.m_oDrawing&&this.m_oDrawing.Get_GameTree()&&!0!==this.m_oDrawing.Get_GameTree().Get_LocalSettings().Is_Embedding()?this.m_oSettingsToolbar.Add_Control(new CDrawingButtonSettings(t),36,1,EToolbarFloat.Left):this.m_nSettingsWidth=73,this.m_oSettingsToolbar.Add_Control(new CDrawingButtonToolbarCustomize(t,this),36,1,EToolbarFloat.Left),this.m_oGeneralNavigation=new CDrawingToolbar(t),this.m_oGeneralNavigation.Add_Control(new CDrawingButtonBackwardToStart(t),36,1,EToolbarFloat.Left),this.m_oGeneralNavigation.Add_Control(new CDrawingButtonBackward5(t),36,1,EToolbarFloat.Left),this.m_oGeneralNavigation.Add_Control(new CDrawingButtonBackward(t),36,1,EToolbarFloat.Left),this.m_oGeneralNavigation.Add_Control(new CDrawingButtonForward(t),36,1,EToolbarFloat.Left),this.m_oGeneralNavigation.Add_Control(new CDrawingButtonForward5(t),36,1,EToolbarFloat.Left),this.m_oGeneralNavigation.Add_Control(new CDrawingButtonForwardToEnd(t),36,1,EToolbarFloat.Left),this.m_oTreeNavigation=new CDrawingToolbar(t),this.m_oTreeNavigation.Add_Control(new CDrawingButtonNextVariant(t),36,1,EToolbarFloat.Left),this.m_oTreeNavigation.Add_Control(new CDrawingButtonPrevVariant(t),36,1,EToolbarFloat.Left),this.m_oGeneralToolbar=new CDrawingToolbar(t),this.m_oGeneralToolbar.Add_Control(new CDrawingButtonPass(t),73,1,EToolbarFloat.Left),this.m_oGeneralToolbar.Add_Control(new CDrawingButtonBoardMode(t),36,1,EToolbarFloat.Left),this.m_oGeneralToolbar.Add_Control(new CDrawingButtonGameInfo(t),36,1,EToolbarFloat.Left),this.m_oAutoPlayToolbar=new CDrawingToolbar(t),this.m_oAutoPlayToolbar.Add_Control(new CDrawingButtonAutoPlay(t),36,1,EToolbarFloat.Left),this.m_oAutoPlayToolbar.Add_Control(new CDrawingSlider(t,EDrawingSliderType.AutoPlaySpeed),-1,1,EToolbarFloat.Left),this.m_oTimelineToolbar=new CDrawingToolbar(t),this.m_oTimelineToolbar.Add_Control(new CDrawingSlider(t,EDrawingSliderType.Timeline),-1,1,EToolbarFloat.Left),this.m_oKifuToolbar=new CDrawingToolbar(t),this.m_oKifuToolbar.Add_Control(new CDrawingButtonKifuWindow(t),36,1,EToolbarFloat.Left),this.m_oKifuToolbar.Add_Control(new CDrawingButtonKifuMode(t),36,1,EToolbarFloat.Left),this.m_nLevelsCount=1,this.m_aElements=[],this.m_pOnChangeCallback=null}function CDrawingVerticalTabs(){this.m_aTabs=[],this.m_oCurTab=null,this.m_aContens=[]}function CDrawingWindow(){this.HtmlElement={Control:null,InnerDiv:null,InnerControl:null,CloseButton:null,Caption:null,CaptionText:null,CaptionTextControl:null,HandlerL:null,HandlerR:null,HandlerB:null,HandlerT:null,HandlerLT:null,HandlerRT:null,HandlerLB:null,HandlerRB:null},this.m_oOuterBorderColor=new CColor(166,166,166,255),this.m_oInnerBorderColor=new CColor(185,185,185,255),this.m_oBackColor=new CColor(217,217,217,255),this.m_oDrawing=null,this.m_nW=-1,this.m_nH=-1,this.m_bVisible=!1,this.m_sWindowId=null;var t=this;this.private_OnDragLeftHandler=function(){var e=parseInt(t.HtmlElement.Control.HtmlElement.style.left),o=parseInt(t.HtmlElement.Control.HtmlElement.style.width),r=parseInt(t.HtmlElement.HandlerL.style.left);o-r<60?t.HtmlElement.HandlerL.style.left="0px":(t.HtmlElement.Control.HtmlElement.style.left=e+r+"px",t.HtmlElement.Control.HtmlElement.style.width=o-r+"px",t.HtmlElement.HandlerL.style.left="0px"),t.Update_Size()},this.private_OnDragRightHandler=function(){var e=parseInt(t.HtmlElement.Control.HtmlElement.style.width),o=parseInt(t.HtmlElement.HandlerR.style.left)+6-e;e+o<60?t.HtmlElement.HandlerR.style.left=e-6+"px":(t.HtmlElement.Control.HtmlElement.style.width=e+o+"px",t.HtmlElement.HandlerR.style.left=e+o-6+"px",t.Update_Size())},this.private_OnDragBottomHandler=function(){var e=parseInt(t.HtmlElement.Control.HtmlElement.style.height),o=parseInt(t.HtmlElement.HandlerB.style.top)+6-e;e+o<60?t.HtmlElement.HandlerB.style.top=e-6+"px":(t.HtmlElement.Control.HtmlElement.style.height=e+o+"px",t.HtmlElement.HandlerB.style.top=e+o-6+"px",t.Update_Size())},this.private_OnDragTopHandler=function(){var e=parseInt(t.HtmlElement.Control.HtmlElement.style.top),o=parseInt(t.HtmlElement.Control.HtmlElement.style.height),r=parseInt(t.HtmlElement.HandlerT.style.top);o-r<60?t.HtmlElement.HandlerT.style.top="0px":(t.HtmlElement.Control.HtmlElement.style.top=e+r+"px",t.HtmlElement.Control.HtmlElement.style.height=o-r+"px",t.HtmlElement.HandlerT.style.top="0px",t.Update_Size())},this.private_OnDragLeftTopHandler=function(){var e=parseInt(t.HtmlElement.Control.HtmlElement.style.top),o=parseInt(t.HtmlElement.Control.HtmlElement.style.height),r=parseInt(t.HtmlElement.HandlerLT.style.top);o-r<60?t.HtmlElement.HandlerLT.style.top="0px":(t.HtmlElement.Control.HtmlElement.style.top=e+r+"px",t.HtmlElement.Control.HtmlElement.style.height=o-r+"px",t.HtmlElement.HandlerLT.style.top="0px");var i=parseInt(t.HtmlElement.Control.HtmlElement.style.left),a=parseInt(t.HtmlElement.Control.HtmlElement.style.width),n=parseInt(t.HtmlElement.HandlerLT.style.left);a-n<60?t.HtmlElement.HandlerLT.style.left="0px":(t.HtmlElement.Control.HtmlElement.style.left=i+n+"px",t.HtmlElement.Control.HtmlElement.style.width=a-n+"px",t.HtmlElement.HandlerLT.style.left="0px"),t.Update_Size()},this.private_OnDragRightTopHandler=function(){var e=parseInt(t.HtmlElement.Control.HtmlElement.style.top),o=parseInt(t.HtmlElement.Control.HtmlElement.style.height),r=parseInt(t.HtmlElement.HandlerRT.style.top);o-r<60?t.HtmlElement.HandlerRT.style.top="0px":(t.HtmlElement.Control.HtmlElement.style.top=e+r+"px",t.HtmlElement.Control.HtmlElement.style.height=o-r+"px",t.HtmlElement.HandlerRT.style.top="0px");var i=parseInt(t.HtmlElement.Control.HtmlElement.style.width),a=parseInt(t.HtmlElement.HandlerRT.style.left)+6-i;i+a<60?t.HtmlElement.HandlerRT.style.left=i-6+"px":(t.HtmlElement.Control.HtmlElement.style.width=i+a+"px",t.HtmlElement.HandlerRT.style.left=i+a-6+"px"),t.Update_Size()},this.private_OnDragLeftBottomHandler=function(){var e=parseInt(t.HtmlElement.Control.HtmlElement.style.left),o=parseInt(t.HtmlElement.Control.HtmlElement.style.width),r=parseInt(t.HtmlElement.HandlerLB.style.left);o-r<60?t.HtmlElement.HandlerLB.style.left="0px":(t.HtmlElement.Control.HtmlElement.style.left=e+r+"px",t.HtmlElement.Control.HtmlElement.style.width=o-r+"px",t.HtmlElement.HandlerLB.style.left="0px");var i=parseInt(t.HtmlElement.Control.HtmlElement.style.height),a=parseInt(t.HtmlElement.HandlerLB.style.top)+6-i;i+a<60?t.HtmlElement.HandlerLB.style.top=i-6+"px":(t.HtmlElement.Control.HtmlElement.style.height=i+a+"px",t.HtmlElement.HandlerLB.style.top=i+a-6+"px"),t.Update_Size()},this.private_OnDragRightBottomHandler=function(){var e=parseInt(t.HtmlElement.Control.HtmlElement.style.width),o=parseInt(t.HtmlElement.HandlerRB.style.left)+6-e;e+o<60?t.HtmlElement.HandlerRB.style.left=e-6+"px":(t.HtmlElement.Control.HtmlElement.style.width=e+o+"px",t.HtmlElement.HandlerRB.style.left=e+o-6+"px");var r=parseInt(t.HtmlElement.Control.HtmlElement.style.height);r+(o=parseInt(t.HtmlElement.HandlerRB.style.top)+6-r)<60?t.HtmlElement.HandlerRB.style.top=r-6+"px":(t.HtmlElement.Control.HtmlElement.style.height=r+o+"px",t.HtmlElement.HandlerRB.style.top=r+o-6+"px"),t.Update_Size()}}function CDrawingConfirmWindow(){CDrawingConfirmWindow.superclass.constructor.call(this),this.HtmlElement.OKButton=null,this.HtmlElement.CancelButton=null,this.HtmlElement.OkButtonControl=null,this.HtmlElement.CancelButtonControl=null,this.HtmlElement.OkCancelDiv=null,this.HtmlElement.ConfirmInnerDiv=null,this.HtmlElement.ConfirmInnerControl=null}function CDrawingInfoWindow(){CDrawingInfoWindow.superclass.constructor.call(this),this.HtmlElement2={},this.m_oGameTree=null,this.m_nBottomOffset=10,this.m_nRowHeight=20,this.m_nLineSpacing=5,this.m_nLeftWidth=100}function CDrawingErrorWindow(){CDrawingErrorWindow.superclass.constructor.call(this),this.m_nW=300,this.m_nH=100,this.m_oMainElement=null}function CDrawingSettingsWindow(){CDrawingSettingsWindow.superclass.constructor.call(this),this.m_oGameTree=null,this.HtmlElement2={Theme:{TrueColor:null,SimpleColor:null,BookStyle:null,Dark:null},Sound:null,LoadUnfinishedSgf:null,NavigatorLabel:null,CycleThroughVariants:null,LoadShowVariants:null,ShowTarget:null}}function CDrawingCountColorsWindow(){CDrawingCountColorsWindow.superclass.constructor.call(this),this.m_nLeftWidth=100}function CDrawingGifWriterWindow(){CDrawingGifWriterWindow.superclass.constructor.call(this),this.m_oProgressSliderElement=null,this.m_oProgressValueElement=null,this.m_oDrawing=null,this.m_oGameTree=null}function CDrawingAboutWindow(){CDrawingAboutWindow.superclass.constructor.call(this),this.m_oDrawingBoard=null}function CDrawingDiagramSLWindow(){CDrawingDiagramSLWindow.superclass.constructor.call(this),this.m_oTextArea=null}function CDrawingViewPortWindow(){CDrawingViewPortWindow.superclass.constructor.call(this),this.m_oButtonReset=null}function CDrawingCreateNewWindow(){CDrawingCreateNewWindow.superclass.constructor.call(this)}function CDrawingClipboardWindow(){CDrawingClipboardWindow.superclass.constructor.call(this),this.m_oTextArea=null}function CDrawingKifuWindow(){CDrawingKifuWindow.superclass.constructor.call(this),this.m_nKifuW=-1,this.m_nKifuH=-1,this.m_nMoveMin=-1,this.m_nMoveMax=-1,this.m_nNextW=72}function CreateWindow(t,e,o){g_aWindows[t]||(g_aWindows[t]={});var r=g_aWindows[t];if(r[e])return(s=r[e]).Show(o),s;var i="unknownwindow";switch(e){case EWindowType.GameInfo:i="Info";break;case EWindowType.Settings:i="Settings";break;case EWindowType.Error:i="Error";break;case EWindowType.CountColors:i="CountColors";break;case EWindowType.GifWriter:i="GifWriter";break;case EWindowType.About:i="About";break;case EWindowType.DiagramSL:i="DiagramSL";break;case EWindowType.ViewPort:i="ViewPort";break;case EWindowType.CreateNew:i="CreateNew";break;case EWindowType.Clipboard:i="Clipboard";break;case EWindowType.Kifu:i="Kifu"}var a=t+i+RenjuBoardApi.Get_Version(),n=document.createElement("div");if(n.setAttribute("id",a),n.setAttribute("style","position:absolute;padding:0;margin:0;width:500px;height:500px;left:300px;top:300px;"),n.setAttribute("oncontextmenu","return false;"),o.Drawing){o.Drawing.Get_MainDiv().appendChild(n);var s=null;switch(e){case EWindowType.GameInfo:s=new CDrawingInfoWindow;break;case EWindowType.Settings:s=new CDrawingSettingsWindow;break;case EWindowType.Error:s=new CDrawingErrorWindow;break;case EWindowType.CountColors:s=new CDrawingCountColorsWindow;break;case EWindowType.GifWriter:s=new CDrawingGifWriterWindow;break;case EWindowType.About:s=new CDrawingAboutWindow;break;case EWindowType.DiagramSL:s=new CDrawingDiagramSLWindow;break;case EWindowType.ViewPort:s=new CDrawingViewPortWindow;break;case EWindowType.CreateNew:s=new CDrawingCreateNewWindow;break;case EWindowType.Clipboard:s=new CDrawingClipboardWindow;break;case EWindowType.Kifu:s=new CDrawingKifuWindow}return r[e]=s,null!==s&&(s.Init(a,o),s.Update_Size(!0)),s}return null}CRenjuBoardApi.prototype.Create_GameTree=function(){return new CGameTree},CRenjuBoardApi.prototype.Create_SimpleBoard=function(t,e){new CDrawing(t).Create_SimpleBoard(e)},CRenjuBoardApi.prototype.Create_Viewer=function(t,e,o){var r=new CDrawing(t);!0===o?r.Create_ViewerForBooklet(e):r.Create_Viewer(e)},CRenjuBoardApi.prototype.Create_EditorVer=function(t,e){new CDrawing(t).Create_VerticalFullTemplate(e)},CRenjuBoardApi.prototype.Create_EditorHor=function(t,e){new CDrawing(t).Create_HorizontalFullTemplate(e)},CRenjuBoardApi.prototype.Create_BoardWithNavigateButtons=function(t,e){new CDrawing(t).Create_BoardWithNavigateButtons(e)},CRenjuBoardApi.prototype.Create_BoardCommentsButtonsNavigator=function(t,e){new CDrawing(t).Create_MixedFullTemplate(e)},CRenjuBoardApi.prototype.Create_Presentation=function(t,e,o){new CPresentation(t).Init(e,o)},CRenjuBoardApi.prototype.Create_Problems=function(t,e,o){new CDrawing(t).Create_Problems(e);var r=.3;o.TutorTime&&(r=parseFloat(o.TutorTime)),o.TutorColor&&"Black"===o.TutorColor?t.Set_TutorMode(!1,BOARD_BLACK,r):o.TutorColor&&"White"===o.TutorColor?t.Set_TutorMode(!1,BOARD_WHITE,r):t.Set_TutorMode(!0,BOARD_EMPTY,r),t.Forbid_All(),void 0!==o.NewNode&&(t.Set_EditingFlags({NewNode:!0}),t.Set_TutorNewNodeText(o.NewNode));var i=void 0!==o.RightCallback?o.RightCallback:null,a=void 0!==o.WrongCallback?o.WrongCallback:null,n=void 0!==o.ResetCallback?o.ResetCallback:null;t.Set_TutorCallbacks(i,a,n)},CRenjuBoardApi.prototype.Find_ProblemRightVariant=function(t){return t.Find_ProblemRightVariant()},CRenjuBoardApi.prototype.Start_AutoPlay=function(t){t.Start_AutoPlay(!0)},CRenjuBoardApi.prototype.Stop_AutoPlay=function(t){t.Stop_AutoPlay()},CRenjuBoardApi.prototype.Set_Permissions=function(t,e){var o={};o.NewNode=e.NewNode,o.RemoveNodes=e.RemoveNodes,o.Move=e.Move,o.ChangeBoardMode=e.ChangeBoardMode,o.LoadFile=e.LoadFile,o.GameInfo=e.GameInfo,o.ViewPort=e.ViewPort,t.Set_EditingFlags(o)},CRenjuBoardApi.prototype.Load_Sgf=function(t,e,o,r,i){var a={};o&&!0===o.Auto?a.Auto=!0:o&&void 0!==o.X0&&void 0!==o.X1&&void 0!==o.Y0&&void 0!==o.Y1?(a.Auto=!1,a.X0=o.X0,a.X1=o.X1,a.Y0=o.Y0,a.Y1=o.Y1):a=null;var n=t.m_nEditingFlags;t.Reset_EditingFlags(),t.Load_Sgf(e,a,r,i),t.m_nEditingFlags=n},CRenjuBoardApi.prototype.Save_Sgf=function(t){return t.Save_Sgf()},CRenjuBoardApi.prototype.Get_MoveReference=function(t,e,o){var r;return r=1===o?t.Get_StartNode():t.Get_CurNode(),t.Get_NodeReference(e,r)},CRenjuBoardApi.prototype.Set_StartNodeByReference=function(t,e){if(t&&e){var o=t.Get_CurNode();t.GoTo_MoveReference(e),t.Set_StartNode(t.Get_CurNode()),t.GoTo_Node(o,!0)}},CRenjuBoardApi.prototype.Is_Modified=function(t){return t.Is_Modified()},CRenjuBoardApi.prototype.Update_Size=function(t){t.Update_Size()},CRenjuBoardApi.prototype.Get_MatchName=function(t){return t?t.Get_MatchName():"White vs. Black"},CRenjuBoardApi.prototype.Set_Sound=function(t,e){t.Set_Sound(e)},CRenjuBoardApi.prototype.Focus=function(t){t&&t.Focus()},CRenjuBoardApi.prototype.Get_Version=function(){return this.Version},CRenjuBoardApi.prototype.Toggle_Rulers=function(t){t&&t.Toggle_Rulers()},CRenjuBoardApi.prototype.Set_GameTreeHandler=function(t,e){t&&e&&t.Set_Handler(e)},CRenjuBoardApi.prototype.GoTo_Node=function(t,e){t&&t.GoTo_NodeById(e)},CRenjuBoardApi.prototype.GoTo_NodeByMoveNumber=function(t,e){t&&t.GoTo_NodeByMoveNumber(e)},CRenjuBoardApi.prototype.Set_ShowTarget=function(t,e){t&&t.Set_ShowTarget(e,!0)},CRenjuBoardApi.prototype.Set_BoardTheme=function(t,e){if(t){var o=null;"TrueColor"===e?o=EColorScheme.TrueColor:"BookStyle"===e?o=EColorScheme.BookStyle:"Simple"===e?o=EColorScheme.SimpleColor:"Dark"===e&&(o=EColorScheme.Dark),o&&t.Set_LocalColorScheme(o)}},CRenjuBoardApi.prototype.Get_DivHeightByWidth=function(t,e){if(t)return t.Get_DivHeightByWidth(e)},CRenjuBoardApi.prototype.Embed=function(t,e){function o(){var o=document.getElementById(t);if(o){var d={};d.LoadFile=!1,d.GameInfo=!1,d.ChangeBoardMode=!1,d.NewNode=!1,d.Move=!1,d.ViewPort=!1,m.Set_BoardTheme(h,l);var p=400;if("image"===n)m.Create_SimpleBoard(h,t),m.Set_ShowTarget(h,!1),p=600;else if("viewer"==n)m.Create_Viewer(h,t,_),d.Move=!0,p=600;else if("vereditor"===n)m.Create_EditorVer(h,t),d.ChangeBoardMode=!0,d.NewNode=!0,d.Move=!0,p=600;else if("horeditor"===n)m.Create_EditorHor(h,t),d.ChangeBoardMode=!0,d.NewNode=!0,d.Move=!0,p=900;else if("problems"==n){var u={};e.problemsTime&&(u.TutorTime=e.problemsTime),e.problemsColor&&(u.TutorColor=e.problemsColor),e.problemsNewNode&&(u.NewNode=e.problemsNewNode),m.Create_Problems(h,t,u),d=null,p=400,null===i&&((i={}).Auto=!0)}m.Load_Sgf(h,a,i),null!==s&&(p=s);var C=m.Get_DivHeightByWidth(h,p);o.style.width=p+"px",o.style.height=C+"px",-1!==r?m.GoTo_NodeByMoveNumber(h,r):m.GoTo_NodeByMoveNumber(h,0),m.Update_Size(h),d&&m.Set_Permissions(h,d)}}var r=-1,i=null,a=null,n=null,s=null,l="TrueColor",m=this,_=!1,h=this.Create_GameTree();return h.Get_LocalSettings().Set_Embedding(!0),e.viewPort&&(i={},"auto"===e.viewPort?i.Auto=!0:(i.Auto=!1,i.X0=parseInt(e.viewPort.X0),i.X1=parseInt(e.viewPort.X1),i.Y0=parseInt(e.viewPort.Y0),i.Y1=parseInt(e.viewPort.Y1))),e.moveNumber&&(r=parseInt(e.moveNumber)),n=e.boardMode?e.boardMode:"viewer",e.width&&(s=e.width),e.boardTheme&&(l=e.boardTheme),!0===e.booklet&&(_=!0),null!=e.sgfUrl?function(t){t=decodeURIComponent(t);var e=new XMLHttpRequest;e.open("GET",t+"?_="+(new Date).getTime(),!0),e.onreadystatechange=function(){4===e.readyState&&(200!==e.status&&0!=e.status||(a=e.responseText,o()))},e.send(null)}(e.sgfUrl):null!==e.sgfData?(a=e.sgfData,o()):(a="(;FF[4]GM[1]SZ[19])",o()),h},window.RenjuBoardApi=new CRenjuBoardApi,CRenjuBoardApi.prototype.Embed=CRenjuBoardApi.prototype.Embed,CRenjuBoardApi.prototype.Create_GameTree=CRenjuBoardApi.prototype.Create_GameTree,CRenjuBoardApi.prototype.Create_SimpleBoard=CRenjuBoardApi.prototype.Create_SimpleBoard,CRenjuBoardApi.prototype.Create_Viewer=CRenjuBoardApi.prototype.Create_Viewer,CRenjuBoardApi.prototype.Create_EditorHor=CRenjuBoardApi.prototype.Create_EditorHor,CRenjuBoardApi.prototype.Create_EditorVer=CRenjuBoardApi.prototype.Create_EditorVer,CRenjuBoardApi.prototype.Create_BoardWithNavigateButtons=CRenjuBoardApi.prototype.Create_BoardWithNavigateButtons,CRenjuBoardApi.prototype.Create_BoardCommentsButtonsNavigator=CRenjuBoardApi.prototype.Create_BoardCommentsButtonsNavigator,CRenjuBoardApi.prototype.Create_Presentation=CRenjuBoardApi.prototype.Create_Presentation,CRenjuBoardApi.prototype.Create_Problems=CRenjuBoardApi.prototype.Create_Problems,CRenjuBoardApi.prototype.Set_Permissions=CRenjuBoardApi.prototype.Set_Permissions,CRenjuBoardApi.prototype.Load_Sgf=CRenjuBoardApi.prototype.Load_Sgf,CRenjuBoardApi.prototype.Save_Sgf=CRenjuBoardApi.prototype.Save_Sgf,CRenjuBoardApi.prototype.Get_MoveReference=CRenjuBoardApi.prototype.Get_MoveReference,CRenjuBoardApi.prototype.Set_StartNodeByReference=CRenjuBoardApi.prototype.Set_StartNodeByReference,CRenjuBoardApi.prototype.Is_Modified=CRenjuBoardApi.prototype.Is_Modified,CRenjuBoardApi.prototype.Update_Size=CRenjuBoardApi.prototype.Update_Size,CRenjuBoardApi.prototype.Set_Sound=CRenjuBoardApi.prototype.Set_Sound,CRenjuBoardApi.prototype.Find_ProblemRightVariant=CRenjuBoardApi.prototype.Find_ProblemRightVariant,CRenjuBoardApi.prototype.Start_AutoPlay=CRenjuBoardApi.prototype.Start_AutoPlay,CRenjuBoardApi.prototype.Stop_AutoPlay=CRenjuBoardApi.prototype.Stop_AutoPlay,CRenjuBoardApi.prototype.Focus=CRenjuBoardApi.prototype.Focus,CRenjuBoardApi.prototype.Get_MatchName=CRenjuBoardApi.prototype.Get_MatchName,CRenjuBoardApi.prototype.Get_Version=CRenjuBoardApi.prototype.Get_Version,CRenjuBoardApi.prototype.Toggle_Rulers=CRenjuBoardApi.prototype.Toggle_Rulers,CRenjuBoardApi.prototype.Set_GameTreeHandler=CRenjuBoardApi.prototype.Set_GameTreeHandler,CRenjuBoardApi.prototype.GoTo_Node=CRenjuBoardApi.prototype.GoTo_Node,CRenjuBoardApi.prototype.GoTo_NodeByMoveNumber=CRenjuBoardApi.prototype.GoTo_NodeByMoveNumber,CRenjuBoardApi.prototype.Set_ShowTarget=CRenjuBoardApi.prototype.Set_ShowTarget,CRenjuBoardApi.prototype.Get_DivHeightByWidth=CRenjuBoardApi.prototype.Get_DivHeightByWidth,CRenjuBoardApi.prototype.Set_BoardTheme=CRenjuBoardApi.prototype.Set_BoardTheme;var ECommand={Unknown:0,B:1,W:2,MN:3,AB:257,AW:258,AE:259,PL:260,RM:513,CR:529,MA:530,SQ:531,TR:532,LB:533,BL:769,WL:770,OB:771,OW:772,CT:4353,CM:4354};CCommand.prototype.Get_Type=function(){return this.m_nType},CCommand.prototype.Get_Value=function(){return this.m_oValue},CCommand.prototype.Get_Count=function(){return this.m_nCount},CCommand.prototype.Set_Type=function(t){this.m_nType=t},CCommand.prototype.Set_Value=function(t){this.m_oValue=t},CCommand.prototype.Set_Count=function(t){this.m_nCount=t},CCommand.prototype.To_String=function(){return JSON.stringify({Type:this.m_nType,Value:this.m_oValue,Count:this.m_nCount})},CCommand.prototype.From_String=function(t){var e=JSON.parse(t);this.m_nType=e.Type,this.m_oValue=e.Value,this.m_nCount=e.m_nCount},CCommand.prototype.Copy=function(){return new CCommand(this.m_nType,this.m_oValue,this.m_nCount)},CColor.prototype.ToString=function(){return"rgba("+this.r+","+this.g+","+this.b+","+this.a/255+")"},CColor.prototype.Compare=function(t){return this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a},CColor.prototype.Copy=function(){return new CColor(this.r,this.g,this.b,this.a)},CColor.prototype.ToLong=function(){return this.r<<24&4278190080|this.g<<16&16711680|this.b<<8&65280|255&this.a},CColor.prototype.FromLong=function(t){this.r=t>>24&255,this.g=t>>16&255,this.b=t>>8&255,this.a=255&t},CColor.prototype.Set=function(t,e,o){this.r=t,this.g=e,this.b=o};var Common_DragHandler={Obj:null,Init:function(t,e,o,r,i,a,n,s,l,m){t.onmousedown=Common_DragHandler.Start,t.hmode=!n,t.vmode=!s,t.root=e&&null!=e?e:t,t.hmode&&isNaN(parseInt(t.root.style.left))&&(t.root.style.left="0px"),t.vmode&&isNaN(parseInt(t.root.style.top))&&(t.root.style.top="350px"),!t.hmode&&isNaN(parseInt(t.root.style.right))&&(t.root.style.right="0px"),!t.vmode&&isNaN(parseInt(t.root.style.bottom))&&(t.root.style.bottom="0px"),t.minX=void 0!==o?o:null,t.minY=void 0!==i?i:null,t.maxX=void 0!==r?r:null,t.maxY=void 0!==a?a:null,t.xMapper=l||null,t.yMapper=m||null,t.root.onDragStart=function(){},t.root.onDragEnd=function(){},t.root.onDrag=function(){}},Start:function(t){var e=Common_DragHandler.Obj=this;t=Common_DragHandler.FixE(t);var o=parseInt(e.vmode?e.root.style.top:e.root.style.bottom),r=parseInt(e.hmode?e.root.style.left:e.root.style.right);return e.root.onDragStart(r,o),e.lastMouseX=t.clientX,e.lastMouseY=t.clientY,e.hmode?(null!=e.minX&&(e.minMouseX=t.clientX-r+e.minX),null!=e.maxX&&(e.maxMouseX=e.minMouseX+e.maxX-e.minX)):(null!=e.minX&&(e.maxMouseX=-e.minX+t.clientX+r),null!=e.maxX&&(e.minMouseX=-e.maxX+t.clientX+r)),e.vmode?(null!=e.minY&&(e.minMouseY=t.clientY-o+e.minY),null!=e.maxY&&(e.maxMouseY=e.minMouseY+e.maxY-e.minY)):(null!=e.minY&&(e.maxMouseY=-e.minY+t.clientY+o),null!=e.maxY&&(e.minMouseY=-e.maxY+t.clientY+o)),document.onmousemove=Common_DragHandler.Drag,document.onmouseup=Common_DragHandler.End,!1},Drag:function(t){check_MouseMoveEvent(t),t=Common_DragHandler.FixE(t);var e,o,r=Common_DragHandler.Obj,i=t.clientY,a=t.clientX,n=parseInt(r.vmode?r.root.style.top:r.root.style.bottom),s=parseInt(r.hmode?r.root.style.left:r.root.style.right);return null!=r.minX&&(a=r.hmode?Math.max(a,r.minMouseX):Math.min(a,r.maxMouseX)),null!=r.maxX&&(a=r.hmode?Math.min(a,r.maxMouseX):Math.max(a,r.minMouseX)),null!=r.minY&&(i=r.vmode?Math.max(i,r.minMouseY):Math.min(i,r.maxMouseY)),null!=r.maxY&&(i=r.vmode?Math.min(i,r.maxMouseY):Math.max(i,r.minMouseY)),e=s+(a-r.lastMouseX)*(r.hmode?1:-1),o=n+(i-r.lastMouseY)*(r.vmode?1:-1),r.xMapper?e=r.xMapper(n):r.yMapper&&(o=r.yMapper(s)),null!=r.minX&&(e=Math.max(e,r.minX)),null!=r.maxX&&(e=Math.min(e,r.maxX)),null!=r.minY&&(o=Math.max(o,r.minY)),null!=r.maxY&&(o=Math.min(o,r.maxY)),Common_DragHandler.Obj.root.style[r.hmode?"left":"right"]=e+"px",Common_DragHandler.Obj.root.style[r.vmode?"top":"bottom"]=o+"px",Common_DragHandler.Obj.lastMouseX=a,Common_DragHandler.Obj.lastMouseY=i,Common_DragHandler.Obj.root.onDrag(e,o),!1},End:function(){document.onmousemove=null,document.onmouseup=null,Common_DragHandler.Obj.root.onDragEnd(parseInt(Common_DragHandler.Obj.root.style[Common_DragHandler.Obj.hmode?"left":"right"]),parseInt(Common_DragHandler.Obj.root.style[Common_DragHandler.Obj.vmode?"top":"bottom"])),Common_DragHandler.Obj=null},FixE:function(t){return void 0===t&&(t=window.event),void 0===t.layerX&&(t.layerX=t.offsetX),void 0===t.layerY&&(t.layerY=t.offsetY),t}},Common_RequestAnimationFrame=window.requestAnimationFrame?window.requestAnimationFrame:function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return window.setTimeout(t,1e3/60)}}(),Common_CancelAnimationFrame=window.cancelAnimationFrame?window.cancelAnimationFrame:function(){return window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame||function(t){window.clearTimeout(t)}}();CCommon.prototype.Get_Browser=function(){var t="",e=navigator.userAgent;return-1!=e.indexOf("Opera")?t="Opera":-1!=e.indexOf("Chrome")?t="Chrome":-1!=e.indexOf("MSIE")?t="IE":-1!=e.indexOf("Safari")?t="Safari":-1!=e.indexOf("Mozilla")&&(t="Mozilla"),t},CCommon.prototype.SaveAs=function(t,e,o){if("undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob)return navigator.msSaveOrOpenBlob(t,e);var r=document.createElementNS("http://www.w3.org/1999/xhtml","a"),i=(window.URL||window.webkitURL||window).createObjectURL(t);r.href=i,r.download=e,o&&(r.type=o),this.Click(r)},CCommon.prototype.OpenFileDialog=function(t){var e=document.getElementsByTagName("body");if(e.length>0){var o=e[0],r=document.createElement("input");o.appendChild(r),r.type="file",r.multiple=!1,r.accept=".sgf",r.style.display="none",r.addEventListener("change",function(e){var o=e.target.files;if(o.length>0){var r=o[0],i=r.name.split(".").pop().toLowerCase(),a=new FileReader;a.onload=function(e){t.Load_Sgf(e.target.result,null,null,i),t.Focus()},a.readAsText(r),t.Focus()}},!1),this.Click(r),o.removeChild(r)}},CCommon.prototype.Click=function(t){var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),t.dispatchEvent(e)},CCommon.prototype.Get_LocalStorageItem=function(t){if(void 0!==window.localStorage){var e="HTMLGoBoard"+t;return localStorage.getItem(e)}return""},CCommon.prototype.Set_LocalStorageItem=function(t,e){if(void 0!==window.localStorage){var o="HTMLGoBoard"+t;localStorage.setItem(o,e)}},CCommon.prototype.Encode_Base64=function(t){var e,o,r,i,a,n="",s=0,l=0,m=0;do{r=(e=t[m++])>>2,i=(3&e)<<4|(o=t[m++])>>4,a=(15&o)<<2|(s=t[m++])>>6,l=63&s,isNaN(o)?a=l=64:isNaN(s)&&(l=64),n=n+g_oBase64String.charAt(r)+g_oBase64String.charAt(i)+g_oBase64String.charAt(a)+g_oBase64String.charAt(l)}while(m<t.length);return n},CCommon.prototype.Decode_Base64=function(t){var e,o,r,i,a=0,n="",s=0,l=t.replace(/[^A-Za-z0-9\+\/\=]/g,""),m=[];do{e=g_oBase64String.indexOf(l.charAt(s++))<<2|(r=g_oBase64String.indexOf(l.charAt(s++)))>>4,o=(15&r)<<4|(i=g_oBase64String.indexOf(l.charAt(s++)))>>2,a=(3&i)<<6|(n=g_oBase64String.indexOf(l.charAt(s++))),m.push(e),64!=i&&m.push(o),64!=n&&m.push(a)}while(s<l.length);return m},CCommon.prototype.Encode_Base64_UrlSafe=function(t){var e=this.Encode_Base64(t);return e=e.replace(new RegExp("\\+","g"),"~"),e=e.replace(new RegExp("\\/","g"),"-"),e=e.replace(new RegExp("=","g"),"_")},CCommon.prototype.Decode_Base64_UrlSafe=function(t){return t=t.replace(new RegExp("~","g"),"+"),t=t.replace(new RegExp("-","g"),"/"),t=t.replace(new RegExp("_","g"),"="),this.Decode_Base64(t)},CCommon.prototype.Set_InnerTextToElement=function(t,e){t.innerText?t.innerText=e:t.textContent=e},CCommon.prototype.Is_NodeDescendant=function(t,e,o){if(!t||!e)return!1;for(var r=o||0,i=e.parentNode;null!=i;){if(i==t)return!0;if(--r<0)return!1;i=i.parentNode}return!1},CCommon.prototype.Create_DivElement=function(t,e){var o=document.createElement("div");return o.setAttribute("id",e),o.setAttribute("style","position:absolute;padding:0;margin:0;"),o.setAttribute("oncontextmenu","return false;"),t.appendChild(o),o},CCommon.prototype.Compare_Strings=function(t,e){if(!t)return-1;if(!e)return 1;var o=t.toLowerCase(),r=e.toLowerCase();return o<r?-1:o>r?1:t<e?-1:t>e?1:0},CCommon.prototype.ClearNode=function(t){for(;t.firstChild;)t.removeChild(t.firstChild)};var g_oBase64String="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Common=new CCommon,BOARD_EMPTY=0,BOARD_BLACK=1,BOARD_WHITE=2,BOARD_DRAW=3,EShowVariants={None:0,Curr:1,Next:2,Min:0,Max:2},g_dBoard_H=460,g_dBoard_W=g_dBoard_H,g_dVerOff_2_Cell_H=17.51/23.61,g_dHorOff_2_Cell_W=g_dVerOff_2_Cell_H,g_dBoardCellW=23.61,g_dBoardHorOffset=17.51,g_dBoardCellW_2=g_dBoardCellW/2,g_sBackground="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAIAAAD/gAIDAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAg3SURBVHhe7ZpLltw2DEVdNfPQ83gLnmYp3kLWkiwkC0syztAzd54ICgJBEPxXVef0PXJZLeL7SH1aXbdf//ztU+DHX/8e/93w743+84EF7Kp8/uVL3EOKv0OK1cgUoDeL1UhyjOPf6T/w+Ws4dNjcLstLtFS+tzyBgWpD/biEPGZvFqsRQylwiQWEXidhP+jUIk6CWfRavUrRVmVRce5q0Ua9UgydbhXtnHI3daIbmc6Sxz9Wlq1XRY30rEzJ0yzvREHxVZYZzJm4ffvjO/2sh3G9Z0Eg3M3o0CzOTEM4Q73IUCqOM0RUGynVefv2+3cWRRudeuXRFRyulIbxDcxEfpB8FJQMzPgMWToVXiuL8MM5IKiTRmKaVfNyNGlZSgGUWTW+iYqvxQJjcRVOG2BZinB9KFHKktdmWuZmp1hp1slmfKWIxk48M7oFlcUCyl0Gh5+6h0ljo4U3fs5yU3bRohSAmbLMjwD74D84EiruKTuJYz1USwNjkm7pQylRmsxG2t0rMynQoz/xL2vWFU5HKBj7eqVi5WoPUwvVrhSRtIEnQcRXDWcZOUVLfMYxTsWyHqYGiEHapG/vJLEsraOF851hnIZroGZQulX98JSwXjoCZzlFHFtWRCnLNrEA6mbJCgx0YoD4vNDKuSaI0bdds5iaXrNIpYDcX0asXop125Npp1775sDiFOvoZ2fmHXpRtE0TbBHEQr4HTJGl1/CVPvJApcBdKbXkilsMcuo1nOW6x9FfDMqU7mgtlO6k90esKUm2vtqb0ZaPXVbAeHSYXFzRHXK8He2p7RgKTc5kOXxPpVR8bHFApJAHZzDEQjfDnVz1ff1ivs5X/RDmQUmXlzh+rT3T0oQtcxGy91mIH86R9ugK5Gj0NS1VicNlmOT9K4pKQRM8WSViTSv1LnAkk43Ht+pBJi3WKdSIUpR+WGKUZZ6zkpkU8B10lHpd16zzZZgKijS0xZ8z/NEWqCB8luJwiuHJgGNjkaoM9S4oea2cKxX3TEjdM9BwJyAmEmUlwek47q211efD7eSlHhMGRDppw47Xrzt9SgFubDnpNBCTSknQ2rXRUkIuVip8HgdPWJkoVrdSBBKE6PlcdXG40/IBtEP7hNxfCOkCsMMb5coyUoOHWINK7UO1MT0ZxBWE4xM0N7SxXpkOcL/PKnWGnoXiUBsqpuptBhkfn0IaM7VSI3mCf/6aylHCTeJIU0gkNUnEeiaoXjbAP+JzrV4IeO94zSnPvESsJZeGKVQPa2UiEPMnzUMdJUj2ZbYn6sXS8Gpavqx6yK/mx8qa12vyYkcP8RESKJVpMj7RFSRXCp/xNGzRCwfVFgfWcYT9GoKfn3HgsajWWJz46w7NZclIHVccZmEh+GYlyN3XhSoZi8847fAQKIkAglhizQ8XhKCTzWzl6Ln/t0upFAin4YqrwysrBVDepFIgffl3knfuiPjiMuWUepGNmDb1h1K4OUoBNVq1B/GVyH66aquWHcR6w0XLpupPSDOan1JZxysR+aCwExQwvOpNx/QCn97UGpViDEdx6zg4J2X+mYAVz7vi7HKovRfHq34ajqOUYpYuK/SjtjggMA+WcIy1WMPLCrBLPtsSf7SR6tpckyUNkoq1cM7zZVVaaJuZmXXFttPQVOpJeq1i5zWLgEDEO1cKnGJxS8shgfD5zpUC4StH77+NxxC+zAZOvRrvaCbs4l9TB664OUeQtrNhphGFuGbtOxM34Z4Qy6ZEYFzg2aJrTrqMl3RCIK/a4sAoToTK3bAxtzSTQlD1cosDc1CKUkA+PjDr0jKfUVss1XDcK2Aa4GDX8S5agiibRpe4V8B+nwVyz1zpavQHMFBVu4uybH359wqgdFlY3jOj6leOXcgsxmk4EBcRndJ9Gh1//FVrWNzNVT1wbM2SNSKT6pWlClIp496JE7ed1hTpnxtU6hIyILmUivR7odFELNOikVIRLehE/EuF+O2C43dVBeYdCbhfp+GMUovhp03sPO9RWSkAfaJYk0op914896AXGwxMIbsMFKnSHWJNKrUXcSY+BanG9Df/dvPUM1GRPDq8nFLEU1eWXEzGc9YHJRKxBi6B/2+kIDjtXumbf2W4yIHy2KX3IqOUwuexsub16q1D0eX+mOnMlQLXE7wqoqrgvMSMDOWUwUMqtYOM1vIXfyLxEkPXNavkgJ08Oigd74XzmgFLB+OeizQ7soSvcZi+8rj2ElR+kX5lVCeK+Uby+Mb7rFIa6fw6muYtVWtrcTFnwnjOyu1wRB3MjxDmwbWoFOhTbXEgkNczU3b9odQJpIboR3xWc5NN1axEo+Nhlv6q5Di2xKychi0hHHs1z0Aa5KON+EHM0ZZGgNML8FZWYwLHDENqiwPrUPGxxYEyziT57lqs4dkm2t1nEtV9w9nHZkoCXxEezbMUV1bLFDFdxo9gz4uK+gX+A+ZDrA4+xOrgQ6wOimJ13a0Gbm0z94RGX+e+5lC6hwIt1uR9bdL96fiyeqfhwHrpYkzZLi82bulF2phZDLGkXVeO3uZ3T4YC6ZyMLcXMXuBljq7mu4wlk1lMd9ss+3tl6/usfNWYZqBlfUlf2JdCOfRmGUNl2fKm1O9EKUU71by5psuzkJmTJRHLtGtJAJwcEmmW25i5pNmmLMqmlOUSy6+jmgB0RcjdG6nGmU0UvopiBoli7e5kVXzCiTaeKGgkyUMdd8OFnShfirwwPmFmkTtEXyJSStwB8yzrv3JU6oSYj0/kWdYkgmSkV/hUQZLnrE2dMKviE060qUSsV0CGusTa3cna+IQZc0Ei6IXtTmfmGfDTp/8Aysg4kH9KLq0AAAAASUVORK5CYII=",EDITINGFLAGS_MASK=4294967295,EDITINGFLAGS_NEWNODE=1,EDITINGFLAGS_MOVE=2,EDITINGFLAGS_BOARDMODE=4,EDITINGFLAGS_LOADFILE=8,EDITINGFLAGS_GAMEINFO=16,EDITINGFLAGS_VIEWPORT=32,EDITINGFLAGS_REMOVE=64,EDITINGFLAGS_NEWNODE_NON=EDITINGFLAGS_MASK^EDITINGFLAGS_NEWNODE,EDITINGFLAGS_MOVE_NON=EDITINGFLAGS_MASK^EDITINGFLAGS_MOVE,EDITINGFLAGS_BOARDMODE_NON=EDITINGFLAGS_MASK^EDITINGFLAGS_BOARDMODE,EDITINGFLAGS_LOADFILE_NON=EDITINGFLAGS_MASK^EDITINGFLAGS_LOADFILE,EDITINGFLAGS_GAMEINFO_NON=EDITINGFLAGS_MASK^EDITINGFLAGS_GAMEINFO,EDITINGFLAGS_VIEWPORT_NON=EDITINGFLAGS_MASK^EDITINGFLAGS_VIEWPORT,EDITINGFLAGS_REMOVE_NON=EDITINGFLAGS_MASK^EDITINGFLAGS_REMOVE;CGameTree.prototype.Copy_ForScoreEstimate=function(){var t=new CGameTree;return t.m_oBoard=this.m_oBoard.Copy(),t.m_oFirstNode=this.m_oFirstNode.Copy_CurrentVariant(this.m_oCurNode),t.m_oCurNode=t.m_oFirstNode,t.Step_ForwardToEnd(),t},CGameTree.prototype.Set_TutorMode=function(t,e,o){!0===t?(this.m_bTutorModeAuto=!0,this.m_nTutorMode=BOARD_EMPTY):(this.m_bTutorModeAuto=!1,this.m_nTutorMode=e),void 0!==o&&(this.m_nTutorInterval=1e3*o)},CGameTree.prototype.Set_TutorNewNodeText=function(t){t&&""!==t||(t="Wrong.\nOut of variants."),this.m_sTutorText=t},CGameTree.prototype.Set_TutorCallbacks=function(t,e,o){this.m_pTutorRightCallback=t,this.m_pTutorWrongCallback=e,this.m_pTutorResetCallback=o},CGameTree.prototype.Find_ProblemRightVariant=function(){var t=[];return this.m_oFirstNode.Find_RightNodes(t),t.length>0&&(t[Math.max(0,Math.min(t.length-1,Math.floor(Math.random()*t.length)))].Make_ThisNodeCurrent(),!0)},CGameTree.prototype.Start_AutoPlay=function(t){if(EDITINGFLAGS_MOVE&this.m_nEditingFlags||!0===t){this.Stop_AutoPlay(),this.m_oDrawing&&this.m_oDrawing.On_StartAutoPlay();var e=this,o=function(){e.Get_CurNode().Get_NextsCount()>0&&(e.m_nAutoPlayTimer=0,e.Step_Forward(1,t)),e.Get_CurNode().Get_NextsCount()>0?(e.m_nAutoPlayOldTime=(new Date).getTime(),e.m_nAutoPlayTimer=setTimeout(o,e.Get_AutoPlayInterval())):(e.m_nAutoPlayTimer=null,e.m_oDrawing&&e.m_oDrawing.On_StopAutoPlay())},r=(new Date).getTime()-this.m_nAutoPlayOldTime,i=this.Get_AutoPlayInterval()-r;i<=0?o():this.m_nAutoPlayTimer=setTimeout(o,i)}},CGameTree.prototype.Get_AutoPlayInterval=function(){return 100+6900*(1-this.m_dAutoPlaySpeed)},CGameTree.prototype.Stop_AutoPlay=function(){this.m_oDrawing&&this.m_oDrawing.On_StopAutoPlay(),null!==this.m_nAutoPlayTimer&&(clearTimeout(this.m_nAutoPlayTimer),this.m_nAutoPlayTimer=null)},CGameTree.prototype.Is_AutoPlay=function(){return null!==this.m_nAutoPlayTimer},CGameTree.prototype.Set_AutoPlaySpeed=function(t){this.m_dAutoPlaySpeed=t,this.m_oDrawing&&this.m_oDrawing.Update_AutoPlaySpeed(t),null!==this.m_nAutoPlayTimer&&this.Start_AutoPlay()},CGameTree.prototype.GoTo_NodeByTimeLine=function(t){for(var e=t*(this.private_GetMovesCountInCurVariant()-1),o=this.m_oFirstNode;o.Get_NextsCount()>0&&e>0;)e--,o=o.Get_Next();this.GoTo_Node(o)},CGameTree.prototype.private_GetTimeLinePos=function(){for(var t=this.m_oFirstNode,e=1,o=1;t.Get_NextsCount()>0;)e++,(t=t.Get_Next())===this.m_oCurNode&&(o=e);return e>0?(o-1)/(e-1):1},CGameTree.prototype.private_GetMovesCountInCurVariant=function(){for(var t=this.m_oFirstNode,e=1;t.Get_NextsCount()>0;)e++,t=t.Get_Next();return e},CGameTree.prototype.On_EndLoadDrawing=function(){this.m_oDrawingNavigator&&this.m_oDrawingNavigator.Create_FromGameTree(),this.m_oDrawing&&(this.Update_InterfaceState(),this.m_oDrawing.Update_AutoPlaySpeed(this.m_dAutoPlaySpeed))},CGameTree.prototype.Set_DrawingNavigator=function(t){this.m_oDrawingNavigator=t},CGameTree.prototype.Set_Drawing=function(t){this.m_oDrawing=t},CGameTree.prototype.Update_Size=function(){this.m_oDrawing&&this.m_oDrawing.Update_Size()},CGameTree.prototype.Get_Drawing=function(){return this.m_oDrawing},CGameTree.prototype.Get_DrawingBoard=function(){return this.m_oDrawingBoard},CGameTree.prototype.Get_DrawingNavigator=function(){return this.m_oDrawingNavigator},CGameTree.prototype.Focus=function(){this.m_oDrawingBoard&&this.m_oDrawingBoard.Focus()},CGameTree.prototype.Load_Sgf=function(t,e,o,r){if(this.m_nEditingFlags&EDITINGFLAGS_LOADFILE){g_oIdCounter.Reset();var i=this.m_nEditingFlags;this.Reset_EditingFlags();var a=new CSgfReader(this);a.Load(t),this.m_bTutorModeAuto&&(this.m_nTutorMode=this.Get_NextMove()===BOARD_BLACK?BOARD_WHITE:BOARD_BLACK);var n=this.m_oBoard.Get_Size().X,s=this.m_oBoard.Get_Size().Y;if(this.m_oDrawingBoard&&e)if(!0===e.Auto){var l=a.m_oViewPort.X0<=4?0:a.m_oViewPort.X0-2,m=n-a.m_oViewPort.X1<=3?n-1:a.m_oViewPort.X1,_=a.m_oViewPort.Y0<=4?0:a.m_oViewPort.Y0-2,h=s-a.m_oViewPort.Y1<=3?s-1:a.m_oViewPort.Y1;this.m_oDrawingBoard.Set_ViewPort(l,_,m,h)}else void 0!==e.X0&&void 0!==e.X1&&void 0!==e.Y0&&void 0!==e.Y1&&this.m_oDrawingBoard.Set_ViewPort(e.X0,e.Y0,e.X1,e.Y1);else this.m_oDrawingBoard&&this.m_oDrawingBoard.Set_ViewPort(0,0,n-1,s-1);if(this.m_oDrawingNavigator&&(this.m_oDrawingNavigator.Create_FromGameTree(),this.m_oDrawingNavigator.Update()),o)this.GoTo_MoveReference(o);else{var d;d=this.Is_LoadUnfinishedFilesOnLastNode()&&this.Is_Unfinished()?this.m_oFirstNode.Get_LastNodeInMainVariant():this.m_oFirstNode,this.m_oStartNode=d,this.GoTo_Node(d)}var p=this.Get_LoadShowVariants();ESettingsLoadShowVariants.FromFile!==this.Get_LoadShowVariants()&&(this.m_eShowVariants=p),this.m_nEditingFlags=i,this.m_oDrawingBoard&&this.m_oDrawingBoard.On_EndLoadSgf(),this.m_oDrawing&&this.m_oDrawing.Update_Size(!0),this.Set_Modified(!1)}},CGameTree.prototype.Save_Sgf=function(){var t=new CSgfWriter;return t.Write(this),t.m_sFile},CGameTree.prototype.Set_DrawingBoard=function(t){this.m_oDrawingBoard=t},CGameTree.prototype.Reset=function(){this.m_oFirstNode=new CNode(this),this.Set_GameName(""),this.Set_Result(""),this.Set_Rules(""),this.Set_TimeLimit(""),this.Set_OverTime(""),this.Set_Black("Black"),this.Set_BlackRating(""),this.Set_White("White"),this.Set_WhiteRating(""),this.Set_Copyright(""),this.Set_GameInfo(""),this.Set_DateTime(""),this.Set_GameEvent(""),this.Set_GameRound(""),this.Set_GamePlace(""),this.Set_GameAnnotator(""),this.Set_GameSource(""),this.Set_GameTranscriber(""),this.m_eShowVariants=EShowVariants.None,this.Init_Match()},CGameTree.prototype.GoTo_StartNode=function(){this.GoTo_Node(this.m_oStartNode)},CGameTree.prototype.Step_BackwardToStart=function(){var t=this.m_nEditingFlags;BOARD_EMPTY!==this.m_nTutorMode&&this.Set_EditingFlags({Move:!0}),this.GoTo_Node(this.m_oFirstNode),this.m_nEditingFlags=t,BOARD_EMPTY!==this.m_nTutorMode&&this.m_pTutorResetCallback&&this.private_SendCallback(this.m_pTutorResetCallback)},CGameTree.prototype.Step_Backward=function(t){for(var e=this.Get_CurNode();null!=e.Get_Prev()&&t>0&&(e=e.Get_Prev(),t--,!(e.Get_NextsCount()>1)););this.GoTo_Node(e)},CGameTree.prototype.Step_Forward=function(t,e){var o=this.m_oCurNode,r=this.m_nCurNodeDepth;if(1===t){if(!this.GoTo_Next(e))return;if(this.m_oHandler&&this.m_oHandler.GoToNode)return this.m_oHandler.GoToNode(this.Get_CurNode()),this.m_nCurNodeDepth=r,void(this.m_oCurNode=o);this.Execute_CurNodeCommands()}else{for(var i=0;i<t&&(this.GoTo_Next(),!(this.Get_CurNode().Get_NextsCount()>1));i++);if(this.m_oHandler&&this.m_oHandler.GoToNode)return this.m_oHandler.GoToNode(this.Get_CurNode()),this.m_nCurNodeDepth=r,void(this.m_oCurNode=o);this.GoTo_Node(this.Get_CurNode())}},CGameTree.prototype.Step_ForwardToEnd=function(){for(var t=this.m_oCurNode,e=this.m_nCurNodeDepth;this.GoTo_Next(););if(this.m_oHandler&&this.m_oHandler.GoToNode)return this.m_oHandler.GoToNode(this.Get_CurNode()),this.m_nCurNodeDepth=e,void(this.m_oCurNode=t);this.GoTo_Node(this.Get_CurNode())},CGameTree.prototype.Pass=function(){this.m_oHandler&&this.m_oHandler.Pass?this.m_oHandler.Pass(this.m_nNextMove):!0===this.Add_NewNodeByPos(0,0,this.m_nNextMove)&&this.Execute_CurNodeCommands()},CGameTree.prototype.GoTo_PrevVariant=function(){var t=this.m_oCurNode.Get_Prev();if(null!==t){var e=t.Get_NextCur(),o=t.Get_NextsCount();if(o>1)if(this.Is_CycleThroughVariants()){var r;r=e>0?t.Get_Next(e-1):t.Get_Next(o-1),this.GoTo_Node(r)}else e>0&&(r=t.Get_Next(e-1),this.GoTo_Node(r))}},CGameTree.prototype.GoTo_NextVariant=function(){var t=this.m_oCurNode.Get_Prev();if(null!==t){var e=t.Get_NextCur(),o=t.Get_NextsCount();if(o>1)if(this.Is_CycleThroughVariants()){r=e<o-1?t.Get_Next(e+1):t.Get_Next(0),this.GoTo_Node(r)}else if(e<o-1){var r=t.Get_Next(e+1);this.GoTo_Node(r)}}},CGameTree.prototype.GoTo_MainVariant=function(){for(var t=this.m_oCurNode;!t.Is_OnMainVariant();){var e=t.Get_Prev();if(null===e&&t!==this.m_oFirstNode)return;t=e}t.GoTo_MainVariant(),this.GoTo_Node(t),this.m_oDrawingNavigator&&this.m_oDrawingNavigator.Update()},CGameTree.prototype.GoTo_NodeByXY=function(t,e){this.m_oSound&&this.m_oSound.Off();var o=this.m_oCurNode,r=this.Get_Handler();this.Set_Handler(null),this.Step_BackwardToStart();for(var i=0;i<1e3&&BOARD_EMPTY===this.m_oBoard.Get(t,e);)this.Step_Forward(1),i++;if(r&&r.GoToNode)return r.GoToNode(this.Get_CurNode()),this.GoTo_Node(o),void this.Set_Handler(r);BOARD_EMPTY===this.m_oBoard.Get(t,e)&&this.GoTo_Node(o),this.m_oSound&&this.m_oSound.On()},CGameTree.prototype.Set_NextMove=function(t){this.m_nNextMove=t,this.m_oCurNode.Set_NextMove(t)},CGameTree.prototype.Get_FirstNode=function(){return this.m_oFirstNode},CGameTree.prototype.Get_CurNode=function(){return this.m_oCurNode},CGameTree.prototype.Set_CurNode=function(t){this.m_oCurNode=t},CGameTree.prototype.Set_GameCurNode=function(t){this.m_oGameCurNode=t},CGameTree.prototype.Get_GameCurNode=function(){return this.m_oGameCurNode},CGameTree.prototype.Add_Move=function(t,e,o){this.m_oCurNode.Add_Move(t,e,o)},CGameTree.prototype.Add_NewNode=function(t,e){if(!(this.m_nEditingFlags&EDITINGFLAGS_NEWNODE))return!1;var o=new CNode(this);return this.m_oCurNode.Add_Next(o,e),this.Set_CurNode(o),this.m_nCurNodeDepth++,!0===t&&this.m_oDrawingNavigator&&(this.m_oDrawingNavigator.Create_FromGameTree(),this.m_oDrawingNavigator.Update()),!0},CGameTree.prototype.Add_NewNodeByPos=function(t,e,o){for(var r=Common_XYtoValue(t,e),i=0,a=this.m_oCurNode.Get_NextsCount();i<a;i++){var n=this.m_oCurNode.Get_Next(i),s=n.Get_Move(),l=s.Get_Type();if(!0===this.Is_KifuMode()&&0!==i)return!1;if(r===s.Get_Value()&&o===l&&(BOARD_BLACK===o||BOARD_WHITE===o)){var m=this.m_oCurNode.Get_NextCur();return this.m_oCurNode.Set_NextCur(i),this.Set_CurNode(n),this.m_nCurNodeDepth++,this.m_oDrawingNavigator&&m!==i&&this.m_oDrawingNavigator.Update(),!0}}return!!(this.m_nEditingFlags&EDITINGFLAGS_NEWNODE)&&(this.Add_NewNode(!1,!0),this.m_oCurNode.Add_Move(t,e,o),this.m_oDrawingNavigator&&(this.m_oDrawingNavigator.Create_FromGameTree(),this.m_oDrawingNavigator.Update()),BOARD_EMPTY!==this.m_nTutorMode&&""!==this.m_sTutorText&&this.m_oCurNode.Set_Comment(this.m_sTutorText),!0)},CGameTree.prototype.Add_MoveNumber=function(t){this.m_oCurNode.Add_MoveNumber(t)},CGameTree.prototype.AddOrRemove_Stones=function(t,e){this.m_oCurNode.AddOrRemove_Stones(t,e)},CGameTree.prototype.Add_Comment=function(t){var e=this.m_oCurNode.Get_Comment();this.m_oCurNode.Add_Comment(t),this.m_oDrawing&&this.m_oDrawing.Update_Comments(this.m_oCurNode.Get_Comment()),this.m_oDrawingNavigator&&""===e&&""!==t&&this.m_oDrawingNavigator.Update()},CGameTree.prototype.Set_Comment=function(t){var e=this.m_oCurNode.Get_Comment();this.m_oCurNode.Set_Comment(t),this.m_oDrawingNavigator&&(""===e&&""!==t||""!==e&&""===t)&&this.m_oDrawingNavigator.Update()},CGameTree.prototype.Add_Mark=function(t,e){this.m_oCurNode.Add_Mark(t,e)},CGameTree.prototype.Remove_Mark=function(t){this.m_oCurNode.Add_Mark(ECommand.RM,t)},CGameTree.prototype.Add_TextMark=function(t,e){this.m_oCurNode.Add_TextMark(t,e)},CGameTree.prototype.Add_BlackTimeLeft=function(t){this.m_oCurNode.Add_BlackTimeLeft(t)},CGameTree.prototype.Add_WhiteTimeLeft=function(t){this.m_oCurNode.Add_WhiteTimeLeft(t)},CGameTree.prototype.Remove_CurNode=function(){if(!(this.m_nEditingFlags&EDITINGFLAGS_REMOVE))return!1;var t=this.m_oCurNode.Get_Prev();if(null===t)return this.m_oCurNode.Clear(),this.m_oDrawingNavigator&&(this.m_oDrawingNavigator.Create_FromGameTree(),this.m_oDrawingNavigator.Update()),void this.GoTo_Node(this.m_oCurNode);for(var e=0,o=t.Get_NextsCount();e<o;e++)if(this.m_oCurNode===t.Get_Next(e))return t.Remove_Next(e),this.Set_CurNode(t),this.m_oDrawingNavigator&&(this.m_oDrawingNavigator.Create_FromGameTree(),this.m_oDrawingNavigator.Update()),void this.GoTo_Node(t)},CGameTree.prototype.Have_Move=function(){return this.m_oCurNode.Have_Move()},CGameTree.prototype.Is_CurNodeLast=function(){return 0===this.m_oCurNode.Get_NextsCount()},CGameTree.prototype.Execute_CurNodeCommands=function(){this.m_oBoard.Clear_Scores(),this.m_oDrawingBoard&&(this.m_oDrawingBoard.Remove_AllMarks(),this.Show_Variants());for(var t=0,e=this.m_oCurNode.Get_CommandsCount();t<e;t++){var o=this.m_oCurNode.Get_Command(t),r=o.Get_Type(),i=o.Get_Value(),a=o.Get_Count();switch(r){case ECommand.B:s=Common_ValuetoXY(i);this.Execute_Move(s.X,s.Y,BOARD_BLACK,!1);break;case ECommand.W:s=Common_ValuetoXY(i);this.Execute_Move(s.X,s.Y,BOARD_WHITE,!1);break;case ECommand.AB:for(n=0;n<a;n++){s=Common_ValuetoXY(i[n]);this.private_SetBoardPoint(s.X,s.Y,BOARD_BLACK,-1)}break;case ECommand.AW:for(n=0;n<a;n++){s=Common_ValuetoXY(i[n]);this.private_SetBoardPoint(s.X,s.Y,BOARD_WHITE,-1)}break;case ECommand.AE:for(n=0;n<a;n++){s=Common_ValuetoXY(i[n]);this.private_SetBoardPoint(s.X,s.Y,BOARD_EMPTY,-1)}break;case ECommand.PL:this.private_SetNextMove(i);break;case ECommand.CR:if(this.m_oDrawingBoard)for(n=0;n<a;n++){s=Common_ValuetoXY(i[n]);this.m_oDrawingBoard.Add_Mark(new CDrawingMark(s.X,s.Y,EDrawingMark.Cr,""))}break;case ECommand.MA:if(this.m_oDrawingBoard)for(n=0;n<a;n++){s=Common_ValuetoXY(i[n]);this.m_oDrawingBoard.Add_Mark(new CDrawingMark(s.X,s.Y,EDrawingMark.X,""))}break;case ECommand.SQ:if(this.m_oDrawingBoard)for(n=0;n<a;n++){s=Common_ValuetoXY(i[n]);this.m_oDrawingBoard.Add_Mark(new CDrawingMark(s.X,s.Y,EDrawingMark.Sq,""))}break;case ECommand.TR:if(this.m_oDrawingBoard)for(n=0;n<a;n++){s=Common_ValuetoXY(i[n]);this.m_oDrawingBoard.Add_Mark(new CDrawingMark(s.X,s.Y,EDrawingMark.Tr,""))}break;case ECommand.LB:if(this.m_oDrawingBoard){s=Common_ValuetoXY(i.Pos);this.m_oDrawingBoard.Add_Mark(new CDrawingMark(s.X,s.Y,EDrawingMark.Tx,i.Text))}break;case ECommand.RM:if(this.m_oDrawingBoard)for(var n=0;n<a;n++){var s=Common_ValuetoXY(i[n]);this.m_oDrawingBoard.Remove_Mark(s.X,s.Y)}break;case ECommand.BL:case ECommand.WL:}}if(this.m_oDrawingBoard){if(this.m_oCurNode.Have_Move()){var l=this.m_oCurNode.Get_Move(),m=l.Get_X(),_=l.Get_Y();this.m_oDrawingBoard.Set_LastMoveMark(m,_)}else this.m_oDrawingBoard.Set_LastMoveMark(-1,-1);this.m_oDrawingBoard.Draw_Marks(),this.m_oCurNode.Draw_ColorMap(this.m_oDrawingBoard)}if(this.m_oDrawing){var h=this.m_oCurNode.Get_Comment(),d=!0;BOARD_EMPTY!==this.m_nTutorMode?(-1!==h.indexOf("CHOICE")&&(h=h.replace("CHOICE","")),this.m_oCurNode.Get_NextsCount()<=0&&(-1!==h.indexOf("RIGHT")&&null!==this.m_pTutorRightCallback?(this.m_oDrawing.Update_Comments(h.replace("RIGHT","")),this.private_SendCallback(this.m_pTutorRightCallback),d=!1):-1===h.indexOf("RIGHT")&&null!==this.m_pTutorWrongCallback&&(this.m_oDrawing.Update_Comments(h),this.private_SendCallback(this.m_pTutorWrongCallback),d=!1)),d&&this.m_oDrawing.Update_Comments(h)):this.m_oDrawing.Update_Comments(h)}if(this.m_oDrawingNavigator&&this.m_oDrawingNavigator.Update_Current(!0),this.Update_InterfaceState(),this.m_nNextMove===this.m_nTutorMode){if(null!==this.m_nTutorId||null!==this.m_nAutoPlayTimer||null!==this.m_nGifId)return;if(this.m_oCurNode.Get_NextsCount()>=0){var p=this.m_nEditingFlags,u=this;this.m_nTutorId=setTimeout(function(){u.Reset_EditingFlags();for(var t=u.Get_CurNode(),e=[],o=0,r=t.Get_NextsCount();o<r;o++)-1!==t.Get_Next(o).Get_Comment().indexOf("CHOICE")&&e.push(o);if(e.length>0){var i=Math.max(0,Math.min(e.length-1,Math.floor(Math.random()*e.length)));t.Set_NextCur(e[i])}else t.Get_NextsCount()>0&&t.Set_NextCur(0);u.Step_Forward(1),u.m_nEditingFlags=p,u.m_nTutorId=null},this.m_nTutorInterval),this.Forbid_All()}}},CGameTree.prototype.Execute_Move=function(t,e,o,r){0!=t||0!=e?(this.m_oSound&&!0!==r&&this.m_oSound.Play_PlaceStone(),this.private_SetBoardPoint(t,e,o,this.m_nMovesCount+1,r),this.private_UpdateNextMove(o)):this.private_UpdateNextMove(o)},CGameTree.prototype.GoTo_Next=function(t){return!!(this.m_nEditingFlags&EDITINGFLAGS_MOVE||!0===t)&&((!0!==this.Is_KifuMode()||!0===t)&&(0!==this.m_oCurNode.Get_NextsCount()&&-1!==this.m_oCurNode.Get_NextCur()&&(this.Set_CurNode(this.m_oCurNode.Get_Next(this.m_oCurNode.Get_NextCur())),this.m_nCurNodeDepth++,!0)))},CGameTree.prototype.Show_Variants=function(){this.m_oDrawingBoard&&this.m_oCurNode.Show_Variants(this.m_eShowVariants,this.m_oDrawingBoard)},CGameTree.prototype.Set_Sound=function(t){this.m_oSound.Init(t)},CGameTree.prototype.Set_SoundClass=function(t){this.m_oSound=t},CGameTree.prototype.GoTo_Node=function(t,e){if((this.m_nEditingFlags&EDITINGFLAGS_MOVE||!0===e)&&!0!==this.Is_KifuMode())if(this.m_oHandler&&this.m_oHandler.GoToNode)this.m_oHandler.GoToNode(t);else{this.Stop_AutoPlay(),this.Init_Match(),this.m_oBoard.Clear(),this.m_oSound&&this.m_oSound.Off();var o=t.Make_ThisNodeCurrent();for(this.Set_CurNode(this.m_oFirstNode);this.m_oCurNode!=t&&this.m_oCurNode.Get_NextsCount()>0;){for(var r=this.m_oCurNode.Get_CommandsCount(),i=0;i<r;i++){var a=this.m_oCurNode.Get_Command(i),n=a.Get_Type(),s=a.Get_Value(),l=a.Get_Count();switch(n){case ECommand.B:_=Common_ValuetoXY(s);this.Execute_Move(_.X,_.Y,BOARD_BLACK,!0);break;case ECommand.W:_=Common_ValuetoXY(s);this.Execute_Move(_.X,_.Y,BOARD_WHITE,!0);break;case ECommand.AB:for(m=0;m<l;m++){_=Common_ValuetoXY(s[m]);this.m_oBoard.Set(_.X,_.Y,BOARD_BLACK,-1)}break;case ECommand.AW:for(m=0;m<l;m++){_=Common_ValuetoXY(s[m]);this.m_oBoard.Set(_.X,_.Y,BOARD_WHITE,-1)}break;case ECommand.AE:for(var m=0;m<l;m++){var _=Common_ValuetoXY(s[m]);this.m_oBoard.Set(_.X,_.Y,BOARD_EMPTY,-1)}}}if(!this.GoTo_Next(e))break}this.m_oDrawingBoard&&this.m_oDrawingBoard.Draw_AllStones(),this.Execute_CurNodeCommands(),this.m_oDrawingNavigator&&!0===o&&this.m_oDrawingNavigator.Update(),this.m_oSound&&this.m_oSound.On()}},CGameTree.prototype.Get_BlackName=function(){return this.m_sBlack},CGameTree.prototype.Get_BlackRating=function(){return this.m_sBlackRating},CGameTree.prototype.Get_WhiteName=function(){return this.m_sWhite},CGameTree.prototype.Get_WhiteRating=function(){return this.m_sWhiteRating},CGameTree.prototype.Get_Board=function(){return this.m_oBoard},CGameTree.prototype.Get_NextMove=function(){return this.m_nNextMove},CGameTree.prototype.Get_MovesCount=function(){return this.m_nMovesCount},CGameTree.prototype.Get_BlackPassCount=function(){return this.m_nBlackPassCount},CGameTree.prototype.Get_WhitePassCount=function(){return this.m_nWhitePassCount},CGameTree.prototype.Get_CurNodeDepth=function(){return this.m_nCurNodeDepth},CGameTree.prototype.Set_Application=function(t){this.m_sApplication=t,this.Set_Modified(!0)},CGameTree.prototype.Get_Application=function(){return this.m_sApplication},CGameTree.prototype.Set_Author=function(t){this.m_sAuthor=t,this.Set_Modified(!0)},CGameTree.prototype.Set_Charset=function(t){this.m_sCharset=t,this.Set_Modified(!0)},CGameTree.prototype.Get_Charset=function(){return this.m_sCharset},CGameTree.prototype.Set_ShowVariants=function(t){t!==this.m_eShowVariants&&(this.m_eShowVariants=t,this.Show_Variants())},CGameTree.prototype.Get_ShowVariants=function(){return this.m_eShowVariants},CGameTree.prototype.Set_GameAnnotator=function(t){this.m_sGameAnnotator=t,this.Set_Modified(!0)},CGameTree.prototype.Get_GameAnnotator=function(){return this.m_sGameAnnotator},CGameTree.prototype.Set_BlackRating=function(t){this.m_sBlackRating=t,this.m_oDrawing&&this.m_oDrawing.Update_BlackRank(this.m_sBlackRating),this.Set_Modified(!0)},CGameTree.prototype.Set_BlackTeam=function(t){this.m_sBlackTeam=t,this.Set_Modified(!0)},CGameTree.prototype.Get_BlackTeam=function(){return this.m_sBlackTeam},CGameTree.prototype.Set_Copyright=function(t){this.m_sCopyright=t,this.Set_Modified(!0)},CGameTree.prototype.Get_Copyright=function(){return this.m_sCopyright},CGameTree.prototype.Set_DateTime=function(t){this.m_sDateTime=t,this.Set_Modified(!0)},CGameTree.prototype.Get_DateTime=function(){return this.m_sDateTime},CGameTree.prototype.Set_GameEvent=function(t){this.m_sGameEvent=t,this.Set_Modified(!0)},CGameTree.prototype.Get_GameEvent=function(){return this.m_sGameEvent},CGameTree.prototype.Set_GameName=function(t){this.m_sGameName=t,this.Set_Modified(!0)},CGameTree.prototype.Get_GameName=function(){return this.m_sGameName},CGameTree.prototype.Get_MatchName=function(){var t=this.Get_GameName();return""===t&&(t=this.Get_WhiteName()+" vs. "+this.Get_BlackName()),""===t&&(t="White vs. Black"),t},CGameTree.prototype.Set_GameInfo=function(t){this.m_sGameInfo=t,this.Set_Modified(!0)},CGameTree.prototype.Get_GameInfo=function(){return this.m_sGameInfo},CGameTree.prototype.Set_OverTime=function(t){this.m_sOverTime=t,this.Set_Modified(!0)},CGameTree.prototype.Get_OverTime=function(){return this.m_sOverTime},CGameTree.prototype.Set_Black=function(t){this.m_sBlack=t,this.m_oDrawing&&this.m_oDrawing.Update_BlackName(this.m_sBlack),this.Set_Modified(!0)},CGameTree.prototype.Set_GamePlace=function(t){this.m_sGamePlace=t,this.Set_Modified(!0)},CGameTree.prototype.Get_GamePlace=function(){return this.m_sGamePlace},CGameTree.prototype.Set_White=function(t){this.m_sWhite=t,this.m_oDrawing&&this.m_oDrawing.Update_WhiteName(this.m_sWhite),this.Set_Modified(!0)},CGameTree.prototype.Set_Result=function(t){this.m_sResult=t,this.Set_Modified(!0)},CGameTree.prototype.Get_Result=function(){return this.m_sResult},CGameTree.prototype.Set_GameRound=function(t){this.m_sGameRound=t,this.Set_Modified(!0)},CGameTree.prototype.Get_GameRound=function(){return this.m_sGameRound},CGameTree.prototype.Set_Rules=function(t){this.m_sRules=t,this.Set_Modified(!0)},CGameTree.prototype.Get_Rules=function(){return this.m_sRules},CGameTree.prototype.Set_GameSource=function(t){this.m_sGameSource=t,this.Set_Modified(!0)},CGameTree.prototype.Get_GameSource=function(){return this.m_sGameSource},CGameTree.prototype.Set_TimeLimit=function(t){this.m_nTimeLimit=t,this.Set_Modified(!0)},CGameTree.prototype.Get_TimeLimit=function(){return this.m_nTimeLimit},CGameTree.prototype.Set_GameTranscriber=function(t){this.m_sGameTranscriber=t,this.Set_Modified(!0)},CGameTree.prototype.Get_GameTranscriber=function(){return this.m_sGameTranscriber},CGameTree.prototype.Set_WhiteRating=function(t){this.m_sWhiteRating=t,this.m_oDrawing&&this.m_oDrawing.Update_WhiteRank(this.m_sWhiteRating),this.Set_Modified(!0)},CGameTree.prototype.Set_WhiteTeam=function(t){this.m_sWhiteTeam=t,this.Set_Modified(!0)},CGameTree.prototype.Get_WhiteTeam=function(){return this.m_sWhiteTeam},CGameTree.prototype.Set_BoardSize=function(t,e){var o=Math.min(52,Math.max(t,2)),r=Math.min(52,Math.max(e,2)),i=this.m_oBoard.Get_Size();o===i.X&&r===i.Y||(this.m_oBoard.Reset_Size(o,r),this.m_oDrawingBoard&&this.m_oDrawingBoard.On_Resize(!0))},CGameTree.prototype.Init_Match=function(){this.Set_CurNode(this.m_oFirstNode),this.m_nBlackPassCount=0,this.m_nWhitePassCount=0,this.m_nMovesCount=0,this.m_nCurNodeDepth=0,this.m_nNextMove=BOARD_BLACK},CGameTree.prototype.private_UpdateNextMove=function(t){BOARD_BLACK===t?(this.Is_CurrentMovePass()&&this.m_nBlackPassCount++,this.private_SetNextMove(BOARD_WHITE)):(this.Is_CurrentMovePass()&&this.m_nWhitePassCount++,this.private_SetNextMove(BOARD_BLACK)),this.m_nMovesCount++},CGameTree.prototype.private_SetBoardPoint=function(t,e,o,r,i){this.m_oBoard.Set(t,e,o,r),this.m_oDrawingBoard&&!0!==i&&this.m_oDrawingBoard.Draw_Sector(t,e,o)},CGameTree.prototype.private_SetNextMove=function(t){this.m_nNextMove=t},CGameTree.prototype.Update_InterfaceState=function(t){if(this.m_oDrawing){var e=this.m_oInterfaceState,o=this.m_oCurNode.Get_Prev();if(e.Backward=null!==this.m_oCurNode.Get_Prev(),e.Forward=!(this.m_oCurNode.Get_NextsCount()<=0),null!==o){var r=o.Get_NextCur(),i=o.Get_NextsCount();this.Is_CycleThroughVariants()?(e.NextVariant=i>1,e.PrevVariant=i>1):(e.NextVariant=r<i-1,e.PrevVariant=r>0)}else e.NextVariant=!1,e.PrevVariant=!1;this.m_oDrawingBoard&&(e.BoardMode=this.m_oDrawingBoard.Get_Mode()),e.TimelinePos=this.private_GetTimeLinePos(),this.m_oDrawing.Update_InterfaceState(e),this.m_oDrawingBoard&&this.m_oDrawing.Update_PassCount(this.Get_BlackPassCount(),this.Get_WhitePassCount()),t&&(this.m_oDrawing.Update_BlackRank(this.m_sBlackRating),this.m_oDrawing.Update_WhiteRank(this.m_sWhiteRating),this.m_oDrawing.Update_BlackName(this.m_sBlack),this.m_oDrawing.Update_WhiteName(this.m_sWhite))}},CGameTree.prototype.Set_EditingFlags=function(t){t&&(!0===t.NewNode?this.m_nEditingFlags|=EDITINGFLAGS_NEWNODE:!1===t.NewNode&&(this.m_nEditingFlags&=EDITINGFLAGS_NEWNODE_NON),!0===t.Move?this.m_nEditingFlags|=EDITINGFLAGS_MOVE:!1===t.Move&&(this.m_nEditingFlags&=EDITINGFLAGS_MOVE_NON),!0===t.ChangeBoardMode?this.m_nEditingFlags|=EDITINGFLAGS_BOARDMODE:!1===t.ChangeBoardMode&&(this.m_nEditingFlags&=EDITINGFLAGS_BOARDMODE_NON),!0===t.LoadFile?this.m_nEditingFlags|=EDITINGFLAGS_LOADFILE:!1===t.LoadFile&&(this.m_nEditingFlags&=EDITINGFLAGS_LOADFILE_NON),!0===t.GameInfo?this.m_nEditingFlags|=EDITINGFLAGS_GAMEINFO:!1===t.GameInfo&&(this.m_nEditingFlags&=EDITINGFLAGS_GAMEINFO_NON),!0===t.ViewPort?this.m_nEditingFlags|=EDITINGFLAGS_VIEWPORT:!1===t.ViewPort&&(this.m_nEditingFlags&=EDITINGFLAGS_VIEWPORT_NON),!0===t.RemoveNodes?this.m_nEditingFlags|=EDITINGFLAGS_REMOVE:!1===t.RemoveNodes&&(this.m_nEditingFlags&=EDITINGFLAGS_REMOVE_NON))},CGameTree.prototype.Reset_EditingFlags=function(){this.m_nEditingFlags=EDITINGFLAGS_MASK},CGameTree.prototype.Forbid_All=function(){this.m_nEditingFlags=0},CGameTree.prototype.Can_EditGameInfo=function(){return!!(this.m_nEditingFlags&EDITINGFLAGS_GAMEINFO)},CGameTree.prototype.Download_PngBoardScreenShot=function(){var t=this.Get_DrawingBoard();if(t){var e=t.Get_FullImage(!0).toDataURL("image/png"),o=document.createElement("a");o.download="BoardShot.png",o.href="data:image/png;base64"+e,Common.Click(o)}},CGameTree.prototype.Download_GifForCurVariant=function(){var t=[],e=this.m_oFirstNode;for(t.push(e);e.Get_NextsCount()>0;)e=e.Get_Next(e.Get_NextCur()),t.push(e);this.private_DownloadGif(t)},CGameTree.prototype.Download_GifForProblem=function(){var t=[],e=[];this.m_oFirstNode.Find_RightNodes(e);for(var o=0,r=e.length;o<r;o++){var i=e[o];i.Make_ThisNodeCurrent();var a=this.m_oFirstNode;for(t.push(a);a!==i&&a.Get_NextsCount()>0;)a=a.Get_Next(a.Get_NextCur()),t.push(a)}this.private_DownloadGif(t)},CGameTree.prototype.Download_GifBoardScreenShot=function(){this.private_DownloadGif([this.m_oCurNode])},CGameTree.prototype.Abort_DownloadGid=function(){this.m_nGifId=null},CGameTree.prototype.private_DownloadGif=function(t){var e=this.Get_DrawingBoard();if(e){var o=this.m_oCurNode,r=e.m_oImageData.W,i=e.m_oImageData.H,a=t.length,n=Math.max(1,Math.ceil(2e6/r/i)),s=0,l=null,m=null,_=Math.ceil(a/n)>5,h=!0===_?CreateWindow(this.m_oDrawing.Get_MainDiv().id,EWindowType.GifWriter,{Drawing:this.m_oDrawing,GameTree:this}):null;e.Set_BlackWhiteLastMark(!0);var d=new CGifWriter;d.Set_Delay(1500),d.Start();var r=0,i=0;null!==h&&h.On_Start();var p=this;this.m_nGifId=!0;var u=function(){if(null===p.m_nGifId)return e.Set_BlackWhiteLastMark(!1),void p.GoTo_Node(o,!0);for(var C=Math.min(s+n,a);s<C;s++){p.GoTo_Node(t[s],!0),oCanvas=e.Get_FullImage(!1),oContext=oCanvas.getContext("2d");var g=e.Get_BoardState(),c=g.Stones,v=g.Marks;if(0!==r&&0!==i||(r=oCanvas.width,i=oCanvas.height),null===l||null===m)d.Add_ContextFrame(oContext,0,0,r,i,[{X0:0,Y0:0,X1:r,Y1:i}]);else{var f={};for(var w in v)f[w]=v[w];for(var w in m)void 0===f[w]||!1!==f[w]&&!1!==m[w]?f[w]=m[w]:f[w]=!1;for(var w in l)l[w]!==c[w]&&!1!==f[w]&&(f[w]=!0);var S=[];for(var w in f){var T=Common_ValuetoXY(w);null!==(G=e.Get_BoardAreaByPosition(T.X,T.Y,e.private_GetSettings_Shadows(),f[w]))&&S.push(G)}if(S.length>0){for(var y=r,D=i,E=0,B=0,A=0,b=S.length;A<b;A++){var G=S[A];G.X0<y&&(y=G.X0),G.Y0<D&&(D=G.Y0),G.X1>E&&(E=G.X1),G.Y1>B&&(B=G.Y1)}d.Add_ContextFrame(oContext,y,D,E-y,B-D,S)}else d.Add_ContextFrame(oContext,0,0,r,i,[])}l=g.Stones,m=g.Marks}if(null!==h&&h.On_Progress(Math.min(100,s/a*100)),s<a)!0===_?setTimeout(u,10):u();else{h&&h.On_End(),d.Finish();var M=p.Get_GameName();""===M&&(M=p.Get_WhiteName()+" vs. "+p.Get_BlackName()),""===M&&(M="download"),M+=".gif";var H=new Blob([d.Get_Stream().Get_Bytes()],{type:"image/gif"});Common.SaveAs(H,M),p.m_nGifId=null,e.Set_BlackWhiteLastMark(!1),p.GoTo_Node(o,!0)}};!0===_?setTimeout(u,10):u()}},CGameTree.prototype.private_SendCallback=function(t){null===this.m_nGifId&&t&&t()},CGameTree.prototype.Toggle_Sound=function(t,e){g_oGlobalSettings.Set_Sound(t)},CGameTree.prototype.Is_SoundOn=function(){return g_oGlobalSettings.Is_SoundOn()},CGameTree.prototype.Set_LoadUnfinishedFilesOnLastNode=function(t){g_oGlobalSettings.Set_LoadUnfinishedFilesOnLastNode(t)},CGameTree.prototype.Is_LoadUnfinishedFilesOnLastNode=function(){return(!this.m_oDrawing||EDrawingTemplate.Problems!==this.m_oDrawing.Get_TemplateType())&&g_oGlobalSettings.Is_LoadUnfinishedFilesOnLastNode()},CGameTree.prototype.Is_ShowTarget=function(){return g_oGlobalSettings.Is_ShowTarget()},CGameTree.prototype.Set_ShowTarget=function(t,e){!0===e?this.m_oSettings.Set_ShowTarget(t):g_oGlobalSettings.Set_ShowTarget(t),this.m_oDrawingBoard&&this.m_oDrawingBoard.Update_Target()},CGameTree.prototype.Is_CycleThroughVariants=function(){return g_oGlobalSettings.Is_CycleThroughVariants()},CGameTree.prototype.Set_CycleThroughVariants=function(t){g_oGlobalSettings.Set_CycleThroughVariants(t),this.Update_InterfaceState()},CGameTree.prototype.Get_NavigatorLabel=function(){return g_oGlobalSettings.Get_NavigatorLabel()},CGameTree.prototype.Set_NavigatorLabel=function(t){t!==this.Get_NavigatorLabel()&&(g_oGlobalSettings.Set_NavigatorLabel(t),this.m_oDrawingNavigator&&this.m_oDrawingNavigator.Update())},CGameTree.prototype.Get_LoadShowVariants=function(){return g_oGlobalSettings.Get_LoadShowVariants()},CGameTree.prototype.Set_LoadShowVariants=function(t){t!==this.Get_LoadShowVariants()&&g_oGlobalSettings.Set_LoadShowVariants(t)},CGameTree.prototype.Is_Unfinished=function(){return""===this.m_sResult||null===this.m_sResult||void 0===this.m_sResult},CGameTree.prototype.Add_ColorMark=function(t,e,o){this.m_oCurNode.Add_ColorMark(t,e,o),this.m_oDrawing&&this.m_oDrawing.Update_ColorsCounter()},CGameTree.prototype.Remove_ColorMark=function(t,e){this.m_oCurNode.Remove_ColorMark(t,e),this.m_oDrawing&&this.m_oDrawing.Update_ColorsCounter()},CGameTree.prototype.Remove_AllColorMarks=function(){this.m_oCurNode.Remove_AllColorMarks(),this.m_oDrawing&&this.m_oDrawing.Update_ColorsCounter()},CGameTree.prototype.Copy_ColorMapFromPrevNode=function(){this.m_oCurNode.Copy_ColorMapFromPrevNode(),this.m_oDrawingBoard&&this.m_oCurNode.Draw_ColorMap(this.m_oDrawingBoard),this.m_oDrawing&&this.m_oDrawing.Update_ColorsCounter()},CGameTree.prototype.Get_StartNode=function(){return this.m_oStartNode},CGameTree.prototype.GoTo_MoveReference=function(t){var e=this.Get_FirstNode(),o=Common.Decode_Base64_UrlSafe(t),r=new CStreamReader(o,o.length);if("GBMR"!==r.Get_String(4))return this.GoTo_Node(e);var i=r.Get_Short();if(1===i){var a=r.Get_String2(),n=e.Get_NodeById(a);if(null!==n){var s=r.Get_Byte();if(this.Set_CurNode(n),1===s)for(var l=r.Get_Long(),m=0;m<l&&1===r.Get_Short();m++){this.Add_NewNode(!1,!1);for(var _=r.Get_Long(),h=0;h<_;h++){var d=r.Get_Short(),p=r.Get_Long();switch(d){case 16:u=Common_ValuetoXY(r.Get_Long());this.Add_Move(u.X,u.Y,BOARD_BLACK);break;case 17:var u=Common_ValuetoXY(r.Get_Long());this.Add_Move(u.X,u.Y,BOARD_WHITE);break;case 32:case 33:case 34:var C=BOARD_BLACK;switch(d){case 32:C=BOARD_BLACK;break;case 33:C=BOARD_WHITE;break;case 34:C=BOARD_EMPTY}for(var g=r.Get_Long(),c=[],v=0;v<g;v++)c.push(r.Get_Long());this.AddOrRemove_Stones(C,c);break;default:r.Skip(p)}}r.Get_Short(),n=this.Get_CurNode(),this.m_oDrawingNavigator&&(this.m_oDrawingNavigator.Create_FromGameTree(),this.m_oDrawingNavigator.Update())}this.GoTo_Node(n,!0)}else this.GoTo_Node(e,!0)}else if(2===i){for(var f=r.Get_Long(),w=e,m=0;m<f;m++){var S=r.Get_Long();if(S<0||S>=w.Get_NextsCount()||w.Get_NextsCount()<=0)break;w=w.Get_Next(S)}this.GoTo_Node(w,!0)}},CGameTree.prototype.Make_CurrentVariantMainly=function(){this.m_oFirstNode.Make_CurrentVariantMainly(),this.m_oDrawingNavigator&&(this.m_oDrawingNavigator.Create_FromGameTree(),this.m_oDrawingNavigator.Update(),this.m_oDrawingNavigator.Update_Current(!0))},CGameTree.prototype.Move_Variant=function(t){this.m_oCurNode.Move_Variant(t),this.m_oDrawingNavigator&&(this.m_oDrawingNavigator.Create_FromGameTree(),this.m_oDrawingNavigator.Update(),this.m_oDrawingNavigator.Update_Current(!0))},CGameTree.prototype.Toggle_Rulers=function(){this.m_oDrawingBoard&&this.m_oDrawingBoard.Set_Rulers(!this.m_oDrawingBoard.Get_Rulers())},CGameTree.prototype.Set_Handler=function(t){this.m_oHandler=t},CGameTree.prototype.Get_Handler=function(){return this.m_oHandler},CGameTree.prototype.GoTo_NodeById=function(t){var e=this.Get_FirstNode().Get_NodeById(t);null!==e&&this.GoTo_Node(e)},CGameTree.prototype.GoTo_NodeByMoveNumber=function(t){var e=this.Get_FirstNode().Get_NodeByMoveNumber(t);null!==e&&this.GoTo_Node(e)},CGameTree.prototype.Get_DivHeightByWidth=function(t){return this.m_oDrawing?this.m_oDrawing.Get_DivHeightByWidth(t):0},CGameTree.prototype.Set_Modified=function(t){this.m_bModified=t},CGameTree.prototype.Is_Modified=function(){return this.m_bModified},CGameTree.prototype.Get_LocalSettings=function(){return this.m_oSettings},CGameTree.prototype.Set_LocalColorScheme=function(t){var e=this.m_oSettings.Set_ColorScheme(t);!0===e.Board&&this.m_oDrawingBoard&&this.m_oDrawingBoard.Update_Size(!0),this.m_oDrawingNavigator&&!0===e.Navigator&&this.m_oDrawingNavigator.Update_All()},CGameTree.prototype.Get_LogicBoardForKifu=function(){var t=this.m_bKifuMode;!0===t&&(this.m_bKifuMode=!1);var e=this.Get_CurNode(),o=this.Get_FirstNode();this.GoTo_Node(o);var r=new CKifuLogicBoard;return r.Load_FromNode(this.Get_Board(),o),this.GoTo_Node(e),!0===t&&(this.m_bKifuMode=!0),r},CGameTree.prototype.Start_KifuMode=function(){this.m_nKifuEditFlags=this.m_nEditingFlags,this.Forbid_All(),this.Set_EditingFlags({Move:!0}),this.Set_ShowVariants(EShowVariants.None),this.GoTo_MainVariant(),this.m_bKifuMode=!0,this.m_oDrawing&&this.m_oDrawing.Update_KifuMode()},CGameTree.prototype.Stop_KifuMode=function(){this.m_nEditingFlags=this.m_nKifuEditFlags,this.m_bKifuMode=!1,this.m_oDrawing&&this.m_oDrawing.Update_KifuMode()},CGameTree.prototype.Is_KifuMode=function(){return this.m_bKifuMode},CGameTree.prototype.Set_StartNode=function(t){this.m_oStartNode=t},CGameTree.prototype.Get_NodeReference=function(t,e){var o=this.Get_CurNode();e.Make_ThisNodeCurrent();var r=e.Get_Reference(t);return o.Make_CurrentVariantMainly(),r},CGameTree.prototype.Is_CurrentMovePass=function(){return this.Get_CurNode().Get_Move().Is_Pass()},CGifWriter.prototype.Add_ContextFrame=function(t,e,o,r,i,a){this.m_bFirstFrame&&(this.m_nW=t.canvas.width,this.m_nH=t.canvas.height),this.m_pPixels=t.getImageData(0,0,t.canvas.width,t.canvas.height).data,this.private_IndexPixels(e,o,r,i,a),this.m_bFirstFrame&&(this.private_WriteLogicalScreenDescriptor(),this.private_WriteColorTable(),this.private_WriteAppExt(),this.private_WriteCommentExt()),this.private_WriteGraphicControlExt(),this.private_WriteImageDescriptor(e,o,r,i),this.private_WriteFrame(),this.m_bFirstFrame=!1,console.log("Frame "+this.m_nFrameIndex),this.m_nFrameIndex++},CGifWriter.prototype.Set_Delay=function(t){this.m_nDelay=Math.floor(t/10)},CGifWriter.prototype.Start=function(){this.m_pStream=new CStreamWriter,this.m_pStream.Write_String("GIF89a")},CGifWriter.prototype.Finish=function(){this.m_pStream.Write_Byte(59)},CGifWriter.prototype.Get_Stream=function(){return this.m_pStream},CGifWriter.prototype.private_IndexPixels=function(t,e,o,r,i){if(this.m_bFirstFrame){this.private_LoadColorTableFromString("ff0000e0b65ce0b65ce0b65ce0b65ce0b75ce0b75ce1b75ce0b75ce0b75de1b75de1b75de1b85de2b85de2b85de2b85de2b85de3b85de3b85de3b95de3b95de3b95de3b95ee3b95ee3b95ee4b95ee4ba5ee4ba5ee4ba5ee4ba5ee5ba5ee5ba5ee5ba5ee5ba5ee5bb5ee5bb5ee5ba5ee5bb5ee5bb5ee5ba5ee5ba5fe1bc6dddbc75e1bb6ae4bb64e5bb5fe6bb5fe6bb5fe6bb5ee6bb5ee6bb5fe6bb5edeb65cdeb55cdfb55cdeb55cdeb55bdeb45bddb45bddb45bddb45bddb35bddb35bdcb35bdcb35bdbb35ddcb35adcb35adbb35adbb25adbb25adab25adab25adab15ad9b15ad9b15adab159d9b159d9b159d9b059d9b059d8b059d8b059d8af58d8b059d7b059d7af59d7af58d7af58d7ae58d6af58d6ae58d6ae58d5ae58d5ae58d5ae58d4ae5ad4ad58d5ad57d5ad57d4ad57d4ad57d4ac57d3ac57d4ac57d4ac57d3ac57d3ac57d3ac57d2ac57d2ac57d3ab56d2ab56d2ab56d2ab56d2ab56d2aa56d1aa56d1aa56d1aa56d1aa55d0aa55cfa956d0a955cfa855cfa855cba554c9a65bbea87ac5b38cd5c197cdc4b0e2d0aaead6abeed9adf1dcaef3ddaff3ddaffaf0dbfefefefdfdfdfafafaf8f8f8f5f5f5f1f1f1eeeeeeebebebe8e8e8e4e4e4e1e1e1dedededadadad6d6d6d3d3d3d0d0d0d0d0d0cfcfcfcecececececdcdcdcdcdcdcccfccc5cccbcbcacacacacac9c8c8c8cac8c3c7c7c7c6c6c5c4c4c4c3c3c2c2c1c1c0c0c0bfbebebdbdbdbbbbbab3b3b2bcb6a9b4ad9da7a49d9c9c9c9494948e8e8e8888888282827c7c7c7474746e6e6e6767677b756aa39370b99a59c29e50c09c4ebc994db9964bb6944ab29149af8e48ac8b47a88945a68744a28443a082429d7f40997c3f967a3d91753b876e387a6434735d2f6f5b2e6b572c64522a6359435e5e5e5757575050504a4a4a404040363636413c31524324423821352d1a2c2c2c2725212222221f1d191c171016161413131212121112111111111111111011101010101010100f0f0f0f0f0f0f0f0e0e0e0e0d0d0d0d0d0d0d0c0c0b0b0b0a0909090d0a07640909ef02023e0000000000000000000000000000")}this.m_pIndexedPixels=[];for(var a=this.m_oColorMap,n=this.m_pPixels,s=e;s<e+r;s++)for(var l=t;l<t+o;l++){var m=l-t+(s-e)*o;if(!0===this.private_IsPointInFrameAreas(l,s,i)){var _=4*(l+s*this.m_nW),h=255&n[_+0],d=255&n[_+1],p=255&n[_+2],u=h<<16|d<<8|p;void 0===a[u]&&(a[u]=this.private_FindBestColorIndex(h,d,p)),this.m_pIndexedPixels[m]=a[u]}else this.m_pIndexedPixels[m]=this.m_nTranspIndex}},CGifWriter.prototype.private_IsPointInFrameAreas=function(t,e,o){for(var r=0,i=o.length;r<i;r++){var a=o[r];if(t>=a.X0&&t<=a.X1&&e>=a.Y0&&e<=a.Y1)return!0}return!1},CGifWriter.prototype.private_FindBestColorIndex=function(t,e,o){for(var r=this.m_pColorTable,i=0,a=16777216,n=1;n<256;n++){var s=3*n,l=t-(255&r[s+0]),m=e-(255&r[s+1]),_=o-(255&r[s+2]),h=l*l+m*m+_*_;h<a&&(a=h,i=n)}return i},CGifWriter.prototype.private_WriteLogicalScreenDescriptor=function(){this.m_pStream.Write_Short(this.m_nW),this.m_pStream.Write_Short(this.m_nH),this.m_pStream.Write_Byte(247),this.m_pStream.Write_Byte(0),this.m_pStream.Write_Byte(0)},CGifWriter.prototype.private_WriteColorTable=function(){this.m_pStream.Write_Bytes(this.m_pColorTable);for(var t=768-this.m_pColorTable.length,e=0;e<t;e++)this.m_pStream.Write_Byte(0)},CGifWriter.prototype.private_WriteAppExt=function(){this.m_pStream.Write_Byte(33),this.m_pStream.Write_Byte(255),this.m_pStream.Write_Byte(11),this.m_pStream.Write_String("NETSCAPE2.0"),this.m_pStream.Write_Byte(3),this.m_pStream.Write_Byte(1),this.m_pStream.Write_Short(this.m_nRepeat),this.m_pStream.Write_Byte(0)},CGifWriter.prototype.private_WriteGraphicControlExt=function(){this.m_pStream.Write_Byte(33),this.m_pStream.Write_Byte(249),this.m_pStream.Write_Byte(4),this.m_pStream.Write_Byte(5),this.m_pStream.Write_Short(this.m_nDelay),this.m_pStream.Write_Byte(this.m_nTranspIndex),this.m_pStream.Write_Byte(0)},CGifWriter.prototype.private_WriteCommentExt=function(){this.m_pStream.Write_Byte(33),this.m_pStream.Write_Byte(254),this.m_pStream.Write_Byte(this.m_sComment.length),this.m_pStream.Write_String(this.m_sComment),this.m_pStream.Write_Byte(0)},CGifWriter.prototype.private_WriteImageDescriptor=function(t,e,o,r){this.m_pStream.Write_Byte(44),this.m_pStream.Write_Short(void 0!==t?t:0),this.m_pStream.Write_Short(void 0!==e?e:0),this.m_pStream.Write_Short(void 0!==o?o:this.m_nW),this.m_pStream.Write_Short(void 0!==r?r:this.m_nH),this.m_pStream.Write_Byte(0)},CGifWriter.prototype.private_WriteFrame=function(){new CLZWEncoder(this.m_nW,this.m_nH,this.m_pIndexedPixels,8).Encode(this.m_pStream)},CGifWriter.prototype.private_LoadColorTableFromString=function(t){if(1536===t.length){this.m_pColorTable=new Array(768);for(var e=0,o=0;e<768;e+=3,o+=6)this.m_pColorTable[e+0]=parseInt(t[o+0]+t[o+1],16),this.m_pColorTable[e+1]=parseInt(t[o+2]+t[o+3],16),this.m_pColorTable[e+2]=parseInt(t[o+4]+t[o+5],16)}};var LZW_EOF=-1,LZW_HASHSIZE=5003,LZW_BITS=12,LZW_MAXBITS=LZW_BITS,LZW_MAXCODE=1<<LZW_BITS;CLZWEncoder.prototype.Encode=function(t){t.Write_Byte(this.m_nInitCodeSize),this.m_nRemaining=this.m_nW*this.m_nH,this.m_nCurPixel=0,this.private_Compress(this.m_nInitCodeSize+1,t),t.Write_Byte(0)},CLZWEncoder.prototype.private_Compress=function(t,e){this.m_nInitBits=t,this.m_bClear=!1,this.m_nBits=t,this.m_nMaxCode=this.private_MaxCode(this.m_nBits);var o=1<<t-1;this.m_nEofCode=o+1,this.m_nFreeEntry=o+2,this.m_nCount=0;var r,i=this.private_GetNextPixel(),a=0;for(r=LZW_HASHSIZE;r<65536;r*=2)++a;a=8-a;var n=LZW_HASHSIZE;this.private_ClearHash(n),this.private_Output(o,e);for(var s,l=[];LZW_EOF!==(s=this.private_GetNextPixel());){var m=s<<a^i;if((r=(s<<LZW_MAXBITS)+i)!==this.m_aHashTable[m]){if(this.m_aHashTable[m]>=0){var _=n-m,h=!1;0===m&&(_=1);do{if((m-=_)<0&&(m+=n),r===this.m_aHashTable[m]){i=l[m],h=!0;break}}while(this.m_aHashTable[m]>=0);if(h)continue}this.private_Output(i,e),i=s,this.m_nFreeEntry<LZW_MAXCODE?(l[m]=this.m_nFreeEntry++,this.m_aHashTable[m]=r):(this.private_ClearHash(LZW_HASHSIZE),this.m_nFreeEntry=o+2,this.m_bClear=!0,this.private_Output(o,e))}else i=l[m]}this.private_Output(i,e),this.private_Output(this.m_nEofCode,e)},CLZWEncoder.prototype.private_MaxCode=function(t){return(1<<t)-1},CLZWEncoder.prototype.private_GetNextPixel=function(){return 0===this.m_nRemaining?LZW_EOF:(--this.m_nRemaining,255&this.m_pData[this.m_nCurPixel++])},CLZWEncoder.prototype.private_ClearHash=function(t){for(var e=0;e<t;e++)this.m_aHashTable[e]=-1},CLZWEncoder.prototype.private_Output=function(t,e){for(this.m_nCurAccum&=this.m_aMasks[this.m_nCurBits],this.m_nCurBits>0?this.m_nCurAccum|=t<<this.m_nCurBits:this.m_nCurAccum=t,this.m_nCurBits+=this.m_nBits;this.m_nCurBits>=8;)this.private_CharOut(255&this.m_nCurAccum,e),this.m_nCurAccum>>=8,this.m_nCurBits-=8;if((this.m_nFreeEntry>this.m_nMaxCode||this.m_bClear)&&(this.m_bClear?(this.m_nBits=this.m_nInitBits,this.m_nMaxCode=this.private_MaxCode(this.m_nBits),this.m_bClear=!1):++this.m_nBits==LZW_MAXBITS?this.m_nMaxCode=LZW_MAXCODE:this.m_nMaxCode=this.private_MaxCode(this.m_nBits)),t===this.m_nEofCode){for(;this.m_nCurBits>0;)this.private_CharOut(255&this.m_nCurAccum,e),this.m_nCurAccum>>=8,this.m_nCurBits-=8;this.private_FlushChar(e)}},CLZWEncoder.prototype.private_CharOut=function(t,e){this.m_aAccum[this.m_nCount++]=t,this.m_nCount>=254&&this.private_FlushChar(e)},CLZWEncoder.prototype.private_FlushChar=function(t){this.m_nCount>0&&(t.Write_Byte(this.m_nCount),t.Write_Bytes(this.m_aAccum,0,this.m_nCount),this.m_nCount=0)},CBoardPoint.prototype.CopyFrom=function(t){this.m_eValue=t.m_eValue,this.m_nNum=t.m_nNum},CBoardPoint.prototype.Clear=function(){this.m_eValue=BOARD_EMPTY,this.m_nNum=-1},CBoardPoint.prototype.Set_Value=function(t){this.m_eValue=t},CBoardPoint.prototype.Set_Num=function(t){this.m_nNum=t},CBoardPoint.prototype.Get_Value=function(){return this.m_eValue},CBoardPoint.prototype.Get_Num=function(){return this.m_nNum},CAreaScoreCounter.prototype.Clear=function(){this.m_oArea={},this.m_nOwner=BOARD_EMPTY},CAreaScoreCounter.prototype.Is_PointIn=function(t,e){var o=Common_XYtoValue(t,e);return void 0!==this.m_oArea[o]||(this.m_oArea[o]=1,!1)},CAreaScoreCounter.prototype.Set_Owner=function(t){this.m_nOwner=t},CAreaScoreCounter.prototype.Get_Owner=function(){return this.m_nOwner},CAreaScoreCounter.prototype.Update_Board=function(t,e){var o=void 0===e?this.m_nOwner:e;for(var r in this.m_oArea){var i=Common_ValuetoXY(0|r);t.Set_ScorePoint(i.X,i.Y,o)}},CLogicBoard.prototype.Copy=function(){for(var t=new CLogicBoard(this.m_nW,this.m_nH),e=0,o=this.m_aBoard.length;e<o;e++)t.m_aBoard[e].CopyFrom(this.m_aBoard[e]);return t},CLogicBoard.prototype.Clear=function(){for(var t=this.m_nW*this.m_nH,e=0;e<t;e++)this.m_aBoard[e].Clear()},CLogicBoard.prototype.Reset_Size=function(t,e){this.m_nW=t,this.m_nH=e,this.private_InitBoard()},CLogicBoard.prototype.Get_Size=function(){return{X:this.m_nW,Y:this.m_nH}},CLogicBoard.prototype.Set=function(t,e,o,r){var i=this.private_GetPos(t,e);this.m_aBoard[i].Set_Value(o),void 0!==r&&null!==r&&-1!==r&&this.m_aBoard[i].Set_Num(r)},CLogicBoard.prototype.Get=function(t,e){return this.m_aBoard[this.private_GetPos(t,e)].Get_Value()},CLogicBoard.prototype.Get_Num=function(t,e){return this.m_aBoard[this.private_GetPos(t,e)].Get_Num()},CLogicBoard.prototype.Get_HandiPoints=function(){for(var t=[],e=this.private_GetLineHandiPoints(this.m_nW),o=this.private_GetLineHandiPoints(this.m_nH),r=0;r<e.length;r++)for(var i=0;i<o.length;i++)t.push([e[r],o[i]]);return(9!=this.m_nW&&11!=this.m_nW||1!=this.m_nH%2)&&(9!=this.m_nH&&11!=this.m_nH||1!=this.m_nW%2)||t.push([(this.m_nW-1)/2,(this.m_nH-1)/2]),t},CLogicBoard.prototype.private_GetLineHandiPoints=function(t){var e=[];return 5==t?e=[2]:7==t?e=[3]:8==t?e=[2,5]:9==t?e=[2,6]:10==t?e=[3,6]:11==t?e=[3,7]:t>=12&&(e=1==t%2?[3,(t-1)/2,t-4]:[3,t-4]),e},CLogicBoard.prototype.Is_HandiPoint=function(t,e){if(this.m_nW===this.m_nH)for(var o=this.Get_HandiPoints(),r=0,i=o.length;r<i;r++)if(t-1===o[r][0]&&e-1===o[r][1])return!0;return!1},CLogicBoard.prototype.private_InitBoard=function(){var t=this.m_nW*this.m_nH;this.m_aBoard=new Array(t);for(var e=0;e<t;e++)this.m_aBoard[e]=new CBoardPoint},CLogicBoard.prototype.private_GetPos=function(t,e){return(e-1)*this.m_nW+(t-1)},CLogicBoard.prototype.Clear_Scores=function(){this.m_aBoardScores=[]},CLogicBoard.prototype.Init_CountScores=function(t){this.m_aBoardScores=[];for(var e=1;e<=this.m_nH;e++)for(var o=1;o<=this.m_nW;o++)this.m_aBoardScores[this.private_GetPos(o,e)]=BOARD_EMPTY;!0!==t&&this.private_CheckAllEmptyAreas(!1)},CLogicBoard.prototype.Set_ScorePoint=function(t,e,o){this.m_aBoardScores[this.private_GetPos(t,e)]=o},CLogicBoard.prototype.Get_ScorePoint=function(t,e){return this.m_aBoardScores[this.private_GetPos(t,e)]},CLogicBoard.prototype.private_CheckEmptyAreaByXY=function(t,e){if(!(t>this.m_nW||t<1||e>this.m_nH||e<1)){var o=this.Get(t,e);if(BOARD_EMPTY===this.Get(t,e))!1===this.m_oArea.Is_PointIn(t,e)&&(this.private_CheckEmptyAreaByXY(t+1,e),this.private_CheckEmptyAreaByXY(t-1,e),this.private_CheckEmptyAreaByXY(t,e+1),this.private_CheckEmptyAreaByXY(t,e-1));else{var r=this.m_oArea.Get_Owner();switch(r){case BOARD_EMPTY:this.m_oArea.Set_Owner(o);break;case BOARD_BLACK:case BOARD_WHITE:r!==o&&this.m_oArea.Set_Owner(BOARD_DRAW)}}}},CLogicBoard.prototype.private_CheckAllEmptyAreas=function(t){for(var e=1;e<=this.m_nH;e++)for(var o=1;o<=this.m_nW;o++)BOARD_EMPTY===this.Get(o,e)&&(BOARD_EMPTY===this.Get_ScorePoint(o,e)||!0===t&&BOARD_DRAW===this.Get_ScorePoint(o,e))&&(this.m_oArea.Clear(),this.private_CheckEmptyAreaByXY(o,e),this.m_oArea.Update_Board(this))},CommonExtend(CKifuLogicBoard,CLogicBoard),CKifuLogicBoard.prototype.Load_FromNode=function(t,e){this.m_nW=t.m_nW,this.m_nH=t.m_nH,this.m_aBoard=null,this.private_InitBoard();for(var o=0,r=0,i=this.m_aBoard.length;r<i;r++)this.m_aBoard[r].CopyFrom(t.m_aBoard[r]),o<this.m_aBoard[r].Get_Num()&&(o=this.m_aBoard[r].Get_Num()),this.m_aBoard[r].Set_Num(-1);for(;e.Get_NextsCount()>0;)for(var a=(e=e.Get_Next(e.Get_NextCur())).Get_CommandsCount(),n=0;n<a;n++){var s=e.Get_Command(n),l=s.Get_Type(),m=s.Get_Value(),_=s.Get_Count();switch(l){case ECommand.B:this.Add_ToKifu(m,BOARD_BLACK,++o);break;case ECommand.W:this.Add_ToKifu(m,BOARD_WHITE,++o);break;case ECommand.AB:for(r=0;r<_;r++)this.Add_ToKifu(m[r],BOARD_BLACK,-1);break;case ECommand.AW:for(r=0;r<_;r++)this.Add_ToKifu(m[r],BOARD_WHITE,-1);break;case ECommand.AE:for(r=0;r<_;r++)this.Add_ToKifu(m[r],BOARD_EMPTY,-1)}}},CKifuLogicBoard.prototype.Add_ToKifu=function(t,e,o){if(!(t<=0)){var r=Common_ValuetoXY(t),i=this.Get(r.X,r.Y);if(BOARD_EMPTY!==i){if(-1===o)return;var a=this.private_GetPos(r.X,r.Y);this.m_aRepetitions&&void 0!==this.m_aRepetitions.length||(this.m_aRepetitions=[]);for(var n=0,s=this.m_aRepetitions.length;n<s;++n)if(a===this.m_aRepetitions[n].nPosValue)return void this.m_aRepetitions[n].aReps.push({nValue:e,nMoveNumber:o});this.m_aRepetitions.push({nPosValue:a,nValue:i,nMoveNumber:this.Get_Num(r.X,r.Y),aReps:[{nValue:e,nMoveNumber:o}]})}else this.Set(r.X,r.Y,e,o)}},CStreamWriter.prototype.Init=function(){var t=document.createElement("canvas").getContext("2d");this.m_nLength=5242880,this.m_pImageData=t.createImageData(this.m_nLength/4,1),this.m_pData=this.m_pImageData.data,this.m_nPos=0},CStreamWriter.prototype.private_CheckSize=function(t){if(this.m_nPos+t>=this.m_nLength){var e=document.createElement("canvas").getContext("2d"),o=this.m_pData;this.m_nLength*=2,this.m_pImageData=e.createImageData(this.m_nLength/4,1),this.m_pData=this.m_pImageData.data;for(var r=this.m_pData,i=0;i<this.m_pPos;i++)r[i]=o[i]}},CStreamWriter.prototype.Get_Bytes=function(){for(var t=new Uint8Array(this.m_nPos),e=0;e<this.m_nPos;e++)t[e]=this.m_pData[e];return t},CStreamWriter.prototype.Get_CurPosition=function(){return this.m_nPos},CStreamWriter.prototype.Seek=function(t){this.m_nPos=t},CStreamWriter.prototype.Skip=function(t){this.m_nPos+=t},CStreamWriter.prototype.Write_Byte=function(t){this.private_CheckSize(1),this.m_pData[this.m_nPos++]=t},CStreamWriter.prototype.Write_String=function(t){var e=t.length;this.private_CheckSize(e);for(var o=0;o<e;o++)this.m_pData[this.m_nPos++]=t.charCodeAt(o)},CStreamWriter.prototype.Write_String2=function(t){this.Write_Long(t.length),this.Write_String(t)},CStreamWriter.prototype.Write_Bytes=function(t,e,o){var r=e||0,i=o||t.length;this.private_CheckSize(i-r);for(var a=r;a<i;a++)this.m_pData[this.m_nPos++]=t[a]},CStreamWriter.prototype.Write_Short=function(t){this.private_CheckSize(2),this.m_pData[this.m_nPos++]=255&t,this.m_pData[this.m_nPos++]=t>>8&255},CStreamWriter.prototype.Write_Long=function(t){this.private_CheckSize(4),this.m_pData[this.m_nPos++]=255&t,this.m_pData[this.m_nPos++]=t>>8&255,this.m_pData[this.m_nPos++]=t>>16&255,this.m_pData[this.m_nPos++]=t>>24&255},CStreamReader.prototype.Is_EOF=function(){return!(this.m_nPos<this.m_nSize)},CStreamReader.prototype.Get_Byte=function(){return this.m_nPos>=this.m_nSize?0:this.m_pData[this.m_nPos++]},CStreamReader.prototype.Get_Short=function(){return this.m_nPos+1>=this.m_nSize?0:this.m_pData[this.m_nPos++]|this.m_pData[this.m_nPos++]<<8},CStreamReader.prototype.Get_Long=function(){return this.m_nPos+3>=this.m_nSize?0:this.m_pData[this.m_nPos++]|this.m_pData[this.m_nPos++]<<8|this.m_pData[this.m_nPos++]<<16|this.m_pData[this.m_nPos++]<<24},CStreamReader.prototype.Get_String=function(t){if(this.m_nPos+t>this.m_nSize)return"";for(var e=[],o=0;o<t;o++)e.push(String.fromCharCode(this.m_pData[this.m_nPos+o]));return this.m_nPos+=t,e.join("")},CStreamReader.prototype.Get_String2=function(){var t=this.Get_Long();return this.Get_String(t)},CMove.prototype.Get_X=function(){return Common_ValuetoXY(this.m_nValue).X},CMove.prototype.Get_Y=function(){return Common_ValuetoXY(this.m_nValue).Y},CMove.prototype.Get_Value=function(){return this.m_nValue},CMove.prototype.Get_Type=function(){return this.m_nType},CMove.prototype.Set_Value=function(t){this.m_nValue=t},CMove.prototype.Set_Type=function(t){this.m_nType=t},CMove.prototype.Copy=function(){return new CMove(this.m_nValue,this.m_nType)},CMove.prototype.Is_Pass=function(){return BOARD_EMPTY!==this.m_nType&&0===this.m_nValue},CNodeIdCounter.prototype.Get_NextId=function(){return++this.m_nCounter+""},CNodeIdCounter.prototype.Reset=function(){this.m_nCounter=0};var g_oIdCounter=new CNodeIdCounter;CNode.prototype.Get_Id=function(){return this.m_sId},CNode.prototype.Is_FromFile=function(){return this.m_bLoaded},CNode.prototype.Set_Origin=function(t){this.m_bOrigin=t},CNode.prototype.Is_Origin=function(){return this.m_bOrigin},CNode.prototype.Reset_ToOrigin=function(t){if(!0===this.m_bOrigin){for(var e=0;e<this.m_aNext.length;++e)!0!==this.m_aNext[e].m_bOrigin&&(this.m_aNext.splice(e,1),e--,this.m_nNextCur>=e&&this.m_nNextCur--);this.m_sComment=t.m_sComment,this.m_nMoveNumber=t.m_nMoveNumber,this.m_aCommands=[];for(var o=0,r=t.m_aCommands.length;o<r;++o){var i=t.m_aCommands[o];this.m_aCommands.push(i.Copy())}this.m_oMove=t.m_oMove.Copy()}},CNode.prototype.Get_NodeById=function(t){if(t===this.m_sId)return this;for(var e=0,o=this.Get_NextsCount();e<o;e++){var r=this.m_aNext[e].Get_NodeById(t);if(null!==r)return r}return null},CNode.prototype.Get_NodeByMoveNumber=function(t){if(0===t)return this;for(var e=0,o=this;e!==t&&!(o.Get_NextsCount()<=0)&&(o=o.Get_Next(o.Get_NextCur()));)o.Have_Move()&&e++;return o},CNode.prototype.Copy_CurrentVariant=function(t){var e=new CNode;return e.m_aCommands=this.m_aCommands,this.m_aNext.length>0&&this!==t&&(e.m_aNext[0]=this.m_aNext[this.m_nNextCur].Copy_CurrentVariant(t),e.m_nNextCur=0,e.m_aNext[0].m_oPrev=e),e},CNode.prototype.Is_Node=function(){return!0},CNode.prototype.Clear=function(){this.m_aNext=[],this.m_nNextCur=-1,this.m_aCommands=[],this.m_oMove=new CMove(0,BOARD_EMPTY),this.m_sComment=""},CNode.prototype.Get_Next=function(t){return void 0!==this.m_aNext[t]?this.m_aNext[t]:this.m_aNext[this.m_nNextCur]},CNode.prototype.Get_NextCur=function(){return this.m_nNextCur},CNode.prototype.Set_NextCur=function(t){var e=t>=this.m_aNext.length?this.m_aNext.length-1:t;this.m_nNextCur=e},CNode.prototype.Get_NextsCount=function(){return this.m_aNext.length},CNode.prototype.Add_Next=function(t,e,o){if(t.Set_Prev(this),void 0===o&&!0===this.m_bOrigin&&!0===t.m_bOrigin)for(o=0;o<this.m_aNext.length&&!0===this.m_aNext[o].m_bOrigin;)o++;void 0===o?(this.m_aNext.push(t),!0!==e&&-1!==this.m_nNextCur||(this.m_nNextCur=this.m_aNext.length-1)):(o=Math.max(0,Math.min(this.m_aNext.length,o)),this.m_aNext.splice(o,0,t),!0===e||-1===this.m_nNextCur?this.m_nNextCur=o:this.m_nNextCur>=o&&this.m_nNextCur++),this.m_oGameTree&&this.m_oGameTree.Set_Modified(!0)},CNode.prototype.Remove_Next=function(t){this.m_aNext.splice(t,1),this.m_nNextCur>=t&&this.m_nNextCur--,-1===this.m_nNextCur&&this.m_aNext.length>0&&(this.m_nNextCur=0),this.m_oGameTree&&this.m_oGameTree.Set_Modified(!0)},CNode.prototype.Get_Prev=function(){return this.m_oPrev},CNode.prototype.Set_Prev=function(t){this.m_oPrev=t},CNode.prototype.Add_Command=function(t){this.m_aCommands.push(t),this.ToHandler_AddCommand(t),this.m_oGameTree&&this.m_oGameTree.Set_Modified(!0)},CNode.prototype.Get_Command=function(t){return this.m_aCommands[t]},CNode.prototype.Get_CommandsCount=function(){return this.m_aCommands.length},CNode.prototype.Set_Move=function(t){this.m_oMove=t,this.m_oGameTree&&this.m_oGameTree.Set_Modified(!0)},CNode.prototype.Get_Move=function(){return this.m_oMove},CNode.prototype.Have_Move=function(){return BOARD_EMPTY!==this.m_oMove.Get_Type()},CNode.prototype.Add_Comment=function(t){this.m_sComment+=t,this.m_oGameTree&&this.m_oGameTree.Set_Modified(!0)},CNode.prototype.Set_Comment=function(t){this.m_sComment=t,this.m_oGameTree&&this.m_oGameTree.Set_Modified(!0)},CNode.prototype.Get_Comment=function(){return this.m_sComment},CNode.prototype.Get_MainVariantLen=function(){for(var t=1,e=this;e.Get_NextsCount()>0;)t++,e=e.Get_Next(0);return t},CNode.prototype.GoTo_MainVariant=function(){for(var t=this;t.Get_NextsCount()>0;)t.Set_NextCur(0),t=t.Get_Next(0)},CNode.prototype.Get_LastNodeInMainVariant=function(){for(var t=this;t.Get_NextsCount()>0;)t=t.Get_Next(0);return t},CNode.prototype.Is_First=function(){return null===this.m_oPrev},CNode.prototype.Make_ThisNodeCurrent=function(){for(var t=!1,e=this.Get_Prev(),o=this;null!=e;){for(var r=!1,i=0,a=e.Get_NextsCount();i<a;i++)if(o===e.Get_Next(i)){i!==e.Get_NextCur()&&(t=!0),e.Set_NextCur(i),r=!0;break}if(!r)return!1;o=e,e=e.Get_Prev()}return t},CNode.prototype.Is_OnMainVariant=function(){for(var t=this,e=null;null!==(e=t.Get_Prev());){if(0!=e.Get_NextCur())return!1;t=e}return!0},CNode.prototype.Is_OnCurrentVariant=function(){for(var t=this,e=null;null!=(e=t.Get_Prev());){if(e.Get_Next(e.Get_NextCur())!=t)return!1;t=e}return!0},CNode.prototype.Set_NavigatorInfo=function(t,e,o){this.m_oNavInfo.X=t,this.m_oNavInfo.Y=e,this.m_oNavInfo.Num=o},CNode.prototype.Get_NavigatorInfo=function(){return this.m_oNavInfo},CNode.prototype.Add_Move=function(t,e,o){var r=Common_XYtoValue(t,e);this.Add_Command(new CCommand(BOARD_BLACK===o?ECommand.B:ECommand.W,r)),BOARD_EMPTY===this.m_oMove.Get_Type()&&(this.m_oMove.Set_Value(r),this.m_oMove.Set_Type(o))},CNode.prototype.Add_MoveNumber=function(t){this.Add_Command(new CCommand(ECommand.MN,t))},CNode.prototype.AddOrRemove_Stones=function(t,e){var o=BOARD_BLACK===t?ECommand.AB:BOARD_WHITE===t?ECommand.AW:ECommand.AE;this.Add_Command(new CCommand(o,Common_CopyArray(e),e.length))},CNode.prototype.Add_Mark=function(t,e){var o=ECommand.Unknown;switch(t){case EDrawingMark.Cr:o=ECommand.CR;break;case EDrawingMark.Lm:return;case EDrawingMark.Sq:o=ECommand.SQ;break;case EDrawingMark.Tr:o=ECommand.TR;break;case EDrawingMark.Tx:o=ECommand.LB;break;case EDrawingMark.X:o=ECommand.MA;break;case ECommand.RM:o=ECommand.RM}this.Add_Command(new CCommand(o,Common_CopyArray(e),e.length))},CNode.prototype.Add_TextMark=function(t,e){this.Add_Command(new CCommand(ECommand.LB,{Text:t,Pos:e}))},CNode.prototype.Set_NextMove=function(t){this.Add_Command(new CCommand(ECommand.PL,t))},CNode.prototype.Add_BlackTimeLeft=function(t){this.Add_Command(new CCommand(ECommand.BL,t))},CNode.prototype.Add_WhiteTimeLeft=function(t){this.Add_Command(new CCommand(ECommand.WL,t))},CNode.prototype.Show_Variants=function(t,e){switch(e.Clear_Variants(),t){case EShowVariants.Next:this.private_ShowNextVariants(e,-1);break;case EShowVariants.Curr:var o=this.Get_Prev();null!==o&&o.private_ShowNextVariants(e,this.Get_Move().Get_Value());break;default:return}},CNode.prototype.Count_NodeNumber=function(){for(var t=1,e=this,o=null;null!==(o=e.Get_Prev());)t++,e=o;return t},CNode.prototype.private_ShowNextVariants=function(t,e){if(t)for(var o=0,r=this.Get_NextsCount();o<r;o++){var i=this.Get_Next(o).Get_Move();if(BOARD_EMPTY!==i.Get_Type()&&e!==i.Get_Value()){var a=Common_ValuetoXY(i.Get_Value());t.Draw_Variant(a.X,a.Y)}}},CNode.prototype.Find_RightNodes=function(t){-1!==this.m_sComment.indexOf("RIGHT")&&t.push(this);for(var e=0,o=this.Get_NextsCount();e<o;e++)this.Get_Next(e).Find_RightNodes(t)},CNode.prototype.Add_ColorMark=function(t,e,o){this.m_oColorMap[Common_XYtoValue(t,e)]=o,this.m_oGameTree&&this.m_oGameTree.Set_Modified(!0)},CNode.prototype.Remove_ColorMark=function(t,e){delete this.m_oColorMap[Common_XYtoValue(t,e)],this.m_oGameTree&&this.m_oGameTree.Set_Modified(!0)},CNode.prototype.Remove_AllColorMarks=function(){this.m_oColorMap={},this.m_oGameTree&&this.m_oGameTree.Set_Modified(!0)},CNode.prototype.Draw_ColorMap=function(t){t.Clear_AllColorMarks();for(var e in this.m_oColorMap)t.m_oColorMarks[e]=this.m_oColorMap[e];t.Draw_AllColorMarks()},CNode.prototype.Copy_ColorMapFromPrevNode=function(){if(this.m_oColorMap={},null!==this.m_oPrev){var t=this.m_oPrev.m_oColorMap;for(var e in t)this.m_oColorMap[e]=t[e].Copy()}this.m_oGameTree&&this.m_oGameTree.Set_Modified(!0)},CNode.prototype.Get_ColorTable=function(t){for(var e in this.m_oColorMap)t[this.m_oColorMap[e].ToLong()]=!0;for(var o=0,r=this.Get_NextsCount();o<r;o++)this.m_aNext[o].Get_ColorTable(t)},CNode.prototype.Make_CurrentVariantMainly=function(){for(var t=this,e=this.Get_NextCur(),o=this.Get_Next(e);null!==o&&void 0!==o;)0!==e&&(t.m_aNext.splice(e,1),t.m_aNext.splice(0,0,o),t.Set_NextCur(0)),e=(t=o).Get_NextCur(),o=t.Get_Next(e)},CNode.prototype.Move_Variant=function(t){for(var e=this,o=this.Get_Prev();null!==o&&void 0!==o;){var r=o.Get_NextsCount();if(o.Get_NextsCount()>1){for(var i=0;i<r;++i)if(e===o.Get_Next(i)){t>0?i>0&&(o.m_aNext.splice(i,1),o.m_aNext.splice(i-1,0,e),o.Set_NextCur(i-1)):i<r-1&&(o.m_aNext.splice(i,1),o.m_aNext.splice(i+1,0,e),o.Set_NextCur(i+1));break}return}e=o,o=o.Get_Prev()}},CNode.prototype.Get_Reference=function(t){var e=f=this,o=new CStreamWriter;if(o.Write_String("GBMR"),!1!==t){for(;!f.Is_FromFile();){var r=f.Get_Prev();if(null===r)return"";f=r}if(o.Write_Short(1),o.Write_String2(f.Get_Id()),f!==e){o.Write_Byte(1);for(var i=[],a=e;a!==f;)i.splice(0,0,a),a=a.Get_Prev();o.Write_Long(i.length);for(var n=0,s=i.length;n<s;n++){var l=i[n];o.Write_Short(1);var m=o.Get_CurPosition();o.Skip(4);for(var _=0,h=0,d=l.Get_CommandsCount();h<d;h++){var p=l.Get_Command(h),u=p.Get_Type(),C=p.Get_Value(),g=p.Get_Count();switch(u){case ECommand.B:o.Write_Short(16),o.Write_Long(4),o.Write_Long(C),_++;break;case ECommand.W:o.Write_Short(17),o.Write_Long(4),o.Write_Long(C),_++;break;case ECommand.AB:case ECommand.AW:case ECommand.AE:switch(u){case ECommand.AB:o.Write_Short(32);break;case ECommand.AW:o.Write_Short(33);break;case ECommand.AE:o.Write_Short(34)}o.Write_Long(4*(g+1)),o.Write_Long(g);for(var c=0;c<g;c++)o.Write_Long(C[c]);_++}}w=o.Get_CurPosition();o.Seek(m),o.Write_Long(_),o.Seek(w),o.Write_Short(0)}}else o.Write_Byte(0)}else{o.Write_Short(2);var v=o.Get_CurPosition();o.Skip(4);for(var f=this.Get_FirstNode(),s=0;f!==e&&f.Get_NextsCount()>0;)s++,o.Write_Long(f.Get_NextCur()),f=f.Get_Next();var w=o.Get_CurPosition();o.Seek(v),o.Write_Long(s),o.Seek(w)}return Common.Encode_Base64_UrlSafe(o.Get_Bytes())},CNode.prototype.Get_FirstNode=function(){for(var t=this;null!==t.Get_Prev();)t=t.Get_Prev();return t},CNode.prototype.Get_MoveNumber=function(){if(-1===this.m_nMoveNumber){var t=0,e=this,o=e.Get_Prev();for(e.Have_Move()&&t++;null!==o;)o=(e=o).Get_Prev(),e.Have_Move()&&t++;this.m_nMoveNumber=t}return this.m_nMoveNumber},CNode.prototype.Have_ChildNodeWithMove=function(t,e,o){if(o!==BOARD_BLACK&&o!==BOARD_WHITE)return-1;for(var r=Common_XYtoValue(t,e),i=0,a=this.Get_NextsCount();i<a;++i){var n=this.Get_Next(i).Get_Move();if(r===n.Get_Value()&&o==n.Get_Type())return i}return-1},CNode.prototype.ToHandler_AddCommand=function(){this.m_oHandler&&this.m_oHandler.Add_NodeCommand&&this.m_oHandler.Add_NodeCommand(this.Get_Id(),Command.To_String())},CNode.prototype.FromHandler_AddCommand=function(t){var e=new CCommand;e.From_String(t),this.m_aCommands.push(e)},CNode.prototype.ToHandler_UpdateNexts=function(){if(this.m_oHandler&&this.m_oHandler.Update_NodeNexts){for(var t=[],e=0,o=this.m_aNext.length;e<o;++e)t.push(this.m_aNext[e].Get_Id());this.m_oHandler.Update_NodeNexts(this.Get_Id(),t)}},CNode.prototype.FromHandler_UpdateNexts=function(t){};var g_nSgfReaderCharCodeOffsetLo="a".charCodeAt(0)-1,g_nSgfReaderCharCodeOffsetHi="A".charCodeAt(0)-1,g_nSgfReaderCharCode_a="a".charCodeAt(0),g_nSgfReaderCharCode_z="z".charCodeAt(0),g_nSgfReaderCharCode_A="A".charCodeAt(0),g_nSgfReaderCharCode_Z="Z".charCodeAt(0),ESgfEncoding={None:0,UTF8:1};CSgfReader.prototype.Load=function(t){if(void 0!==t&&""!==t&&(this.private_Init(),this.private_Normalize(t),!this.private_Parse()&&this.m_oGameTree&&this.m_oGameTree.Get_Drawing())){var e=this.m_oGameTree,o=e.Get_Drawing();CreateWindow(o.Get_MainDiv().id,EWindowType.Error,{GameTree:e,Drawing:o,ErrorText:"File cannot be read. Invalid SGF file.",W:275,H:80})}},CSgfReader.prototype.private_Init=function(){this.m_sSGF=[],this.m_nPos=0,this.m_nVariantDepth=0,this.m_arrVariant=[],this.m_bValidNode=!0,this.m_nLength=0},CSgfReader.prototype.private_Normalize=function(t){for(var e=0,o=t.length,r=[],i=!1;e<o;){if((i||t.charCodeAt(e)>32)&&r.push(t.charAt(e)),r.length>=3&&"["==r[r.length-1]){var a=r[r.length-3]+r[r.length-2];("C"==r[r.length-2]&&"UC"!=a||"AN"==a||"BR"==a||"BT"==a||"CP"==a||"DT"==a||"EV"==a||"GN"==a||"GC"==a||"ON"==a||"OT"==a||"PB"==a||"PC"==a||"PW"==a||"RE"==a||"RO"==a||"RU"==a||"SO"==a||"TM"==a||"US"==a||"WR"==a||"WT"==a)&&(i=!0)}else i&&r.length>=1&&"]"==r[r.length-1]&&(r.length<2||"\\"!=r[r.length-2])&&(i=!1);e++}this.m_sSGF=r,this.m_nLength=this.m_sSGF.length},CSgfReader.prototype.private_Parse=function(){if(this.m_oGameTree.Reset(),"("!==this.m_sSGF[0]||";"!==this.m_sSGF[1])return!1;for(this.m_nPos++;this.m_nPos<this.m_nLength&&(")"!==this.m_sSGF[this.m_nPos]||0!==this.m_nVariantDepth);){var t=this.m_sSGF[this.m_nPos];if(";"===t){if(1!=this.m_nPos?this.m_oGameTree.Add_NewNode(!1,!1):this.m_oGameTree.Set_CurNode(this.m_oGameTree.Get_FirstNode()),this.m_oGameTree.m_oCurNode.m_bLoaded=!0,!this.private_ReadNode())return!1}else if("("===t)this.m_arrVariant[this.m_nVariantDepth]=this.m_oGameTree.Get_CurNode(),this.m_nVariantDepth++,this.m_nPos++;else{if(")"!==t)return!1;this.m_nVariantDepth--,this.m_oGameTree.Set_CurNode(this.m_arrVariant[this.m_nVariantDepth]),this.m_nPos++}}return!0},CSgfReader.prototype.private_ReadNode=function(){this.m_nPos++;for(var t=this.m_sSGF[this.m_nPos],e=this.m_sSGF[this.m_nPos+1];void 0!==t&&")"!==t&&";"!==t&&"("!==t;){switch(t){case"A":switch(e){case"B":this.private_ReadAddOrRemoveStone(BOARD_BLACK);break;case"E":this.private_ReadAddOrRemoveStone(BOARD_EMPTY);break;case"W":this.private_ReadAddOrRemoveStone(BOARD_WHITE);break;case"N":this.private_ReadAN();break;case"P":this.private_ReadAP();break;default:this.private_ReadUnknown()}break;case"B":switch(e){case"[":this.private_ReadMove(BOARD_BLACK);break;case"R":this.private_ReadBR();break;case"T":this.private_ReadBT();break;case"L":this.private_ReadBL();break;default:this.private_ReadUnknown()}break;case"C":switch(e){case"[":this.private_ReadComments();break;case"A":this.private_ReadCA();break;case"P":this.private_ReadCP();break;case"R":this.private_ReadMark(EDrawingMark.Cr);break;case"T":this.private_ReadCT();break;case"M":this.private_ReadCM();break;default:this.private_ReadUnknown()}break;case"D":switch(e){case"T":this.private_ReadDT();break;default:this.private_ReadUnknown()}break;case"E":switch(e){case"V":this.private_ReadEV();break;default:this.private_ReadUnknown()}break;case"F":switch(e){case"F":this.private_ReadFF();break;default:this.private_ReadUnknown()}break;case"G":switch(e){case"N":this.private_ReadGN();break;case"C":this.private_ReadGC();break;case"M":this.private_ReadGM();break;default:this.private_ReadUnknown()}break;case"H":switch(e){case"A":this.private_ReadHA();break;default:this.private_ReadUnknown()}break;case"K":this.private_ReadUnknown();break;case"L":switch(e){case"B":this.private_ReadLB();break;default:this.private_ReadUnknown()}break;case"M":switch(e){case"A":this.private_ReadMark(EDrawingMark.X);break;default:this.private_ReadUnknown()}break;case"O":switch(e){case"N":this.private_ReadON();break;case"T":this.private_ReadOT();break;default:this.private_ReadUnknown()}break;case"P":switch(e){case"B":this.private_ReadPB();break;case"C":this.private_ReadPC();break;case"W":this.private_ReadPW();break;case"L":this.private_ReadPL();break;default:this.private_ReadUnknown()}break;case"R":switch(e){case"E":this.private_ReadRE();break;case"O":this.private_ReadRO();break;case"U":this.private_ReadRU();break;default:this.private_ReadUnknown()}break;case"S":switch(e){case"Q":this.private_ReadMark(EDrawingMark.Sq);break;case"T":this.private_ReadST();break;case"Z":this.private_ReadSZ();break;case"O":this.private_ReadSO();break;default:this.private_ReadUnknown()}break;case"T":switch(e){case"R":this.private_ReadMark(EDrawingMark.Tr);break;case"M":this.private_ReadTM();break;case"B":this.private_ReadTerritory(BOARD_BLACK);break;case"W":this.private_ReadTerritory(BOARD_WHITE);break;default:this.private_ReadUnknown()}break;case"U":switch(e){case"S":this.private_ReadUS();break;default:this.private_ReadUnknown()}break;case"W":switch(e){case"[":this.private_ReadMove(BOARD_WHITE);break;case"R":this.private_ReadWR();break;case"T":this.private_ReadWT();break;case"L":this.private_ReadWL();break;default:this.private_ReadUnknown()}break;default:this.private_ReadUnknown()}if(!this.m_bValidNode)return!1;t=this.m_sSGF[this.m_nPos],e=this.m_sSGF[this.m_nPos+1]}return!0},CSgfReader.prototype.private_ReadSimpleText=function(t){void 0===t&&(t="]");for(var e="";void 0!==this.m_sSGF[this.m_nPos]&&t!==this.m_sSGF[this.m_nPos];)e+=this.m_sSGF[this.m_nPos],this.m_nPos++;return void 0===this.m_sSGF[this.m_nPos]&&(this.m_bValidNode=!1),this.m_nPos++,e},CSgfReader.prototype.private_ReadReal=function(t){var e=parseFloat(this.private_ReadSimpleText(t));return isNaN(e)?0:e},CSgfReader.prototype.private_ReadNumber=function(t){var e=parseInt(this.private_ReadSimpleText(t));return isNaN(e)?0:e},CSgfReader.prototype.private_ReadUnknown=function(){for(;;){for(;void 0!==this.m_sSGF[this.m_nPos]&&"]"!==this.m_sSGF[this.m_nPos]&&this.m_nPos<this.m_nLength;)for(this.m_nPos++;"]"===this.m_sSGF[this.m_nPos]&&"\\"===this.m_sSGF[this.m_nPos-1];)this.m_nPos++;if(this.m_nPos++,"["!==this.m_sSGF[this.m_nPos])break}},CSgfReader.prototype.private_LetterToNumber=function(t){var e=t.charCodeAt(0);return e>=g_nSgfReaderCharCode_a&&e<=g_nSgfReaderCharCode_z?e-g_nSgfReaderCharCodeOffsetLo:e>=g_nSgfReaderCharCode_A&&e<=g_nSgfReaderCharCode_Z?e-g_nSgfReaderCharCodeOffsetHi+26:(this.m_bValidNode=!1,0)},CSgfReader.prototype.private_ReadAddOrRemoveStone=function(t){this.m_nPos+=3;var e=[];if("]"!==this.m_sSGF[this.m_nPos]){for(;;){var o=this.m_sSGF[this.m_nPos];this.m_nPos++;var r=this.m_sSGF[this.m_nPos];this.m_nPos++;var i=this.private_LetterToNumber(o),a=this.private_LetterToNumber(r);if(":"===this.m_sSGF[this.m_nPos]){this.m_nPos++,o=this.m_sSGF[this.m_nPos],this.m_nPos++,r=this.m_sSGF[this.m_nPos],this.m_nPos++;for(var n=this.private_LetterToNumber(o),s=this.private_LetterToNumber(r),l=a;l<=s;l++)for(var m=i;m<=n;m++)this.private_RegisterPoint(m,l),e.push(Common_XYtoValue(m,l))}else this.private_RegisterPoint(i,a),e.push(Common_XYtoValue(i,a));if("]"!==this.m_sSGF[this.m_nPos])return void(this.m_bValidNode=!1);if(this.m_nPos++,"["!==this.m_sSGF[this.m_nPos])break;this.m_nPos++}this.m_oGameTree.AddOrRemove_Stones(t,e)}},CSgfReader.prototype.private_ReadAN=function(){this.m_nPos+=3,this.m_oGameTree.Set_GameAnnotator(this.private_ReadSimpleText())},CSgfReader.prototype.private_ReadAP=function(){this.m_nPos+=3,this.m_oGameTree.Set_Application(this.private_ReadSimpleText())},CSgfReader.prototype.private_ReadMove=function(t){if(this.m_nPos+=2,"]"==this.m_sSGF[this.m_nPos])this.m_oGameTree.Add_Move(0,0,t);else{var e=this.m_sSGF[this.m_nPos];this.m_nPos++;var o=this.m_sSGF[this.m_nPos];this.m_nPos++;var r=this.m_oGameTree.Get_Board().Get_Size();if("t"===e&&"t"===o&&r.X<=19&&r.Y<=19)this.m_oGameTree.Add_Move(0,0,t);else{var i=this.private_LetterToNumber(e),a=this.private_LetterToNumber(o);for(this.private_RegisterPoint(i,a),this.m_oGameTree.Add_Move(i,a,t);"]"!==this.m_sSGF[this.m_nPos];)if(++this.m_nPos>=this.m_nLength){this.m_bValidNode=!1;break}}}this.m_nPos++},CSgfReader.prototype.private_ReadBR=function(){this.m_nPos+=3,this.m_oGameTree.Set_BlackRating(this.private_ReadSimpleText())},CSgfReader.prototype.private_ReadBT=function(){this.m_nPos+=3,this.m_oGameTree.Set_BlackTeam(this.private_ReadSimpleText())},CSgfReader.prototype.private_ReadBL=function(){this.m_nPos+=3,this.m_oGameTree.Add_BlackTimeLeft(this.private_ReadReal())},CSgfReader.prototype.private_ReadComments=function(){this.m_nPos+=2;for(var t="";"]"!==this.m_sSGF[this.m_nPos]||"\\"===this.m_sSGF[this.m_nPos-1];)"]"===this.m_sSGF[this.m_nPos+1]&&"\\"===this.m_sSGF[this.m_nPos]?(t+="]",this.m_nPos++):t+=this.m_sSGF[this.m_nPos],this.m_nPos++;switch(this.m_nPos++,this.m_eEncoding){case ESgfEncoding.UTF8:t=Common_UTF8_Decode(t)}var e=this.m_oGameTree.Get_CurNode();e&&e.Add_Comment(t)},CSgfReader.prototype.private_ReadCA=function(){this.m_nPos+=3;var t=this.private_ReadSimpleText();this.m_oGameTree.Set_Charset(t)},CSgfReader.prototype.private_ReadCP=function(){this.m_nPos+=3,this.m_oGameTree.Set_Copyright(this.private_ReadSimpleText())},CSgfReader.prototype.private_ReadMark=function(t){this.m_nPos+=3;var e=[];if("]"!==this.m_sSGF[this.m_nPos]){for(;;){var o=this.m_sSGF[this.m_nPos];this.m_nPos++;var r=this.m_sSGF[this.m_nPos];this.m_nPos++;var i=this.private_LetterToNumber(o),a=this.private_LetterToNumber(r);if(":"===this.m_sSGF[this.m_nPos]){this.m_nPos++,o=this.m_sSGF[this.m_nPos],this.m_nPos++,r=this.m_sSGF[this.m_nPos],this.m_nPos++;for(var n=this.private_LetterToNumber(o),s=this.private_LetterToNumber(r),l=a;l<=s;l++)for(var m=i;m<=n;m++)this.private_RegisterPoint(m,l),e.push(Common_XYtoValue(m,l))}else this.private_RegisterPoint(i,a),e.push(Common_XYtoValue(i,a));if("]"!==this.m_sSGF[this.m_nPos])return void(this.m_bValidNode=!1);if(this.m_nPos++,"["!==this.m_sSGF[this.m_nPos])break;this.m_nPos++}this.m_oGameTree.Add_Mark(t,e)}},CSgfReader.prototype.private_ReadDT=function(){this.m_nPos+=3,this.m_oGameTree.Set_DateTime(this.private_ReadSimpleText())},CSgfReader.prototype.private_ReadEV=function(){this.m_nPos+=3,this.m_oGameTree.Set_GameEvent(this.private_ReadSimpleText())},CSgfReader.prototype.private_ReadFF=function(){this.private_ReadUnknown()},CSgfReader.prototype.private_ReadGN=function(){this.m_nPos+=3,this.m_oGameTree.Set_GameName(this.private_ReadSimpleText())},CSgfReader.prototype.private_ReadGC=function(){this.m_nPos+=3,this.m_oGameTree.Set_GameInfo(this.private_ReadSimpleText())},CSgfReader.prototype.private_ReadGM=function(){this.m_nPos+=3,1!==this.private_ReadNumber()&&(this.m_bValidNode=!1)},CSgfReader.prototype.private_ReadLB=function(){for(this.m_nPos+=3;;){var t=this.m_sSGF[this.m_nPos];this.m_nPos++;var e=this.m_sSGF[this.m_nPos];this.m_nPos++;var o=this.private_LetterToNumber(t),r=this.private_LetterToNumber(e);this.m_nPos++;for(var i="";"]"!==this.m_sSGF[this.m_nPos]&&this.m_nPos<this.m_nLength;)i+=this.m_sSGF[this.m_nPos],this.m_nPos++;if(this.private_RegisterPoint(o,r),this.m_oGameTree.Add_TextMark(i,Common_XYtoValue(o,r)),"]"!==this.m_sSGF[this.m_nPos])return void(this.m_bValidNode=!1);if(this.m_nPos++,"["!==this.m_sSGF[this.m_nPos])break;this.m_nPos++}},CSgfReader.prototype.private_ReadOT=function(){this.m_nPos+=3,this.m_oGameTree.Set_OverTime(this.private_ReadSimpleText())},CSgfReader.prototype.private_ReadPB=function(){this.m_nPos+=3,this.m_oGameTree.Set_Black(this.private_ReadSimpleText())},CSgfReader.prototype.private_ReadPC=function(){this.m_nPos+=3,this.m_oGameTree.Set_GamePlace(this.private_ReadSimpleText())},CSgfReader.prototype.private_ReadPL=function(){this.m_nPos+=3,"W"===this.private_ReadSimpleText()?this.m_oGameTree.Set_NextMove(BOARD_WHITE):this.m_oGameTree.Set_NextMove(BOARD_BLACK)},CSgfReader.prototype.private_ReadPW=function(){this.m_nPos+=3,this.m_oGameTree.Set_White(this.private_ReadSimpleText())},CSgfReader.prototype.private_ReadRE=function(){this.m_nPos+=3,this.m_oGameTree.Set_Result(this.private_ReadSimpleText())},CSgfReader.prototype.private_ReadRO=function(){this.m_nPos+=3,this.m_oGameTree.Set_GameRound(this.private_ReadSimpleText())},CSgfReader.prototype.private_ReadRU=function(){this.m_nPos+=3,this.m_oGameTree.Set_Rules(this.private_ReadSimpleText())},CSgfReader.prototype.private_ReadST=function(){switch(this.m_nPos+=3,this.private_ReadNumber()){case 0:this.m_oGameTree.Set_ShowVariants(EShowVariants.Next);break;case 1:this.m_oGameTree.Set_ShowVariants(EShowVariants.Curr);break;default:this.m_oGameTree.Set_ShowVariants(EShowVariants.None)}},CSgfReader.prototype.private_ReadSZ=function(){this.m_nPos+=3;var t=this.private_ReadSimpleText(),e=19,o=19,r=-1;-1==(r=t.indexOf(":"))?o=e=Math.min(52,Math.max(parseInt(t),2)):(e=parseInt(t.substr(0,r)),o=parseInt(t.substr(r+1,t.length-r-1))),this.m_oGameTree.Set_BoardSize(e,o)},CSgfReader.prototype.private_ReadSO=function(){this.m_nPos+=3,this.m_oGameTree.Set_GameSource(this.private_ReadSimpleText())},CSgfReader.prototype.private_ReadTM=function(){this.m_nPos+=3,this.m_oGameTree.Set_TimeLimit(this.private_ReadSimpleText())},CSgfReader.prototype.private_ReadTerritory=function(t){this.m_nPos+=3;var e=[];if("]"!==this.m_sSGF[this.m_nPos])for(;;){var o=this.m_sSGF[this.m_nPos];this.m_nPos++;var r=this.m_sSGF[this.m_nPos];this.m_nPos++;var i=this.private_LetterToNumber(o),a=this.private_LetterToNumber(r);if(":"===this.m_sSGF[this.m_nPos]){this.m_nPos++,o=this.m_sSGF[this.m_nPos],this.m_nPos++,r=this.m_sSGF[this.m_nPos],this.m_nPos++;for(var n=this.private_LetterToNumber(o),s=this.private_LetterToNumber(r),l=a;l<=s;l++)for(var m=i;m<=n;m++)e.push(Common_XYtoValue(m,l))}else e.push(Common_XYtoValue(i,a));if("]"!==this.m_sSGF[this.m_nPos])return void(this.m_bValidNode=!1);if(this.m_nPos++,"["!==this.m_sSGF[this.m_nPos])break;this.m_nPos++}},CSgfReader.prototype.private_ReadUS=function(){this.m_nPos+=3,this.m_oGameTree.Set_GameTranscriber(this.private_ReadSimpleText())},CSgfReader.prototype.private_ReadWR=function(){this.m_nPos+=3,this.m_oGameTree.Set_WhiteRating(this.private_ReadSimpleText())},CSgfReader.prototype.private_ReadWT=function(){this.m_nPos+=3,this.m_oGameTree.Set_WhiteTeam(this.private_ReadSimpleText())},CSgfReader.prototype.private_ReadWL=function(){this.m_nPos+=3,this.m_oGameTree.Add_WhiteTimeLeft(this.private_ReadReal())},CSgfReader.prototype.private_RegisterPoint=function(t,e){t<this.m_oViewPort.X0&&(this.m_oViewPort.X0=t),t>this.m_oViewPort.X1&&(this.m_oViewPort.X1=t),e<this.m_oViewPort.Y0&&(this.m_oViewPort.Y0=e),e>this.m_oViewPort.Y1&&(this.m_oViewPort.Y1=e)},CSgfReader.prototype.private_ReadCT=function(){this.m_nPos+=3;var t=this.private_ReadSimpleText();if(""!==t){var e=Common.Decode_Base64(t),o=new CStreamReader(e,e.length);if("SGFCT"===o.Get_String(5)){o.Get_Short();var r=o.Get_Long();this.m_oColorTable=[];for(var i=0;i<r;i++){var a=o.Get_Long();this.m_oColorTable[i]=new CColor(0,0,0,0),this.m_oColorTable[i].FromLong(a)}}}},CSgfReader.prototype.private_ReadCM=function(){this.m_nPos+=3;var t=this.private_ReadSimpleText();if(""!==t){var e=Common.Decode_Base64(t),o=new CStreamReader(e,e.length);if("SGFCM"===o.Get_String(5)){o.Get_Short();var r=o.Get_Short(),i=o.Get_Short(),a=this.m_oGameTree.Get_CurNode();a.m_oColorMap={};for(var n=0;n<i;n++)for(var s=0;s<r;s++){var l=o.Get_Byte();if(void 0!==this.m_oColorTable[l]&&0!==this.m_oColorTable[l].a){var m=Common_XYtoValue(s+1,n+1);a.m_oColorMap[m]=this.m_oColorTable[l].Copy()}}}}},CFileReaderBase.prototype.private_Normalize=function(t){for(var e=t.length,o=[],r=0;r<e;)o.push(t.charAt(r++));this.m_nPos=0,this.m_sFile=o,this.m_nSize=this.m_sFile.length},CFileReaderBase.prototype.private_PrepareGameTree=function(){this.m_oGameTree.Reset(),this.m_oGameTree.Set_CurNode(this.m_oGameTree.Get_FirstNode()),this.m_oGameTree.m_oCurNode.m_bLoaded=!0},CFileReaderBase.prototype.private_ReadChar=function(){return this.m_nPos>=this.m_nSize?-1:this.m_sFile[this.m_nPos++]},CFileReaderBase.prototype.private_ReadLine=function(){for(var t="",e=null;-1!==e&&"\n"!==e;)t+=e=this.private_ReadChar();return t},CFileReaderBase.prototype.private_IsEOF=function(){return this.m_nPos>=this.m_nSize},CSgfWriter.prototype.Write=function(t){this.m_oGameTree=t,this.m_sFile="",this.m_oColorTable=null,this.private_Write(t.Get_FirstNode())},CSgfWriter.prototype.private_WriteString=function(t){this.m_sFile+=t},CSgfWriter.prototype.private_WriteCommandName=function(t){this.private_WriteString(t)},CSgfWriter.prototype.private_WriteMovePos=function(t){0!=t?this.private_WritePos(t):this.private_WriteString(String.fromCharCode(91,93))},CSgfWriter.prototype.private_NumberToCharCode=function(t){return t<=26?g_nSgfReaderCharCodeOffsetLo+t:g_nSgfReaderCharCodeOffsetHi+t-26},CSgfWriter.prototype.private_WritePos=function(t){var e=Common_ValuetoXY(t);this.private_WriteString(String.fromCharCode(91,this.private_NumberToCharCode(e.X),this.private_NumberToCharCode(e.Y),93))},CSgfWriter.prototype.private_WritePos2=function(t){var e=Common_ValuetoXY(t);this.private_WriteString(String.fromCharCode(this.private_NumberToCharCode(e.X),this.private_NumberToCharCode(e.Y)))},CSgfWriter.prototype.private_WritePosArray=function(t){for(var e=0,o=t.length;e<o;e++)this.private_WritePos(t[e])},CSgfWriter.prototype.private_WriteReal=function(t){this.private_WriteString("["+t+"]")},CSgfWriter.prototype.private_WriteSimpleText=function(t){this.private_WriteString("["+t+"]")},CSgfWriter.prototype.private_WriteCommand=function(t,e){this.private_WriteCommandName(t),this.private_WriteSimpleText(e)},CSgfWriter.prototype.private_WriteNonEmptyCommand=function(t,e){e&&""!==e&&this.private_WriteCommand(t,e)},CSgfWriter.prototype.private_WriteGameInfo=function(){var t=this.m_oGameTree,e=t.Get_Board().Get_Size();this.private_WriteCommand("GM",4),this.private_WriteCommand("FF",4),this.private_WriteCommand("CA","UTF-8"),this.private_WriteCommand("AP","Web Renju Board:"+RenjuBoardApi.Get_Version()),this.private_WriteCommand("ST",t.Get_ShowVariants()),this.private_WriteNonEmptyCommand("RU",t.Get_Rules()),this.private_WriteCommand("SZ",e.X==e.Y?e.X:e.X+":"+e.Y),this.private_WriteNonEmptyCommand("TM",t.Get_TimeLimit()),this.private_WriteNonEmptyCommand("OT",t.Get_OverTime()),this.private_WriteNonEmptyCommand("RE",t.Get_Result()),this.private_WriteNonEmptyCommand("GN",t.Get_GameName()),this.private_WriteNonEmptyCommand("DT",t.Get_DateTime()),this.private_WriteNonEmptyCommand("CP",t.Get_Copyright()),this.private_WriteNonEmptyCommand("GC",t.Get_GameInfo()),this.private_WriteNonEmptyCommand("PB",t.Get_BlackName()),this.private_WriteNonEmptyCommand("BR",t.Get_BlackRating()),this.private_WriteNonEmptyCommand("BT",t.Get_BlackTeam()),this.private_WriteNonEmptyCommand("PW",t.Get_WhiteName()),this.private_WriteNonEmptyCommand("WR",t.Get_WhiteRating()),this.private_WriteNonEmptyCommand("WT",t.Get_WhiteTeam()),this.private_WriteNonEmptyCommand("EV",t.Get_GameEvent()),this.private_WriteNonEmptyCommand("RO",t.Get_GameRound()),this.private_WriteNonEmptyCommand("PC",t.Get_GamePlace()),this.private_WriteNonEmptyCommand("AN",t.Get_GameAnnotator()),this.private_WriteNonEmptyCommand("SO",t.Get_GameSource()),this.private_WriteNonEmptyCommand("US",t.Get_GameTranscriber());var o={};this.m_oGameTree.Get_FirstNode().Get_ColorTable(o);var r=1,i=[];for(var a in o)o[a]=r,i[r++]=0|a;r>1&&(o[0]=0,i[0]=0,this.m_oColorTable=o,this.private_WriteColorTable(i))},CSgfWriter.prototype.private_WriteNode=function(t){this.private_WriteString(";"),t===this.m_oGameTree.Get_FirstNode()&&this.private_WriteGameInfo(),this.private_WriteAddOrRemoveStones(t),this.private_WriteMarks(t);for(var e=0,o=t.Get_CommandsCount();e<o;e++){var r=t.Get_Command(e),i=r.Get_Type(),a=r.Get_Value();switch(i){case ECommand.AB:case ECommand.AW:case ECommand.AE:break;case ECommand.B:this.private_WriteCommandName("B"),this.private_WriteMovePos(a);break;case ECommand.W:this.private_WriteCommandName("W"),this.private_WriteMovePos(a);break;case ECommand.BL:this.private_WriteCommandName("BL"),this.private_WriteReal(a);break;case ECommand.WL:this.private_WriteCommandName("WL"),this.private_WriteReal(a);break;case ECommand.RM:case ECommand.CR:case ECommand.MA:case ECommand.SQ:case ECommand.TR:case ECommand.LB:break;case ECommand.PL:this.private_WriteCommandName("PL"),this.private_WriteSimpleText(a===BOARD_WHITE?"W":"B")}}var n=t.Get_Comment();""!==n&&(n=n.replace(new RegExp("]","g"),"\\]"),this.private_WriteCommandName("C"),this.private_WriteString("["),this.private_WriteString(n),this.private_WriteString("]")),null!==this.m_oColorTable&&this.private_WriteNodeColorMap(t)},CSgfWriter.prototype.private_Write=function(t){var e=t.Get_Prev(),o=!1;(null===e||e.Get_NextsCount()>1)&&(o=!0),o&&this.private_WriteString("("),this.private_WriteNode(t);for(var r=0,i=t.Get_NextsCount();r<i;r++)this.private_Write(t.Get_Next(r));o&&this.private_WriteString(")")},CSgfWriter.prototype.private_WriteColorTable=function(t){var e=new CStreamWriter;e.Write_String("SGFCT"),e.Write_Short(1),e.Write_Long(t.length);for(var o=0,r=t.length;o<r;o++)e.Write_Long(t[o]);var i=Common.Encode_Base64(e.Get_Bytes());this.private_WriteCommand("CT",i)},CSgfWriter.prototype.private_WriteNodeColorMap=function(t){var e=new CStreamWriter;e.Write_String("SGFCM"),e.Write_Short(1);var o=this.m_oGameTree.Get_Board().Get_Size(),r=o.X,i=o.Y;e.Write_Short(r),e.Write_Short(i);for(var a=!1,n=0;n<i;n++)for(var s=0;s<r;s++){var l=t.m_oColorMap[Common_XYtoValue(s+1,n+1)];if(l){var m=l.ToLong();void 0!==this.m_oColorTable[m]?(e.Write_Byte(this.m_oColorTable[m]),a=!0):e.Write_Byte(0)}else e.Write_Byte(0)}if(!0===a){var _=Common.Encode_Base64(e.Get_Bytes());this.private_WriteCommand("CM",_)}},CSgfWriter.prototype.private_WriteAddOrRemoveStones=function(t){for(var e=[],o=[],r=[],i=0,a=t.Get_CommandsCount();i<a;i++){var n=t.Get_Command(i),s=n.Get_Type(),l=n.Get_Value();switch(s){case ECommand.AB:case ECommand.AW:case ECommand.AE:for(var m=0,_=l.length;m<_;m++){for(var h=l[m],d=0,p=e.length;d<p;d++)h===e[d]&&(e.splice(d,1),p--,d--);for(var d=0,p=o.length;d<p;d++)h===o[d]&&(o.splice(d,1),p--,d--);for(var d=0,p=r.length;d<p;d++)h===r[d]&&(r.splice(d,1),p--,d--);ECommand.AB===s?e.push(h):ECommand.AW===s?o.push(h):ECommand.AE===s&&r.push(h)}}}e.length>0&&(this.private_WriteCommandName("AB"),this.private_WritePosArray(e)),o.length>0&&(this.private_WriteCommandName("AW"),this.private_WritePosArray(o)),r.length>0&&(this.private_WriteCommandName("AE"),this.private_WritePosArray(r))},CSgfWriter.prototype.private_WriteMarks=function(t){for(var e=[[],[],[],[],[],[]],o=[],r=0,i=t.Get_CommandsCount();r<i;r++){var a=t.Get_Command(r),n=a.Get_Type(),s=a.Get_Value(),l=-1;switch(n){case ECommand.LB:l=0,s=[s.Pos];break;case ECommand.CR:l=1;break;case ECommand.MA:l=2;break;case ECommand.SQ:l=3;break;case ECommand.TR:l=4;break;case ECommand.RM:l=5}for(var m=0,_=s.length;m<_;m++)for(var h=s[m],d=0,p=e.length;d<p;d++)if(d===l)e[d].push(h),0==d&&o.push(a.Get_Value().Text);else for(var u=0,C=e[d].length;u<C;u++)h===e[d][u]&&(e[d].splice(u,1),0===d&&o.splice(u,1),C--,u--)}if(e[0].length>0){this.private_WriteCommandName("LB");for(var m=0,i=e[0].length;m<i;m++)this.private_WriteString("["),this.private_WritePos2(e[0][m]),this.private_WriteString(":"+o[m]+"]")}e[1].length>0&&(this.private_WriteCommandName("CR"),this.private_WritePosArray(e[1])),e[2].length>0&&(this.private_WriteCommandName("MA"),this.private_WritePosArray(e[2])),e[3].length>0&&(this.private_WriteCommandName("SQ"),this.private_WritePosArray(e[3])),e[4].length>0&&(this.private_WriteCommandName("TR"),this.private_WritePosArray(e[4]))},CRenjuBoardApi.prototype.Version="1.0.0";var EBoardMode={Move:0,AddRemove:2,AddMarkTr:3,AddMarkSq:4,AddMarkCr:5,AddMarkX:6,AddMarkTx:7,AddMarkNum:8,AddMarkColor:10,ViewPort:11};CDrawingBoard.prototype.Init=function(t,e){this.m_oDrawing&&this.m_oDrawing.Register_Board(this),this.Set_GameTree(e),this.HtmlElement.Control=CreateControlContainer(t);var o=this.HtmlElement.Control.HtmlElement,r=t+"_BoardCanvas",i=t+"_LinesCanvas",a=t+"_ColorCanvas",n=t+"_ShadowsCanvas",s=t+"_StonesCanvas",l=t+"_VariantsCanvas",m=t+"_MarksCanvas",_=t+"_TargetCanvas",h=t+"_SelectCanvas",d=t+"_CursorCanvas",p=t+"_EventDiv";this.private_CreateCanvasElement(o,r),this.private_CreateCanvasElement(o,i),this.private_CreateCanvasElement(o,a),this.private_CreateCanvasElement(o,n),this.private_CreateCanvasElement(o,s),this.private_CreateCanvasElement(o,l),this.private_CreateCanvasElement(o,m),this.private_CreateCanvasElement(o,h),this.private_CreateCanvasElement(o,_),this.private_CreateDivElement(o,d);var u=this.private_CreateDivElement(o,p);this.m_oTarget.Init(d);var C=this.HtmlElement.Control;return this.private_FillHtmlElement(this.HtmlElement.Board,C,r),this.private_FillHtmlElement(this.HtmlElement.Lines,C,i),this.private_FillHtmlElement(this.HtmlElement.Colors,C,a),this.private_FillHtmlElement(this.HtmlElement.Shadow,C,n),this.private_FillHtmlElement(this.HtmlElement.Stones,C,s),this.private_FillHtmlElement(this.HtmlElement.Variants,C,l),this.private_FillHtmlElement(this.HtmlElement.Marks,C,m),this.private_FillHtmlElement(this.HtmlElement.Select,C,h),this.private_FillHtmlElement(this.HtmlElement.Target,C,_),this.private_FillHtmlElement(this.HtmlElement.Event,C,p),u.onmousemove=this.private_OnMouseMove,u.onmouseout=this.private_OnMouseOut,u.onmousedown=this.private_OnMouseDown,u.onmouseup=this.private_OnMouseUp,u.onkeydown=this.private_OnKeyDown,u.onkeyup=this.private_OnKeyUp,u.onkeypress=this.private_OnKeyPress,u.tabIndex=-1,u.style.hidefocus=!0,u.style.outline=0,u.ondragover=this.private_OnDragover,u.ondrop=this.private_OnDrop,u.onmousewheel=this.private_OnMouseWheel,u.addEventListener&&(u.addEventListener("contextmenu",this.private_OnContextMenu,!1),u.addEventListener("DOMMouseScroll",this.private_OnMouseWheel,!1)),C},CDrawingBoard.prototype.Add_LinkedControl=function(t){this.HtmlElement.LinkedControls.push(t)},CDrawingBoard.prototype.Focus=function(){this.HtmlElement.Event.Control.HtmlElement.focus()},CDrawingBoard.prototype.Set_Rulers=function(t){t!==this.m_bRulers&&(g_oGlobalSettings.Set_Rulers(t),this.m_bRulers=t,this.m_oDrawing.Update_Size(!0))},CDrawingBoard.prototype.Get_Rulers=function(){return this.m_bRulers},CDrawingBoard.prototype.Set_ShellWhiteStones=function(t){this.m_oGameTree&&this.m_oGameTree.Get_LocalSettings().Set_BoardShellWhiteStones(t)},CDrawingBoard.prototype.Set_BlackWhiteLastMark=function(t){this.m_bBlackWhiteLastMark=t},CDrawingBoard.prototype.Get_FullImage=function(t){var e=document.createElement("canvas"),o=e.getContext("2d");return e.width=this.HtmlElement.Board.Control.HtmlElement.width,e.height=this.HtmlElement.Board.Control.HtmlElement.height,o.drawImage(this.HtmlElement.Board.Control.HtmlElement,0,0),o.drawImage(this.HtmlElement.Lines.Control.HtmlElement,0,0),!0===t&&o.drawImage(this.HtmlElement.Colors.Control.HtmlElement,0,0),o.drawImage(this.HtmlElement.Shadow.Control.HtmlElement,0,0),o.drawImage(this.HtmlElement.Stones.Control.HtmlElement,0,0),o.drawImage(this.HtmlElement.Marks.Control.HtmlElement,0,0),e},CDrawingBoard.prototype.Update_Size=function(t){var e=this.HtmlElement.Control.HtmlElement.clientWidth,o=this.HtmlElement.Control.HtmlElement.clientHeight,r=this.Get_AspectRatio(),i=o*r,a=e/r;i<=e?e=i:o=a,e===this.m_oImageData.W2&&o===this.m_oImageData.H2&&!0!==t||(this.m_oImageData.W2=e,this.m_oImageData.H2=o,this.HtmlElement.Control.Resize(e,o),this.private_UpdateKoeffs(),this.private_OnResize(t))},CDrawingBoard.prototype.Set_Presentation=function(t){this.m_oPresentation=t},CDrawingBoard.prototype.On_Resize=function(t){this.private_UpdateKoeffs(),this.private_OnResize(t)},CDrawingBoard.prototype.On_EndLoadSgf=function(){this.m_oImageData.ResizeBoard=null,null!==this.m_oPresentation&&this.m_oGameTree.Get_CurNode().Count_NodeNumber()>=this.m_oPresentation.Get_NodesCountInSlide()&&this.m_oPresentation.On_EndSgfSlide()},CDrawingBoard.prototype.Set_ViewPort=function(t,e,o,r){var i=this.m_oLogicBoard.Get_Size(),a=i.X,n=i.Y;this.m_oViewPort.X0=Math.max(0,Math.min(a-1,t)),this.m_oViewPort.Y0=Math.max(0,Math.min(n-1,e)),this.m_oViewPort.X1=Math.max(0,Math.min(a-1,o)),this.m_oViewPort.Y1=Math.max(0,Math.min(n-1,r)),this.m_oViewPort.X1<=this.m_oViewPort.X0&&(this.m_oViewPort.X0=0,this.m_oViewPort.X1=a-1),this.m_oViewPort.Y1<=this.m_oViewPort.Y0&&(this.m_oViewPort.Y0=0,this.m_oViewPort.Y1=n-1)},CDrawingBoard.prototype.Get_ViewPort=function(){return this.m_oViewPort},CDrawingBoard.prototype.Reset_ViewPort=function(){var t=this.m_oLogicBoard.Get_Size(),e=t.X,o=t.Y;this.m_oViewPort.X0=0,this.m_oViewPort.Y0=0,this.m_oViewPort.X1=e-1,this.m_oViewPort.Y1=o-1},CDrawingBoard.prototype.Get_ViewPort=function(){return this.m_oViewPort},CDrawingBoard.prototype.Get_SelectedViewPort=function(){var t=Math.min(this.m_oViewPortSelection.StartX,this.m_oViewPortSelection.EndX),e=Math.max(this.m_oViewPortSelection.StartX,this.m_oViewPortSelection.EndX);return{X0:t,Y0:Math.min(this.m_oViewPortSelection.StartY,this.m_oViewPortSelection.EndY),X1:e,Y1:Math.max(this.m_oViewPortSelection.StartY,this.m_oViewPortSelection.EndY)}},CDrawingBoard.prototype.Draw_Sector=function(t,e,o){if(this.m_oImageData.Lines&&o!==this.m_oBoardPosition[Common_XYtoValue(t,e)]){var r=this.HtmlElement.Stones.Control.HtmlElement.getContext("2d"),i=this.HtmlElement.Shadow.Control.HtmlElement.getContext("2d"),a=this.m_oImageData.StoneDiam,n=(a-1)/2,s=this.m_oImageData.Lines,l=this.m_oImageData.ShadowOff,m=this.private_GetSettings_Shadows();if(!0===this.private_IsPointInViewPort(t-1,e-1)){var _=s[t-1].X-n,h=s[e-1].Y-n;switch(o){case BOARD_BLACK:r.putImageData(this.m_oImageData.BlackStone,_,h),!0===m&&i.putImageData(this.m_oImageData.Shadow,_+l,h+l);break;case BOARD_WHITE:var d=this.m_oImageData.WhiteStones2[t-1+(e-1)*this.m_oLogicBoard.Get_Size().X];r.putImageData(this.m_oImageData.WhiteStones[d],_,h),!0===m&&i.putImageData(this.m_oImageData.Shadow,_+l,h+l);break;case BOARD_EMPTY:default:r.clearRect(_,h,a,a),!0===m&&i.clearRect(_+l,h+l,a,a)}}this.m_oBoardPosition[Common_XYtoValue(t,e)]=o,!0===this.m_oTarget.Check_XY(t,e)&&this.private_UpdateTargetType()}},CDrawingBoard.prototype.Get_BoardState=function(){var t={},e={};for(var o in this.m_oBoardPosition)t[o]=this.m_oBoardPosition[o];for(var r in this.m_oMarks){var o=parseInt(r),i=this.m_oMarks[r];EDrawingMark.Tx===i.Get_Type()&&BOARD_EMPTY===this.m_oLogicBoard.Get(i.Get_X(),i.Get_Y())?e[o]=!1:e[o]=!0}return{Stones:t,Marks:e}},CDrawingBoard.prototype.Get_BoardAreaByPosition=function(t,e,o,r){if(!0!==this.private_IsPointInViewPort(t-1,e-1))return null;var i=this.m_oImageData.Lines;if(!0===r){var a=this.m_oImageData.StoneDiam,n=(a-1)/2,s=o?this.m_oImageData.ShadowOff:0,l=i[t-1].X-n,m=i[e-1].Y-n;return{X0:l,Y0:m,X1:l+a+s,Y1:m+a+s}}var _=i[1].X-i[0].X+2,h=i[1].Y-i[0].Y+2,d=i[t-1].X_L2,p=i[e-1].Y_L2;return{X0:d,Y0:p,X1:d+_,Y1:p+h}},CDrawingBoard.prototype.Show_Target=function(){this.private_UpdateTargetType()},CDrawingBoard.prototype.Remove_Mark=function(t,e){var o=Common_XYtoValue(t,e);delete this.m_oMarks[""+o],o===this.m_oLastMoveMark&&(this.m_oMarks[""+o]=new CDrawingMark(t,e,EDrawingMark.Lm,""))},CDrawingBoard.prototype.Get_Mark=function(t,e){var o=Common_XYtoValue(t,e),r=this.m_oMarks[""+o];return r||null},CDrawingBoard.prototype.Add_Mark=function(t){this.private_SetMark(t.Get_X(),t.Get_Y(),t)},CDrawingBoard.prototype.Remove_AllMarks=function(){this.m_oMarks={}},CDrawingBoard.prototype.Draw_Marks=function(){this.private_DrawMarks()},CDrawingBoard.prototype.Draw_AllStones=function(){this.private_DrawTrueColorAllStones()},CDrawingBoard.prototype.Set_LastMoveMark=function(t,e){this.private_SetLastMoveMark(t,e)},CDrawingBoard.prototype.Set_ViewPortMode=function(){this.Set_Mode(EBoardMode.ViewPort)},CDrawingBoard.prototype.Set_GameTree=function(t){this.m_oGameTree=t,this.m_oLogicBoard=t.Get_Board(),t.Set_DrawingBoard(this),this.Reset_ViewPort()},CDrawingBoard.prototype.Set_Mode=function(t){(this.m_oGameTree.m_nEditingFlags&EDITINGFLAGS_BOARDMODE||t===EBoardMode.ViewPort)&&this.m_eMode!==t&&(this.m_eMode=t,this.private_UpdateTargetType(),this.m_oGameTree.Update_InterfaceState())},CDrawingBoard.prototype.Get_Mode=function(){return this.m_eMode},CDrawingBoard.prototype.private_DrawVariants=function(){this.m_oGameTree&&this.m_oGameTree.Show_Variants()},CDrawingBoard.prototype.Draw_Variant=function(t,e){if(this.m_oImageData.Lines){var o=(this.m_oImageData.StoneDiam/2-1)/2,r=this.m_oImageData.Lines;if(!0===this.private_IsPointInViewPort(t-1,e-1)){var i=r[t-1].X,a=r[e-1].Y,n=this.HtmlElement.Variants.Control.HtmlElement.getContext("2d");n.fillStyle=this.m_oVariantsColor.ToString(),n.beginPath(),n.arc(i,a,o,0,2*Math.PI,!1),n.fill()}}},CDrawingBoard.prototype.Clear_Variants=function(){this.HtmlElement.Variants.Control.HtmlElement.getContext("2d").clearRect(0,0,this.m_oImageData.W,this.m_oImageData.H)},CDrawingBoard.prototype.Get_AspectRatio=function(){var t=this.m_oLogicBoard.Get_Size(),e=t.X,o=t.Y,r=(this.m_oViewPort.X1-this.m_oViewPort.X0)*g_dBoardCellW+2*g_dBoardHorOffset,i=(this.m_oViewPort.Y1-this.m_oViewPort.Y0)*g_dBoardCellW+2*g_dBoardHorOffset;return!0===this.m_bRulers&&(r+=g_dBoardCellW,i+=g_dBoardCellW),this.m_oViewPort.X0>0&&(r+=g_dBoardCellW_2/2),this.m_oViewPort.X1<e-1&&(r+=g_dBoardCellW_2/2),this.m_oViewPort.Y0>0&&(i+=g_dBoardCellW_2/2),this.m_oViewPort.Y1<o-1&&(i+=g_dBoardCellW_2/2),r/i},CDrawingBoard.prototype.private_CreateCanvasElement=function(t,e){var o=document.createElement("canvas");return o.setAttribute("id",e),o.setAttribute("style","position:absolute;padding:0;margin:0;"),o.setAttribute("oncontextmenu","return false;"),t.appendChild(o),o},CDrawingBoard.prototype.private_CreateDivElement=function(t,e){var o=document.createElement("div");return o.setAttribute("id",e),o.setAttribute("style","position:absolute;padding:0;margin:0;"),o.setAttribute("oncontextmenu","return false;"),t.appendChild(o),o},CDrawingBoard.prototype.private_FillHtmlElement=function(t,e,o){t.Control=CreateControlContainer(o);var r=t.Control;r.Bounds.SetParams(0,0,1e3,1e3,!1,!1,!1,!1,-1,-1),r.Anchor=g_anchor_top|g_anchor_left|g_anchor_bottom|g_anchor_right,e.AddControl(r)},CDrawingBoard.prototype.private_UpdateMousePos=function(t,e){var o=Common_FindPosition(this.HtmlElement.Board.Control.HtmlElement);return{X:t-o.X,Y:e-o.Y}},CDrawingBoard.prototype.private_UpdateKoeffs=function(){var t=this.m_oLogicBoard.Get_Size(),e=t.X,o=t.Y;this.m_oViewPort.X0=Math.max(0,Math.min(e-1,this.m_oViewPort.X0)),this.m_oViewPort.Y0=Math.max(0,Math.min(o-1,this.m_oViewPort.Y0)),this.m_oViewPort.X1=Math.max(0,Math.min(e-1,this.m_oViewPort.X1)),this.m_oViewPort.Y1=Math.max(0,Math.min(o-1,this.m_oViewPort.Y1)),this.m_oViewPort.X1<=this.m_oViewPort.X0&&(this.m_oViewPort.X0=0,this.m_oViewPort.X1=e-1),this.m_oViewPort.Y1<=this.m_oViewPort.Y0&&(this.m_oViewPort.Y0=0,this.m_oViewPort.Y1=o-1);var r=(this.m_oViewPort.X1-this.m_oViewPort.X0)*g_dBoardCellW+2*g_dBoardHorOffset,i=(this.m_oViewPort.Y1-this.m_oViewPort.Y0)*g_dBoardCellW+2*g_dBoardHorOffset,a=g_dBoardHorOffset,n=g_dBoardHorOffset;!0===this.m_bRulers&&(r+=g_dBoardCellW,i+=g_dBoardCellW,a+=g_dBoardCellW_2,n+=g_dBoardCellW_2),this.m_oViewPort.X0>0&&(r+=g_dBoardCellW_2/2,a+=g_dBoardCellW_2/2),this.m_oViewPort.X1<e-1&&(r+=g_dBoardCellW_2/2),this.m_oViewPort.Y0>0&&(i+=g_dBoardCellW_2/2,n+=g_dBoardCellW_2/2),this.m_oViewPort.Y1<o-1&&(i+=g_dBoardCellW_2/2),this.m_dKoeffCellH=g_dBoardCellW/i,this.m_dKoeffCellW=g_dBoardCellW/r,this.m_dKoeffOffsetX=a/r,this.m_dKoeffOffsetY=n/i,this.m_dKoeffDiam=4/r},CDrawingBoard.prototype.private_OnResize=function(t){var e=this.HtmlElement.Board.Control.HtmlElement.width,o=this.HtmlElement.Board.Control.HtmlElement.height;e!=this.m_oImageData.W||o!=this.m_oImageData.H||null===this.m_oImageData.Board||null!==this.m_oCreateWoodyId||!0===t?(null!==this.m_oCreateWoodyId&&clearTimeout(this.m_oCreateWoodyId),this.m_oCreateWoodyId=this.private_StartDrawingTimer(),this.private_CreateLines(),this.private_DrawSimpleBoard(e,o)):this.private_DrawTrueColorFullBoard(),EBoardMode.ViewPort===this.m_eMode&&this.private_UpdateSelectCanvas()},CDrawingBoard.prototype.private_DrawSimpleBoard=function(t,e){if(0!==t&&0!==e)if(null===this.m_oImageData.ResizeBoard){var o=this.HtmlElement.Board.Control.HtmlElement.getContext("2d");o.fillStyle=this.private_GetSettings_BoardColor().ToString(),o.fillRect(0,0,t,e);var r=this.HtmlElement.Lines.Control.HtmlElement.getContext("2d"),i=this.m_dKoeffCellW*t,a=this.m_dKoeffCellH*e,n=this.m_dKoeffOffsetX*t-this.m_oViewPort.X0*i,s=this.m_dKoeffOffsetY*e-this.m_oViewPort.Y0*a,l=this.m_oLogicBoard.Get_Size();r.clearRect(0,0,t,e),r.strokeStyle=this.private_GetSettings_LinesColor().ToString();for(var m=n,_=m+(l.X-1)*i,h=0;h<l.Y;h++){var d=s+h*a;r.beginPath(),r.moveTo(m,d),r.lineTo(_,d),r.stroke()}for(var p=s,u=p+(l.Y-1)*a,C=0;C<l.X;C++){var g=n+C*i;r.beginPath(),r.moveTo(g,p),r.lineTo(g,u),r.stroke()}r.fillStyle=this.private_GetSettings_LinesColor().ToString();for(var c=Math.max(2,this.m_dKoeffDiam*t/2),v=this.m_oLogicBoard.Get_HandiPoints(),f=0,w=v.length;f<w;f++){var S=n+v[f][0]*i,T=s+v[f][1]*i;r.beginPath(),r.arc(S,T,c,0,2*Math.PI,!1),r.fill()}var y=this.HtmlElement.Stones.Control.HtmlElement.getContext("2d");y.clearRect(0,0,t,e),y.strokeStyle=this.private_GetSettings_LinesColor().ToString(),y.lineWidth=1;for(var D=new CColor(0,0,0,255).ToString(),E=new CColor(255,255,255,255).ToString(),h=1;h<=l.Y;h++)for(C=1;C<=l.X;C++){var B=this.m_oLogicBoard.Get(C,h);if(BOARD_BLACK===B)y.fillStyle=D;else{if(BOARD_WHITE!==B)continue;y.fillStyle=E}var S=n+(C-1)*i,T=s+(h-1)*a;y.beginPath(),y.arc(S,T,i/2,0,2*Math.PI,!1),y.fill(),y.stroke()}this.HtmlElement.Shadow.Control.HtmlElement.getContext("2d").clearRect(0,0,t,e),this.HtmlElement.Variants.Control.HtmlElement.getContext("2d").clearRect(0,0,t,e),this.HtmlElement.Marks.Control.HtmlElement.getContext("2d").clearRect(0,0,t,e),this.HtmlElement.Target.Control.HtmlElement.getContext("2d").clearRect(0,0,t,e),this.HtmlElement.Select.Control.HtmlElement.getContext("2d").clearRect(0,0,t,e)}else this.HtmlElement.Board.Control.HtmlElement.getContext("2d").drawImage(this.m_oImageData.ResizeBoard,0,0,t,e)},CDrawingBoard.prototype.private_CreateTrueColorBoard=function(){var t=this.HtmlElement.Board.Control.HtmlElement.width,e=this.HtmlElement.Board.Control.HtmlElement.height,o=this.HtmlElement.Board.Control.HtmlElement.getContext("2d");if(0!==t&&0!==e){for(var r=o.createImageData(t,e),i=.9,a=this.private_GetSettings_BoardColor(),n=a.r,s=a.g,l=a.b,m=100/t,_=1.6,h=2.72,d=2432/150,p=new Array(t),u=0,C=0;u<t;u++,C+=m)p[u]=.6+_*C+h*C*C*C+d*C*C*C*C*C;var g=new Array(e),c=1/e;_=.02,h=.004,d=.04/15;for(var v=0,C=0;v<e;v++,C+=c)g[v]=_*C+h*C*C*C+d*C*C*C*C*C;var f,w,S;if(!0===this.private_GetSettings_TrueColorBoard())for(v=0;v<e;v++)for(u=0;u<t;u++){i=40*(p[u]+g[v])+.5,i=(i-=Math.floor(i))<.2?1-i/2:i<.4?1-(.4-i)/2:1,(v==e-1||v==e-2&&u<t-2||u>=t-1||u==t-2&&v<e-1)&&(i/=2),0==v||1==v&&u>1||0==u||1==u&&v>1?(f=128+n*i/2,w=128+s*i/2,S=128+l*i/2):(f=n*i,w=s*i,S=l*i);T=4*(u+v*t);r.data[T+0]=f,r.data[T+1]=w,r.data[T+2]=S,r.data[T+3]=255}else for(v=0;v<e;v++)for(u=0;u<t;u++){0==v||1==v&&u>1||0==u||1==u&&v>1?(f=128+n/2,w=128+s/2,S=128+l/2):(f=n,w=s,S=l);var T=4*(u+v*t);r.data[T+0]=f,r.data[T+1]=w,r.data[T+2]=S,r.data[T+3]=255}this.m_oImageData.Board=r,this.m_oImageData.W=t,this.m_oImageData.H=e,this.m_oCreateWoodyId=null}},CDrawingBoard.prototype.private_DrawTrueColorFullBoard=function(){this.private_DrawTrueColorBoard(),this.private_DrawRulers(),this.private_DrawTrueColorLines(),this.private_RedrawTrueColorAllStones(),this.private_DrawAllColorMarks(),this.private_DrawMarks(),this.private_DrawVariants()},CDrawingBoard.prototype.private_DrawTrueColorBoard=function(){this.HtmlElement.Board.Control.HtmlElement.getContext("2d").putImageData(this.m_oImageData.Board,0,0)},CDrawingBoard.prototype.private_CreateLines=function(){var t=this.m_oImageData.W,e=this.m_oImageData.H;if(0!==t&&0!==e){for(var o,r,i,a,n,s,l,m,_,h,d=this.m_dKoeffOffsetX*t,p=this.m_dKoeffOffsetY*e,u=this.m_dKoeffCellH*e,C=this.m_dKoeffCellW*t,g=this.m_oLogicBoard.Get_Size(),c=Math.max(g.X,g.Y),v=new Array(g.X),f=d-C*this.m_oViewPort.X0,w=p-u*this.m_oViewPort.Y0,S=0;S<c;S++)o=f+S*C,i=f+S*C+.6*C,n=f+S*C-.6*C,l=f+S*C+.5*C,_=f+S*C-.5*C,r=w+S*u,a=w+S*u+.6*u,s=w+S*u-.6*u,m=w+S*u+.5*u,h=w+S*u-.5*u,v[S]={X:Math.floor(o+.5),X_G:Math.floor(i+.5),X_L:Math.floor(n+.5),X_G2:Math.floor(l+.5),X_L2:Math.floor(_+.5),Y:Math.floor(r+.5),Y_G:Math.floor(a+.5),Y_L:Math.floor(s+.5),Y_G2:Math.floor(m+.5),Y_L2:Math.floor(h+.5)};this.m_oImageData.Lines=v;var T=this.m_dKoeffDiam*t/2,y=Math.max(2,Math.ceil(T)),D=2*y+1,E=y,B=y,A=this.private_GetSettings_LinesColor();this.m_oImageData.Handi=this.private_DrawHandiMark(E,B,y,D+2,D+2,A),this.m_oImageData.HandiRad=y+1}},CDrawingBoard.prototype.private_DrawTrueColorLines=function(t){if(this.m_oImageData.Lines){var e=this.m_oImageData.W,o=this.m_oImageData.H,r=this.HtmlElement.Lines.Control.HtmlElement.getContext("2d"),i=this.m_oLogicBoard.Get_Size(),a=this.m_oImageData.Lines;r.clearRect(0,0,e,o);for(var n=this.m_oImageData.Handi,s=this.m_oImageData.HandiRad,l=this.m_oLogicBoard.Get_HandiPoints(),m=0,_=l.length;m<_;m++)if(!0===this.private_IsPointInViewPort(l[m][0],l[m][1])){var h=a[l[m][0]].X-s,d=a[l[m][1]].Y-s;r.putImageData(n,h,d)}for(var p=0===this.m_oViewPort.X0?a[this.m_oViewPort.X0].X:a[this.m_oViewPort.X0].X_L,u=i.X-1===this.m_oViewPort.X1?a[this.m_oViewPort.X1].X:a[this.m_oViewPort.X1].X_G,C=0===this.m_oViewPort.Y0?a[this.m_oViewPort.Y0].Y:a[this.m_oViewPort.Y0].Y_L,g=i.Y-1===this.m_oViewPort.Y1?a[this.m_oViewPort.Y1].Y:a[this.m_oViewPort.Y1].Y_G,c=r.createImageData(1,o),v=r.createImageData(e,1),f=this.private_GetSettings_LinesColor(),w=0;w<o;w++){E=4*w;w>=C&&w<=g&&(c.data[E+0]=f.r,c.data[E+1]=f.g,c.data[E+2]=f.b,c.data[E+3]=f.a)}for(w=0;w<e;w++){E=4*w;p<=w&&w<=u&&(v.data[E+0]=f.r,v.data[E+1]=f.g,v.data[E+2]=f.b,v.data[E+3]=f.a)}for(var S=0;S<i.X;S++)!0===this.private_IsVerLineInViewPort(S)&&r.putImageData(c,a[S].X,0);for(var T=0;T<i.Y;T++)!0===this.private_IsHorLineInViewPort(T)&&r.putImageData(v,0,a[T].Y);if(void 0!==t)for(var y=a[1].X-a[0].X+2,D=a[1].Y-a[0].Y+2,E=0,_=t.length;E<_;E++){var B=t[E].X,A=t[E].Y;if(!0===this.private_IsPointInViewPort(B-1,A-1)&&BOARD_EMPTY===this.m_oLogicBoard.Get(B,A)){var b=a[B-1].X_L2,G=a[A-1].Y_L2;r.clearRect(b,G,y,D)}}}},CDrawingBoard.prototype.private_DrawHandiMark=function(t,e,o,r,i,a){for(var n=(f=(v=document.createElement("canvas").getContext("2d")).createImageData(r,i)).data,s=r,l=(Math.max(s/2,2),s/2-.5),m=l-.2,_=0;_<s;_++)for(var h=0;h<s;h++){var d=_-l,p=h-l,u=m-Math.sqrt(d*d+p*p),C=4*(_*s+s-h-1);if(u>=0){var g=255;if(u<=.8){var c=(.8-u)/.8;g=parseInt(255*(1-c))}n[C+0]=a.r,n[C+1]=a.g,n[C+2]=a.b,n[C+3]=g}else n[C+0]=0,n[C+1]=0,n[C+2]=0,n[C+3]=0}return f;var v,f},CDrawingBoard.prototype.private_PutPixel=function(t,e,o,r,i,a,n){var s=4*(e+o*i);t.data[s+0]=n.r,t.data[s+1]=n.g,t.data[s+2]=n.b,t.data[s+3]=r},CDrawingBoard.prototype.private_PutHorLine=function(t,e,o,r,i,a,n,s){for(var l=e;l<=o;l++)this.private_PutPixel(t,l,i,r,a,n,s)},CDrawingBoard.prototype.private_PutVerLine=function(t,e,o,r,i,a,n,s){for(var l=e;l<=o;l++)this.private_PutPixel(t,i,l,r,a,n,s)},CDrawingBoard.prototype.private_CreateTrueColorStones=function(t){if(this.m_oImageData.Lines){var e=this.HtmlElement.Board.Control.HtmlElement.width,o=(this.HtmlElement.Board.Control.HtmlElement.height,this.HtmlElement.Stones.Control.HtmlElement.getContext("2d")),r=t||Math.floor(this.m_dKoeffCellW*e),i=2*Math.floor(r/2)+1;this.m_oImageData.StoneDiam=i,this.m_oTarget.Update_Size(i),this.m_oImageData.BlackStone=o.createImageData(i,i),this.m_oImageData.WhiteStone=o.createImageData(i,i),this.m_oImageData.BlackTarget=o.createImageData(i,i),this.m_oImageData.WhiteTarget=o.createImageData(i,i);var a=this.m_oImageData.BlackStone.data,n=this.m_oImageData.WhiteStone.data,s=this.m_oImageData.BlackTarget.data,l=this.m_oImageData.WhiteTarget.data,m=this.private_GetSettings_WhiteColor(),_=this.private_GetSettings_BlackColor(),h=this.private_GetSettings_DarkBoard();if(!0===this.private_GetSettings_TrueColorStones())for(var d=(D=i/2-.5)-.2,p=Math.sqrt(3),u=0;u<i;u++)for(I=0;I<i;I++){var C=u-D,g=I-D,c=4*(u*i+i-I-1);if((E=d-Math.sqrt(C*C+g*g))>=0){var v=d*d-C*C-g*g;v=v>0?Math.sqrt(v)*p:0;var f=C,w=g,S=Math.sqrt(6*(f*f+w*w+v*v)),T=0;(S=(2*v-f+w)/S)>.9&&(T=10*(S-.9));B=255;if(E<=.8){E=(.8-E)/.8;b=.7;C-g<d/3&&(b=1),B=parseInt(255*(1-E*b))}var y=parseInt(10+10*S+140*T);a[c+0]=y,a[c+1]=y,a[c+2]=y,a[c+3]=B,s[c+0]=y,s[c+1]=y,s[c+2]=y,s[c+3]=parseInt(B/2),y=parseInt(200+10*S+45*T),n[c+0]=y,n[c+1]=y,n[c+2]=y,n[c+3]=B,l[c+0]=y,l[c+1]=y,l[c+2]=y,l[c+3]=parseInt(B/2)}else a[c+0]=0,a[c+1]=0,a[c+2]=0,a[c+3]=0,s[c+0]=0,s[c+1]=0,s[c+2]=0,s[c+3]=0,n[c+0]=0,n[c+1]=0,n[c+2]=0,n[c+3]=0,l[c+0]=0,l[c+1]=0,l[c+2]=0,l[c+3]=0}else for(var D=i/2-.5,d=D-.2,u=0;u<i;u++)for(I=0;I<i;I++){var C=u-D,g=I-D,E=d-Math.sqrt(C*C+g*g),c=4*(u*i+i-I-1);if(E>=0){var B=255;if(E<=.8){var A=(.8-E)/.8,b=.7;C-g<d/3&&(b=1),B=parseInt(255*(1-A*b))}else if(E<=1.6&&E>=.8&&!0===h){var A=(1.6-E)/.8,b=.7;C-g<d/3&&(b=1),B=parseInt(A*b*255)}var G=!1;if(E<=1.6&&(G=!0),!1===G||!1===h?(a[c+0]=_.r,a[c+1]=_.g,a[c+2]=_.b,a[c+3]=B,s[c+0]=_.r,s[c+1]=_.g,s[c+2]=_.b,s[c+3]=parseInt(B/2)):(a[c+0]=m.r,a[c+1]=m.g,a[c+2]=m.b,a[c+3]=B,s[c+0]=m.r,s[c+1]=m.g,s[c+2]=m.b,s[c+3]=B),B=255,E<=.8){var A=(.8-E)/.8,b=.7;C-g<d/3&&(b=1),B=parseInt(255*(1-A*b))}else if(E<=1.6&&E>=.8&&!1===h){var A=(1.6-E)/.8,b=.7;C-g<d/3&&(b=1),B=parseInt(A*b*255)}!1===G||!0===h?(n[c+0]=m.r,n[c+1]=m.g,n[c+2]=m.b,n[c+3]=B,l[c+0]=m.r,l[c+1]=m.g,l[c+2]=m.b,l[c+3]=parseInt(B/2)):(n[c+0]=_.r,n[c+1]=_.g,n[c+2]=_.b,n[c+3]=B,l[c+0]=_.r,l[c+1]=_.g,l[c+2]=_.b,l[c+3]=B)}else a[c+0]=0,a[c+1]=0,a[c+2]=0,a[c+3]=0,s[c+0]=0,s[c+1]=0,s[c+2]=0,s[c+3]=0,n[c+0]=0,n[c+1]=0,n[c+2]=0,n[c+3]=0,l[c+0]=0,l[c+1]=0,l[c+2]=0,l[c+3]=0}for(var M=new Array,H=new Array,c=0;c<28;c++){M[c]=o.createImageData(i,i),H[c]=M[c].data;for(u=0;u<i;u++)for(var I=0;I<i;I++){var N=4*(u*i+I);H[c][N+0]=n[N+0],H[c][N+1]=n[N+1],H[c][N+2]=n[N+2],H[c][N+3]=n[N+3]}}H.push(l),H.push(n),!0===this.private_GetSettings_ShellWhiteStones()&&this.private_CreateShellWhiteStones(H,i,i),this.m_oImageData.WhiteStones=M;for(var P=this.m_oLogicBoard.Get_Size(),k=0;k<P.Y;k++)for(var x=0;x<P.X;x++){var R=Math.floor(Math.random()*(this.m_oImageData.WhiteStones.length-1));this.m_oImageData.WhiteStones2[x+k*P.X]=R}}},CDrawingBoard.prototype.private_CreateShellWhiteStones=function(t,e,o){for(var r=e/51*978|0,i=r,a=.9,n=new Array(r),s=0;s<r;s++)n[s]=(Math.sin(18*s/r)+1)/20+(Math.sin(3*s/r)+1)/10;for(var l=new Array(i),m=0;m<i;m++)l[m]=.2*Math.cos(5*m/i)+.1*Math.sin(11*m/i);for(var _=new Array(r*i),m=0;m<i;m++)for(s=0;s<r;s++)a=90*(n[s]+l[m])+.5,a=(a-=Math.floor(a))<.2?1-a/2:a<.4?1-(.4-a)/2:1,_[s+m*r]=a;for(var h=t.length,d=0;d<h;d++){var p,u,C=t[d];switch(d){case 0:p=12*r/978|0,u=163*r/978|0;break;case 1:p=12*r/978|0,u=213*r/978|0;break;case 2:p=12*r/978|0,u=263*r/978|0;break;case 3:p=12*r/978|0,u=313*r/978|0;break;case 4:p=62*r/978|0,u=163*r/978|0;break;case 5:p=62*r/978|0,u=213*r/978|0;break;case 6:p=62*r/978|0,u=263*r/978|0;break;case 7:p=62*r/978|0,u=313*r/978|0;break;case 8:p=113*r/978|0,u=163*r/978|0;break;case 9:p=113*r/978|0,u=213*r/978|0;break;case 10:p=113*r/978|0,u=263*r/978|0;break;case 11:p=113*r/978|0,u=313*r/978|0;break;case 12:p=163*r/978|0,u=163*r/978|0;break;case 13:p=163*r/978|0,u=213*r/978|0;break;case 14:p=163*r/978|0,u=263*r/978|0;break;case 15:p=163*r/978|0,u=313*r/978|0;break;case 16:p=213*r/978|0,u=163*r/978|0;break;case 17:p=213*r/978|0,u=213*r/978|0;break;case 18:p=213*r/978|0,u=263*r/978|0;break;case 19:p=213*r/978|0,u=313*r/978|0;break;case 20:p=263*r/978|0,u=163*r/978|0;break;case 21:p=263*r/978|0,u=213*r/978|0;break;case 22:p=263*r/978|0,u=263*r/978|0;break;case 23:p=263*r/978|0,u=313*r/978|0;break;case 24:p=313*r/978|0,u=163*r/978|0;break;case 25:p=313*r/978|0,u=213*r/978|0;break;case 26:p=313*r/978|0,u=263*r/978|0;break;case 27:p=313*r/978|0,u=313*r/978|0;break;case 28:case 29:p=12*r/978|0,u=12*r/978|0}for(m=0;m<o;m++)for(s=0;s<e;s++){a=_[p+s+(u+m)*r];var g=4*(s+m*e);C[g+0]*=Math.pow(a,.8),C[g+1]*=Math.pow(a,.8),C[g+2]*=Math.pow(a,.8)}}},CDrawingBoard.prototype.private_RedrawTrueColorAllStones=function(){var t=this.m_oImageData.W,e=this.m_oImageData.H;this.HtmlElement.Stones.Control.HtmlElement.getContext("2d").clearRect(0,0,t,e),this.HtmlElement.Shadow.Control.HtmlElement.getContext("2d").clearRect(0,0,t,e),this.m_oBoardPosition={},this.private_DrawTrueColorAllStones()},CDrawingBoard.prototype.private_DrawTrueColorAllStones=function(){for(var t=this.m_oLogicBoard.Get_Size(),e=1;e<=t.Y;e++)for(var o=1;o<=t.X;o++)this.Draw_Sector(o,e,this.m_oLogicBoard.Get(o,e))},CDrawingBoard.prototype.private_CreateShadows=function(){if(this.m_oImageData.Lines){var t=this.HtmlElement.Shadow.Control.HtmlElement.getContext("2d"),e=this.m_oImageData.StoneDiam;this.m_oImageData.Shadow=t.createImageData(e,e);var o=this.m_oImageData.Shadow.data;this.m_oImageData.ShadowOff=Math.max(parseInt(.15*e),3);for(var r=(e-5)/2+1,i=0;i<e;i++)for(var a=0;a<e;a++){var n=Math.abs(i-r),s=Math.abs(a-r),l=Math.sqrt(s*s+n*n)/r,m=l<1?.15+.75*(1-l):0,_=4*(e*i+a);o[_+0]=0,o[_+1]=0,o[_+2]=0,o[_+3]=parseInt(255*m)}}},CDrawingBoard.prototype.Update_Target=function(){this.private_UpdateTargetType()},CDrawingBoard.prototype.private_UpdateTargetType=function(){var t=this.m_oTarget.Get_LogicPos(),e=t.Y,o=t.X;if(!1!==this.private_IsPointInViewPort(o-1,e-1)){var r=EBoardTargetType.Unknown,i=this.m_oLogicBoard.Get(o,e);switch(this.m_eMode){case EBoardMode.Move:BOARD_EMPTY===i&&(r=BOARD_BLACK===this.m_oGameTree.Get_NextMove()?EBoardTargetType.BlackStone:EBoardTargetType.WhiteStone);break;case EBoardMode.AddRemove:r=BOARD_BLACK===i?EBoardTargetType.WhiteX:BOARD_WHITE===i?EBoardTargetType.BlackX:global_mouseEvent.ShiftKey?EBoardTargetType.WhiteStone:EBoardTargetType.BlackStone;break;case EBoardMode.AddMarkColor:r=global_mouseEvent.CtrlKey&&!global_mouseEvent.ShiftKey?EBoardTargetType.ColorR:!global_mouseEvent.CtrlKey&&global_mouseEvent.ShiftKey?EBoardTargetType.ColorG:global_mouseEvent.CtrlKey&&global_mouseEvent.ShiftKey?EBoardTargetType.ColorA:EBoardTargetType.ColorB;break;default:r=BOARD_BLACK===i||BOARD_EMPTY===i&&!0===this.private_GetSettings_DarkBoard()?EBoardTargetType.WhiteX:EBoardTargetType.BlackX}EBoardTargetType.Unknown!=r&&this.m_oGameTree.Get_LocalSettings().Is_ShowTarget()?this.m_oTarget.Set_Type(r):this.m_oTarget.Hide()}else this.m_oTarget.Hide()},CDrawingBoard.prototype.private_MoveTarget=function(t,e,o,r){if(!1!==this.private_IsPointInViewPort(t-1,e-1)){if(null===this.m_oCreateWoodyId&&null!==this.m_oImageData.Lines&&(void 0===r&&(r=!1),!1===this.m_oTarget.Check_LogicPos(t,e,r))){EBoardMode.AddMarkColor===this.m_eMode&&this.m_bMouseDown&&!r&&this.private_AddColorMark(t,e,o);var i=(this.m_oImageData.StoneDiam-1)/2,a=this.m_oImageData.Lines,n=a[t-1].X-i,s=a[e-1].Y-i;this.m_oTarget.Show(),this.m_oTarget.Set_Pos(n,s),this.private_UpdateTargetType()}}else this.m_oTarget.Hide()},CDrawingBoard.prototype.private_HideTarget=function(){this.m_oTarget.Hide()},CDrawingBoard.prototype.private_GetBoardPosByXY=function(t,e){var o=this.m_oImageData.W,r=this.m_oImageData.H,i=this.m_dKoeffCellH*r,a=this.m_dKoeffCellW*o,n=this.m_dKoeffOffsetX*o-i*this.m_oViewPort.X0,s=this.m_dKoeffOffsetY*r-a*this.m_oViewPort.Y0,l=0,m=this.m_oLogicBoard.Get_Size();for(l=0;l<m.Y-1&&e>s+i*l+i/2;l++);var _=0;for(_=0;_<m.X-1&&t>n+a*_+a/2;_++);return _=Math.max(this.m_oViewPort.X0,Math.min(this.m_oViewPort.X1,_)),l=Math.max(this.m_oViewPort.Y0,Math.min(this.m_oViewPort.Y1,l)),{X:_+1,Y:l+1}},CDrawingBoard.prototype.private_GetXYByBoardPos=function(t,e){var o=this.m_oImageData.W,r=this.m_oImageData.H,i=this.m_dKoeffCellH*r,a=this.m_dKoeffCellW*o;return{X:this.m_dKoeffOffsetX*o+(t-1)*a,Y:this.m_dKoeffOffsetY*r+(e-1)*i}},CDrawingBoard.prototype.private_CreateMarks=function(){if(this.m_oImageData.Lines){var t=this.private_GetSettings_TrueColorBoard(),e=this.private_GetSettings_DarkBoard(),o=this.m_oImageData.StoneDiam;this.m_oImageData.X_Black=this.private_DrawX(o,o,.05*o,new CColor(0,0,0,255)),this.m_oImageData.X_White=this.private_DrawX(o,o,.05*o,new CColor(255,255,255,255)),this.m_oImageData.Tr_Black=this.private_DrawTriangle(o,o,.05*o,new CColor(0,0,0,255)),this.m_oImageData.Tr_White=this.private_DrawTriangle(o,o,.05*o,new CColor(255,255,255,255)),this.m_oImageData.Tr_Hint=this.private_DrawTriangle(o,o,.05*o,new CColor(255,0,0,255)),this.m_oImageData.Sq_Black=this.private_DrawEmptySquare(o,o,.05*o,new CColor(0,0,0,255)),this.m_oImageData.Sq_White=this.private_DrawEmptySquare(o,o,.05*o,new CColor(255,255,255,255)),this.m_oImageData.Ter_Black=this.private_DrawFilledSquare(o,o,.05*o,!1,new CColor(0,0,0,255),t?new CColor(0,0,0,255):e?new CColor(255,255,255,255):new CColor(0,0,0,255)),this.m_oImageData.Ter_White=this.private_DrawFilledSquare(o,o,.05*o,!1,new CColor(255,255,255,255),t?new CColor(255,255,255,255):e?new CColor(255,255,255,255):new CColor(0,0,0,255)),this.m_oImageData.Ter_Black2=this.private_DrawFilledSquare(o,o,.05*o,!0,new CColor(0,0,0,255),t?new CColor(0,0,0,255):e?new CColor(255,255,255,255):new CColor(0,0,0,255)),this.m_oImageData.Ter_White2=this.private_DrawFilledSquare(o,o,.05*o,!0,new CColor(255,255,255,255),t?new CColor(255,255,255,255):e?new CColor(255,255,255,255):new CColor(0,0,0,255)),this.m_oImageData.LastMove=this.private_DrawCircle(o,o,.05*o,new CColor(255,0,0,255)),this.m_oImageData.Cr_Black=this.private_DrawCircle(o,o,.05*o,new CColor(0,0,0,255)),this.m_oImageData.Cr_White=this.private_DrawCircle(o,o,.05*o,new CColor(255,255,255,255)),this.m_oImageData.RcolorTarget=this.private_DrawEmptySquare(o,o,.05*o,new CColor(200,0,0,255)),this.m_oImageData.GcolorTarget=this.private_DrawEmptySquare(o,o,.05*o,new CColor(0,128,0,255)),this.m_oImageData.BcolorTarget=this.private_DrawEmptySquare(o,o,.05*o,new CColor(0,0,200,255)),this.m_oImageData.AcolorTarget=this.private_DrawEmptySquare(o,o,.05*o,new CColor(128,128,128,255))}},CDrawingBoard.prototype.private_DrawX=function(t,e,o,r){var i=this.HtmlElement.Marks.Control.HtmlElement.getContext("2d");return i.clearRect(0,0,t,e),i.strokeStyle=r.ToString(),i.fillStyle=r.ToString(),i.lineWidth=o,i.beginPath(),i.moveTo(1*t/4,1*e/4),i.lineTo(3*t/4,3*e/4),i.moveTo(3*t/4,1*e/4),i.lineTo(1*t/4,3*e/4),i.stroke(),i.getImageData(0,0,t,e)},CDrawingBoard.prototype.private_DrawTriangle=function(t,e,o,r,i){void 0===i&&(i=1);var a=this.HtmlElement.Marks.Control.HtmlElement.getContext("2d");a.clearRect(0,0,t,e),a.globalAlpha=i,a.strokeStyle=r.ToString(),a.fillStyle=r.ToString(),a.lineWidth=o;var n=t/2,s=3*e/4,l=.1*t,m=Math.sqrt(n*n-(s-n)*(s-n))+n,_=-Math.sqrt(n*n-(s-n)*(s-n))+n;return a.beginPath(),a.moveTo(t/2,l),a.lineTo(m-l,s),a.lineTo(_+l,s),a.closePath(),a.stroke(),a.getImageData(0,0,t,e)},CDrawingBoard.prototype.private_DrawEmptySquare=function(t,e,o,r){var i=this.HtmlElement.Marks.Control.HtmlElement.getContext("2d");i.clearRect(0,0,t,e),i.strokeStyle=r.ToString(),i.fillStyle=r.ToString(),i.lineWidth=Math.floor(o+.5);for(var a=t/2,n=-e/2*Math.sqrt(2)/2+e/2,s=e/2*Math.sqrt(2)/2+e/2,l=-Math.sqrt(a*a-(n-a)*(n-a))+a,m=+Math.sqrt(a*a-(n-a)*(n-a))+a,_=Math.floor(l),h=Math.ceil(m),d=Math.ceil(n),p=Math.floor(s),u=Math.floor(o),C=i.createImageData(t,e),g=0;g<e;g++)for(var c=0;c<t;c++){var v=4*(g*t+c);(_<=c&&c<=_+u||h-u<=c&&c<=h)&&d<=g&&g<=p||(d<=g&&g<=d+u||p-u<=g&&g<=p)&&_<=c&&c<=h?(C.data[v+0]=r.r,C.data[v+1]=r.g,C.data[v+2]=r.b,C.data[v+3]=255):(C.data[v+0]=0,C.data[v+1]=0,C.data[v+2]=0,C.data[v+3]=0)}return C},CDrawingBoard.prototype.private_DrawFilledSquare=function(t,e,o,r,i,a){for(var n=this.HtmlElement.Marks.Control.HtmlElement.getContext("2d").createImageData(t,e),s=r?e/4|0:e/3|0,l=r?3*e/4|0:2*e/3|0,m=r?t/4|0:t/3|0,_=r?3*t/4|0:2*t/3|0,h=0;h<e;h++)for(var d=0;d<t;d++){var p=4*(h*t+d);(h===s||h===l)&&d>=m&&d<=_||(d===m||d===_)&&h>=s&&h<=l?(n.data[p+0]=a.r,n.data[p+1]=a.g,n.data[p+2]=a.b,n.data[p+3]=255):h>s&&h<l&&d>m&&d<_?(n.data[p+0]=i.r,n.data[p+1]=i.g,n.data[p+2]=i.b,n.data[p+3]=255):n.data[p+3]=0}return n},CDrawingBoard.prototype.private_DrawCircle=function(t,e,o,r){var i=this.HtmlElement.Marks.Control.HtmlElement.getContext("2d");i.clearRect(0,0,t,e);var a=t/2,n=4*o;return i.strokeStyle=r.ToString(),i.fillStyle=r.ToString(),i.lineWidth=o,i.beginPath(),i.arc(t/2,e/2,a-n,0,2*Math.PI,!1),i.stroke(),i.getImageData(0,0,t,e)},CDrawingBoard.prototype.private_DrawRulers=function(){if(!0===this.m_bRulers&&this.m_oImageData.Lines){var t=this.HtmlElement.Board.Control.HtmlElement.getContext("2d"),e=this.m_oImageData.W,o=this.m_oImageData.H,r=this.m_oLogicBoard.Get_Size(),i=2*this.m_oImageData.StoneDiam/3,a=(i-1)/2,n=this.m_oImageData.Lines,s=2*i/3,l=this.private_GetSettings_DarkBoard();t.fillStyle=l?"rgb(255,255,255)":"rgb(0,0,0)";for(var m=this.m_oViewPort.X0;m<=this.m_oViewPort.X1;m++){var _=n[m].X-a,h=this.m_dKoeffOffsetY*o/3-a,d=s+"px "+(c=Common_IsInt(g=Common_X_to_String(m+1,r.X))?"Arial":"Helvetica, Arial, Verdana");t.font=d;var p=i/2+s/3,u=(i-t.measureText(g).width)/2;t.fillText(g,_+u,h+p),h=o-this.m_dKoeffOffsetY*o/3-a,t.fillText(g,_+u,h+p)}for(var C=this.m_oViewPort.Y0;C<=this.m_oViewPort.Y1;C++){var _=this.m_dKoeffOffsetX*e/3-a,h=n[C].Y-a,g=r.Y-C+"",c=Common_IsInt(g)?"Arial":"Helvetica, Arial, Verdana",d=s+"px "+c;t.font=d;var p=i/2+s/3,u=(i-t.measureText(g).width)/2;t.fillText(g,_+u,h+p),_=e-this.m_dKoeffOffsetX*e/3-a,t.fillText(g,_+u,h+p)}}},CDrawingBoard.prototype.private_GetMark=function(t,e){var o=this.m_oMarks[""+Common_XYtoValue(t,e)];return void 0!==o?o:null},CDrawingBoard.prototype.private_SetMark=function(t,e,o){EDrawingMark.Lm===o.Get_Type()?this.private_SetLastMoveMark(t,e):this.m_oMarks[""+Common_XYtoValue(t,e)]=o},CDrawingBoard.prototype.private_SetLastMoveMark=function(t,e){if(t<=0||e<=0)this.m_oLastMoveMark=0;else{var o=Common_XYtoValue(t,e);void 0===this.m_oMarks[""+o]&&(this.m_oMarks[""+o]=new CDrawingMark(t,e,EDrawingMark.Lm,"")),this.m_oLastMoveMark=o}},CDrawingBoard.prototype.private_DrawMarks=function(){var t=this.HtmlElement.Marks.Control.HtmlElement.getContext("2d"),e=this.m_oImageData.W,o=this.m_oImageData.H;t.clearRect(0,0,e,o);var r=new Array;for(var i in this.m_oMarks){var a=this.m_oMarks[i];void 0===this.m_oHints[i]&&(this.private_DrawMark(a),EDrawingMark.Tx===a.Get_Type()&&r.push({X:a.Get_X(),Y:a.Get_Y()}))}for(var i in this.m_oHints){var n=Common_ValuetoXY(i);this.private_DrawHint(n.X,n.Y),r.push({X:n.X,Y:n.Y})}this.private_DrawTrueColorLines(r)},CDrawingBoard.prototype.private_DrawMark=function(t){if(this.m_oImageData.Lines){var e=t.Get_X(),o=t.Get_Y(),r=t.Get_Type(),i=this.HtmlElement.Marks.Control.HtmlElement.getContext("2d"),a=this.private_GetSettings_DarkBoard();if(!0===this.private_IsPointInViewPort(e-1,o-1)){var n=this.m_oImageData.StoneDiam,s=(n-1)/2,l=this.m_oImageData.Lines,m=l[e-1].X-s,_=l[o-1].Y-s,h=this.m_oLogicBoard.Get(e,o);switch(r){case EDrawingMark.Tb:i.putImageData(this.m_oImageData.Ter_Black,m,_);break;case EDrawingMark.Tw:i.putImageData(this.m_oImageData.Ter_White,m,_);break;case EDrawingMark.Tb2:i.putImageData(this.m_oImageData.Ter_Black2,m,_);break;case EDrawingMark.Tw2:i.putImageData(this.m_oImageData.Ter_White2,m,_);break;case EDrawingMark.Lm:!0===this.m_bBlackWhiteLastMark?BOARD_BLACK===h?i.putImageData(this.m_oImageData.Cr_White,m,_):i.putImageData(this.m_oImageData.Cr_Black,m,_):i.putImageData(this.m_oImageData.LastMove,m,_);break;case EDrawingMark.Cr:i.putImageData(h===BOARD_BLACK||h==BOARD_EMPTY&&1==a?this.m_oImageData.Cr_White:this.m_oImageData.Cr_Black,m,_);break;case EDrawingMark.Sq:i.putImageData(h===BOARD_BLACK||h==BOARD_EMPTY&&1==a?this.m_oImageData.Sq_White:this.m_oImageData.Sq_Black,m,_);break;case EDrawingMark.Tr:i.putImageData(h===BOARD_BLACK||h==BOARD_EMPTY&&1==a?this.m_oImageData.Tr_White:this.m_oImageData.Tr_Black,m,_);break;case EDrawingMark.X:i.putImageData(h===BOARD_BLACK||h==BOARD_EMPTY&&1==a?this.m_oImageData.X_White:this.m_oImageData.X_Black,m,_);break;case EDrawingMark.Tx:var d=t.Get_Text(),p=d.length<=2?2*n/3:n/2,u=p+"px "+(Common_IsInt(d)?"Arial":"Helvetica, Arial, Verdana");i.fillStyle=h===BOARD_BLACK||h==BOARD_EMPTY&&1==a?"rgb(255,255,255)":"rgb(0,0,0)",i.font=u;var C=n/2+p/3,g=(n-i.measureText(d).width)/2;i.fillText(d,m+g,_+C)}}}},CDrawingBoard.prototype.private_DrawHint=function(t,e){if(this.m_oImageData.Lines){var o=this.HtmlElement.Marks.Control.HtmlElement.getContext("2d");if(!0===this.private_IsPointInViewPort(t-1,e-1)){var r=(this.m_oImageData.StoneDiam-1)/2,i=this.m_oImageData.Lines,a=i[t-1].X-r,n=i[e-1].Y-r;o.putImageData(this.m_oImageData.Tr_Hint,a,n)}}},CDrawingBoard.prototype.private_ClearMark=function(t,e){if(this.m_oImageData.Lines&&!0===this.private_IsPointInViewPort(t-1,e-1)){var o=(this.m_oImageData.StoneDiam-1)/2,r=this.m_oImageData.Lines,i=r[t-1].X-o,a=r[e-1].Y-o;this.HtmlElement.Marks.Control.HtmlElement.getContext("2d").clearRect(i,a,2*o,2*o);var n=Common_ValuetoXY(this.m_oLastMoveMark);t===n.X&&e===n.Y&&(this.private_SetLastMoveMark(t,e),this.private_DrawMark(this.private_GetMark(t,e)))}},CDrawingBoard.prototype.Draw_AllColorMarks=function(){this.private_DrawAllColorMarks()},CDrawingBoard.prototype.Clear_AllColorMarks=function(){this.private_ClearAllColorMarks()},CDrawingBoard.prototype.private_DrawAllColorMarks=function(){for(var t in this.m_oColorMarks){var e=Common_ValuetoXY(t);this.private_DrawColorMark(e.X,e.Y)}},CDrawingBoard.prototype.private_ClearAllColorMarks=function(){for(var t in this.m_oColorMarks){var e=Common_ValuetoXY(t);this.private_ClearColorMark(e.X,e.Y)}this.m_oColorMarks={}},CDrawingBoard.prototype.private_AddColorMark=function(t,e,o){var r=Common_XYtoValue(t,e);if(g_mouse_button_right===o.Button)void 0!==this.m_oColorMarks[r]&&(delete this.m_oColorMarks[r],this.private_ClearColorMark(t,e),this.m_oGameTree.Remove_ColorMark(t,e));else{var i;if(i=o.CtrlKey&&!o.ShiftKey?new CColor(200,0,0,50):o.ShiftKey&&!o.CtrlKey?new CColor(0,100,0,50):o.ShiftKey&&o.CtrlKey?new CColor(80,80,80,50):new CColor(0,0,200,50),void 0!==this.m_oColorMarks[r]){var a=this.m_oColorMarks[r];if(i.r===a.r&&i.g===a.g&&i.b===a.b){var n=a.a;n=n<50?50:n<100?100:n<150?150:200,this.m_oColorMarks[r].a=n}else this.m_oColorMarks[r]=i}else this.m_oColorMarks[r]=i;this.private_DrawColorMark(t,e),this.m_oGameTree.Add_ColorMark(t,e,this.m_oColorMarks[r])}},CDrawingBoard.prototype.private_DrawColorMark=function(t,e){this.private_ClearColorMark(t,e);var o=this.HtmlElement.Colors.Control.HtmlElement.getContext("2d"),r=this.m_oImageData.Lines,i=t-1,a=e-1;o.fillStyle=this.m_oColorMarks[Common_XYtoValue(t,e)].ToString(),o.beginPath(),o.moveTo(r[i].X_L2,r[a].Y_L2),o.lineTo(r[i].X_G2,r[a].Y_L2),o.lineTo(r[i].X_G2,r[a].Y_G2),o.lineTo(r[i].X_L2,r[a].Y_G2),o.closePath(),o.fill()},CDrawingBoard.prototype.private_ClearColorMark=function(t,e){var o=this.HtmlElement.Colors.Control.HtmlElement.getContext("2d"),r=this.m_oImageData.Lines,i=t-1,a=e-1;o.clearRect(r[i].X_L2,r[a].Y_L2,r[i].X_G2-r[i].X_L2,r[a].Y_G2-r[a].Y_L2)},CDrawingBoard.prototype.private_HandleMouseDown=function(t,e,o){switch(this.m_eMode){case EBoardMode.Move:this.private_AddMove(t,e,o);break;case EBoardMode.AddRemove:this.private_AddOrRemoveStones(t,e,o);break;case EBoardMode.AddMarkTr:this.private_AddTriangle(t,e,o);break;case EBoardMode.AddMarkSq:this.private_AddSquare(t,e,o);break;case EBoardMode.AddMarkCr:this.private_AddCircle(t,e,o);break;case EBoardMode.AddMarkX:this.private_AddX(t,e,o);break;case EBoardMode.AddMarkTx:this.private_AddText(t,e,o);break;case EBoardMode.AddMarkNum:this.private_AddNum(t,e,o);break;case EBoardMode.AddMarkColor:this.private_AddColorMark(t,e,o);break;case EBoardMode.ViewPort:this.private_StartViewPortSelection(t,e,o)}},CDrawingBoard.prototype.private_HandleMouseUp=function(t,e,o){EBoardMode.ViewPort===this.m_eMode&&this.private_EndViewPortSelection(t,e),this.private_UpdateSelectCanvas()},CDrawingBoard.prototype.private_HandleMouseMove=function(t,e,o){EBoardMode.ViewPort===this.m_eMode&&this.private_MoveViewPortSelection(t,e),this.private_UpdateSelectCanvas()},CDrawingBoard.prototype.private_StartViewPortSelection=function(t,e,o){this.m_oViewPortSelection.Start=!0,this.m_oViewPortSelection.StartX=t,this.m_oViewPortSelection.StartY=e,this.m_oViewPortSelection.EndX=t,this.m_oViewPortSelection.EndY=e,this.private_UpdateSelectCanvas()},CDrawingBoard.prototype.private_MoveViewPortSelection=function(t,e){!0===this.m_oViewPortSelection.Start&&(this.m_oViewPortSelection.EndX=t,this.m_oViewPortSelection.EndY=e)},CDrawingBoard.prototype.private_EndViewPortSelection=function(t,e){!0===this.m_oViewPortSelection.Start&&(this.m_oViewPortSelection.Start=!1,this.m_oViewPortSelection.EndX=t,this.m_oViewPortSelection.EndY=e)},CDrawingBoard.prototype.Set_ViewPortSelection=function(t,e,o,r){this.m_oViewPortSelection.StartX=t+1,this.m_oViewPortSelection.StartY=e+1,this.m_oViewPortSelection.EndX=o+1,this.m_oViewPortSelection.EndY=r+1,this.private_UpdateSelectCanvas()},CDrawingBoard.prototype.private_UpdateSelectCanvas=function(){if(EBoardMode.ViewPort===this.m_eMode){if(!this.m_oImageData.Lines||this.m_oViewPortSelection.StartX<=0||this.m_oViewPortSelection.StartY<=0||this.m_oViewPortSelection.EndX<=0||this.m_oViewPortSelection.EndY<=0)return;var t=this.m_oImageData.W,e=this.m_oImageData.H,o=this.m_oImageData.Lines,r=this.HtmlElement.Select.Control.HtmlElement.getContext("2d");r.clearRect(0,0,t,e);var i=this.m_oViewPortSelection.StartX-1,a=this.m_oViewPortSelection.StartY-1,n=this.m_oViewPortSelection.EndX-1,s=this.m_oViewPortSelection.EndY-1;if(i>n){l=n;n=i,i=l}if(a>s){var l=s;s=a,a=l}var m=new CColor(107,112,122,128);r.fillStyle=m.ToString(),r.beginPath(),r.moveTo(o[i].X_L2,o[a].Y_L2),r.lineTo(o[n].X_G2,o[a].Y_L2),r.lineTo(o[n].X_G2,o[s].Y_G2),r.lineTo(o[i].X_L2,o[s].Y_G2),r.closePath(),r.fill()}},CDrawingBoard.prototype.private_AddMove=function(t,e,o){var r=this.m_oGameTree.Get_Handler();if(g_mouse_button_right==o.Button){if(r&&r.AddNewNodeWithMove){var i=this.m_oGameTree.Get_CurNode(),a=i.Get_Prev();if(a){this.m_oGameTree.Set_Handler(null),this.m_oGameTree.GoTo_Node(a);_=this.m_oGameTree.Get_NextMove();if(!1===this.private_CanMakeMove(t,e))return this.m_oGameTree.GoTo_Node(i),void this.m_oGameTree.Set_Handler(r);if(-1===(h=this.m_oGameTree.Get_CurNode().Have_ChildNodeWithMove(t,e,_))||r.CheckExistNodeOnMove&&!0!==r.CheckExistNodeOnMove())this.m_oGameTree.GoTo_Node(i),this.m_oGameTree.Set_Handler(r),r.AddNewNodeWithMove(a,t,e,_);else{d=this.m_oGameTree.Get_CurNode().Get_Next(h);this.m_oGameTree.GoTo_Node(i),this.m_oGameTree.Set_Handler(r),r.GoToNode&&r.GoToNode(d)}}return}this.m_oGameTree.Get_CurNodeDepth()>=1&&(this.m_oGameTree.Step_Backward(1),this.private_MakeMove(t,e))}else if(o.ShiftKey&&o.CtrlKey){var n=BOARD_BLACK===this.m_oGameTree.Get_NextMove()?BOARD_WHITE:BOARD_BLACK;this.m_oGameTree.Set_NextMove(n),this.private_UpdateTargetType()}else if(!0===o.CtrlKey){var s=this.m_oLogicBoard.Get_Size(),l=Common_XYtoString(t,e,s.X,s.Y);this.m_oGameTree.Add_Comment(l);var m=this.m_oGameTree.Get_Drawing();m&&m.Add_CommentWithCoordinates&&m.Add_CommentWithCoordinates(l)}else if(o.ShiftKey)this.m_oGameTree.GoTo_NodeByXY(t,e);else{if(r&&r.AddNewNodeWithMove){if(!1===this.private_CanMakeMove(t,e))return;var _=this.m_oGameTree.Get_NextMove(),h=this.m_oGameTree.Get_CurNode().Have_ChildNodeWithMove(t,e,_);if(-1===h||r.CheckExistNodeOnMove&&!0!==r.CheckExistNodeOnMove())r.AddNewNodeWithMove(this.m_oGameTree.Get_CurNode(),t,e,_);else{var d=this.m_oGameTree.Get_CurNode().Get_Next(h);r.GoToNode&&r.GoToNode(d)}return}this.private_MakeMove(t,e),null!==this.m_oPresentation&&this.m_oGameTree.Get_CurNode().Count_NodeNumber()>=this.m_oPresentation.Get_NodesCountInSlide()&&this.m_oPresentation.On_EndSgfSlide()}},CDrawingBoard.prototype.private_AddOrRemoveStones=function(t,e,o){var r=BOARD_BLACK;BOARD_EMPTY!==this.m_oLogicBoard.Get(t,e)?r=BOARD_EMPTY:o.ShiftKey&&(r=BOARD_WHITE);var i=this.m_oGameTree.Get_Handler();if(i){var a=this.m_oGameTree.Get_CurNode(),n=!0===a.Have_Move()||a===this.m_oGameTree.Get_FirstNode();return void(i.AddOrRemoveStone&&i.AddOrRemoveStone(n,t,e,r))}!0===this.m_oGameTree.Get_CurNode().Have_Move()&&!0===this.m_oGameTree.Add_NewNode(!0,!0)&&this.m_oGameTree.Execute_CurNodeCommands(),this.Draw_Sector(t,e,r),this.m_oLogicBoard.Set(t,e,r,-1),this.m_oGameTree.AddOrRemove_Stones(r,[Common_XYtoValue(t,e)])},CDrawingBoard.prototype.private_AddMark=function(t,e,o){var r=this.private_GetMark(e,o),i=this.m_oGameTree.Get_Handler();if(i)i.AddOrRemoveMark&&i.AddOrRemoveMark(null===r||t!==r.Get_Type(),e,o,t);else if(null!==r&&t===r.Get_Type())this.m_oGameTree.Remove_Mark([Common_XYtoValue(e,o)]),this.Remove_Mark(e,o),this.private_ClearMark(e,o);else{var a=new CDrawingMark(e,o,t,"");this.m_oGameTree.Add_Mark(t,[Common_XYtoValue(e,o)]),this.private_SetMark(e,o,a),this.private_DrawMark(a)}},CDrawingBoard.prototype.private_AddTriangle=function(t,e,o){this.private_AddMark(EDrawingMark.Tr,t,e)},CDrawingBoard.prototype.private_AddSquare=function(t,e,o){this.private_AddMark(EDrawingMark.Sq,t,e)},CDrawingBoard.prototype.private_AddCircle=function(t,e,o){this.private_AddMark(EDrawingMark.Cr,t,e)},CDrawingBoard.prototype.private_AddX=function(t,e,o){this.private_AddMark(EDrawingMark.X,t,e)},CDrawingBoard.prototype.private_AddText=function(t,e,o){var r=this.private_GetMark(t,e),i=this.m_oGameTree.Get_Handler();if(null!==r&&EDrawingMark.Tx===r.Get_Type()){if(i)return void(i.AddOrRemoveMark&&i.AddOrRemoveMark(!1,t,e,EDrawingMark.Tx,r.Get_Text()));this.m_oGameTree.Remove_Mark([Common_XYtoValue(t,e)]),this.Remove_Mark(t,e)}else{var a="";if(o.ShiftKey){if(!this.m_oDrawing||!this.HtmlElement.Control||!this.HtmlElement.Control.HtmlElement)return;var n=this.m_oDrawing.Get_MainDiv();if(!n)return;var s=this.private_GetXYByBoardPos(t,e),l=this.m_oDrawing.Get_ElementOffset(this.HtmlElement.Control.HtmlElement),m=g_oLocalization?g_oLocalization.gameRoom.labelPlaceholder:"Label...",_=50;g_oTextMeasurer&&(g_oTextMeasurer.SetFont("16px 'Times New Roman', Times, serif"),_=g_oTextMeasurer.Measure(m)+6+2+2);var h=document.createElement("input");h.style.position="absolute",h.style.top=l.Y+s.Y-10+"px",h.style.left=l.X+s.X-_/2+"px",h.style.width=_+"px",h.style.height="20px",h.style.fontFamily='"Times New Roman", Times, serif',h.style.fontSize="16px",h.type="text",h.placeholder=m,h.style.outline=0,h.style.border="1px solid rgb(166, 166, 166)",h.style.boxShadow="rgba(0, 0, 0, 0.8) 0px 1px 15px",h.style.padding="3px",n.appendChild(h),h.focus();var d=this;return h.onblur=function(){d.m_oDrawing.Remove_LabelElement()},h.onkeydown=function(o){if(27===o.keyCode)d.m_oDrawing.Remove_LabelElement();else if(13===o.keyCode){if(a=this.value,i)return i.AddOrRemoveMark&&i.AddOrRemoveMark(!0,t,e,EDrawingMark.Tx,a),void d.m_oDrawing.Remove_LabelElement();var r=new CDrawingMark(t,e,EDrawingMark.Tx,a);d.m_oGameTree.Add_TextMark(a,Common_XYtoValue(t,e)),d.private_SetMark(t,e,r),d.private_DrawMarks(),d.m_oDrawing.Remove_LabelElement()}},void d.m_oDrawing.Register_AddLabelElement(h)}if((void 0==a||""===a||null===a)&&null===(a=this.private_GetNextTextMark())){var p=this.m_oGameTree,u=p.Get_Drawing();return void(u&&CreateWindow(u.Get_MainDiv().id,EWindowType.Error,{GameTree:p,Drawing:u,ErrorText:"Sorry, all standard labels are used up! To add more labels, use shift and click on the board to make up ur own labels.",W:305,H:115}))}if(i)return void(i.AddOrRemoveMark&&i.AddOrRemoveMark(!0,t,e,EDrawingMark.Tx,a));var C=new CDrawingMark(t,e,EDrawingMark.Tx,a);this.m_oGameTree.Add_TextMark(a,Common_XYtoValue(t,e)),this.private_SetMark(t,e,C)}this.private_DrawMarks()},CDrawingBoard.prototype.private_AddNum=function(t,e,o){var r=this.private_GetMark(t,e),i=this.m_oGameTree.Get_Handler();if(null!==r&&EDrawingMark.Tx===r.Get_Type()){if(i)return void(i.AddOrRemoveMark&&i.AddOrRemoveMark(!1,t,e,EDrawingMark.Tx,r.Get_Text()));this.m_oGameTree.Remove_Mark([Common_XYtoValue(t,e)]),this.Remove_Mark(t,e)}else{var a="";if(o.ShiftKey){var n=this.m_oLogicBoard.Get_Num(t,e);if(-1==n){var s=this.m_oGameTree,l=s.Get_Drawing();return void(l&&CreateWindow(l.Get_MainDiv().id,EWindowType.Error,{GameTree:s,Drawing:l,ErrorText:"Sorry, no move has been made at that location, so you can't mark it with the move number.",W:305,H:115}))}a=""+n}if(void 0!==a&&""!==a&&null!==a||(a=this.private_GetNextNumMark()),i)return void(i.AddOrRemoveMark&&i.AddOrRemoveMark(!0,t,e,EDrawingMark.Tx,a));var m=new CDrawingMark(t,e,EDrawingMark.Tx,a);this.m_oGameTree.Add_TextMark(a,Common_XYtoValue(t,e)),this.private_SetMark(t,e,m)}this.private_DrawMarks()},CDrawingBoard.prototype.private_GetNextTextMark=function(){var t=[],e=-1;for(var o in this.m_oMarks){var r=this.m_oMarks[o];if(EDrawingMark.Tx==r.Get_Type()){var i=r.Get_Text(),a=i.charCodeAt(0);1==i.length&&65<=a&&a<=90&&(t[a]=1)}}for(var n=65;n<=90;n++)if(void 0===t[n]||""==t[n]){e=n;break}return-1==e?null:String.fromCharCode(e)},CDrawingBoard.prototype.private_GetNextNumMark=function(){var t=[],e=0;for(var o in this.m_oMarks){var r=this.m_oMarks[o];EDrawingMark.Tx===r.Get_Type()&&Common_IsInt(r.Get_Text())&&(t[e]=parseInt(r.Get_Text()),e++)}if(e<=0)return"1";t.sort(Common_SortIncrease);for(var i=0,a=0,n=!1,s=0;s<e;s++){if(t[s]>i+1){a=i+1,n=!0;break}i=t[s]}return n||(a=i+1),""+a},CDrawingBoard.prototype.private_MakeMove=function(t,e){if(1==this.private_CanMakeMove(t,e)){var o=BOARD_BLACK===this.m_oGameTree.Get_NextMove()?BOARD_BLACK:BOARD_WHITE;!0===this.m_oGameTree.Add_NewNodeByPos(t,e,o)&&this.m_oGameTree.Execute_CurNodeCommands()}},CDrawingBoard.prototype.private_CanMakeMove=function(t,e){var o=!1;if(BOARD_EMPTY===this.m_oLogicBoard.Get(t,e)){var r=BOARD_BLACK===this.m_oGameTree.Get_NextMove()?BOARD_BLACK:BOARD_WHITE;this.m_oLogicBoard.Set(t,e,r,-1),o=!0,this.m_oLogicBoard.Set(t,e,BOARD_EMPTY,-1)}return o},CDrawingBoard.prototype.private_HandleKeyDown=function(t){if(EBoardMode.ViewPort!==this.m_eMode){var e=this.m_oGameTree.Get_Handler(),o=t.KeyCode,r=!1;if(8===o||46===o){if(e&&e.RemoveNode)return void e.RemoveNode(this.m_oGameTree.Get_CurNode());this.m_oGameTree.Remove_CurNode(),r=!0}else if(36===o)!0===t.CtrlKey&&!0===t.ShiftKey&&(this.m_oGameTree.GoTo_StartNode(),r=!0);else if(37===o)t.CtrlKey&&t.ShiftKey?this.m_oGameTree.Step_BackwardToStart():t.CtrlKey?this.m_oGameTree.Step_Backward(5):this.m_oGameTree.Step_Backward(1),r=!0;else if(38===o)t.CtrlKey?this.m_oGameTree.GoTo_MainVariant():this.m_oGameTree.GoTo_PrevVariant(),r=!0;else if(39===o)t.CtrlKey&&t.ShiftKey?this.m_oGameTree.Step_ForwardToEnd():t.CtrlKey?this.m_oGameTree.Step_Forward(5):this.m_oGameTree.Step_Forward(1),r=!0;else if(40===o)this.m_oGameTree.GoTo_NextVariant(),r=!0;else if(65===o&&!0===t.CtrlKey&&!0===t.ShiftKey)this.private_DrawLogo(),r=!0;else if(67===o&&!0===t.CtrlKey)EBoardMode.AddMarkColor===this.m_eMode?this.m_oGameTree.Copy_ColorMapFromPrevNode():CreateWindow(this.HtmlElement.Control.HtmlElement.id,EWindowType.CreateNew,{GameTree:this.m_oGameTree,Drawing:this.m_oDrawing}),r=!0;else if(68===o&&!0===t.CtrlKey)!0===t.ShiftKey?this.m_oGameTree.Move_Variant(-1):CreateWindow(this.HtmlElement.Control.HtmlElement.id,EWindowType.DiagramSL,{GameTree:this.m_oGameTree,Drawing:this.m_oDrawing}),r=!0;else if(72===o&&!0===t.CtrlKey)!0===t.ShiftKey?this.m_oGameTree.Download_GifBoardScreenShot():this.m_oGameTree.Download_PngBoardScreenShot(),r=!0;else if(73===o&&!0===t.CtrlKey)!0===t.ShiftKey?this.m_oGameTree.Download_GifForProblem():this.m_oGameTree.Download_GifForCurVariant(),r=!0;else if(75===o&&!0===t.CtrlKey)CreateWindow(this.HtmlElement.Control.HtmlElement.id,EWindowType.Kifu,{GameTree:this.m_oGameTree,Drawing:this.m_oDrawing}),r=!0;else if(77===o&&!0===t.CtrlKey&&!0===t.ShiftKey)this.m_oGameTree.Make_CurrentVariantMainly(),r=!0;else if(79===o&&!0===t.CtrlKey)EBoardMode.AddMarkColor===this.m_eMode?CreateWindow(this.HtmlElement.Control.HtmlElement.id,EWindowType.CountColors,{DrawingBoard:this,Drawing:this.m_oDrawing}):this.m_oGameTree&&this.m_oGameTree.m_nEditingFlags&EDITINGFLAGS_LOADFILE&&(!0===t.ShiftKey?CreateWindow(this.HtmlElement.Control.HtmlElement.id,EWindowType.Clipboard,{GameTree:this.m_oGameTree,Drawing:this.m_oDrawing}):Common.OpenFileDialog(this.m_oGameTree)),r=!0;else if(82===o&&!0===t.CtrlKey)EBoardMode.AddMarkColor===this.m_eMode?(this.private_ClearAllColorMarks(),this.m_oGameTree.Remove_AllColorMarks()):this.Set_Rulers(!0!==this.m_bRulers),r=!0;else if(83===o&&!0===t.CtrlKey){var i=this.m_oGameTree.Save_Sgf();if(FileReader&&Blob){var a=this.m_oGameTree.Get_GameName();""===a&&(a=this.m_oGameTree.Get_WhiteName()+"_vs_"+this.m_oGameTree.Get_BlackName()),a+=".sgf";var n=new Blob([i],{type:"text/plain;charset=utf-8"});Common.SaveAs(n,a,"application/x-go-sgf")}r=!0}else if(85===o&&!0===t.CtrlKey)!0===t.ShiftKey&&(this.m_oGameTree.Move_Variant(1),r=!0);else if(86===o&&!0===t.CtrlKey){if(!0===t.ShiftKey)this.m_oGameTree&&this.m_oGameTree.m_nEditingFlags&EDITINGFLAGS_VIEWPORT&&CreateWindow(this.HtmlElement.Control.HtmlElement.id,EWindowType.ViewPort,{GameTree:this.m_oGameTree,Drawing:this.m_oDrawing});else{var s=this.m_oGameTree.Get_ShowVariants();++s>EShowVariants.Max&&(s=EShowVariants.Min),this.m_oGameTree.Set_ShowVariants(s)}r=!0}else 112===o?(this.Set_Mode(EBoardMode.Move),r=!0):114===o?(this.Set_Mode(EBoardMode.AddRemove),r=!0):115===o?(this.Set_Mode(EBoardMode.AddMarkTr),r=!0):116===o?(this.Set_Mode(EBoardMode.AddMarkSq),r=!0):117===o?(this.Set_Mode(EBoardMode.AddMarkCr),r=!0):118===o?(this.Set_Mode(EBoardMode.AddMarkX),r=!0):119===o?(this.Set_Mode(EBoardMode.AddMarkTx),r=!0):120===o?(this.Set_Mode(EBoardMode.AddMarkNum),r=!0):121===o&&(this.Set_Mode(EBoardMode.AddMarkColor),r=!0);return r}},CDrawingBoard.prototype.private_IsPointInViewPort=function(t,e){return t>=this.m_oViewPort.X0&&t<=this.m_oViewPort.X1&&e>=this.m_oViewPort.Y0&&e<=this.m_oViewPort.Y1},CDrawingBoard.prototype.private_IsHorLineInViewPort=function(t){return t>=this.m_oViewPort.Y0&&t<=this.m_oViewPort.Y1},CDrawingBoard.prototype.private_IsVerLineInViewPort=function(t){return t>=this.m_oViewPort.X0&&t<=this.m_oViewPort.X1},CDrawingBoard.prototype.private_GetSettings_TrueColorBoard=function(){return this.m_oGameTree.Get_LocalSettings().Is_BoardTrueColorBoard()},CDrawingBoard.prototype.private_GetSettings_TrueColorStones=function(){return this.m_oGameTree.Get_LocalSettings().Is_BoardTrueColorStones()},CDrawingBoard.prototype.private_GetSettings_ShellWhiteStones=function(){return this.m_oGameTree.Get_LocalSettings().Is_BoardShellWhiteStones()},CDrawingBoard.prototype.private_GetSettings_Shadows=function(){return this.m_oGameTree.Get_LocalSettings().Is_BoardShadows()},CDrawingBoard.prototype.private_GetSettings_WhiteColor=function(){return this.m_oGameTree.Get_LocalSettings().Get_BoardWhiteColor()},CDrawingBoard.prototype.private_GetSettings_BlackColor=function(){return this.m_oGameTree.Get_LocalSettings().Get_BoardBlackColor()},CDrawingBoard.prototype.private_GetSettings_BoardColor=function(){return this.m_oGameTree.Get_LocalSettings().Get_BoardBoardColor()},CDrawingBoard.prototype.private_GetSettings_LinesColor=function(){return this.m_oGameTree.Get_LocalSettings().Get_BoardLinesColor()},CDrawingBoard.prototype.private_GetSettings_DarkBoard=function(){return this.m_oGameTree.Get_LocalSettings().Is_BoardDarkBoard()},CDrawingBoard.prototype.private_DrawLogo=function(){this.private_DrawTrueColorBoard();var t=this.m_oImageData.W,e=this.m_oImageData.H,o=this.HtmlElement.Lines.Control.HtmlElement.getContext("2d");o.clearRect(0,0,t,e);for(var r=t/406,i=e/348,a=[207,193,1],n=[{X:0,Y:49},{X:0,Y:198},{X:71,Y:348},{X:178,Y:348},{X:318,Y:348},{X:406,Y:238},{X:406,Y:41},{X:247,Y:0}],s=[[[162,162,2],[221,125,2],[256,156,2],[250,203,1],[234,231,2],[199,236,0],[177,228,1],[150,195,1]],[[133,141,2],[229,89,1],[283,136,1],[282,210,2],[247,249,0],[195,261,2],[158,250,0],[124,196,0]],[[106,122,0],[238,45,0],[309,115,0],[312,216,2],[260,267,0],[187,300,1],[138,272,0],[96,197,1]],[[72,99,2],[246,10,0],[346,88,1],[344,224,0],[272,291,0],[182,329,0],[115,298,0],[60,197,0]],[[28,67,0],[259,-40,0],[373,66,0],[385,233,0],[298,319,2],[170,380,0],[81,336,0],[14,198]]],l=0,m=n.length;l<m;l++)o.beginPath(),o.moveTo(a[0]*r,a[1]*i),o.lineTo(n[l].X*r,n[l].Y*i),o.stroke();for(var _=0,h=s.length;_<h;_++){var d=s[_];o.beginPath();for(var p=0,u=d.length;p<u;p++){var C=d[p];0===p?o.moveTo(C[0]*r,C[1]*i):o.lineTo(C[0]*r,C[1]*i)}o.closePath(),o.stroke()}s.push([a]),this.private_CreateTrueColorStones(30*r),this.private_CreateShadows();var g=this.HtmlElement.Stones.Control.HtmlElement.getContext("2d"),c=this.HtmlElement.Shadow.Control.HtmlElement.getContext("2d");g.clearRect(0,0,t,e),c.clearRect(0,0,t,e);for(var v=(this.m_oImageData.StoneDiam-1)/2,f=this.m_oImageData.ShadowOff,_=0,h=s.length;_<h;_++)for(var p=0,u=(d=s[_]).length;p<u;p++){var w=((C=d[p])[0]*r|0)-v,S=(C[1]*i|0)-v;if(BOARD_BLACK===C[2])g.putImageData(this.m_oImageData.BlackStone,w,S);else if(BOARD_WHITE===C[2]){var T=Math.random()*(this.m_oImageData.WhiteStones.length-1)|0;g.putImageData(this.m_oImageData.WhiteStones[T],w,S)}BOARD_BLACK!==C[2]&&BOARD_WHITE!==C[2]||c.putImageData(this.m_oImageData.Shadow,w+f,S+f)}},CDrawingBoard.prototype.Clear_Board=function(){var t=this.m_oImageData.W,e=this.m_oImageData.H;this.HtmlElement.Board.Control.HtmlElement.getContext("2d").clearRect(0,0,t,e),this.HtmlElement.Lines.Control.HtmlElement.getContext("2d").clearRect(0,0,t,e),this.HtmlElement.Stones.Control.HtmlElement.getContext("2d").clearRect(0,0,t,e),this.HtmlElement.Colors.Control.HtmlElement.getContext("2d").clearRect(0,0,t,e),this.HtmlElement.Shadow.Control.HtmlElement.getContext("2d").clearRect(0,0,t,e),this.HtmlElement.Variants.Control.HtmlElement.getContext("2d").clearRect(0,0,t,e),this.HtmlElement.Marks.Control.HtmlElement.getContext("2d").clearRect(0,0,t,e),this.HtmlElement.Target.Control.HtmlElement.getContext("2d").clearRect(0,0,t,e),this.HtmlElement.Select.Control.HtmlElement.getContext("2d").clearRect(0,0,t,e)},CDrawingBoard.prototype.Get_GameTree=function(){return this.m_oGameTree},CDrawingBoard.prototype.Show_Hint=function(t,e){this.m_oHints[""+Common_XYtoValue(t,e)]=!0,this.private_DrawMarks()},CDrawingBoard.prototype.Hide_Hint=function(){this.m_oHints={},this.private_DrawMarks()};var EBoardTargetType={Unknown:-1,BlackStone:0,WhiteStone:1,BlackX:2,WhiteX:3,ColorR:4,ColorG:5,ColorB:6,ColorA:7};CBoardTarget.prototype.Init=function(t){this.m_oHtmlElement=document.getElementById(t),this.m_oHtmlElement.style.position="absolute",this.Hide()},CBoardTarget.prototype.Get_LogicPos=function(){return{X:this.m_nLogicX,Y:this.m_nLogicY}},CBoardTarget.prototype.Update_Size=function(t){this.m_oHtmlElement.width=t,this.m_oHtmlElement.height=t,this.m_oHtmlElement.style.width=t+"px",this.m_oHtmlElement.style.height=t+"px",this.m_nSize=t,this.m_eType=EBoardTargetType.Unknown},CBoardTarget.prototype.Hide=function(){this.m_oHtmlElement.style.display="none",this.m_nLogicX=-1,this.m_nLogicY=-1},CBoardTarget.prototype.Show=function(){var t=this.m_oDrawingBoard.Get_GameTree();t&&!0===t.Get_LocalSettings().Is_ShowTarget()&&(this.m_oHtmlElement.style.display="block")},CBoardTarget.prototype.Check_LogicPos=function(t,e,o){return t==this.m_nLogicX&&e==this.m_nLogicY&&1!=o||(this.m_nLogicX=t,this.m_nLogicY=e,this.Show(),!1)},CBoardTarget.prototype.Set_Pos=function(t,e){this.m_oHtmlElement.style.left=t+"px",this.m_oHtmlElement.style.top=e+"px"},CBoardTarget.prototype.Set_Type=function(t){if(t!=this.m_eType){if(this.m_eType=t,EBoardTargetType.Unknown===t)return;var e=document.createElement("canvas");e.width=this.m_nSize,e.height=this.m_nSize;var o=e.getContext("2d");switch(t){case EBoardTargetType.BlackStone:o.putImageData(this.m_oImageData.BlackTarget,0,0);break;case EBoardTargetType.WhiteStone:o.putImageData(this.m_oImageData.WhiteTarget,0,0);break;case EBoardTargetType.BlackX:o.putImageData(this.m_oImageData.X_Black,0,0);break;case EBoardTargetType.WhiteX:o.putImageData(this.m_oImageData.X_White,0,0);break;case EBoardTargetType.ColorR:o.putImageData(this.m_oImageData.RcolorTarget,0,0);break;case EBoardTargetType.ColorG:o.putImageData(this.m_oImageData.GcolorTarget,0,0);break;case EBoardTargetType.ColorB:o.putImageData(this.m_oImageData.BcolorTarget,0,0);break;case EBoardTargetType.ColorA:o.putImageData(this.m_oImageData.AcolorTarget,0,0)}var r=e.toDataURL("image/png");this.m_oHtmlElement.style.backgroundImage="url('"+r+"')"}},CBoardTarget.prototype.Check_XY=function(t,e){return t==this.m_nLogicX&&e==this.m_nLogicY};var EDrawingButtonState={Normal:0,Active:1,Hover:2,Disabled:4,Selected:8},EDrawingButtonState2={AutoPlayPlaying:0,AutoPlayStopped:16};CDrawingButtonBase.prototype.Init=function(t,e){this.m_oGameTree=e,this.private_RegisterButton(),this.HtmlElement.Control=CreateControlContainer(t);var o=this.HtmlElement.Control.HtmlElement,r=this.private_GetHint();o.setAttribute("title",r),o.style.backgroundColor="rgba(217,217,217,1)";var i=document.createElement("canvas");i.setAttribute("id",t+"_canvas"),i.setAttribute("style","position:absolute;padding:0;margin:0;"),i.setAttribute("oncontextmenu","return false;"),i.style["-webkit-transition"]="background 2s",i.style.transition="background 2s",i.draggable="false",i.ondragstart=function(t){return t.preventDefault(),!1},o.appendChild(i),this.HtmlElement.Canvas.Control=CreateControlContainer(t+"_canvas");var a=this.HtmlElement.Canvas.Control;a.Bounds.SetParams(0,0,1e3,1e3,!1,!1,!1,!1,-1,-1),a.Anchor=g_anchor_top|g_anchor_left|g_anchor_bottom|g_anchor_right,this.HtmlElement.Control.AddControl(a),o.onmousedown=this.private_OnMouseDown,o.onmouseup=this.private_OnMouseUp,o.onmouseover=this.private_OnMouseOver,o.onmouseout=this.private_OnMouseOut,o.onfocus=this.private_OnFocus,o.tabIndex=-1,o.style.outline="none",o.draggable="true",o.ondragstart=this.private_OnDragStart,this.Update_Size()},CDrawingButtonBase.prototype.Update_Size=function(t){if(!0===this.private_IsReady()){var e=this.HtmlElement.Control.HtmlElement.clientWidth,o=this.HtmlElement.Control.HtmlElement.clientHeight;e===this.m_nW&&o===this.m_nH&&!0!==t||(this.m_nW=e,this.m_nH=o,this.HtmlElement.Control.Resize(this.m_nW,this.m_nH),this.private_OnResize())}},CDrawingButtonBase.prototype.Set_Enabled=function(t){!0===t&&this.m_nState===EDrawingButtonState.Disabled?(this.m_nState=EDrawingButtonState.Normal,this.private_UpdateState()):!1===t&&this.m_nState!==EDrawingButtonState.Disabled&&(this.m_nState=EDrawingButtonState.Disabled,this.private_UpdateState())},CDrawingButtonBase.prototype.Set_State2=function(t){this.m_nState2!==t&&(this.m_nState2=t,this.private_OnResize(),this.HtmlElement.Control.HtmlElement.setAttribute("title",this.private_GetHint()))},CDrawingButtonBase.prototype.Set_Selected=function(t){this.m_bSelected!==t&&(this.m_bSelected=t,!0===t&&EDrawingButtonState.Normal===this.m_nState?(this.m_nState=EDrawingButtonState.Selected,this.private_UpdateState()):!1===t&&EDrawingButtonState.Selected===this.m_nState&&(this.m_nState=EDrawingButtonState.Normal,this.private_UpdateState()))},CDrawingButtonBase.prototype.Hide=function(){this.HtmlElement.Control&&this.HtmlElement.Control.HtmlElement&&(this.HtmlElement.Control.HtmlElement.style.display="none")},CDrawingButtonBase.prototype.Show=function(){this.HtmlElement.Control&&this.HtmlElement.Control.HtmlElement&&(this.HtmlElement.Control.HtmlElement.style.display="block")},CDrawingButtonBase.prototype.private_OnResize=function(){var t=this.m_nH,e=this.m_nW;0!==e&&0!==t&&(this.m_oImageData.Active=this.private_Draw(this.m_oActiveBColor,this.m_oActiveFColor,e,t),this.m_oImageData.Hover=this.private_Draw(this.m_oHoverBColor,this.m_oHoverFColor,e,t,!1,!0),this.m_oImageData.Normal=this.private_Draw(this.m_oNormaBColor,this.m_oNormaFColor,e,t),this.m_oImageData.Disabled=this.private_Draw(this.m_oDisabledBColor,this.m_oDisabledFColor,e,t,!0),this.m_oImageData.Selected=this.private_Draw(this.m_oSelectedBColor,this.m_oHoverFColor,e,t,!1,!0),this.private_UpdateState())},CDrawingButtonBase.prototype.private_Draw=function(t,e,o,r,i,a){var n=this.HtmlElement.Canvas.Control.HtmlElement.getContext("2d");n.clearRect(0,0,o,r),n.fillStyle=t.ToString(),n.fillRect(0,0,o,r),n.fillStyle=e.ToString(),n.strokeStyle=e.ToString();var s=.8*Math.min(o,r)|0,l=(o-s)/2,m=(r-s)/2;return this.private_DrawOnCanvas(n,s,l,m,i,o,r,t,e),!0===a&&this.private_DrawSelectionBounds(n,o,r),n.getImageData(0,0,o,r)},CDrawingButtonBase.prototype.private_DrawOnCanvas=function(t,e,o,r,i,a,n,s,l){},CDrawingButtonBase.prototype.private_DrawTriangle=function(t,e,o,r,i){var a=Math.ceil(e+t/5+.5),n=Math.ceil(e+4*t/5+.5),s=Math.ceil(o+t/5+.5),l=Math.ceil(o+t/2+.5),m=Math.ceil(o+4*t/5+.5);i<0?(r.beginPath(),r.moveTo(a,l),r.lineTo(n,s),r.lineTo(n,m),r.closePath(),r.fill()):(r.beginPath(),r.moveTo(a,s),r.lineTo(n,l),r.lineTo(a,m),r.closePath(),r.fill())},CDrawingButtonBase.prototype.private_UpdateState=function(){var t=this.HtmlElement.Canvas.Control.HtmlElement.getContext("2d"),e=null;switch(this.m_nState){case EDrawingButtonState.Hover:e=this.m_oImageData.Hover;break;case EDrawingButtonState.Active:e=this.m_oImageData.Active;break;case EDrawingButtonState.Disabled:e=this.m_oImageData.Disabled;break;case EDrawingButtonState.Selected:e=this.m_oImageData.Selected;break;default:case EDrawingButtonState.Normal:e=this.m_oImageData.Normal}e&&t.putImageData(e,0,0)},CDrawingButtonBase.prototype.private_HandleMouseDown=function(){},CDrawingButtonBase.prototype.private_GetHint=function(){return""},CDrawingButtonBase.prototype.private_RegisterButton=function(){},CDrawingButtonBase.prototype.private_AddImageToLoad=function(t){this.m_nLoadReady--;var e=new Image,o=this;return e.onload=function(){o.private_OnImageReady()},e.src=t,e},CDrawingButtonBase.prototype.private_IsReady=function(){return!(this.m_nLoadReady<0)},CDrawingButtonBase.prototype.private_OnImageReady=function(){++this.m_nLoadReady>=0&&this.Update_Size(!0)},CDrawingButtonBase.prototype.private_ClickTransformIn=function(){this.HtmlElement.Control.HtmlElement.style.transition="transform 0.1s ease-out",this.HtmlElement.Control.HtmlElement.style.transform="scale(0.9)"},CDrawingButtonBase.prototype.private_ClickTransformOut=function(){this.HtmlElement.Control.HtmlElement.style.transition="transform 0.2s ease-out",this.HtmlElement.Control.HtmlElement.style.transform="scale(1)"},CDrawingButtonBase.prototype.private_DrawSelectionBounds=function(t,e,o){t.beginPath(),t.lineWidth=1,t.strokeStyle=new CColor(0,0,0,255).ToString(),t.moveTo(0,0),t.lineTo(e,0),t.lineTo(e,o),t.lineTo(0,o),t.lineTo(0,0),t.stroke(),t.beginPath()},CommonExtend(CDrawingButtonBackwardToStart,CDrawingButtonBase),CDrawingButtonBackwardToStart.prototype.private_DrawOnCanvas=function(t,e,o,r,i,a,n,s,l){var m=i?this.m_oImageDisabled:this.m_oImage;m&&t.drawImage(m,0,0)},CDrawingButtonBackwardToStart.prototype.private_HandleMouseDown=function(){this.m_oGameTree.Step_BackwardToStart()},CDrawingButtonBackwardToStart.prototype.private_GetHint=function(){return(window.g_oLocalization?window.g_oLocalization.gameRoom.button.hint.backwardStart:"Back to the start")+" (Ctrl+Shift+Left)"},CDrawingButtonBackwardToStart.prototype.private_RegisterButton=function(){this.m_oDrawing.Register_BackwardToStartButton(this)},CommonExtend(CDrawingButtonBackward5,CDrawingButtonBase),CDrawingButtonBackward5.prototype.private_DrawOnCanvas=function(t,e,o,r,i,a,n,s,l){var m=i?this.m_oImageDisabled:this.m_oImage;m&&t.drawImage(m,0,0)},CDrawingButtonBackward5.prototype.private_HandleMouseDown=function(){this.m_oGameTree.Step_Backward(5)},CDrawingButtonBackward5.prototype.private_GetHint=function(){return(window.g_oLocalization?window.g_oLocalization.gameRoom.button.hint.backward5:"Back 5 moves")+" (Ctrl+Left)"},CDrawingButtonBackward5.prototype.private_RegisterButton=function(){this.m_oDrawing.Register_Backward_5Button(this)},CommonExtend(CDrawingButtonBackward,CDrawingButtonBase),CDrawingButtonBackward.prototype.private_DrawOnCanvas=function(t,e,o,r,i,a,n,s,l){var m=i?this.m_oImageDisabled:this.m_oImage;m&&t.drawImage(m,0,0)},CDrawingButtonBackward.prototype.private_HandleMouseDown=function(){this.m_oGameTree.Step_Backward(1)},CDrawingButtonBackward.prototype.private_GetHint=function(){return(window.g_oLocalization?window.g_oLocalization.gameRoom.button.hint.backward1:"Back")+" (Left)"},CDrawingButtonBackward.prototype.private_RegisterButton=function(){this.m_oDrawing.Register_BackwardButton(this)},CommonExtend(CDrawingButtonForward,CDrawingButtonBase),CDrawingButtonForward.prototype.private_DrawOnCanvas=function(t,e,o,r,i,a,n,s,l){var m=i?this.m_oImageDisabled:this.m_oImage;m&&t.drawImage(m,0,0)},CDrawingButtonForward.prototype.private_HandleMouseDown=function(){this.m_oGameTree.Step_Forward(1)},CDrawingButtonForward.prototype.private_GetHint=function(){return(window.g_oLocalization?window.g_oLocalization.gameRoom.button.hint.forward1:"Forward")+" (Right)"},CDrawingButtonForward.prototype.private_RegisterButton=function(){this.m_oDrawing.Register_ForwardButton(this)},CommonExtend(CDrawingButtonForward5,CDrawingButtonBase),CDrawingButtonForward5.prototype.private_DrawOnCanvas=function(t,e,o,r,i,a,n,s,l){var m=i?this.m_oImageDisabled:this.m_oImage;m&&t.drawImage(m,0,0)},CDrawingButtonForward5.prototype.private_HandleMouseDown=function(){this.m_oGameTree.Step_Forward(5)},CDrawingButtonForward5.prototype.private_GetHint=function(){return(window.g_oLocalization?window.g_oLocalization.gameRoom.button.hint.forward5:"Forward 5 moves")+" (Ctrl+Right)"},CDrawingButtonForward5.prototype.private_RegisterButton=function(){this.m_oDrawing.Register_Forward_5Button(this)},CommonExtend(CDrawingButtonForwardToEnd,CDrawingButtonBase),CDrawingButtonForwardToEnd.prototype.private_DrawOnCanvas=function(t,e,o,r,i,a,n,s,l){var m=i?this.m_oImageDisabled:this.m_oImage;m&&t.drawImage(m,0,0)},CDrawingButtonForwardToEnd.prototype.private_HandleMouseDown=function(){this.m_oGameTree.Step_ForwardToEnd()},CDrawingButtonForwardToEnd.prototype.private_GetHint=function(){return(window.g_oLocalization?window.g_oLocalization.gameRoom.button.hint.forwardEnd:"Go to the end")+" (Ctrl+Shift+Right)"},CDrawingButtonForwardToEnd.prototype.private_RegisterButton=function(){this.m_oDrawing.Register_ForwardToEndButton(this)},CommonExtend(CDrawingButtonNextVariant,CDrawingButtonBase),CDrawingButtonNextVariant.prototype.private_DrawOnCanvas=function(t,e,o,r,i,a,n,s,l){var m=Math.ceil(o+.2*e+.5),_=Math.ceil(o+.35*e+.5),h=Math.ceil(o+.57*e+.5),d=Math.ceil(o+.92*e+.5),p=Math.ceil(r+.2*e+.5),u=Math.ceil(r+.38*e+.5),C=Math.ceil(r+.52*e+.5),g=Math.ceil(r+.6*e+.5),c=Math.ceil(r+.68*e+.5),v=Math.ceil(r+.84*e+.5);t.beginPath(),t.moveTo(m,p),t.lineTo(_,p),t.lineTo(_,C),t.lineTo(h,C),t.lineTo(h,u),t.lineTo(d,g),t.lineTo(h,v),t.lineTo(h,c),t.lineTo(m,c),t.closePath(),t.fill()},CDrawingButtonNextVariant.prototype.private_HandleMouseDown=function(){this.m_oGameTree.GoTo_NextVariant()},CDrawingButtonNextVariant.prototype.private_GetHint=function(){return(window.g_oLocalization?window.g_oLocalization.gameRoom.button.hint.nextVariant:"Next variant")+" (Down)"},CDrawingButtonNextVariant.prototype.private_RegisterButton=function(){this.m_oDrawing.Register_NextVariantButton(this)},CommonExtend(CDrawingButtonPrevVariant,CDrawingButtonBase),CDrawingButtonPrevVariant.prototype.private_DrawOnCanvas=function(t,e,o,r,i,a,n,s,l){var m=Math.ceil(o+.2*e+.5),_=Math.ceil(o+.35*e+.5),h=Math.ceil(o+.57*e+.5),d=Math.ceil(o+.92*e+.5),p=Math.ceil(r+.8*e+.5),u=Math.ceil(r+.62*e+.5),C=Math.ceil(r+.48*e+.5),g=Math.ceil(r+.4*e+.5),c=Math.ceil(r+(1-.68)*e+.5),v=Math.ceil(r+(1-.84)*e+.5);t.beginPath(),t.moveTo(m,p),t.lineTo(_,p),t.lineTo(_,C),t.lineTo(h,C),t.lineTo(h,u),t.lineTo(d,g),t.lineTo(h,v),t.lineTo(h,c),t.lineTo(m,c),t.closePath(),t.fill()},CDrawingButtonPrevVariant.prototype.private_HandleMouseDown=function(){this.m_oGameTree.GoTo_PrevVariant()},CDrawingButtonPrevVariant.prototype.private_GetHint=function(){return(window.g_oLocalization?window.g_oLocalization.gameRoom.button.hint.prevVariant:"Previous variant")+" (Up)"},CDrawingButtonPrevVariant.prototype.private_RegisterButton=function(){this.m_oDrawing.Register_PrevVariantButton(this)},CommonExtend(CDrawingButtonEditModeMove,CDrawingButtonBase),CDrawingButtonEditModeMove.prototype.private_DrawOnCanvas=function(t,e,o,r,i,a,n,s,l){var m=Math.ceil(o+.5*e-e/10+.5),_=Math.ceil(r+.5*e-e/10+.5),h=Math.ceil(.25*e+.5);t.fillStyle=new CColor(255,255,255).ToString(),t.strokeStyle=new CColor(0,0,0).ToString(),t.beginPath(),t.arc(m,_,h,0,2*Math.PI,!1),t.fill(),t.stroke(),t.fillStyle=new CColor(0,0,0).ToString(),m=Math.ceil(o+.5*e+e/10+.5),_=Math.ceil(r+.5*e+e/10+.5),h=Math.ceil(.25*e+.5),t.beginPath(),t.arc(m,_,h,0,2*Math.PI,!1),t.fill()},CDrawingButtonEditModeMove.prototype.private_HandleMouseDown=function(){this.m_oGameTree.Get_DrawingBoard().Set_Mode(EBoardMode.Move)},CDrawingButtonEditModeMove.prototype.private_GetHint=function(){return(window.g_oLocalization?window.g_oLocalization.gameRoom.button.hint.editModeMoves:"Moves")+" (F1)"},CDrawingButtonEditModeMove.prototype.private_RegisterButton=function(){this.m_oDrawing.Register_EditModeMoveButton(this)},CommonExtend(CDrawingButtonEditModeAddRem,CDrawingButtonBase),CDrawingButtonEditModeAddRem.prototype.private_DrawOnCanvas=function(t,e,o,r,i,a,n,s,l){var m,_=Math.ceil(o+.75*e+.5),h=Math.ceil(r+.125*e+.5),d=Math.ceil(.25*e+.5),p=Math.ceil(.02*e+.5);t.fillRect(_,h,d,p),_=Math.ceil(o+.875*e+.5),h=Math.ceil(r+.5),d=Math.ceil(.02*e+.5),p=Math.ceil(.25*e+.5),t.fillRect(_,h,d,p),_=Math.ceil(o+.5),h=Math.ceil(r+.875*e+.5),d=Math.ceil(.25*e+.5),p=Math.ceil(.02*e+.5),t.fillRect(_,h,d,p),_=Math.ceil(o+.5*e-e/10+.5),h=Math.ceil(r+.5*e-e/10+.5),m=Math.ceil(.25*e+.5),t.fillStyle=new CColor(255,255,255).ToString(),t.strokeStyle=new CColor(0,0,0).ToString(),t.beginPath(),t.arc(_,h,m,0,2*Math.PI,!1),t.fill(),t.stroke(),t.fillStyle=new CColor(0,0,0).ToString(),_=Math.ceil(o+.5*e+e/10+.5),h=Math.ceil(r+.5*e+e/10+.5),m=Math.ceil(.25*e+.5),t.beginPath(),t.arc(_,h,m,0,2*Math.PI,!1),t.fill()},CDrawingButtonEditModeAddRem.prototype.private_HandleMouseDown=function(){this.m_oGameTree.Get_DrawingBoard().Set_Mode(EBoardMode.AddRemove)},CDrawingButtonEditModeAddRem.prototype.private_GetHint=function(){return(window.g_oLocalization?window.g_oLocalization.gameRoom.button.hint.editModeEditor:"Editor")+" (F3)"},CDrawingButtonEditModeAddRem.prototype.private_RegisterButton=function(){this.m_oDrawing.Register_EditModeAddRemButton(this)},CommonExtend(CDrawingButtonEditModeTr,CDrawingButtonBase),CDrawingButtonEditModeTr.prototype.private_DrawOnCanvas=function(t,e,o,r,i,a,n,s,l){var m=e/2,_=3*e/4,h=.1*e,d=Math.sqrt(m*m-(_-m)*(_-m))+m,p=-Math.sqrt(m*m-(_-m)*(_-m))+m;t.lineWidth=Math.ceil(.05*e+.5),t.beginPath(),t.moveTo(o+e/2,r+2*h),t.lineTo(o+d-h,r+_+h),t.lineTo(o+p+h,r+_+h),t.closePath(),t.stroke()},CDrawingButtonEditModeTr.prototype.private_HandleMouseDown=function(){this.m_oGameTree.Get_DrawingBoard().Set_Mode(EBoardMode.AddMarkTr)},CDrawingButtonEditModeTr.prototype.private_GetHint=function(){return(window.g_oLocalization?window.g_oLocalization.gameRoom.button.hint.editModeTriangles:"Triangles")+" (F4)"},CDrawingButtonEditModeTr.prototype.private_RegisterButton=function(){this.m_oDrawing.Register_EditModeTrButton(this)},CommonExtend(CDrawingButtonEditModeSq,CDrawingButtonBase),CDrawingButtonEditModeSq.prototype.private_DrawOnCanvas=function(t,e,o,r,i,a,n,s,l){var m=e/2,_=.05*e,h=-e/2*Math.sqrt(2)/2+e/2,d=e/2*Math.sqrt(2)/2+e/2,p=Math.sqrt(m*m-(h-m)*(h-m))+m,u=-Math.sqrt(m*m-(h-m)*(h-m))+m,C=Math.floor(o+p-_),g=Math.ceil(o+u+_),c=Math.ceil(r+h+_),v=Math.floor(r+d-_);t.lineWidth=Math.ceil(.05*e+.5),t.beginPath(),t.moveTo(C,c),t.lineTo(g,c),t.lineTo(g,v),t.lineTo(C,v),t.closePath(),t.stroke()},CDrawingButtonEditModeSq.prototype.private_HandleMouseDown=function(){this.m_oGameTree.Get_DrawingBoard().Set_Mode(EBoardMode.AddMarkSq)},CDrawingButtonEditModeSq.prototype.private_GetHint=function(){return(window.g_oLocalization?window.g_oLocalization.gameRoom.button.hint.editModeSquares:"Squares")+" (F5)"},CDrawingButtonEditModeSq.prototype.private_RegisterButton=function(){this.m_oDrawing.Register_EditModeSqButton(this)},CommonExtend(CDrawingButtonEditModeCr,CDrawingButtonBase),CDrawingButtonEditModeCr.prototype.private_DrawOnCanvas=function(t,e,o,r,i,a,n,s,l){var m=.05*e,_=e/2,h=4*m;t.lineWidth=Math.ceil(m+.5),t.beginPath(),t.arc(o+e/2,r+e/2,_-h,0,2*Math.PI,!1),t.stroke()},CDrawingButtonEditModeCr.prototype.private_HandleMouseDown=function(){this.m_oGameTree.Get_DrawingBoard().Set_Mode(EBoardMode.AddMarkCr)},CDrawingButtonEditModeCr.prototype.private_GetHint=function(){return(window.g_oLocalization?window.g_oLocalization.gameRoom.button.hint.editModeCircles:"Circles")+" (F6)"},CDrawingButtonEditModeCr.prototype.private_RegisterButton=function(){this.m_oDrawing.Register_EditModeCrButton(this)},CommonExtend(CDrawingButtonEditModeX,CDrawingButtonBase),CDrawingButtonEditModeX.prototype.private_DrawOnCanvas=function(t,e,o,r,i,a,n,s,l){var m=o+.25*e,_=o+.75*e,h=r+.25*e,d=r+.75*e,p=.05*e;t.lineWidth=Math.ceil(p+.5),t.beginPath(),t.moveTo(m,h),t.lineTo(_,d),t.moveTo(_,h),t.lineTo(m,d),t.stroke()},CDrawingButtonEditModeX.prototype.private_HandleMouseDown=function(){this.m_oGameTree.Get_DrawingBoard().Set_Mode(EBoardMode.AddMarkX)},CDrawingButtonEditModeX.prototype.private_GetHint=function(){return(window.g_oLocalization?window.g_oLocalization.gameRoom.button.hint.editModeXMarks:"X marks")+" (F7)"},CDrawingButtonEditModeX.prototype.private_RegisterButton=function(){this.m_oDrawing.Register_EditModeXButton(this)},CommonExtend(CDrawingButtonEditModeText,CDrawingButtonBase),CDrawingButtonEditModeText.prototype.private_DrawOnCanvas=function(t,e,o,r,i,a,n,s,l){var m=.8*e,_=m+"px Arial";t.font=_;var h=r+e/2+m/3,d=o+(e-t.measureText("A").width)/2;t.fillText("A",d,h)},CDrawingButtonEditModeText.prototype.private_HandleMouseDown=function(){this.m_oGameTree.Get_DrawingBoard().Set_Mode(EBoardMode.AddMarkTx)},CDrawingButtonEditModeText.prototype.private_GetHint=function(){return(window.g_oLocalization?window.g_oLocalization.gameRoom.button.hint.editModeText:"Text labels")+" (F8)"},CDrawingButtonEditModeText.prototype.private_RegisterButton=function(){this.m_oDrawing.Register_EditModeTextButton(this)},CommonExtend(CDrawingButtonEditModeNum,CDrawingButtonBase),CDrawingButtonEditModeNum.prototype.private_DrawOnCanvas=function(t,e,o,r,i,a,n,s,l){var m=.8*e,_=m+"px Helvetica, Arial, Verdana";t.font=_;var h=r+e/2+m/3,d=o+(e-t.measureText("1").width)/2;t.fillText("1",d,h)},CDrawingButtonEditModeNum.prototype.private_HandleMouseDown=function(){this.m_oGameTree.Get_DrawingBoard().Set_Mode(EBoardMode.AddMarkNum)},CDrawingButtonEditModeNum.prototype.private_GetHint=function(){return(window.g_oLocalization?window.g_oLocalization.gameRoom.button.hint.editModeNumbers:"Numeric labels")+" (F9)"},CDrawingButtonEditModeNum.prototype.private_RegisterButton=function(){this.m_oDrawing.Register_EditModeNumButton(this)},CommonExtend(CDrawingButtonAutoPlay,CDrawingButtonBase),CDrawingButtonAutoPlay.prototype.private_DrawOnCanvas=function(t,e,o,r,i,a,n,s,l){if(EDrawingButtonState2.AutoPlayStopped===this.m_nState2)this.private_DrawTriangle(e,o,r,t,1);else{var m=Math.floor(o+e/5+e/20+.5),_=Math.ceil(o+4*e/5-e/20+.5),h=Math.ceil(r+e/5+.5),d=Math.ceil(r+4*e/5+.5),p=Math.ceil(m+e/5),u=Math.floor(_-e/5);t.beginPath(),t.moveTo(m,h),t.lineTo(p,h),t.lineTo(p,d),t.lineTo(m,d),t.closePath(),t.fill(),t.beginPath(),t.moveTo(_,h),t.lineTo(u,h),t.lineTo(u,d),t.lineTo(_,d),t.closePath(),t.fill()}},CDrawingButtonAutoPlay.prototype.private_HandleMouseDown=function(){EDrawingButtonState2.AutoPlayStopped===this.m_nState2?this.m_oGameTree.Start_AutoPlay():this.m_oGameTree.Stop_AutoPlay()},CDrawingButtonAutoPlay.prototype.private_GetHint=function(){return EDrawingButtonState2.AutoPlayStopped===this.m_nState2?window.g_oLocalization?window.g_oLocalization.gameRoom.button.hint.startAutoplay:"Start autoplay":window.g_oLocalization?window.g_oLocalization.gameRoom.button.hint.stopAutoplay:"Stop autoplay"},CDrawingButtonAutoPlay.prototype.private_RegisterButton=function(){this.m_oDrawing.Register_AutoPlayButton(this)},CommonExtend(CDrawingButtonClose,CDrawingButtonBase),CDrawingButtonClose.prototype.private_DrawOnCanvas=function(t,e,o,r,i,a,n,s,l){for(var m=t.createImageData(a,n),_=m.data,o=(a-8)/2|0,r=(n-8)/2|0,h=0;h<n;h++)for(var d=0;d<a;d++){var p=4*(d+h*a),u=l.r,C=l.g,g=l.b,c=h-r,v=d-o;(0!==c||0!==v&&1!==v&&6!==v&&7!==v)&&(1!==c||1!==v&&2!==v&&5!==v&&6!==v)&&(2!==c||2!==v&&3!==v&&4!==v&&5!==v)&&(3!==c||3!==v&&4!==v)&&(4!==c||3!==v&&4!==v)&&(5!==c||2!==v&&3!==v&&4!==v&&5!==v)&&(6!==c||1!==v&&2!==v&&5!==v&&6!==v)&&(7!==c||0!==v&&1!==v&&6!==v&&7!==v)||(u=255,C=255,g=255),_[p+0]=u,_[p+1]=C,_[p+2]=g,_[p+3]=255}t.putImageData(m,0,0)},CDrawingButtonClose.prototype.private_HandleMouseDown=function(){this.m_oGameTree.Close()},CDrawingButtonClose.prototype.private_GetHint=function(){return window.g_oLocalization?window.g_oLocalization.common.button.close:"Close"},CDrawingButtonClose.prototype.private_ClickTransformIn=function(){},CDrawingButtonClose.prototype.private_ClickTransformOut=function(){},CDrawingButtonClose.prototype.private_DrawSelectionBounds=function(t,e,o){},CommonExtend(CDrawingButtonGameInfo,CDrawingButtonBase),CDrawingButtonGameInfo.prototype.private_DrawOnCanvas=function(t,e,o,r,i,a,n,s,l){var m=.02*e,_=e/2,h=4*m;t.lineWidth=Math.ceil(m+.5),t.beginPath(),t.arc(o+e/2,r+e/2,_-h,0,2*Math.PI,!1),t.stroke();var d=.9*e,p=d+"px Times New Roman, Sans serif";t.font=p;var u=r+e/2+d/3,C=o+(e-t.measureText("i").width)/2;t.fillText("i",C,u)},CDrawingButtonGameInfo.prototype.private_HandleMouseDown=function(){CreateWindow(this.HtmlElement.Control.HtmlElement.id,EWindowType.GameInfo,{GameTree:this.m_oGameTree,Drawing:this.m_oDrawing})},CDrawingButtonGameInfo.prototype.private_GetHint=function(){return window.g_oLocalization?window.g_oLocalization.gameRoom.button.hint.gameInfo:"Game info"},CommonExtend(CDrawingButtonOK,CDrawingButtonBase),CDrawingButtonOK.prototype.private_DrawOnCanvas=function(t,e,o,r,i,a,n,s,l){var m="OK";window.g_oLocalization&&(m=window.g_oLocalization.common.button.ok),t.lineWidth=1,t.moveTo(0,0),t.lineTo(0,n),t.lineTo(a,n),t.lineTo(a,0),t.lineTo(0,0),t.stroke();var _=m,h=.8*e,d=h+"px Tahoma, Sans serif";t.fillStyle=new CColor(0,0,0,255).ToString(),t.font=d;var p=r+e/2+h/3,u=o+(e-t.measureText(_).width)/2;t.fillText(_,u,p)},CDrawingButtonOK.prototype.private_HandleMouseDown=function(){this.m_oGameTree.Handle_OK()},CDrawingButtonOK.prototype.private_GetHint=function(){var t="OK";return window.g_oLocalization&&(t=window.g_oLocalization.common.button.ok),t},CDrawingButtonOK.prototype.private_ClickTransformIn=function(){},CDrawingButtonOK.prototype.private_ClickTransformOut=function(){},CDrawingButtonOK.prototype.private_DrawSelectionBounds=function(t,e,o){},CommonExtend(CDrawingButtonCancel,CDrawingButtonBase),CDrawingButtonCancel.prototype.private_DrawOnCanvas=function(t,e,o,r,i,a,n,s,l){var m="Cancel";window.g_oLocalization&&(m=window.g_oLocalization.common.button.cancel),t.lineWidth=1,t.moveTo(0,0),t.lineTo(0,n),t.lineTo(a,n),t.lineTo(a,0),t.lineTo(0,0),t.stroke();var _=m,h=.8*e,d=h+"px Tahoma, Sans serif";t.fillStyle=new CColor(0,0,0,255).ToString(),t.font=d;var p=r+e/2+h/3,u=o+(e-t.measureText(_).width)/2;t.fillText(_,u,p)},CDrawingButtonCancel.prototype.private_HandleMouseDown=function(){this.m_oGameTree.Handle_Cancel()},CDrawingButtonCancel.prototype.private_GetHint=function(){var t="Cancel";return window.g_oLocalization&&(t=window.g_oLocalization.common.button.cancel),t},CDrawingButtonCancel.prototype.private_ClickTransformIn=function(){},CDrawingButtonCancel.prototype.private_ClickTransformOut=function(){},CDrawingButtonCancel.prototype.private_DrawSelectionBounds=function(t,e,o){},CommonExtend(CDrawingButtonSettings,CDrawingButtonBase),CDrawingButtonSettings.prototype.Init=function(t,e){CDrawingButtonToolbarCustomize.superclass.Init.apply(this,arguments);var o=this.HtmlElement.Control.HtmlElement,r=document.createElement("canvas");r.setAttribute("id",t+"_transform"),r.setAttribute("style","position:absolute;padding:0;margin:0;"),r.setAttribute("oncontextmenu","return false;"),r.width=36,r.height=36,r.draggable="false",r.ondragstart=function(t){return t.preventDefault(),!1},o.appendChild(r);var i=CreateControlContainer(t+"_canvas");i.Bounds.SetParams(0,0,1e3,1e3,!1,!1,!1,!1,-1,-1),i.Anchor=g_anchor_top|g_anchor_left|g_anchor_bottom|g_anchor_right,this.HtmlElement.Control.AddControl(i),this.m_oTransformCanvas=r},CDrawingButtonSettings.prototype.private_DrawOnCanvas=function(t,e,o,r,i,a,n,s,l){var m=this.m_oTransformCanvas.getContext("2d");m.fillStyle=t.fillStyle,m.strokeStyle=t.strokeStyle;var _=.02*e,h=e/2-e/30,d=e/4;m.lineWidth=Math.ceil(7*_+.5),m.beginPath(),m.arc(o+e/2,r+e/2,d,0,2*Math.PI,!1),m.stroke(),m.lineWidth=Math.ceil(5*_+.5);for(var p=0;p<9;p++){m.beginPath();var u=40*p*Math.PI/180;m.lineTo(o+d*Math.cos(u)+e/2,r-d*Math.sin(u)+e/2),m.lineTo(o+h*Math.cos(u)+e/2,r-h*Math.sin(u)+e/2),m.stroke()}},CDrawingButtonSettings.prototype.private_HandleMouseDown=function(){CreateWindow(this.HtmlElement.Control.HtmlElement.id,EWindowType.Settings,{GameTree:this.m_oGameTree,Drawing:this.m_oDrawing}),"rotate(90deg)"!==this.m_oTransformCanvas.style.transform?(this.m_oTransformCanvas.style.transition="transform 0.5s linear",this.m_oTransformCanvas.style.transform="rotate(90deg)"):(this.m_oTransformCanvas.style.transition="transform 0.5s linear",this.m_oTransformCanvas.style.transform="rotate(0deg)")},CDrawingButtonSettings.prototype.private_GetHint=function(){return"Settings"},CommonExtend(CDrawingButtonPass,CDrawingButtonBase),CDrawingButtonPass.prototype.private_DrawOnCanvas=function(t,e,o,r,i,a,n,s,l){var m=window.g_oLocalization?window.g_oLocalization.gameRoom.button.pass:"Pass",_=.9*e,h=_+"px Times New Roman, Sans serif";t.font=h;var d=r+e/2+_/3,p=o+(e-t.measureText(m).width)/2;t.fillText(m,p,d)},CDrawingButtonPass.prototype.private_HandleMouseDown=function(){this.m_oGameTree.Pass()},CDrawingButtonPass.prototype.private_GetHint=function(){return window.g_oLocalization?window.g_oLocalization.gameRoom.button.pass:"Pass"},CommonExtend(CDrawingButtonAbout,CDrawingButtonBase),CDrawingButtonAbout.prototype.private_DrawOnCanvas=function(t,e,o,r,i,a,n,s,l){var m=.02*e,_=e/2,h=4*m;t.lineWidth=Math.ceil(m+.5),t.beginPath(),t.arc(o+e/2,r+e/2,_-h,0,2*Math.PI,!1),t.stroke();var d=.9*e,p=d+"px Times New Roman, Sans serif";t.font=p;var u=r+e/2+d/3,C=o+(e-t.measureText("?").width)/2;t.fillText("?",C,u)},CDrawingButtonAbout.prototype.private_HandleMouseDown=function(){CreateWindow(this.HtmlElement.Control.HtmlElement.id,EWindowType.About,{GameTree:this.m_oGameTree,Drawing:this.m_oDrawing})},CDrawingButtonAbout.prototype.private_GetHint=function(){return"About"},CommonExtend(CDrawingButtonTabComments,CDrawingButtonBase),CDrawingButtonTabComments.prototype.private_DrawOnCanvas=function(t,e,o,r,i,a,n,s,l){var m=Math.ceil(o+3*e/20+.5),_=Math.ceil(o+16*e/20+.5),h=Math.ceil(o+14*e/20+.5),d=Math.ceil(o+11*e/20+.5),p=Math.ceil(r+5*e/20+.5),u=Math.ceil(r+14*e/20+.5),C=Math.ceil(r+18*e/20+.5);t.lineWidth=2,t.beginPath(),t.moveTo(m,p),t.lineTo(_,p),t.lineTo(_,u),t.lineTo(h,u),t.lineTo(h,C),t.lineTo(d,u),t.lineTo(m,u),t.closePath(),t.stroke()},CDrawingButtonTabComments.prototype.private_HandleMouseDown=function(){this.m_oParent.Select(this)},CDrawingButtonTabComments.prototype.private_GetHint=function(){return"Comments"},CommonExtend(CDrawingButtonTabNavigator,CDrawingButtonBase),CDrawingButtonTabNavigator.prototype.private_DrawOnCanvas=function(t,e,o,r,i,a,n,s,l){var m=o+0,_=o+5*e/20,h=o+15*e/20,d=o+e,p=r+6*e/20,u=r+16*e/20,C=e/6+1|0;t.lineWidth=2,t.lineJoin="miter",t.strokeStyle="rgba(0,0,0, 1)",t.beginPath(),t.moveTo(m-2|0,0|p),t.lineTo(d+2|0,0|p),t.stroke(),t.beginPath(),t.moveTo(0|_,0|p),t.lineTo(0|_,0|u),t.lineTo(d+2|0,0|u),t.stroke(),t.lineWidth=1,t.strokeStyle=new CColor(0,0,0).ToString(),t.fillStyle=new CColor(255,255,255).ToString(),t.beginPath(),t.arc(h,p,C,0,2*Math.PI,!1),t.fill(),t.stroke(),t.beginPath(),t.arc(h,u,C,0,2*Math.PI,!1),t.fill(),t.stroke(),t.fillStyle=new CColor(0,0,0).ToString(),t.beginPath(),t.arc(_,p,C,0,2*Math.PI,!1),t.fill()},CDrawingButtonTabNavigator.prototype.private_HandleMouseDown=function(){this.m_oParent.Select(this)},CDrawingButtonTabNavigator.prototype.private_GetHint=function(){return"Navigator"},CommonExtend(CDrawingButtonBoardMode,CDrawingButtonBase),CDrawingButtonBoardMode.prototype.Update_Size=function(){CDrawingButtonBoardMode.superclass.Update_Size.apply(this,arguments);var t=this.m_oDrawing.Get_ElementOffset(this.HtmlElement.Control.HtmlElement),e=t.X-this.m_nWidth/2+18,o=t.Y-50,r=this.m_oDrawing.Get_Width(),i=this.m_oDrawing.Get_Height();e+this.m_nWidth>r-5&&(e=r-5-this.m_nWidth),e<5&&(e=5),o+this.m_nHeight>i-5&&(o=i-5-this.m_nHeight),o<5&&(o=5),this.m_nTop=o,this.m_oToolbarElement.style.left=e+"px",this.m_oToolbarElement.style.top=o+"px"},CDrawingButtonBoardMode.prototype.private_DrawOnCanvas=function(t,e,o,r,i,a,n,s,l){},CDrawingButtonBoardMode.prototype.private_HandleMouseDown=function(){if("none"===this.m_oToolbarElement.style.display){if(null===this.m_nShowToolbarId){var t=this;this.m_nShowToolbarId=setTimeout(function(){null!==t.m_nTransitionId&&(clearTimeout(t.m_nTransitionId),t.m_nTransitionId=null),t.m_oToolbarElement.style.display="block",t.m_oToolbarElement.style.opacity=0,t.m_oToolbarElement.style.top=t.m_nTop+50+"px",t.m_oToolbarElement.style.height="0px";var e=t;t.m_nTransitionId=setTimeout(function(){e.m_oToolbarElement.style.opacity=1,e.m_oToolbarElement.style.top=e.m_nTop+"px",e.m_oToolbarElement.style.height=e.m_nHeight+"px",e.m_nTransitionId=null,e.m_nShowToolbarId=null},20)},20)}}else this.Hide_Toolbar()},CDrawingButtonBoardMode.prototype.private_GetHint=function(){return(window.g_oLocalization?window.g_oLocalization.gameRoom.button.hint.editMode:"Select Edit mode")+" (F1-F10)"},CDrawingButtonBoardMode.prototype.private_RegisterButton=function(){this.m_oDrawing.Register_SelectBoardModeButton(this)},CDrawingButtonBoardMode.prototype.On_UpdateBoardMode=function(t){if(this.m_eMode!==t){switch(this.m_eMode=t,t){case EBoardMode.Move:this.m_oImageData=this.m_oButtonMove.m_oImageData;break;case EBoardMode.AddRemove:this.m_oImageData=this.m_oButtonAddRem.m_oImageData;break;case EBoardMode.AddMarkTr:this.m_oImageData=this.m_oButtonTr.m_oImageData;break;case EBoardMode.AddMarkSq:this.m_oImageData=this.m_oButtonSq.m_oImageData;break;case EBoardMode.AddMarkCr:this.m_oImageData=this.m_oButtonCr.m_oImageData;break;case EBoardMode.AddMarkX:this.m_oImageData=this.m_oButtonX.m_oImageData;break;case EBoardMode.AddMarkTx:this.m_oImageData=this.m_oButtonText.m_oImageData;break;case EBoardMode.AddMarkNum:this.m_oImageData=this.m_oButtonNum.m_oImageData;break;case EBoardMode.AddMarkColor:this.m_oImageData=this.m_oButtonColor.m_oImageData}this.private_UpdateState()}},CDrawingButtonBoardMode.prototype.private_OnResize=function(){this.private_UpdateState()},CDrawingButtonBoardMode.prototype.Hide_Toolbar=function(){if("none"!==this.m_oToolbarElement.style.display){null!==this.m_nTransitionId&&(clearTimeout(this.m_nTransitionId),this.m_nTransitionId=null),this.m_oToolbarElement.style.opacity=0,this.m_oToolbarElement.style.top=this.m_nTop+50+"px",this.m_oToolbarElement.style.height="0px";var t=this;this.m_nTransitionId=setTimeout(function(){t.m_oToolbarElement.style.display="none",t.m_nTransitionId=null},500)}},CommonExtend(CDrawingButtonEditModeColor,CDrawingButtonBase),CDrawingButtonEditModeColor.prototype.private_DrawOnCanvas=function(t,e,o,r,i,a,n,s,l){t.lineWidth=2,t.strokeStyle="rgb(0, 0, 200)",t.beginPath(),t.moveTo(18,12),t.lineTo(18,6),t.lineTo(6,6),t.lineTo(6,18),t.lineTo(12,18),t.stroke(),t.strokeStyle="rgb(0, 100, 0)",t.beginPath(),t.moveTo(24,18),t.lineTo(24,12),t.lineTo(12,12),t.lineTo(12,24),t.lineTo(18,24),t.stroke(),t.strokeStyle="rgb(200, 0, 0)",t.beginPath(),t.moveTo(30,30),t.lineTo(30,18),t.lineTo(18,18),t.lineTo(18,30),t.closePath(),t.stroke()},CDrawingButtonEditModeColor.prototype.private_HandleMouseDown=function(){this.m_oGameTree.Get_DrawingBoard().Set_Mode(EBoardMode.AddMarkColor)},CDrawingButtonEditModeColor.prototype.private_GetHint=function(){return(window.g_oLocalization?window.g_oLocalization.gameRoom.button.hint.editModeColors:"Color marks")+" (F10)"},CDrawingButtonEditModeColor.prototype.private_RegisterButton=function(){this.m_oDrawing.Register_EditModeColorButton(this)},CommonExtend(CDrawingButtonToolbarCustomize,CDrawingButtonBase),CDrawingButtonToolbarCustomize.prototype.Init=function(t,e){CDrawingButtonToolbarCustomize.superclass.Init.apply(this,arguments);var o=this.HtmlElement.Control.HtmlElement,r=document.createElement("canvas");r.setAttribute("id",t+"_transform"),r.setAttribute("style","position:absolute;padding:0;margin:0;top:14px;left:11px;width:14px;height:8px;"),r.width=14,r.height=8,r.setAttribute("oncontextmenu","return false;"),r.draggable="false",r.ondragstart=function(t){return t.preventDefault(),!1},o.appendChild(r),this.m_oTransformCanvas=r},CDrawingButtonToolbarCustomize.prototype.Update_Size=function(){CDrawingButtonToolbarCustomize.superclass.Update_Size.apply(this,arguments);var t=this.m_oDrawing.Get_ElementOffset(this.HtmlElement.Control.HtmlElement),e=t.X+36-this.m_nWidth,o=t.Y+36+5,r=this.m_oDrawing.Get_Width(),i=this.m_oDrawing.Get_Height();e+this.m_nWidth>r-5&&(e=r-5-this.m_nWidth),e<5&&(e=5),o+this.m_nHeight>i-5&&(o=i-5-this.m_nHeight),o<5&&(o=5),this.m_nTop=o,this.m_oContextMenuElement.style.left=e+"px",this.m_oContextMenuElement.style.top=o+"px"},CDrawingButtonToolbarCustomize.prototype.private_DrawOnCanvas=function(t,e,o,r,i,a,n,s,l){this.m_oTransformCanvas&&this.m_oTransformCanvas.getContext("2d").drawImage(this.m_oImage,0,0)},CDrawingButtonToolbarCustomize.prototype.private_HandleMouseDown=function(){if("none"===this.m_oContextMenuElement.style.display){if(null===this.m_nShowId){var t=this;this.m_nShowId=setTimeout(function(){null!==t.m_nTransitionId&&(clearTimeout(t.m_nTransitionId),t.m_nTransitionId=null),t.m_oContextMenuElement.style.display="block",t.m_oContextMenuElement.style.height="0px",t.m_nTransitionId=setTimeout(function(){t.m_oContextMenuElement.style.height=t.m_nHeight+"px",t.m_nTransitionId=null,t.m_nShowId=null,t.m_oTransformCanvas.style.transition="transform 0.2s ease",t.m_oTransformCanvas.style.transform="rotate(180deg)",t.Set_Selected(!0)},20)},20)}}else this.Hide_ContextMenu()},CDrawingButtonToolbarCustomize.prototype.private_GetHint=function(){return""},CDrawingButtonToolbarCustomize.prototype.private_RegisterButton=function(){this.m_oDrawing.Register_ToolbarCustomizeButton(this)},CDrawingButtonToolbarCustomize.prototype.Hide_ContextMenu=function(t){if("none"!==this.m_oContextMenuElement.style.display)if(!0===t)this.m_oContextMenuElement.style.height="0px",this.m_oContextMenuElement.style.display="none",this.m_oTransformCanvas.style.transition="transform 0.2s ease",this.m_oTransformCanvas.style.transform="rotate(0deg)",this.Set_Selected(!1);else{null!==this.m_nTransitionId&&(clearTimeout(this.m_nTransitionId),this.m_nTransitionId=null),this.m_oContextMenuElement.style.height="0px";var e=this;this.m_nTransitionId=setTimeout(function(){e.m_oContextMenuElement.style.display="none",e.m_nTransitionId=null,e.m_oTransformCanvas.style.transition="transform 0.2s ease",e.m_oTransformCanvas.style.transform="rotate(0deg)",e.Set_Selected(!1)},200)}},CDrawingButtonToolbarCustomize.prototype.private_CreateListItem=function(t,e,o,r){var i=document.createElement("li");i.style.fontFamily='"Times New Roman", Times, serif',i.style.width=this.m_nWidth-10+"px",i.style.height="20px",i.style.color="#444444",i.style.margin="0px 5px 0px 5px",i.style.cursor="pointer";var a=document.createElement("div");a.style.paddingLeft="3px",a.style.width="20px",a.style.height="20px",a.style.float="left",Common.Set_InnerTextToElement(a,r?"✔":""),i.appendChild(a);var n=document.createElement("div");n.style.paddingLeft="5px",n.style.height="20px",n.style.width=this.m_nWidth-10-20-10+"px",n.style.float="left",n.style.overflow="hidden",Common.Set_InnerTextToElement(n,e),i.appendChild(n),i.onmouseover=function(){i.style.background="#d8dadc",i.style.color="#373737"},i.onmouseout=function(){i.style.background="transparent",i.style.color="#444444"};var s=this;return i.onclick=function(){o&&o(),s.Hide_ContextMenu(!0)},t.appendChild(i),a},CDrawingButtonToolbarCustomize.prototype.Set_MainNavigation=function(t){this.m_oMultiLevelToolbar&&this.m_oMultiLevelToolbar.Set_MainNavigation(t),this.private_UpdateCheckElement(this.m_oMainNavigationCheckElement,t)},CDrawingButtonToolbarCustomize.prototype.Set_TreeNavigation=function(t){this.m_oMultiLevelToolbar&&this.m_oMultiLevelToolbar.Set_TreeNavigation(t),this.private_UpdateCheckElement(this.m_oTreeNavigationCheckElement,t)},CDrawingButtonToolbarCustomize.prototype.Set_General=function(t){this.m_oMultiLevelToolbar&&this.m_oMultiLevelToolbar.Set_General(t),this.private_UpdateCheckElement(this.m_oGeneralCheckElement,t)},CDrawingButtonToolbarCustomize.prototype.Set_AutoPlay=function(t){this.m_oMultiLevelToolbar&&this.m_oMultiLevelToolbar.Set_AutoPlay(t),this.private_UpdateCheckElement(this.m_oAutoPlayCheckElement,t)},CDrawingButtonToolbarCustomize.prototype.Set_Timeline=function(t){this.m_oMultiLevelToolbar&&this.m_oMultiLevelToolbar.Set_Timeline(t),this.private_UpdateCheckElement(this.m_oTimelineCheckElement,t)},CDrawingButtonToolbarCustomize.prototype.Set_KifuMode=function(t){this.m_oMultiLevelToolbar&&this.m_oMultiLevelToolbar.Set_KifuMode(t),this.private_UpdateCheckElement(this.m_oKifuModeCheckElement,t)},CDrawingButtonToolbarCustomize.prototype.private_UpdateCheckElement=function(t,e){t&&(!0===e?Common.Set_InnerTextToElement(t,"✔"):Common.Set_InnerTextToElement(t,""))},CommonExtend(CDrawingButtonFileMenu,CDrawingButtonBase),CDrawingButtonFileMenu.prototype.private_DrawOnCanvas=function(t,e,o,r,i,a,n,s,l){var m=o+3,_=o+e-3,h=r+9,d=r+6+9,p=r+12+9;t.fillStyle=!0===this.m_oActiveBColor.Compare(s)?"rgb(167, 167, 167)":"rgb(217, 217, 217)",t.fillRect(0,0,e+2*o,e+2*o),t.lineWidth=2,t.strokeStyle="rgb(100, 100, 100)",t.beginPath(),t.moveTo(m,h),t.lineTo(_,h),t.stroke(),t.beginPath(),t.moveTo(m,d),t.lineTo(_,d),t.stroke(),t.beginPath(),t.moveTo(m,p),t.lineTo(_,p),t.stroke()},CDrawingButtonFileMenu.prototype.private_CreateMenuItem=function(t,e,o){var r=document.createElement("div");r.style.padding="0px",r.style.maring="0px",t.appendChild(r);var i=document.createElement("div");i.style.display="flex",i.style.alignItems="center",i.style.padding="0px",i.style.position="relative",i.style.cursor="pointer",i.style.transition="background-color 0.25s ease",i.style.backgroundColor="#fff",i.style.color="#424242",i.style.border="1px solid transparent",i.style.outline="none",r.appendChild(i);var a=document.createElement("div");a.style.padding="10px 20px",a.style.position="relative",a.style.cursor="pointer",a.style.borderBottom="1px solid #e6e7e8",a.style.transition="background-color 0.25s ease",a.style.outline="none",a.style.width="100%",i.appendChild(a);var n=document.createElement("span");n.style.color="#4d4d4d",n.style.fontFamily='"Segoe UI Light","Segoe UI Semilight","Segoe UI",Helvetica,Tahoma,Geneva,Verdana,sans-serif',n.style.fontWeight="lighter",n.style.fontSize="15px",n.style.userSelect="none",n.style.verticalAlign="middle",n.style.cursor="pointer",Common.Set_InnerTextToElement(n,e),a.appendChild(n),i.onmouseover=function(){i.style.backgroundColor="#e6e6e6",i.style.color="#424242"},i.onmouseout=function(){i.style.background="transparent",i.style.color="#424242",i.style.border="1px solid transparent"},i.onmousedown=function(){i.style.backgroundColor="#969696",i.style.border="1px solid #737373",i.style.color="#424242"},i.onmouseup=function(){i.style.backgroundColor="#e6e6e6",i.style.color="#424242",i.style.border="1px solid transparent"};var s=this;return i.onclick=function(){o&&o(),s.Hide_Menu(!0)},r},CDrawingButtonFileMenu.prototype.private_HandleMouseDown=function(){this.Show_Menu()},CDrawingButtonFileMenu.prototype.private_GetHint=function(){return window.g_oLocalization?window.g_oLocalization.gameRoom.menu.hint:"Menu"},CDrawingButtonFileMenu.prototype.Show_Menu=function(){if("none"===this.m_oMenuElement.style.display){if(null===this.m_nShowId){var t=this;this.m_nShowId=setTimeout(function(){null!==t.m_nTransitionId&&(clearTimeout(t.m_nTransitionId),t.m_nTransitionId=null),t.m_oMenuElement.style.display="block",t.m_oMenuElement.style.height="0px",t.m_nTransitionId=setTimeout(function(){t.m_oMenuElement.style.height=t.m_nHeight+"px",t.m_nTransitionId=null,t.m_nShowId=null,t.Set_Selected(!0)},20)},20)}}else this.Hide_Menu()},CDrawingButtonFileMenu.prototype.Hide_Menu=function(t){if("none"!==this.m_oMenuElement.style.display)if(!0===t)this.m_oMenuElement.style.height="0px",this.m_oMenuElement.style.display="none",this.Set_Selected(!1);else{null!==this.m_nTransitionId&&(clearTimeout(this.m_nTransitionId),this.m_nTransitionId=null),this.m_oMenuElement.style.height="0px";var e=this;this.m_nTransitionId=setTimeout(function(){e.m_oMenuElement.style.display="none",e.m_nTransitionId=null,e.Set_Selected(!1)},200)}},CDrawingButtonFileMenu.prototype.Update_Size=function(){CDrawingButtonFileMenu.superclass.Update_Size.apply(this,arguments);var t=this.m_oDrawing.Get_ElementOffset(this.HtmlElement.Control.HtmlElement),e=t.X,o=t.Y+36+5,r=this.m_oDrawing.Get_Width(),i=this.m_oDrawing.Get_Height();e+this.m_nWidth>r-5&&(e=r-5-this.m_nWidth),e<5&&(e=5),o+this.m_nHeight>i-5&&(o=i-5-this.m_nHeight),o<5&&(o=5),this.m_nTop=o,this.m_oMenuElement.style.left=e+"px",this.m_oMenuElement.style.top=o+"px"},CDrawingButtonFileMenu.prototype.private_ClickTransformIn=function(){},CDrawingButtonFileMenu.prototype.private_ClickTransformOut=function(){},CDrawingButtonFileMenu.prototype.InitDefaultMenu=function(t){var e=window.g_oLocalization?window.g_oLocalization.gameRoom.menu.createNew:"Create New",o=window.g_oLocalization?window.g_oLocalization.gameRoom.menu.loadFile:"Load from disk",r=window.g_oLocalization?window.g_oLocalization.gameRoom.menu.loadFileFromClipboard:"Load from clipboard",i=window.g_oLocalization?window.g_oLocalization.gameRoom.menu.downloadSGF:"Download as SGF",a=window.g_oLocalization?window.g_oLocalization.gameRoom.menu.createSnapshot:"Create snapshot",n=window.g_oLocalization?window.g_oLocalization.gameRoom.menu.exportToGif:"Export to GIF",s=window.g_oLocalization?window.g_oLocalization.gameRoom.menu.convertToASCIIDiagram:"Convert to ASCII diagram",l=window.g_oLocalization?window.g_oLocalization.gameRoom.menu.toggleCoordinates:"Toggle coordinates",m=window.g_oLocalization?window.g_oLocalization.gameRoom.menu.gameInfo:"Game info",_=window.g_oLocalization?window.g_oLocalization.gameRoom.menu.cropBoard:"Crop the board",h=this.m_oMenuElement,d=this.m_oGameTree,p=this.m_oMainDiv;h.style.display="block",h.style.opacity=null,h.style.height=null,Common.ClearNode(h);var u=this;!0!==t&&(this.private_CreateMenuItem(h,e,function(){CreateWindow(p.id,EWindowType.CreateNew,{GameTree:d,Drawing:u.m_oDrawing})}),this.private_CreateMenuItem(h,o,function(){Common.OpenFileDialog(d)}),this.private_CreateMenuItem(h,r,function(){CreateWindow(p.id,EWindowType.Clipboard,{GameTree:d,Drawing:u.m_oDrawing})})),this.private_CreateMenuItem(h,m,function(){CreateWindow(p.id,EWindowType.GameInfo,{GameTree:d,Drawing:u.m_oDrawing})}),this.private_CreateMenuItem(h,i,function(){if(FileReader&&Blob){var t=d.Save_Sgf(),e=d.Get_MatchName();""===e&&(e="download"),e+=".sgf";var o=new Blob([t],{type:"text/plain;charset=utf-8"});Common.SaveAs(o,e,"application/x-go-sgf")}}),this.private_CreateMenuItem(h,a,function(){d.Download_PngBoardScreenShot()}),this.private_CreateMenuItem(h,n,function(){d.Download_GifForCurVariant()}),this.private_CreateMenuItem(h,s,function(){CreateWindow(p.id,EWindowType.DiagramSL,{GameTree:d,Drawing:u.m_oDrawing})}),this.private_CreateMenuItem(h,l,function(){d.Toggle_Rulers()}),this.private_CreateMenuItem(h,_,function(){CreateWindow(p.id,EWindowType.ViewPort,{GameTree:d,Drawing:u.m_oDrawing})}),this.m_nHeight=h.clientHeight,h.style.display="none"},CommonExtend(CDrawingButtonKifuWindow,CDrawingButtonBase),CDrawingButtonKifuWindow.prototype.private_DrawOnCanvas=function(t,e,o,r,i,a,n,s,l){var m=Math.ceil(o+.5*e-e/10+.5),_=Math.ceil(r+.5*e-e/10+.5),h=Math.ceil(.35*e+.5);t.fillStyle=new CColor(255,255,255).ToString(),t.strokeStyle=new CColor(0,0,0).ToString(),t.beginPath(),t.arc(m,_,h,0,2*Math.PI,!1),t.fill(),t.stroke();var d="白",p=.4*e*1.4,u=p+"px Times New Roman, Sans serif";t.font=u,t.fillStyle="rgb(0, 0, 0)",_+=p/3,m+=-t.measureText(d).width/2,t.fillText(d,m,_),t.fillStyle=new CColor(0,0,0).ToString(),m=Math.ceil(o+.5*e+e/10+.5),_=Math.ceil(r+.5*e+e/10+.5),t.beginPath(),t.arc(m,_,h,0,2*Math.PI,!1),t.fill();d="黒";t.fillStyle="rgb(255, 255, 255)",_+=p/3,m+=-t.measureText(d).width/2,t.fillText(d,m,_)},CDrawingButtonKifuWindow.prototype.private_HandleMouseDown=function(){CreateWindow(this.HtmlElement.Control.HtmlElement.id,EWindowType.Kifu,{GameTree:this.m_oGameTree,Drawing:this.m_oDrawing})},CDrawingButtonKifuWindow.prototype.private_GetHint=function(){return window.g_oLocalization?window.g_oLocalization.gameRoom.button.hint.showKifu:"Show kifu"},CommonExtend(CDrawingButtonKifuMode,CDrawingButtonBase),CDrawingButtonKifuMode.prototype.private_DrawOnCanvas=function(t,e,o,r,i,a,n,s,l){e=36;var m=(o=0)+10|.5,_=o+25|.5,h=(r=0)+10|.5,d=r+25|.5;t.lineWidth=2,t.strokeStyle="rgb(0, 0, 0)",t.beginPath(),t.moveTo(o+1,h),t.lineTo(e/2+1,h),t.moveTo(o+1,d),t.lineTo(e+o-1,d),t.moveTo(m,r+1),t.lineTo(m,e+r-1),t.moveTo(_,e/2),t.lineTo(_,e+r-1),t.stroke(),t.fillStyle="rgb(255, 255, 255)",t.beginPath(),t.arc(m,h,5.5,0,2*Math.PI,!1),t.stroke(),t.fill(),t.beginPath(),t.arc(_,d,5.5,0,2*Math.PI,!1),t.stroke(),t.fill(),t.fillStyle="rgb(0, 0, 0)",t.beginPath(),t.arc(m,d,5.5,0,2*Math.PI,!1),t.stroke(),t.fill();t.font="22px Times New Roman, Sans serif";var p=h+22/3,u=_-t.measureText("?").width/2;t.fillText("?",u,p)},CDrawingButtonKifuMode.prototype.private_HandleMouseDown=function(){!0===this.m_oGameTree.Is_KifuMode()?this.m_oGameTree.Stop_KifuMode():this.m_oGameTree.Start_KifuMode()},CDrawingButtonKifuMode.prototype.private_GetHint=function(){return window.g_oLocalization?window.g_oLocalization.gameRoom.button.hint.toggleKifuMode:"Toggle kifu mode"},CDrawingButtonKifuMode.prototype.private_RegisterButton=function(){this.m_oDrawing.Register_KifuModeButton(this)},CommonExtend(CDrawingButtonSimpleText,CDrawingButtonBase),CDrawingButtonSimpleText.prototype.private_DrawOnCanvas=function(t,e,o,r,i,a,n,s,l){t.lineWidth=1,t.moveTo(0,0),t.lineTo(0,n),t.lineTo(a,n),t.lineTo(a,0),t.lineTo(0,0),t.stroke();var m=this.m_sText;t.fillStyle=new CColor(0,0,0,255).ToString(),t.font="16px 'Segoe UI', Helvetica, Tahoma, Geneva, Verdana, sans-serif";var _=r+e/2+16/3,h=o+(e-t.measureText(m).width)/2;t.fillText(m,h,_)},CDrawingButtonSimpleText.prototype.private_HandleMouseDown=function(){if(this.m_fHandler)return this.m_fHandler()},CDrawingButtonSimpleText.prototype.private_GetHint=function(){return this.m_sHint},CDrawingButtonSimpleText.prototype.private_ClickTransformIn=function(){},CDrawingButtonSimpleText.prototype.private_ClickTransformOut=function(){},CDrawingButtonSimpleText.prototype.private_DrawSelectionBounds=function(t,e,o){},CDrawingComments.prototype.Init=function(t,e){this.m_oGameTree=e,this.HtmlElement.Control=CreateControlContainer(t);var o=this.HtmlElement.Control.HtmlElement;o.style.background=new CColor(217,217,217,255).ToString(),o.style.boxSizing="content-box";var r=t+"_TextArea",i=document.createElement("textarea");i.setAttribute("id",r),i.setAttribute("style","position:absolute;padding:0;margin:0;resize:none;outline: none;-moz-appearance: none;padding:2px;"),o.appendChild(i),i.onchange=this.private_OnValueChange,i.onblur=this.private_OnValueChange,i.style.outline="none",i.style.margin="0px",i.style.border="1px solid rgb(172,172,172)",i.style.overflowY="auto";var a=this.HtmlElement.Control;this.HtmlElement.TextArea.Control=CreateControlContainer(r);var n=this.HtmlElement.TextArea.Control;n.Bounds.SetParams(6,0,12,6,!0,!0,!0,!0,-1,-1),n.Anchor=g_anchor_top|g_anchor_left|g_anchor_bottom|g_anchor_right,a.AddControl(n),this.m_oDrawing&&this.m_oDrawing.Register_Comments(this),this.Update_Size()},CDrawingComments.prototype.Update_Comments=function(t){this.HtmlElement.TextArea.Control.HtmlElement.value=t},CDrawingComments.prototype.Update_Size=function(){var t=this.HtmlElement.Control.HtmlElement.clientWidth,e=this.HtmlElement.Control.HtmlElement.clientHeight;this.HtmlElement.Control.Resize(t,e)},CDrawingComments.prototype.private_OnChangeComment=function(){this.m_oGameTree.Set_Comment(this.HtmlElement.TextArea.Control.HtmlElement.value)},CDrawingPlayerInfo.prototype.Init=function(t,e,o){this.m_nPlayer=o,this.m_oGameTree=e,this.HtmlElement.Control=CreateControlContainer(t);var r=this.HtmlElement.Control.HtmlElement;r.style.backgroundColor=new CColor(217,217,217,255).ToString(),this.HtmlElement.NameDiv=document.createElement("div"),this.HtmlElement.PassCountDiv=document.createElement("div"),this.HtmlElement.Image=document.createElement("canvas");var i=this.HtmlElement.Image,a=this.HtmlElement.NameDiv,n=this.HtmlElement.PassCountDiv;r.appendChild(i),r.appendChild(a),r.appendChild(n),a.style.paddingLeft="25px",n.style.paddingLeft="25px",a.style.fontSize="14pt",n.style.fontSize="10pt",i.setAttribute("id",t+"_Image"),i.setAttribute("style","position:absolute;padding:0;margin:0;"),i.setAttribute("oncontextmenu","return false;"),i.style.left="0px",i.style.top="0px",i.style.width="25px",i.style.height="25px",i.width=25,i.height=25;var s=i.getContext("2d");s.clearRect(0,0,25,25);var l=Math.ceil(13),m=Math.ceil(13),_=Math.ceil(6.75);BOARD_WHITE===o?(s.fillStyle=new CColor(255,255,255).ToString(),s.strokeStyle=new CColor(0,0,0).ToString()):BOARD_BLACK===o&&(s.fillStyle=new CColor(0,0,0).ToString(),s.strokeStyle=new CColor(0,0,0).ToString()),s.beginPath(),s.arc(l,m,_,0,2*Math.PI,!1),s.fill(),s.stroke(),this.m_oDrawing&&(BOARD_BLACK===o?this.m_oDrawing.Register_BlackInfo(this):BOARD_WHITE===o&&this.m_oDrawing.Register_WhiteInfo(this)),this.private_Update()},CDrawingPlayerInfo.prototype.Update_Size=function(){this.private_Update();var t=this.m_dTextWidth,e=this.HtmlElement.Control.HtmlElement.clientWidth-25,o=0;o=e<t?0:(e-t)/2,this.HtmlElement.Image.style.left=o+"px",o+=25,this.HtmlElement.NameDiv.style.paddingLeft=o+"px",this.HtmlElement.PassCountDiv.style.paddingLeft=o+"px",this.HtmlElement.NameDiv.style.overflow="hidden",this.HtmlElement.NameDiv.style.textOverflow="ellipsis",this.HtmlElement.NameDiv.style["-o-text-overflow"]="ellipsis",this.HtmlElement.NameDiv.style.height="25px",this.HtmlElement.NameDiv.style.lineHeight="25px",this.HtmlElement.NameDiv.style.fontFamily='"Times New Roman", Times, serif',this.HtmlElement.PassCountDiv.style.overflow="hidden",this.HtmlElement.PassCountDiv.style.textOverflow="ellipsis",this.HtmlElement.PassCountDiv.style["-o-text-overflow"]="ellipsis",this.HtmlElement.PassCountDiv.style.height="25px",this.HtmlElement.PassCountDiv.style.lineHeight="25px",this.HtmlElement.PassCountDiv.style.fontFamily='"Times New Roman", Times, serif'},CDrawingPlayerInfo.prototype.Update_Name=function(t){this.m_sName=t,this.private_Update()},CDrawingPlayerInfo.prototype.Update_Rank=function(t){this.m_sRank=t,this.private_Update()},CDrawingPlayerInfo.prototype.Update_PassCount=function(t){this.m_dPassCount=t,this.private_Update()},CDrawingPlayerInfo.prototype.private_Update=function(){var t=this.HtmlElement.NameDiv,e=this.HtmlElement.PassCountDiv,o=(""===this.m_sName?BOARD_BLACK===this.m_nPlayer?"Black ":"White ":this.m_sName)+(""===this.m_sRank?"":"["+this.m_sRank+"]"),r="Pass "+this.m_dPassCount;Common.Set_InnerTextToElement(t,o),Common.Set_InnerTextToElement(e,r);var i=document.createElement("canvas").getContext("2d");i.font="14pt Times New Roman",this.m_dTextWidth=i.measureText(o).width},CDrawingViewerTitle.prototype.Init=function(t,e){this.m_oGameTree=e,this.HtmlElement.Control=CreateControlContainer(t);var o=this.HtmlElement.Control.HtmlElement;o.style.backgroundColor=new CColor(217,217,217,255).ToString(),this.HtmlElement.TitleDiv=document.createElement("div"),o.appendChild(this.HtmlElement.TitleDiv),this.HtmlElement.TitleDiv.style.position="absolute",this.HtmlElement.TitleDiv.style.left="0px",this.HtmlElement.TitleDiv.style.top="0px",this.HtmlElement.TitleDiv.style.overflow="hidden",this.HtmlElement.TitleDiv.style.textOverflow="ellipsis",this.HtmlElement.TitleDiv.style.fontFamily='"Times New Roman", Times, serif',this.HtmlElement.TitleDiv.style.fontSize="16px",this.HtmlElement.TitleDiv.style.height="25px",this.HtmlElement.TitleDiv.style.lineHeight="25px",this.HtmlElement.TitleDiv.style.width="100%",this.HtmlElement.TitleDiv.style.textAlign="center",this.private_Update()},CDrawingViewerTitle.prototype.Set_Title=function(t){this.m_sTitle=t,this.private_Update()},CDrawingViewerTitle.prototype.Update_Size=function(){this.private_Update()},CDrawingViewerTitle.prototype.private_Update=function(){Common.Set_InnerTextToElement(this.HtmlElement.TitleDiv,""+this.m_sTitle)},CControlBounds.prototype.SetParams=function(t,e,o,r,i,a,n,s,l,m){this.L=t,this.T=e,this.R=o,this.B=r,this.isAbsL=i,this.isAbsT=a,this.isAbsR=n,this.isAbsB=s,this.AbsW=l,this.AbsH=m};var g_anchor_left=1,g_anchor_top=2,g_anchor_right=4,g_anchor_bottom=8;CControlContainer.prototype.Set_Type=function(t,e,o){this.Type=t,this.DrawingElement=e,e&&e.Add_LinkedControl&&e.Add_LinkedControl(this),o&&void 0!==o.RMin&&(this.RMin=o.RMin)},CControlContainer.prototype.AddControl=function(t){t.Parent=this,this.Controls[this.Controls.length]=t},CControlContainer.prototype.Resize=function(t,e){if(this.width=t,this.height=e,null==this.Parent)return this.AbsolutePosition.L=0,this.AbsolutePosition.T=0,this.AbsolutePosition.R=t,this.AbsolutePosition.B=e,void(null!==this.HtmlElement&&this.private_ResizeControls(t,e));var o=0,r=0,i=0,a=0,n=5&this.Anchor,s=10&this.Anchor;g_anchor_left==n?(o=this.Bounds.isAbsL?this.Bounds.L:this.Bounds.L*t/1e3,i=-1!=this.Bounds.AbsW?o+this.Bounds.AbsW:this.Bounds.isAbsR?t-this.Bounds.R:this.Bounds.R*t/1e3):g_anchor_right==n?(i=this.Bounds.isAbsR?t-this.Bounds.R:this.Bounds.R*t/1e3,o=-1!=this.Bounds.AbsW?i-this.Bounds.AbsW:this.Bounds.isAbsL?this.Bounds.L:this.Bounds.L*t/1e3):(g_anchor_left|g_anchor_right)==n?(o=this.Bounds.isAbsL?this.Bounds.L:this.Bounds.L*t/1e3,i=this.Bounds.isAbsR?t-this.Bounds.R:this.Bounds.R*t/1e3):(o=this.Bounds.L,i=this.Bounds.R),g_anchor_top==s?(r=this.Bounds.isAbsT?this.Bounds.T:this.Bounds.T*e/1e3,a=-1!=this.Bounds.AbsH?r+this.Bounds.AbsH:this.Bounds.isAbsB?e-this.Bounds.B:this.Bounds.B*e/1e3):g_anchor_bottom==s?(a=this.Bounds.isAbsB?e-this.Bounds.B:this.Bounds.B*e/1e3,r=-1!=this.Bounds.AbsH?a-this.Bounds.AbsH:this.Bounds.isAbsT?this.Bounds.T:this.Bounds.T*e/1e3):(g_anchor_top|g_anchor_bottom)==s?(r=this.Bounds.isAbsT?this.Bounds.T:this.Bounds.T*e/1e3,a=this.Bounds.isAbsB?e-this.Bounds.B:this.Bounds.B*e/1e3):(r=this.Bounds.T,a=this.Bounds.B),i<o&&(i=o),a<r&&(a=r),-2===this.Bounds.AbsW?i=o+1*(a-r):-3===this.Bounds.AbsW&&(o=1*(a-r)),this.AbsolutePosition.L=o,this.AbsolutePosition.T=r,this.AbsolutePosition.R=i,this.AbsolutePosition.B=a,this.HtmlElement.style.left=(o+.5|0)+"px",this.HtmlElement.style.top=(r+.5|0)+"px",this.HtmlElement.style.width=(i-o+.5|0)+"px",this.HtmlElement.style.height=(a-r+.5|0)+"px",this.HtmlElement.width=i-o+.5|0,this.HtmlElement.height=a-r+.5|0,this.private_ResizeControls(i-o,a-r)},CControlContainer.prototype.private_ResizeControls=function(t,e){var o=this.Controls.length;if(1===this.Type&&2===o){var r=this.DrawingElement?this.DrawingElement.Get_AspectRatio():1,i=this.Controls[0],a=this.Controls[1],n=t,s=(n-=this.RMin)/r;(f=(v=e)*r)<=n?(p=v,d=f,C=0,u=0):(d=n,u=0,C=(v-(p=s))/2),i.Bounds.SetParams(u,C,1e3,1e3,!0,!0,!1,!1,d,p),i.Anchor=g_anchor_left|g_anchor_top,a.Bounds.SetParams(d,0,1e3,1e3,!0,!1,!1,!1,-1,-1),a.Anchor=g_anchor_right|g_anchor_bottom|g_anchor_top}else if(2===this.Type&&1===o)if(this.DrawingElement){var r=this.DrawingElement.Get_AspectRatio(),l=this.Controls[0],s=t/r;(f=e*r)<=t?(p=e,C=0,u=(t-(d=f))/2):(d=t,u=0,C=(e-(p=s))/2),l.Bounds.SetParams(u,C,1e3,1e3,!0,!0,!1,!1,d,p),l.Anchor=g_anchor_left|g_anchor_top}else{var l=this.Controls[0],m=Math.min(t,e),_=(t-m)/2,h=(e-m)/2;l.Bounds.SetParams(_,h,1e3,1e3,!0,!0,!0,!1,m,m),l.Anchor=g_anchor_left|g_anchor_bottom|g_anchor_top}else if(3===this.Type&&2===o){var d,p,u,C,r=this.DrawingElement?this.DrawingElement.Get_AspectRatio():1,g=this.Controls[0],c=this.Controls[1],v=e,f=(v-=this.RMin)*r,s=(n=t)/r;f<=n?(p=v,C=0,u=(n-(d=f))/2):(d=n,p=s,u=0,C=0),g.Bounds.SetParams(u,C,1e3,1e3,!0,!0,!1,!1,d,p),g.Anchor=g_anchor_left|g_anchor_top,c.Bounds.SetParams(0,p,1e3,1e3,!1,!0,!1,!1,-1,-1),c.Anchor=g_anchor_left|g_anchor_right|g_anchor_bottom}for(var w=0;w<o;w++)this.Controls[w].Resize(t,e)},CControlContainer.prototype.Clear=function(){this.Controls=[],this.Type=0,this.DrawingElement=null,this.RMin=400},CControlContainer.prototype.SetParams=function(t,e,o,r,i,a,n,s,l,m){this.Bounds.SetParams(t,e,o,r,i,a,n,s,l,m)},CControlContainer.prototype.SetAnchor=function(t,e,o,r){this.Anchor=0,t&&(this.Anchor|=g_anchor_left),e&&(this.Anchor|=g_anchor_top),o&&(this.Anchor|=g_anchor_right),r&&(this.Anchor|=g_anchor_bottom)},CControlContainerBoardAndBottomButtons.prototype.Set=function(t){this.H=t},CControlContainerBoardAndBottomButtons.prototype.AddControl=function(t){t.Parent=this,this.Controls[this.Controls.length]=t},CControlContainerBoardAndBottomButtons.prototype.Resize=function(t,e){var o=e-this.H,r=t;r!==o&&(o=r=Math.min(r,o));var i=(t-r)/2,a=(e-this.H-o)/2;this.HtmlElement.style.left=parseInt(i+.5)+"px",this.HtmlElement.style.top=parseInt(a+.5)+"px",this.HtmlElement.style.width=parseInt(r+.5)+"px",this.HtmlElement.style.height=parseInt(o+this.H+.5)+"px",this.HtmlElement.width=parseInt(r+.5),this.HtmlElement.height=parseInt(o+this.H+.5);for(var n=this.Controls.length,s=0;s<n;s++)this.Controls[s].Resize(r,o+this.H)},CControlContainerBoardAndBottomButtons.Create=function(t){var e=new CControlContainerBoardAndBottomButtons;return e.Name=t,e.HtmlElement=document.getElementById(t),e};var EColorScheme={Custom:0,TrueColor:1,BookStyle:2,SimpleColor:3,Dark:4},ESettingsNavigatorLabels={Empty:0,MoveNumbers:1,MoveNumbersCurrentVariant:2,MoveCoordinates:3},ESettingsLoadShowVariants={None:0,Curr:1,Next:2,FromFile:3},EDrawingTemplate={None:0,SimpleBoard:1,Viewer:2,VerEditor:3,HorEditor:4,Problems:5,GoUniverseViewerHor:21,GoUniverseViewerVer:22,GoUniverseMatch:23};CSettingsBase.prototype.private_SetColorScheme=function(t){var e=!0,o=!0,r=null,i=!0,a=!0,n=new CColor(255,255,255,255),s=new CColor(0,0,0,255),l=new CColor(0,0,0,255),m=!1;switch(t){default:case EColorScheme.TrueColor:e=!0,o=!0,i=!0,a=!0,r=new CColor(231,188,95,255),l=new CColor(0,0,0,255);break;case EColorScheme.BookStyle:e=!1,o=!1,i=!1,a=!1,r=new CColor(255,255,255,255),l=new CColor(0,0,0,255);break;case EColorScheme.SimpleColor:e=!1,o=!1,i=!1,a=!1,r=new CColor(231,188,95,255),l=new CColor(0,0,0,255);break;case EColorScheme.Dark:e=!1,o=!1,i=!1,a=!1,m=!0,r=new CColor(30,30,30,255),n=new CColor(220,220,220,220),l=new CColor(255,255,255,255)}var _=!1,h=!1;return this.m_oBoardPr.bTrueColorBoard===e&&this.m_oBoardPr.bTrueColorStones===o&&!0===this.m_oBoardPr.oBoardColor.Compare(r)&&this.m_oBoardPr.bShellWhiteStones===i&&this.m_oBoardPr.bShadows===a&&!0===this.m_oBoardPr.oWhiteColor.Compare(n)&&!0===this.m_oBoardPr.oBlackColor.Compare(s)&&!0===this.m_oBoardPr.oLinesColor.Compare(l)&&this.m_oBoardPr.bDarkBoard===m||(this.m_oBoardPr.bTrueColorBoard=e,this.m_oBoardPr.bTrueColorStones=o,this.m_oBoardPr.oBoardColor=r,this.m_oBoardPr.bShellWhiteStones=i,this.m_oBoardPr.bShadows=a,this.m_oBoardPr.oWhiteColor=n,this.m_oBoardPr.oBlackColor=s,this.m_oBoardPr.oLinesColor=l,this.m_oBoardPr.bDarkBoard=m,_=!0),this.m_oNavigatorPr.bTrueColorBoard===e&&this.m_oNavigatorPr.bTrueColorStones===o&&!0===this.m_oNavigatorPr.oBoardColor.Compare(r)&&this.m_oNavigatorPr.bShadows===a&&!0===this.m_oNavigatorPr.oWhiteColor.Compare(n)&&!0===this.m_oNavigatorPr.oBlackColor.Compare(s)&&!0===this.m_oNavigatorPr.oLinesColor.Compare(l)&&this.m_oNavigatorPr.bDarkBoard===m||(this.m_oNavigatorPr.bTrueColorBoard=e,this.m_oNavigatorPr.bTrueColorStones=o,this.m_oNavigatorPr.oBoardColor=r,this.m_oNavigatorPr.bShadows=a,this.m_oNavigatorPr.oWhiteColor=n,this.m_oNavigatorPr.oBlackColor=s,this.m_oNavigatorPr.oLinesColor=l,this.m_oNavigatorPr.bDarkBoard=m,h=!0),{Board:_,Navigator:h}},CommonExtend(CSettings,CSettingsBase),CSettings.prototype.Load_FromLocalStorage=function(){this.m_bShowTarget="0"!==Common.Get_LocalStorageItem("ShowTarget"),this.m_bCycleThroughVariants="1"===Common.Get_LocalStorageItem("CycleThroughVariants"),this.m_bSound="0"!==Common.Get_LocalStorageItem("Sound");var t=Common.Get_LocalStorageItem("NavigatorLabels");this.m_eNavigatorLabels=t&&""!==t?parseInt(t):ESettingsNavigatorLabels.MoveNumbers;var e=EColorScheme.TrueColor,o=Common.Get_LocalStorageItem("ColorScheme");"BookStyle"===o?e=EColorScheme.BookStyle:"SimpleColor"===o?e=EColorScheme.SimpleColor:"Dark"===o&&(e=EColorScheme.Dark),this.Set_ColorScheme(e),this.m_bLoadUnfinishedFilesOnLastNode="1"===Common.Get_LocalStorageItem("LoadUnfinishedFilesOnLastNode");var r=Common.Get_LocalStorageItem("ShowVariants");this.m_eLoadShowVariants=r&&""!==r?parseInt(r):ESettingsLoadShowVariants.FromFile;var i=Common.Get_LocalStorageItem("Rulers");this.m_bRulers="1"===i,this.m_bMultiLevelToolbarMainNavigation="0"!=Common.Get_LocalStorageItem("MultiLevelToolbarMainNavigation"),this.m_bMultiLevelToolbarTreeNavigation="0"!=Common.Get_LocalStorageItem("MultiLevelToolbarTreeNavigation"),this.m_bMultiLevelToolbarGeneral="0"!=Common.Get_LocalStorageItem("MultiLevelToolbarGeneral"),this.m_bMultiLevelToolbarAutoPlay="1"==Common.Get_LocalStorageItem("MultiLevelToolbarAutoPlay"),this.m_bMultiLevelToolbarTimeline="1"==Common.Get_LocalStorageItem("MultiLevelToolbarTimeline"),this.m_bMultiLevelToolbarKifuMode="1"==Common.Get_LocalStorageItem("MultiLevelToolbarKifuMode")},CSettings.prototype.Set_Sound=function(t){this.m_bSound=t,Common.Set_LocalStorageItem("Sound",!0===t?"1":"0")},CSettings.prototype.Is_SoundOn=function(){return this.m_bSound},CSettings.prototype.Set_Rulers=function(t){this.m_bRulers=t,Common.Set_LocalStorageItem("Rulers",!0===t?"1":"0")},CSettings.prototype.Is_Rulers=function(){return this.m_bRulers},CSettings.prototype.Set_LoadUnfinishedFilesOnLastNode=function(t){this.m_bLoadUnfinishedFilesOnLastNode=t,Common.Set_LocalStorageItem("LoadUnfinishedFilesOnLastNode",!0===t?"1":"0")},CSettings.prototype.Is_LoadUnfinishedFilesOnLastNode=function(){return this.m_bLoadUnfinishedFilesOnLastNode},CSettings.prototype.Set_CycleThroughVariants=function(t){this.m_bCycleThroughVariants=t,Common.Set_LocalStorageItem("CycleThroughVariants",!0===t?"1":"0")},CSettings.prototype.Is_CycleThroughVariants=function(){return this.m_bCycleThroughVariants},CSettings.prototype.Set_ShowTarget=function(t){this.m_bShowTarget=t,Common.Set_LocalStorageItem("ShowTarget",!0===t?"1":"0")},CSettings.prototype.Is_ShowTarget=function(){return this.m_bShowTarget},CSettings.prototype.Set_ColorScheme=function(t){switch(t){case EColorScheme.TrueColor:Common.Set_LocalStorageItem("ColorScheme","TrueColor");break;case EColorScheme.BookStyle:Common.Set_LocalStorageItem("ColorScheme","BookStyle");break;case EColorScheme.SimpleColor:Common.Set_LocalStorageItem("ColorScheme","SimpleColor");break;case EColorScheme.Dark:Common.Set_LocalStorageItem("ColorScheme","Dark")}return this.private_SetColorScheme(t)},CSettings.prototype.Get_NavigatorLabel=function(){return this.m_eNavigatorLabels},CSettings.prototype.Set_NavigatorLabel=function(t){this.m_eNavigatorLabels=t,Common.Set_LocalStorageItem("NavigatorLabels",t)},CSettings.prototype.Get_LoadShowVariants=function(){return this.m_eLoadShowVariants},CSettings.prototype.Set_LoadShowVariants=function(t){this.m_eLoadShowVariants=t,Common.Set_LocalStorageItem("ShowVariants",t)},CSettings.prototype.Toggle_MultiLevelToolbarMainNavigation=function(){return this.m_bMultiLevelToolbarMainNavigation=!this.m_bMultiLevelToolbarMainNavigation,Common.Set_LocalStorageItem("MultiLevelToolbarMainNavigation",!0===this.m_bMultiLevelToolbarMainNavigation?"1":"0"),this.m_bMultiLevelToolbarMainNavigation},CSettings.prototype.Toggle_MultiLevelToolbarTreeNavigation=function(){return this.m_bMultiLevelToolbarTreeNavigation=!this.m_bMultiLevelToolbarTreeNavigation,Common.Set_LocalStorageItem("MultiLevelToolbarTreeNavigation",!0===this.m_bMultiLevelToolbarTreeNavigation?"1":"0"),this.m_bMultiLevelToolbarTreeNavigation},CSettings.prototype.Toggle_MultiLevelToolbarGeneral=function(){return this.m_bMultiLevelToolbarGeneral=!this.m_bMultiLevelToolbarGeneral,Common.Set_LocalStorageItem("MultiLevelToolbarGeneral",!0===this.m_bMultiLevelToolbarGeneral?"1":"0"),this.m_bMultiLevelToolbarGeneral},CSettings.prototype.Toggle_MultiLevelToolbarAutoPlay=function(){return this.m_bMultiLevelToolbarAutoPlay=!this.m_bMultiLevelToolbarAutoPlay,Common.Set_LocalStorageItem("MultiLevelToolbarAutoPlay",!0===this.m_bMultiLevelToolbarAutoPlay?"1":"0"),this.m_bMultiLevelToolbarAutoPlay},CSettings.prototype.Toggle_MultiLevelToolbarTimeline=function(){return this.m_bMultiLevelToolbarTimeline=!this.m_bMultiLevelToolbarTimeline,Common.Set_LocalStorageItem("MultiLevelToolbarTimeline",!0===this.m_bMultiLevelToolbarTimeline?"1":"0"),this.m_bMultiLevelToolbarTimeline},CSettings.prototype.Toggle_MultiLevelToolbarKifuMode=function(){return this.m_bMultiLevelToolbarKifuMode=!this.m_bMultiLevelToolbarKifuMode,Common.Set_LocalStorageItem("MultiLevelToolbarKifuMode",!0===this.m_bMultiLevelToolbarKifuMode?"1":"0"),this.m_bMultiLevelToolbarKifuMode},CSettings.prototype.Is_MultiLevelToolbarMainNavigation=function(){return this.m_bMultiLevelToolbarMainNavigation},CSettings.prototype.Is_MultiLevelToolbarTreeNavigation=function(){return this.m_bMultiLevelToolbarTreeNavigation},CSettings.prototype.Is_MultiLevelToolbarGeneral=function(){return this.m_bMultiLevelToolbarGeneral},CSettings.prototype.Is_MultiLevelToolbarAutoPlay=function(){return this.m_bMultiLevelToolbarAutoPlay},CSettings.prototype.Is_MultiLevelToolbarTimeline=function(){return this.m_bMultiLevelToolbarTimeline},CSettings.prototype.Is_MultiLevelToolbarKifuMode=function(){return this.m_bMultiLevelToolbarKifuMode};var g_oGlobalSettings=new CSettings;CommonExtend(CLocalSetting,CSettingsBase),CLocalSetting.prototype.Is_Embedding=function(){return this.m_bEmbedding},CLocalSetting.prototype.Set_Embedding=function(t){this.m_bEmbedding=t},CLocalSetting.prototype.Set_ColorScheme=function(t){return null!==t?this.private_SetColorScheme(t):{Board:!0,Navigator:!0}},CLocalSetting.prototype.Is_BoardTrueColorBoard=function(){return null===this.m_oBoardPr.bTrueColorBoard?g_oGlobalSettings.m_oBoardPr.bTrueColorBoard:this.m_oBoardPr.bTrueColorBoard},CLocalSetting.prototype.Is_BoardTrueColorStones=function(){return null===this.m_oBoardPr.bTrueColorStones?g_oGlobalSettings.m_oBoardPr.bTrueColorStones:this.m_oBoardPr.bTrueColorStones},CLocalSetting.prototype.Is_BoardShellWhiteStones=function(){return null===this.m_oBoardPr.bShellWhiteStones?g_oGlobalSettings.m_oBoardPr.bShellWhiteStones:this.m_oBoardPr.bShellWhiteStones},CLocalSetting.prototype.Set_BoardShellWhiteStones=function(t){this.m_oBoardPr.bShellWhiteStones=t},CLocalSetting.prototype.Is_BoardShadows=function(){return null===this.m_oBoardPr.bShadows?g_oGlobalSettings.m_oBoardPr.bShadows:this.m_oBoardPr.bShadows},CLocalSetting.prototype.Get_BoardWhiteColor=function(){return null===this.m_oBoardPr.oWhiteColor?g_oGlobalSettings.m_oBoardPr.oWhiteColor:this.m_oBoardPr.oWhiteColor},CLocalSetting.prototype.Get_BoardBlackColor=function(){return null===this.m_oBoardPr.oBlackColor?g_oGlobalSettings.m_oBoardPr.oBlackColor:this.m_oBoardPr.oBlackColor},CLocalSetting.prototype.Get_BoardBoardColor=function(){return null===this.m_oBoardPr.oBoardColor?g_oGlobalSettings.m_oBoardPr.oBoardColor:this.m_oBoardPr.oBoardColor},CLocalSetting.prototype.Get_BoardLinesColor=function(){return null===this.m_oBoardPr.oLinesColor?g_oGlobalSettings.m_oBoardPr.oLinesColor:this.m_oBoardPr.oLinesColor},CLocalSetting.prototype.Is_BoardDarkBoard=function(){return null===this.m_oBoardPr.bDarkBoard?g_oGlobalSettings.m_oBoardPr.bDarkBoard:this.m_oBoardPr.bDarkBoard},CLocalSetting.prototype.Is_NavigatorTrueColorBoard=function(){return null===this.m_oNavigatorPr.bTrueColorBoard?g_oGlobalSettings.m_oNavigatorPr.bTrueColorBoard:this.m_oNavigatorPr.bTrueColorBoard},CLocalSetting.prototype.Is_NavigatorTrueColorStones=function(){return null===this.m_oNavigatorPr.bTrueColorStones?g_oGlobalSettings.m_oNavigatorPr.bTrueColorStones:this.m_oNavigatorPr.bTrueColorStones},CLocalSetting.prototype.Is_NavigatorShadows=function(){return null===this.m_oNavigatorPr.bShadows?g_oGlobalSettings.m_oNavigatorPr.bShadows:this.m_oNavigatorPr.bShadows},CLocalSetting.prototype.Get_NavigatorWhiteColor=function(){return null===this.m_oNavigatorPr.oWhiteColor?g_oGlobalSettings.m_oNavigatorPr.oWhiteColor:this.m_oNavigatorPr.oWhiteColor},CLocalSetting.prototype.Get_NavigatorBlackColor=function(){return null===this.m_oNavigatorPr.oBlackColor?g_oGlobalSettings.m_oNavigatorPr.oBlackColor:this.m_oNavigatorPr.oBlackColor},CLocalSetting.prototype.Get_NavigatorBoardColor=function(){return null===this.m_oNavigatorPr.oBoardColor?g_oGlobalSettings.m_oNavigatorPr.oBoardColor:this.m_oNavigatorPr.oBoardColor},CLocalSetting.prototype.Get_NavigatorLinesColor=function(){return null===this.m_oNavigatorPr.oLinesColor?g_oGlobalSettings.m_oNavigatorPr.oLinesColor:this.m_oNavigatorPr.oLinesColor},CLocalSetting.prototype.Is_NavigatorDarkBoard=function(){return null===this.m_oNavigatorPr.bDarkBoard?g_oGlobalSettings.m_oNavigatorPr.bDarkBoard:this.m_oNavigatorPr.bDarkBoard},CLocalSetting.prototype.Is_ShowTarget=function(){return null===this.m_bShowTarget?g_oGlobalSettings.Is_ShowTarget():this.m_bShowTarget},CLocalSetting.prototype.Set_ShowTarget=function(t){this.m_bShowTarget=t},CDrawing.prototype.OnDestroy=function(){null!==this.m_nAnimationFrameTimer&&(Common_CancelAnimationFrame(this.m_nAnimationFrameTimer),this.m_nAnimationFrameTimer=null),this.m_oMainDiv&&delete g_aWindows[this.m_oMainDiv.id]},CDrawing.prototype.Disable=function(){if(this.m_oMainDiv){var t=document.createElement("div");t.style.width="100%",t.style.height="100%",t.style.position="absolute",t.style.left="0px",t.style.top="0px",t.style.backgroundColor="rgb(0, 0, 0)",t.style.opacity=.4,this.m_oMainDiv.appendChild(t),this.m_oDisableElement=t;var e=g_aWindows[this.m_oMainDiv.id][EWindowType.Error];e&&(e=e.HtmlElement.Control.HtmlElement),Common.Is_NodeDescendant(this.m_oMainDiv,e,0)&&(this.m_oMainDiv.removeChild(e),this.m_oMainDiv.appendChild(e))}},CDrawing.prototype.Enable=function(){this.m_oDisableElement&&(this.m_oMainDiv.removeChild(this.m_oDisableElement),this.m_oDisableElement=null)},CDrawing.prototype.Get_Width=function(){return this.m_oMainDiv?parseInt(this.m_oMainDiv.clientWidth):0},CDrawing.prototype.Get_Height=function(){return this.m_oMainDiv?parseInt(this.m_oMainDiv.clientHeight):0},CDrawing.prototype.Get_MainDiv=function(){return this.m_oMainDiv},CDrawing.prototype.Get_GameTree=function(){return this.m_oGameTree},CDrawing.prototype.Get_ElementOffset=function(t){for(var e=0,o=0,r=t;r!=this.m_oMainDiv&&r;)e+=r.offsetLeft-r.scrollLeft+r.clientLeft,o+=r.offsetTop-r.scrollTop+r.clientTop,r=r.offsetParent;return{X:e,Y:o}},CDrawing.prototype.Set_TemplateType=function(t){this.m_eTemplateType=t},CDrawing.prototype.Create_SimpleBoard=function(t){this.Set_TemplateType(EDrawingTemplate.SimpleBoard),this.private_SetMainDiv(t);var e=new CDrawingBoard(this);e.Init(t,this.m_oGameTree),e.Focus(),this.m_aElements.push(e),this.Update_Size()},CDrawing.prototype.Create_Viewer=function(t){this.Set_TemplateType(EDrawingTemplate.Viewer),this.private_CreateWrappingMainDiv(t),this.m_nMinWidth=295;var e=this.m_oGameTree,o=this.m_oMainControl,r=this.m_oMainDiv.id;this.m_nViewerTitleH=25,this.m_nViewerToolbarH=36;var i=r+"I";this.private_CreateDiv(o.HtmlElement,i);var a=CreateControlContainer(i);a.Bounds.SetParams(0,0,1e3,0,!1,!1,!1,!1,-1,25),a.Anchor=g_anchor_top|g_anchor_left|g_anchor_right,o.AddControl(a);var n=i+"S";this.private_CreateDiv(a.HtmlElement,n);var s=CreateControlContainer(n);s.Bounds.SetParams(0,0,1e3,1e3,!1,!1,!1,!1,122,-1),s.Anchor=g_anchor_top|g_anchor_left|g_anchor_bottom,a.AddControl(s);var l=i+"T";this.private_CreateDiv(a.HtmlElement,l);var m=CreateControlContainer(l);m.Bounds.SetParams(122,0,1e3,1e3,!0,!1,!1,!1,-1,-1),m.Anchor=g_anchor_top|g_anchor_right|g_anchor_bottom,a.AddControl(m),this.m_oViewerTitle=new CDrawingViewerTitle(this),this.m_oViewerTitle.Init(l,e),this.m_aElements.push(this.m_oViewerTitle);var _=r+"T";this.private_CreateDiv(o.HtmlElement,_);var h=CreateControlContainer(_);h.Bounds.SetParams(0,0,1e3,0,!1,!1,!1,!0,-1,36),h.Anchor=g_anchor_bottom|g_anchor_left|g_anchor_right,o.AddControl(h);var d=new CDrawingToolbar(this);d.Add_Control(new CDrawingButtonBackwardToStart(this),36,1,EToolbarFloat.Left),d.Add_Control(new CDrawingButtonBackward5(this),36,1,EToolbarFloat.Left),d.Add_Control(new CDrawingButtonBackward(this),36,1,EToolbarFloat.Left),d.Add_Control(new CDrawingButtonForward(this),36,1,EToolbarFloat.Left),d.Add_Control(new CDrawingButtonForward5(this),36,1,EToolbarFloat.Left),d.Add_Control(new CDrawingButtonForwardToEnd(this),36,1,EToolbarFloat.Left),d.Add_Control(new CDrawingButtonAbout(this),36,1,EToolbarFloat.Right),d.Add_Control(new CDrawingButtonGameInfo(this),36,1,EToolbarFloat.Right),d.Init(_,e),this.m_aElements.push(d);var p=r+"B",u=this.private_CreateDiv(o.HtmlElement,p),C=CreateControlContainer(p);C.Bounds.SetParams(0,25,1e3,36,!1,!0,!1,!0,-1,-1),C.Anchor=g_anchor_left|g_anchor_right|g_anchor_top|g_anchor_bottom,o.AddControl(C);var g=p+"B";this.private_CreateDiv(u,g);var c=CreateControlContainer(g);C.AddControl(c);var v=p+"N";this.private_CreateDiv(u,v);var f=CreateControlContainer(v);C.AddControl(f);var w=new CDrawingBoard(this);w.Init(g,this.m_oGameTree),w.Focus(),this.m_aElements.push(w),C.Set_Type(3,w,{RMin:0}),this.Update_Size(),e.On_EndLoadDrawing()},CDrawing.prototype.Create_BoardWithNavigateButtons=function(t){g_oGlobalSettings.Load_FromLocalStorage(),this.m_nMinWidth=739,this.private_SetMainDiv(t);var e=this.m_oGameTree,o=CreateControlContainer(t);this.private_CreateDiv(o.HtmlElement,t+"div");var r=CControlContainerBoardAndBottomButtons.Create(t+"div");r.Set(38);var i=r.HtmlElement;o.AddControl(r);var a=t+"_Board",n=t+"_ToolbarPanel",s=t+"_Toolbar";this.private_CreateDiv(i,a);var l=this.private_CreateDiv(i,n);l.style.background="rgb(217, 217, 217)",this.private_CreateDiv(l,s);var m=CreateControlContainer(a);m.Bounds.SetParams(0,0,1e3,38,!1,!1,!1,!0,-1,-1),m.Anchor=g_anchor_top|g_anchor_left|g_anchor_right,r.AddControl(m);var _=new CDrawingBoard(this);_.Init(a,e),_.Focus();var h=CreateControlContainer(n);h.Bounds.SetParams(0,0,1e3,0,!1,!1,!1,!0,-1,38),h.Anchor=g_anchor_left|g_anchor_bottom|g_anchor_right,r.AddControl(h);var d=CreateControlContainer(s);d.Bounds.SetParams(0,1,1e3,1,!1,!0,!1,!0,-1,-1),d.Anchor=g_anchor_left|g_anchor_bottom|g_anchor_right,h.AddControl(d);var p=new CDrawingToolbar(this);p.Add_Control(new CDrawingButtonBackwardToStart(this),36,1,EToolbarFloat.Left),p.Add_Control(new CDrawingButtonBackward5(this),36,1,EToolbarFloat.Left),p.Add_Control(new CDrawingButtonBackward(this),36,1,EToolbarFloat.Left),p.Add_Control(new CDrawingButtonForward(this),36,1,EToolbarFloat.Left),p.Add_Control(new CDrawingButtonForward5(this),36,1,EToolbarFloat.Left),p.Add_Control(new CDrawingButtonForwardToEnd(this),36,1,EToolbarFloat.Left),p.Add_Control(new CDrawingButtonNextVariant(this),36,1,EToolbarFloat.Left),p.Add_Control(new CDrawingButtonPrevVariant(this),36,1,EToolbarFloat.Left),p.Add_Control(new CDrawingButtonEditModeMove(this),36,1,EToolbarFloat.Left),p.Add_Control(new CDrawingButtonEditModeAddRem(this),36,1,EToolbarFloat.Left),p.Add_Control(new CDrawingButtonEditModeTr(this),36,1,EToolbarFloat.Left),p.Add_Control(new CDrawingButtonEditModeSq(this),36,1,EToolbarFloat.Left),p.Add_Control(new CDrawingButtonEditModeCr(this),36,1,EToolbarFloat.Left),p.Add_Control(new CDrawingButtonEditModeX(this),36,1,EToolbarFloat.Left),p.Add_Control(new CDrawingButtonEditModeText(this),36,1,EToolbarFloat.Left),p.Add_Control(new CDrawingButtonEditModeNum(this),36,1,EToolbarFloat.Left),p.Add_Control(new CDrawingButtonGameInfo(this),36,1,EToolbarFloat.Left),p.Add_Control(new CDrawingButtonAbout(this),36,1,EToolbarFloat.Right),p.Add_Control(new CDrawingButtonSettings(this),36,1,EToolbarFloat.Right),p.Init(s,e),this.m_oControl=o,this.m_aElements.push(_),this.m_aElements.push(p),this.Update_Size()},CDrawing.prototype.Create_MixedFullTemplate=function(t){this.m_bMixedTemplate=!0,this.m_nMixedRightSide=400,this.m_nMixedBotSize=200,this.private_CreateWrappingMainDiv(t),this.private_UpdateSize(!0)},CDrawing.prototype.Create_HorizontalFullTemplate=function(t){this.m_bMixedTemplate=!1,this.private_CreateWrappingMainDiv(t),this.private_CreateHorFullTemplate(),this.Set_TemplateType(EDrawingTemplate.HorEditor)},CDrawing.prototype.Create_VerticalFullTemplate=function(t){this.m_bMixedTemplate=!1,this.private_CreateWrappingMainDiv(t),this.private_CreateVerFullTemplate(),this.Set_TemplateType(EDrawingTemplate.VerEditor)},CDrawing.prototype.Create_VerticalSpecialTemplate_1=function(t){this.private_CreateWrappingMainDiv(t),this.m_nMinWidth=332;var e=this.m_oGameTree,o=this.m_oMainControl,r=this.m_oMainDiv.id,i=e.Get_LocalSettings().Is_Embedding(),a=r+"B";this.private_CreateDiv(o.HtmlElement,a).style.background="rgb(217, 217, 217)";var n=CreateControlContainer(a);n.Bounds.SetParams(0,0,1e3,0,!0,!1,!1,!1,-1,50),n.Anchor=g_anchor_top|g_anchor_left|g_anchor_right,o.AddControl(n);var s=r+"I";this.private_CreateDiv(o.HtmlElement,s);var l=CreateControlContainer(s);l.Bounds.SetParams(!0!==i?43:0,0,1e3,0,!0,!1,!1,!1,-1,50),l.Anchor=g_anchor_top|g_anchor_left|g_anchor_right,o.AddControl(l);var m=r+"O";this.private_CreateDiv(o.HtmlElement,m);var _=CreateControlContainer(m);_.Bounds.SetParams(0,50,1e3,1e3,!1,!0,!1,!1,-1,-1),_.Anchor=g_anchor_bottom|g_anchor_left|g_anchor_right,o.AddControl(_);var h=s+"W";this.private_CreateDiv(l.HtmlElement,h);var d=CreateControlContainer(h);d.Bounds.SetParams(0,0,500,1e3,!1,!1,!1,!1,-1,-1),d.Anchor=g_anchor_top|g_anchor_left|g_anchor_right|g_anchor_bottom,l.AddControl(d);var p=new CDrawingPlayerInfo(this);p.Init(h,e,BOARD_WHITE),this.m_aElements.push(p);var u=s+"B";this.private_CreateDiv(l.HtmlElement,u);var C=CreateControlContainer(u);C.Bounds.SetParams(500,0,1e3,1e3,!1,!1,!1,!1,-1,-1),C.Anchor=g_anchor_top|g_anchor_left|g_anchor_right|g_anchor_bottom,l.AddControl(C);var g=new CDrawingPlayerInfo(this);g.Init(u,e,BOARD_BLACK),this.m_aElements.push(g);var c=new CDrawingBoard(this);this.m_aElements.push(c),_.Set_Type(3,c,{RMin:this.m_nMixedBotSize-50});var v=m+"B";this.private_CreateDiv(_.HtmlElement,v);var f=CreateControlContainer(v);_.AddControl(f),c.Init(v,e),c.Focus();var w=m+"N",S=this.private_CreateDiv(_.HtmlElement,w),T=CreateControlContainer(w);_.AddControl(T),S.style.background="rgb(217, 217, 217)";var y=w+"T";this.private_CreateDiv(T.HtmlElement,y);var D=CreateControlContainer(y);D.Bounds.SetParams(0,1,1e3,1,!1,!0,!1,!0,-1,-1),D.Anchor=g_anchor_left|g_anchor_bottom|g_anchor_right,T.AddControl(D);var E=new CDrawingToolbar(this);E.Add_Control(new CDrawingButtonBackwardToStart(this),36,1,EToolbarFloat.Left),E.Add_Control(new CDrawingButtonBackward5(this),36,1,EToolbarFloat.Left),E.Add_Control(new CDrawingButtonBackward(this),36,1,EToolbarFloat.Left),E.Add_Control(new CDrawingButtonForward(this),36,1,EToolbarFloat.Left),E.Add_Control(new CDrawingButtonForward5(this),36,1,EToolbarFloat.Left),E.Add_Control(new CDrawingButtonForwardToEnd(this),36,1,EToolbarFloat.Left),E.Add_Control(new CDrawingButtonAbout(this),36,1,EToolbarFloat.Right),E.Add_Control(new CDrawingButtonAutoPlay(this),36,1,EToolbarFloat.Right),E.Init(y,e);this.m_aElements.push(E),this.m_nMixedBotSize=196,_.Set_Type(3,c,{RMin:this.m_nMixedBotSize-50});var B=CreateControlContainer(y);B.Bounds.SetParams(0,1,1e3,0,!1,!0,!1,!1,-1,36),B.Anchor=g_anchor_left|g_anchor_right|g_anchor_top,T.AddControl(B);var A=w+"U";this.private_CreateDiv(T.HtmlElement,A);var b=CreateControlContainer(A);b.Bounds.SetParams(0,38,1e3,1e3,!1,!0,!1,!1,-1,-1),b.Anchor=g_anchor_left|g_anchor_right|g_anchor_bottom,T.AddControl(b);var G=A+"N";this.private_CreateDiv(b.HtmlElement,G);var M=CreateControlContainer(G);M.Bounds.SetParams(0,0,1e3,1e3,!1,!1,!1,!1,-1,-1),M.Anchor=g_anchor_left|g_anchor_right|g_anchor_top|g_anchor_bottom,b.AddControl(M);var H=new CDrawingNavigator(this);H.Init(G,e),this.m_aElements.push(H),this.Update_Size(),e.On_EndLoadDrawing()},CDrawing.prototype.private_CreateWrappingMainDiv=function(t){g_oGlobalSettings.Load_FromLocalStorage();var e=CreateControlContainer(t);this.m_oControl=e;var o=t+"GB";this.private_CreateDiv(e.HtmlElement,o);var r=CreateControlContainer(o);r.Bounds.SetParams(0,0,1,1,!1,!1,!0,!0,-1,-1),r.Anchor=g_anchor_top|g_anchor_left|g_anchor_right|g_anchor_bottom,e.AddControl(r),this.private_SetMainDiv(o,r)},CDrawing.prototype.private_CreateHorFullTemplate=function(){var t=this.m_oGameTree,e=this.m_oMainControl,o=this.m_oMainDiv.id,r=t.Get_LocalSettings().Is_Embedding();this.m_nMixedRightSide=344;var i=new CDrawingBoard(this);e.Set_Type(1,i,{RMin:this.m_nMixedRightSide});var a=o+"_Board",n=o+"_Panel";this.private_CreateDiv(e.HtmlElement,a),this.private_CreateDiv(e.HtmlElement,n);var s=CreateControlContainer(a),l=CreateControlContainer(n);e.AddControl(s),e.AddControl(l),i.Init(a,t),i.Focus();var m=n+"_CaT",_=n+"_Navigator";this.private_CreateDiv(l.HtmlElement,m),this.private_CreateDiv(l.HtmlElement,_);var h=CreateControlContainer(m);h.Bounds.SetParams(0,0,1e3,500,!1,!1,!1,!1,-1,-1),h.Anchor=g_anchor_top|g_anchor_left|g_anchor_right|g_anchor_bottom,l.AddControl(h),h.HtmlElement.style.background="rgb(217, 217, 217)";var d=CreateControlContainer(_);d.Bounds.SetParams(0,500,1e3,1e3,!1,!1,!1,!1,-1,-1),d.Anchor=g_anchor_top|g_anchor_left|g_anchor_right|g_anchor_bottom,l.AddControl(d);var p=new CDrawingNavigator(this);p.Init(_,t);var u=m+"_Info",C=m+"_Comments",g=m+"_Toolbar";this.private_CreateDiv(h.HtmlElement,u),this.private_CreateDiv(h.HtmlElement,C),this.private_CreateDiv(h.HtmlElement,g);var c=CreateControlContainer(u);c.Bounds.SetParams(!0!==r?43:0,0,1e3,0,!0,!1,!1,!1,-1,50),c.Anchor=g_anchor_top|g_anchor_left|g_anchor_right,h.AddControl(c);var v=u+"_White",f=u+"_Black";this.private_CreateDiv(c.HtmlElement,v),this.private_CreateDiv(c.HtmlElement,f);var w=CreateControlContainer(v);w.Bounds.SetParams(0,0,500,1e3,!1,!1,!1,!1,-1,-1),w.Anchor=g_anchor_top|g_anchor_left|g_anchor_right|g_anchor_bottom,c.AddControl(w);var S=CreateControlContainer(f);S.Bounds.SetParams(500,0,1e3,1e3,!1,!1,!1,!1,-1,-1),S.Anchor=g_anchor_top|g_anchor_left|g_anchor_right|g_anchor_bottom,c.AddControl(S);var T=new CDrawingPlayerInfo(this);T.Init(v,t,BOARD_WHITE);var y=new CDrawingPlayerInfo(this);if(y.Init(f,t,BOARD_BLACK),!0!==r){var D=m+"_M";this.private_CreateDiv(h.HtmlElement,D);var E=CreateControlContainer(D);E.Bounds.SetParams(7,7,1e3,7,!0,!0,!1,!0,36,36),E.Anchor=g_anchor_top|g_anchor_left,h.AddControl(E);var B=new CDrawingButtonFileMenu(this);B.Init(D,t),this.Register_MenuButton(B),this.m_aElements.push(B)}var A=new CDrawingMultiLevelToolbar(this);A.Init(g);var b=A.Get_Height(),G=CreateControlContainer(g);G.Bounds.SetParams(6,0,6,0,!0,!1,!0,!0,-1,b),G.Anchor=g_anchor_left|g_anchor_right|g_anchor_bottom,h.AddControl(G);var M=CreateControlContainer(C);M.Bounds.SetParams(0,50,1e3,b+1,!1,!0,!1,!0,-1,-1),M.Anchor=g_anchor_top|g_anchor_left|g_anchor_right|g_anchor_bottom,h.AddControl(M);var H=this;A.Set_OnChangeCallback(function(){b=A.Get_Height(),G.Bounds.SetParams(6,0,6,0,!0,!1,!0,!0,-1,b),M.Bounds.SetParams(0,50,1e3,b+1,!1,!0,!1,!0,-1,-1),H.Update_Size(!1)});var I=new CDrawingComments(this);I.Init(C,t),this.m_aElements.push(i),this.m_aElements.push(p),this.m_aElements.push(I),this.m_aElements.push(A),this.m_aElements.push(y),this.m_aElements.push(T),this.Update_Size(),t.On_EndLoadDrawing()},CDrawing.prototype.private_CreateVerFullTemplate=function(){this.m_nMinWidth=332;var t=this.m_oGameTree,e=this.m_oMainControl,o=this.m_oMainDiv.id,r=t.Get_LocalSettings().Is_Embedding(),i=o+"B";this.private_CreateDiv(e.HtmlElement,i).style.background="rgb(217, 217, 217)";var a=CreateControlContainer(i);a.Bounds.SetParams(0,0,1e3,0,!0,!1,!1,!1,-1,50),a.Anchor=g_anchor_top|g_anchor_left|g_anchor_right,e.AddControl(a);var n=o+"I";if(this.private_CreateDiv(e.HtmlElement,n),!0!==r){var s=o+"M";this.private_CreateDiv(e.HtmlElement,s);var l=CreateControlContainer(s);l.Bounds.SetParams(7,7,1e3,7,!0,!0,!1,!0,36,36),l.Anchor=g_anchor_top|g_anchor_left,e.AddControl(l);var m=new CDrawingButtonFileMenu(this);m.Init(s,t),this.Register_MenuButton(m),this.m_aElements.push(m)}var _=CreateControlContainer(n);_.Bounds.SetParams(!0!==r?43:0,0,1e3,0,!0,!1,!1,!1,-1,50),_.Anchor=g_anchor_top|g_anchor_left|g_anchor_right,e.AddControl(_);var h=o+"O";this.private_CreateDiv(e.HtmlElement,h);var d=CreateControlContainer(h);d.Bounds.SetParams(0,50,1e3,1e3,!1,!0,!1,!1,-1,-1),d.Anchor=g_anchor_bottom|g_anchor_left|g_anchor_right,e.AddControl(d);var p=n+"W";this.private_CreateDiv(_.HtmlElement,p);var u=CreateControlContainer(p);u.Bounds.SetParams(0,0,500,1e3,!1,!1,!1,!1,-1,-1),u.Anchor=g_anchor_top|g_anchor_left|g_anchor_right|g_anchor_bottom,_.AddControl(u);var C=new CDrawingPlayerInfo(this);C.Init(p,t,BOARD_WHITE),this.m_aElements.push(C);var g=n+"B";this.private_CreateDiv(_.HtmlElement,g);var c=CreateControlContainer(g);c.Bounds.SetParams(500,0,1e3,1e3,!1,!1,!1,!1,-1,-1),c.Anchor=g_anchor_top|g_anchor_left|g_anchor_right|g_anchor_bottom,_.AddControl(c);var v=new CDrawingPlayerInfo(this);v.Init(g,t,BOARD_BLACK),this.m_aElements.push(v);var f=new CDrawingBoard(this);this.m_aElements.push(f),d.Set_Type(3,f,{RMin:this.m_nMixedBotSize-50});var w=h+"B";this.private_CreateDiv(d.HtmlElement,w);var S=CreateControlContainer(w);d.AddControl(S),f.Init(w,t),f.Focus();var T=h+"N",y=this.private_CreateDiv(d.HtmlElement,T),D=CreateControlContainer(T);d.AddControl(D),y.style.background="rgb(217, 217, 217)";var E=T+"T";this.private_CreateDiv(D.HtmlElement,E);var B=new CDrawingMultiLevelToolbar(this);B.Init(E);var A=B.Get_Height();this.m_aElements.push(B),this.m_nMixedBotSize=A+160,d.Set_Type(3,f,{RMin:this.m_nMixedBotSize-50});var b=CreateControlContainer(E);b.Bounds.SetParams(0,1,1e3,0,!1,!0,!1,!1,-1,A),b.Anchor=g_anchor_left|g_anchor_right|g_anchor_top,D.AddControl(b);var G=T+"U";this.private_CreateDiv(D.HtmlElement,G);var M=CreateControlContainer(G);M.Bounds.SetParams(0,A+2,1e3,1e3,!1,!0,!1,!1,-1,-1),M.Anchor=g_anchor_left|g_anchor_right|g_anchor_bottom,D.AddControl(M);var H=this;B.Set_OnChangeCallback(function(){A=B.Get_Height(),H.m_nMixedBotSize=A+160,d.Set_Type(3,f,{RMin:H.m_nMixedBotSize-50}),b.Bounds.SetParams(0,1,1e3,0,!1,!0,!1,!1,-1,A),M.Bounds.SetParams(0,A+2,1e3,1e3,!1,!0,!1,!1,-1,-1),H.Update_Size(!1)});var I=G+"L";this.private_CreateDiv(M.HtmlElement,I);var N=CreateControlContainer(I);N.Bounds.SetParams(0,0,0,1e3,!1,!1,!1,!1,36,-1),N.Anchor=g_anchor_left|g_anchor_top|g_anchor_bottom,M.AddControl(N);var P=G+"R";this.private_CreateDiv(M.HtmlElement,P);var k=CreateControlContainer(P);k.Bounds.SetParams(36,0,1e3,1e3,!0,!1,!1,!1,-1,-1),k.Anchor=g_anchor_right|g_anchor_top|g_anchor_bottom,M.AddControl(k);var x=P+"N";this.private_CreateDiv(k.HtmlElement,x);var R=CreateControlContainer(x);R.Bounds.SetParams(0,0,1e3,1e3,!1,!1,!1,!1,-1,-1),R.Anchor=g_anchor_left|g_anchor_right|g_anchor_top|g_anchor_bottom,k.AddControl(R);var L=P+"C";this.private_CreateDiv(k.HtmlElement,L);var W=CreateControlContainer(L);W.Bounds.SetParams(0,0,1e3,1e3,!1,!1,!1,!1,-1,-1),W.Anchor=g_anchor_left|g_anchor_right|g_anchor_top|g_anchor_bottom,k.AddControl(W);var V=new CDrawingNavigator(this);V.Init(x,t),this.m_aElements.push(V);var O=new CDrawingComments(this);O.Init(L,t),this.m_aElements.push(O);var F=new CDrawingNavigatorCommentsTabs(this);F.Init(I,t,x,L),this.m_aElements.push(F),this.Update_Size(),t.On_EndLoadDrawing(),this.m_nVerEditorTitleH=50,this.m_nVerEditorToolbarH=36,this.m_nVerEditorComNavH=160},CDrawing.prototype.Create_BoardCommentsButtonsNavigator=function(t){return this.Create_HorizontalFullTemplate(t)},CDrawing.prototype.Create_Problems=function(t){this.Set_TemplateType(EDrawingTemplate.Problems);var e=this.m_oGameTree,o=new CDrawingBoard(this),r=CreateControlContainer(t),i=t+"RenjuBoard";this.private_CreateDiv(r.HtmlElement,i);var a=CreateControlContainer(i);a.Bounds.SetParams(0,0,1,1,!1,!1,!0,!0,-1,-1),a.Anchor=g_anchor_top|g_anchor_left|g_anchor_right|g_anchor_bottom,r.AddControl(a),this.m_nMixedRightSide=200,a.Set_Type(1,o,{RMin:this.m_nMixedRightSide});var n=t+"_Board",s=t+"_Panel";this.private_CreateDiv(a.HtmlElement,n),this.private_CreateDiv(a.HtmlElement,s);var l=CreateControlContainer(n),m=CreateControlContainer(s);a.AddControl(l),a.AddControl(m),m.HtmlElement.style.background="rgb(217, 217, 217)",o.Init(n,e),o.Focus(),o.Set_ShellWhiteStones(!1);var _=s+"_Toolbar",h=s+"_Comments";this.private_CreateDiv(m.HtmlElement,h),this.private_CreateDiv(m.HtmlElement,_);var d=CreateControlContainer(h);d.Bounds.SetParams(0,38,1e3,1e3,!1,!0,!1,!1,-1,-1),d.Anchor=g_anchor_top|g_anchor_left|g_anchor_right|g_anchor_bottom,m.AddControl(d);var p=CreateControlContainer(_);p.Bounds.SetParams(6,1,1e3,1e3,!0,!0,!1,!0,-1,36),p.Anchor=g_anchor_left|g_anchor_right|g_anchor_top,m.AddControl(p);var u=new CDrawingComments(this);u.Init(h,e);var C=new CDrawingToolbar(this);C.Add_Control(new CDrawingButtonBackwardToStart(this),36,1,EToolbarFloat.Left),C.Add_Control(new CDrawingButtonAbout(this),36,1,EToolbarFloat.Left),C.Init(_,e),this.m_aElements.push(o),this.m_aElements.push(u),this.m_aElements.push(C),this.m_oControl=r,this.Update_Size(),e.On_EndLoadDrawing(),this.private_SetMainDiv(i)},CDrawing.prototype.Update_Size=function(t){t?this.private_UpdateSize(!0):this.m_bNeedUpdateSize=!0},CDrawing.prototype.private_SetMainDiv=function(t,e){this.m_oMainDiv=document.getElementById(t),this.m_oMainControl=e,this.m_oMainDiv.style.background="url('"+g_sBackground+"')",this.m_oMainDiv.onclick=this.private_OnMainDivClick},CDrawing.prototype.private_ClearMainDiv=function(){for(this.Remove_LabelElement();this.m_oMainDiv.firstChild;)this.m_oMainDiv.removeChild(this.m_oMainDiv.firstChild);this.m_oMainControl&&this.m_oMainControl.Clear(),g_aWindows={}},CDrawing.prototype.private_UpdateSize=function(t){if(!0===this.m_bMixedTemplate){var e=this.m_oControl.HtmlElement.clientWidth,o=this.m_oControl.HtmlElement.clientHeight;this.m_nMinWidth>0&&e<this.m_nMinWidth&&(e=this.m_nMinWidth);var r=-1;r=o-(e-this.m_nMixedRightSide)>this.m_nMixedBotSize+100?1:0,this.m_nMixedTemplateIndex!==r&&(this.m_nMixedTemplateIndex=r,this.private_ClearMainDiv(),0===this.m_nMixedTemplateIndex?this.private_CreateHorFullTemplate():this.private_CreateVerFullTemplate(),this.m_oGameTree&&(this.m_oGameTree.GoTo_Node(this.m_oGameTree.Get_CurNode(),!0),this.m_oGameTree.Update_InterfaceState(!0)))}if(this.m_bNeedUpdateSize=!1,this.m_oControl){var e=this.m_oControl.HtmlElement.clientWidth,o=this.m_oControl.HtmlElement.clientHeight;this.m_nMinWidth>0&&e<this.m_nMinWidth&&(e=this.m_nMinWidth),this.m_oControl.Resize(e,o)}for(var i=0,a=this.m_aElements.length;i<a;i++)this.m_aElements[i].Update_Size(t)},CDrawing.prototype.private_CreateDiv=function(t,e){var o=document.createElement("div");return o.setAttribute("id",e),o.setAttribute("style","position:absolute;padding:0;margin:0;"),o.setAttribute("oncontextmenu","return false;"),t.appendChild(o),o},CDrawing.prototype.Register_PassButton=function(t){this.m_oButtons.Pass=t},CDrawing.prototype.Register_BackwardToStartButton=function(t){this.m_oButtons.BackwardToStart.push(t)},CDrawing.prototype.Register_Backward_5Button=function(t){this.m_oButtons.Backward_5.push(t)},CDrawing.prototype.Register_BackwardButton=function(t){this.m_oButtons.Backward.push(t)},CDrawing.prototype.Register_ForwardButton=function(t){this.m_oButtons.Forward.push(t)},CDrawing.prototype.Register_Forward_5Button=function(t){this.m_oButtons.Forward_5.push(t)},CDrawing.prototype.Register_ForwardToEndButton=function(t){this.m_oButtons.ForwardToEnd.push(t)},CDrawing.prototype.Register_NextVariantButton=function(t){this.m_oButtons.NextVariant.push(t)},CDrawing.prototype.Register_PrevVariantButton=function(t){this.m_oButtons.PrevVariant.push(t)},CDrawing.prototype.Register_EditModeMoveButton=function(t){this.m_oButtons.BoardModeMove.push(t)},CDrawing.prototype.Register_EditModeAddRemButton=function(t){this.m_oButtons.BoardModeEditor.push(t)},CDrawing.prototype.Register_EditModeTrButton=function(t){this.m_oButtons.BoardModeTr.push(t)},CDrawing.prototype.Register_EditModeSqButton=function(t){this.m_oButtons.BoardModeSq.push(t)},CDrawing.prototype.Register_EditModeCrButton=function(t){this.m_oButtons.BoardModeCr.push(t)},CDrawing.prototype.Register_EditModeXButton=function(t){this.m_oButtons.BoardModeX.push(t)},CDrawing.prototype.Register_EditModeTextButton=function(t){this.m_oButtons.BoardModeText.push(t)},CDrawing.prototype.Register_EditModeNumButton=function(t){this.m_oButtons.BoardModeNum.push(t)},CDrawing.prototype.Register_EditModeColorButton=function(t){this.m_oButtons.BoardModeColor.push(t)},CDrawing.prototype.Register_Comments=function(t){this.m_aComments.push(t)},CDrawing.prototype.Register_Board=function(t){this.m_oBoard=t},CDrawing.prototype.Register_Navigator=function(t){this.m_oNavigator=t},CDrawing.prototype.Register_TimeLine=function(t){this.m_oTimeLine=t},CDrawing.prototype.Register_AutoPlaySpeed=function(t){this.m_oAutoPlaySlider=t},CDrawing.prototype.Register_AutoPlayButton=function(t){this.m_oAutoPlayButton=t},CDrawing.prototype.Register_SelectBoardModeButton=function(t){this.m_oSelectBoardModeButton=t},CDrawing.prototype.Register_ToolbarCustomizeButton=function(t){this.m_oButtons.ToolbarCustomize=t},CDrawing.prototype.Register_AddLabelElement=function(t){this.Remove_LabelElement(),this.m_oAddLabelElement=t},CDrawing.prototype.Register_MenuButton=function(t){this.m_oButtons.Menu=t},CDrawing.prototype.Register_EditorControlButton=function(t){this.m_oButtons.EditorControl=t},CDrawing.prototype.Register_KifuModeButton=function(t){this.m_oButtons.KifuMode=t},CDrawing.prototype.Register_KifuWindow=function(t){this.m_oWindows.Kifu=t},CDrawing.prototype.Remove_LabelElement=function(){if(this.m_oAddLabelElement){var t=this.m_oAddLabelElement;this.m_oAddLabelElement=null,this.m_oMainDiv.removeChild(t)}},CDrawing.prototype.On_StartAutoPlay=function(){this.m_oAutoPlayButton&&this.m_oAutoPlayButton.Set_State2(EDrawingButtonState2.AutoPlayPlaying)},CDrawing.prototype.On_StopAutoPlay=function(){this.m_oAutoPlayButton&&this.m_oAutoPlayButton.Set_State2(EDrawingButtonState2.AutoPlayStopped)},CDrawing.prototype.Update_AutoPlaySpeed=function(t){this.m_oAutoPlaySlider&&this.m_oAutoPlaySlider.Update_Pos(t)},CDrawing.prototype.Update_KifuMode=function(){this.m_oButtons.KifuMode&&this.m_oButtons.KifuMode.Set_Selected(this.m_oGameTree.Is_KifuMode())},CDrawing.prototype.Register_BlackInfo=function(t){this.m_oBlackInfo=t},CDrawing.prototype.Register_WhiteInfo=function(t){this.m_oWhiteInfo=t},CDrawing.prototype.Update_BlackName=function(t){this.m_oBlackInfo&&this.m_oBlackInfo.Update_Name(t),this.private_UpdateViewerTitle()},CDrawing.prototype.Update_BlackRank=function(t){this.m_oBlackInfo&&this.m_oBlackInfo.Update_Rank(t)},CDrawing.prototype.Update_WhiteName=function(t){this.m_oWhiteInfo&&this.m_oWhiteInfo.Update_Name(t),this.private_UpdateViewerTitle()},CDrawing.prototype.Update_WhiteRank=function(t){this.m_oWhiteInfo&&this.m_oWhiteInfo.Update_Rank(t)},CDrawing.prototype.private_UpdateViewerTitle=function(){this.m_oViewerTitle&&this.m_oViewerTitle.Set_Title(this.m_oGameTree.Get_MatchName())},CDrawing.prototype.Update_PassCount=function(t,e){this.m_oBlackInfo&&this.m_oBlackInfo.Update_PassCount(t),this.m_oWhiteInfo&&this.m_oWhiteInfo.Update_PassCount(e)},CDrawing.prototype.Update_InterfaceState=function(t){for(var e=0,o=this.m_oButtons.BackwardToStart.length;e<o;e++)this.m_oButtons.BackwardToStart[e].Set_Enabled(t.Backward);for(var e=0,o=this.m_oButtons.Backward_5.length;e<o;e++)this.m_oButtons.Backward_5[e].Set_Enabled(t.Backward);for(var e=0,o=this.m_oButtons.Backward.length;e<o;e++)this.m_oButtons.Backward[e].Set_Enabled(t.Backward);for(var e=0,o=this.m_oButtons.Forward.length;e<o;e++)this.m_oButtons.Forward[e].Set_Enabled(t.Forward);for(var e=0,o=this.m_oButtons.Forward_5.length;e<o;e++)this.m_oButtons.Forward_5[e].Set_Enabled(t.Forward);for(var e=0,o=this.m_oButtons.ForwardToEnd.length;e<o;e++)this.m_oButtons.ForwardToEnd[e].Set_Enabled(t.Forward);for(var e=0,o=this.m_oButtons.NextVariant.length;e<o;e++)this.m_oButtons.NextVariant[e].Set_Enabled(t.NextVariant);for(var e=0,o=this.m_oButtons.PrevVariant.length;e<o;e++)this.m_oButtons.PrevVariant[e].Set_Enabled(t.PrevVariant);for(var e=0,o=this.m_oButtons.BoardModeMove.length;e<o;e++)this.m_oButtons.BoardModeMove[e].Set_Selected(t.BoardMode===EBoardMode.Move);for(var e=0,o=this.m_oButtons.BoardModeEditor.length;e<o;e++)this.m_oButtons.BoardModeEditor[e].Set_Selected(t.BoardMode===EBoardMode.AddRemove);for(var e=0,o=this.m_oButtons.BoardModeTr.length;e<o;e++)this.m_oButtons.BoardModeTr[e].Set_Selected(t.BoardMode===EBoardMode.AddMarkTr);for(var e=0,o=this.m_oButtons.BoardModeSq.length;e<o;e++)this.m_oButtons.BoardModeSq[e].Set_Selected(t.BoardMode===EBoardMode.AddMarkSq);for(var e=0,o=this.m_oButtons.BoardModeCr.length;e<o;e++)this.m_oButtons.BoardModeCr[e].Set_Selected(t.BoardMode===EBoardMode.AddMarkCr);for(var e=0,o=this.m_oButtons.BoardModeX.length;e<o;e++)this.m_oButtons.BoardModeX[e].Set_Selected(t.BoardMode===EBoardMode.AddMarkX);for(var e=0,o=this.m_oButtons.BoardModeText.length;e<o;e++)this.m_oButtons.BoardModeText[e].Set_Selected(t.BoardMode===EBoardMode.AddMarkTx);for(var e=0,o=this.m_oButtons.BoardModeNum.length;e<o;e++)this.m_oButtons.BoardModeNum[e].Set_Selected(t.BoardMode===EBoardMode.AddMarkNum);for(var e=0,o=this.m_oButtons.BoardModeColor.length;e<o;e++)this.m_oButtons.BoardModeColor[e].Set_Selected(t.BoardMode===EBoardMode.AddMarkColor);this.m_oTimeLine&&this.m_oTimeLine.Update_Pos(t.TimelinePos),this.m_oSelectBoardModeButton&&this.m_oSelectBoardModeButton.On_UpdateBoardMode(t.BoardMode),this.m_oWindows.Kifu&&this.m_oWindows.Kifu.Update_NextMove(),this.Update_ColorsCounter();for(var r=0,i=this.m_arrStateHandlers.length;r<i;++r){var a=this.m_arrStateHandlers[r];a&&a.OnGameTreeStateChange&&a.OnGameTreeStateChange(this.m_oGameTree,t)}},CDrawing.prototype.Update_Comments=function(t){for(var e=0,o=this.m_aComments.length;e<o;e++)this.m_aComments[e].Update_Comments(t)},CDrawing.prototype.Update_ColorsCounter=function(){var t=g_aWindows[EWindowType.CountColors];t&&t.Is_Visible()&&t.Update()},CDrawing.prototype.Toggle_MultiLevelToolbarMainNavigation=function(){var t=g_oGlobalSettings.Toggle_MultiLevelToolbarMainNavigation();return this.m_oButtons.ToolbarCustomize&&this.m_oButtons.ToolbarCustomize.Set_MainNavigation(t),t},CDrawing.prototype.Toggle_MultiLevelToolbarTreeNavigation=function(){var t=g_oGlobalSettings.Toggle_MultiLevelToolbarTreeNavigation();return this.m_oButtons.ToolbarCustomize&&this.m_oButtons.ToolbarCustomize.Set_TreeNavigation(t),t},CDrawing.prototype.Toggle_MultiLevelToolbarGeneral=function(){var t=g_oGlobalSettings.Toggle_MultiLevelToolbarGeneral();return this.m_oButtons.ToolbarCustomize&&this.m_oButtons.ToolbarCustomize.Set_General(t),t},CDrawing.prototype.Toggle_MultiLevelToolbarAutoPlay=function(){var t=g_oGlobalSettings.Toggle_MultiLevelToolbarAutoPlay();return this.m_oButtons.ToolbarCustomize&&this.m_oButtons.ToolbarCustomize.Set_AutoPlay(t),t},CDrawing.prototype.Toggle_MultiLevelToolbarTimeline=function(){var t=g_oGlobalSettings.Toggle_MultiLevelToolbarTimeline();return this.m_oButtons.ToolbarCustomize&&this.m_oButtons.ToolbarCustomize.Set_Timeline(t),t},CDrawing.prototype.Toggle_MultiLevelToolbarKifuMode=function(){var t=g_oGlobalSettings.Toggle_MultiLevelToolbarKifuMode();return this.m_oButtons.ToolbarCustomize&&this.m_oButtons.ToolbarCustomize.Set_KifuMode(t),t},CDrawing.prototype.Get_DivHeightByWidth=function(t){var e=this.m_oGameTree?this.m_oGameTree.Get_DrawingBoard():null;if(!e)return 0;var o=e.Get_AspectRatio();if(Math.abs(o)<.1)return 0;var r=1/e.Get_AspectRatio();switch(this.m_eTemplateType){case EDrawingTemplate.SimpleBoard:return r*t;case EDrawingTemplate.Viewer:return this.m_nViewerTitleH+this.m_nViewerToolbarH+r*t;case EDrawingTemplate.VerEditor:return this.m_nVerEditorComNavH+this.m_nVerEditorTitleH+this.m_nVerEditorToolbarH+r*t;case EDrawingTemplate.HorEditor:case EDrawingTemplate.Problems:return(t-this.m_nMixedRightSide)*r;case EDrawingTemplate.None:default:return 0}return 0},CDrawing.prototype.Get_TemplateType=function(){return this.m_eTemplateType},CDrawing.prototype.Add_StateHandler=function(t){this.m_arrStateHandlers.push(t)},CDrawing.prototype.Create_ViewerForBooklet=function(t){this.Set_TemplateType(EDrawingTemplate.Viewer),this.private_CreateWrappingMainDiv(t),this.m_oMainDiv.style.background="",this.m_nMinWidth=295;var e=this.m_oGameTree,o=this.m_oMainControl,r=this.m_oMainDiv.id;this.m_nViewerTitleH=25,this.m_nViewerToolbarH=36;var i=r+"I";this.private_CreateDiv(o.HtmlElement,i);var a=CreateControlContainer(i);a.Bounds.SetParams(0,0,1e3,0,!1,!1,!1,!1,-1,25),a.Anchor=g_anchor_top|g_anchor_left|g_anchor_right,o.AddControl(a);var n=i+"S";this.private_CreateDiv(a.HtmlElement,n);var s=CreateControlContainer(n);s.Bounds.SetParams(159,0,1e3,1e3,!0,!1,!1,!1,122,-1),s.Anchor=g_anchor_top|g_anchor_left|g_anchor_bottom,a.AddControl(s);var l=r+"T";this.private_CreateDiv(o.HtmlElement,l);var m=CreateControlContainer(l);m.Bounds.SetParams(109,0,1e3,0,!0,!1,!1,!0,221,36),m.Anchor=g_anchor_bottom|g_anchor_left,o.AddControl(m);var _=new CDrawingToolbar(this);_.Add_Control(new CDrawingButtonBackwardToStart(this),36,1,EToolbarFloat.Left),_.Add_Control(new CDrawingButtonBackward5(this),36,1,EToolbarFloat.Left),_.Add_Control(new CDrawingButtonBackward(this),36,1,EToolbarFloat.Left),_.Add_Control(new CDrawingButtonForward(this),36,1,EToolbarFloat.Left),_.Add_Control(new CDrawingButtonForward5(this),36,1,EToolbarFloat.Left),_.Add_Control(new CDrawingButtonForwardToEnd(this),36,1,EToolbarFloat.Left),_.Init(l,e),_.HtmlElement.Control.HtmlElement.style.backgroundColor="",this.m_aElements.push(_);var h=r+"B",d=this.private_CreateDiv(o.HtmlElement,h),p=CreateControlContainer(h);p.Bounds.SetParams(0,25,1e3,36,!1,!0,!1,!0,-1,-1),p.Anchor=g_anchor_left|g_anchor_right|g_anchor_top|g_anchor_bottom,o.AddControl(p);var u=h+"B";this.private_CreateDiv(d,u);var C=CreateControlContainer(u);p.AddControl(C);var g=h+"N";this.private_CreateDiv(d,g);var c=CreateControlContainer(g);p.AddControl(c);var v=new CDrawingBoard(this);v.Init(u,this.m_oGameTree),v.Focus(),this.m_aElements.push(v),p.Set_Type(3,v,{RMin:0}),this.Update_Size(),e.On_EndLoadDrawing()},CDrawingFullInfo.prototype.Init=function(){},CDrawingFullInfo.prototype.Update_Size=function(){};var g_mouse_event_type_down=0,g_mouse_event_type_move=1,g_mouse_event_type_up=2,g_mouse_event_type_wheel=3,g_mouse_button_left=0,g_mouse_button_center=1,g_mouse_button_right=2,g_mouse_event_settings_lock=1,g_mouse_event_settings_count=2,global_mouseEvent=new CMouseEventHandler,global_keyboardEvent=new CKeyboardEvent;InitCaptureEvents();var EDrawingMark={Lm:-1,Tr:0,Sq:1,Cr:2,Tx:3,X:4,Tb:5,Tw:6,Tb2:7,Tw2:8};CDrawingMark.prototype.Get_Pos=function(){return this.m_oPos},CDrawingMark.prototype.Get_X=function(){return this.m_oPos.X},CDrawingMark.prototype.Get_Y=function(){return this.m_oPos.Y},CDrawingMark.prototype.Set_Pos=function(t,e){this.m_oPos.X=t,this.m_oPos.Y=e},CDrawingMark.prototype.Get_Type=function(){return this.m_nType},CDrawingMark.prototype.Set_Type=function(t){this.m_nType=t},CDrawingMark.prototype.Get_Text=function(){return this.m_sText},CDrawingMark.prototype.Set_Text=function(t){this.m_sText=t},CDrawingNavigator.prototype.Init=function(t,e){this.m_oDrawing&&this.m_oDrawing.Register_Navigator(this),this.m_oGameTree=e,this.m_oGameTree.Set_DrawingNavigator(this),this.m_oMap.Set_GameTree(e),this.HtmlElement.Control=CreateControlContainer(t);var o=this.HtmlElement.Control.HtmlElement,r=this.HtmlElement.Control,i=t+"_Board",a=t+"_Selection",n=t+"_Current",s=t+"_Lines",l=t+"_Shadows",m=t+"_Nodes",_=t+"_Events";this.private_CreateCanvasElement(o,i),this.private_CreateCanvasElement(o,a),this.private_CreateCanvasElement(o,n),this.private_CreateCanvasElement(o,s),this.private_CreateCanvasElement(o,l),this.private_CreateCanvasElement(o,m);var h=this.private_CreateDivElement(o,_);this.HtmlElement.HorScrollBG=this.private_CreateDivElement(o,t+"HorScroll_BG"),this.HtmlElement.HorScroll=this.private_CreateDivElement(o,t+"HorScroll"),this.HtmlElement.VerScrollBG=this.private_CreateDivElement(o,t+"VerScroll_BG"),this.HtmlElement.VerScroll=this.private_CreateDivElement(o,t+"VerScroll"),this.HtmlElement.HorScrollBG.style.background="rgb(0,0,0)",this.HtmlElement.HorScrollBG.style.opacity="0",this.HtmlElement.VerScrollBG.style.background="rgb(0,0,0)",this.HtmlElement.VerScrollBG.style.opacity="0",this.HtmlElement.HorScrollBG.onmousedown=this.private_OnMouseDownHorScrollBG,this.HtmlElement.HorScrollBG.onmouseup=this.private_OnMouseUpHorScrollBG,this.HtmlElement.HorScrollBG.onmouseover=this.private_OnMouseOverHorScrollBG,this.HtmlElement.HorScrollBG.onmouseout=this.private_OnMouseOutHorScrollBG,this.HtmlElement.VerScrollBG.onmousedown=this.private_OnMouseDownVerScrollBG,this.HtmlElement.VerScrollBG.onmouseup=this.private_OnMouseUpVerScrollBG,this.HtmlElement.VerScrollBG.onmouseover=this.private_OnMouseOverVerScrollBG,this.HtmlElement.VerScrollBG.onmouseout=this.private_OnMouseOutVerScrollBG,this.HtmlElement.HorScroll.onmouseover=this.private_OnMouseOverHorScroll,this.HtmlElement.HorScroll.onmouseout=this.private_OnMouseOutHorScroll,this.HtmlElement.VerScroll.onmouseover=this.private_OnMouseOverVerScroll,this.HtmlElement.VerScroll.onmouseout=this.private_OnMouseOutVerScroll;var d=CreateControlContainer(t+"HorScroll_BG");d.Bounds.SetParams(2,0,2,4,!0,!1,!0,!0,-1,8),d.Anchor=g_anchor_left|g_anchor_bottom|g_anchor_right,r.AddControl(d);var p=CreateControlContainer(t+"VerScroll_BG");p.Bounds.SetParams(0,2,4,2,!1,!0,!0,!0,8,-1),p.Anchor=g_anchor_top|g_anchor_bottom|g_anchor_right,r.AddControl(p),this.private_FillHtmlElement(this.HtmlElement.Board,r,i),this.private_FillHtmlElement(this.HtmlElement.Selection,r,a),this.private_FillHtmlElement(this.HtmlElement.Current,r,n),this.private_FillHtmlElement(this.HtmlElement.Lines,r,s),this.private_FillHtmlElement(this.HtmlElement.Shadows,r,l),this.private_FillHtmlElement(this.HtmlElement.Nodes,r,m),this.private_FillHtmlElement(this.HtmlElement.Events,r,_),h.onmousedown=this.private_OnMouseDown,h.onmousemove=this.private_OnMouseMove,h.onmouseout=this.private_OnMouseOut,h.onmousewheel=this.private_OnMouseWheel,h.addEventListener&&h.addEventListener("DOMMouseScroll",this.private_OnMouseWheel,!1),h.onfocus=this.private_OnFocus,h.tabIndex=-1,h.style.hidefocus=!0,h.style.outline=0,this.private_CreateTrueColorStones(),this.private_CreateLines(),this.private_CreateTarget(),this.private_CreateShadows()},CDrawingNavigator.prototype.Update_All=function(){this.private_CreateTrueColorStones(),this.private_CreateLines(),this.private_CreateTarget(),this.private_CreateShadows(),this.Update_Size(!0)},CDrawingNavigator.prototype.Update_Size=function(t){var e=this.HtmlElement.Control.HtmlElement.clientWidth,o=this.HtmlElement.Control.HtmlElement.clientHeight;this.HtmlElement.Control.Resize(e,o),this.private_OnResize(e,o,t)},CDrawingNavigator.prototype.Update=function(){if(!(this.m_oImageData.W<=0||this.m_oImageData.H<=0)){var t=this.m_oMap.Get_Width()+1,e=this.m_oMap.Get_Height()+1,o=this.m_oImageData.W,r=this.m_oImageData.H,i=20+24*t,a=20+24*e;i>o?(this.HtmlElement.ScrollW=Math.max(50,o*o/i),this.HtmlElement.HorScroll.style.width=Math.max(50,o*o/i)+"px",this.HtmlElement.HorScroll.style.display="block",this.HtmlElement.HorScroll.style.position="absolute",this.HtmlElement.HorScroll.style.top=r-12+"px",this.HtmlElement.HorScroll.style.height="8px",this.HtmlElement.HorScroll.style.background=this.private_GetSettings_DarkBoard()?"rgb(220, 220, 220)":"rgb(0,0,0)",this.HtmlElement.HorScroll.style.opacity=0,Common_DragHandler.Init(this.HtmlElement.HorScroll,null,2,o-this.HtmlElement.ScrollW-2,r-12,r-12),this.HtmlElement.HorScroll.onDrag=this.private_OnDragHorScroll,this.HtmlElement.HorScroll.onDragStart=this.private_OnDragStartScroll,this.HtmlElement.HorScroll.onDragEnd=this.private_OnDragEndScroll,this.HtmlElement.HorScrollBG.style.display="block"):(this.HtmlElement.HorScrollBG.style.display="none",this.HtmlElement.HorScroll.style.display="none"),a>r?(this.HtmlElement.ScrollH=Math.max(50,r*r/a),this.HtmlElement.VerScroll.style.height=Math.max(50,r*r/a)+"px",this.HtmlElement.VerScroll.style.display="block",this.HtmlElement.VerScroll.style.position="absolute",this.HtmlElement.VerScroll.style.left=o-12+"px",this.HtmlElement.VerScroll.style.width="8px",this.HtmlElement.VerScroll.style.background=this.private_GetSettings_DarkBoard()?"rgb(220, 220, 220)":"rgb(0,0,0)",this.HtmlElement.VerScroll.style.opacity=0,Common_DragHandler.Init(this.HtmlElement.VerScroll,null,o-12,o-12,2,r-this.HtmlElement.ScrollH-2),this.HtmlElement.VerScroll.onDrag=this.private_OnDragVerScroll,this.HtmlElement.VerScroll.onDragStart=this.private_OnDragStartScroll,this.HtmlElement.VerScroll.onDragEnd=this.private_OnDragEndScroll,this.HtmlElement.VerScrollBG.style.display="block"):(this.HtmlElement.VerScrollBG.style.display="none",this.HtmlElement.VerScroll.style.display="none"),this.m_oLastDrawMap.H=-1,this.m_oLastDrawMap.W=-1,this.private_DrawMap(),this.private_UpdateScrollsPos()}},CDrawingNavigator.prototype.Create_FromGameTree=function(){this.m_oMap.Create_FromGameTree(),this.m_oLastDrawMap.H=-1,this.m_oLastDrawMap.W=-1},CDrawingNavigator.prototype.Update_Current=function(t){this.m_bNeedRedrawCurrent=!0;var e=this.m_oImageData.W,o=this.m_oImageData.H;if(!(e<=0||o<=0)){var r=this.m_oGameTree.Get_CurNode().Get_NavigatorInfo(),i=r.X,a=r.Y,n=10+this.m_oOffset.X+24*i,s=10+this.m_oOffset.Y+24*a;if(0!=t&&!0===this.m_bNavigatorScroll&&(n<=10||n>=e-10||s<=10||s>=o-10)){var l=20+24*(this.m_oMap.Get_Height()+1)-o,m=20+24*(this.m_oMap.Get_Width()+1)-e;n<=10?this.m_oOffset.X=24*-i:n>=e-10&&(this.m_oOffset.X=e-24-10-10-24*i),s<=10?this.m_oOffset.Y=24*-a:s>=o-10&&(this.m_oOffset.Y=o-24-10-10-24*a),this.m_oOffset.X=Math.min(0,Math.max(this.m_oOffset.X,-m)),this.m_oOffset.Y=Math.min(0,Math.max(this.m_oOffset.Y,-l)),this.private_UpdateScrollsPos(),this.private_DrawMap()}}},CDrawingNavigator.prototype.Update_GameCurrent=function(){this.m_bNeedRedrawGameCurrent=!0},CDrawingNavigator.prototype.Draw=function(){this.m_bNeedRedrawCurrent&&this.private_DrawCurrentOnTimer(),this.m_bNeedRedrawMap&&this.private_DrawMapOnTimer(),this.m_bNeedRedrawGameCurrent&&this.private_DrawGameCurrentOnTimer()},CDrawingNavigator.prototype.Need_Redraw=function(){return!(!this.m_bNeedRedrawCurrent&&!this.m_bNeedRedrawMap)},CDrawingNavigator.prototype.private_CreateCanvasElement=function(t,e){var o=document.createElement("canvas");return o.setAttribute("id",e),o.setAttribute("style","position:absolute;padding:0;margin:0;"),o.setAttribute("oncontextmenu","return false;"),t.appendChild(o),o},CDrawingNavigator.prototype.private_CreateDivElement=function(t,e){var o=document.createElement("div");return o.setAttribute("id",e),o.setAttribute("style","position:absolute;padding:0;margin:0;"),o.setAttribute("oncontextmenu","return false;"),t.appendChild(o),o},CDrawingNavigator.prototype.private_FillHtmlElement=function(t,e,o){t.Control=CreateControlContainer(o);var r=t.Control;r.Bounds.SetParams(0,0,1e3,1e3,!1,!1,!1,!1,-1,-1),r.Anchor=g_anchor_top|g_anchor_left|g_anchor_bottom|g_anchor_right,e.AddControl(r)},CDrawingNavigator.prototype.private_OnResize=function(t,e,o){this.private_DrawBackground(t,e,o),this.Update(),this.Update_Current(!0),this.Update_GameCurrent()},CDrawingNavigator.prototype.private_DrawBackground=function(t,e,o){var r=this.HtmlElement.Board.Control.HtmlElement.getContext("2d");t!==this.m_oImageData.W||e!==this.m_oImageData.H||null===this.m_oImageData.Board||null!==this.m_oCreateWoodyId||!0===o?(this.m_oImageData.W=t,this.m_oImageData.H=e,r.fillStyle=this.private_GetSettings_BoardColor().ToString(),r.fillRect(0,0,t,e),null!==this.m_oCreateWoodyId&&clearTimeout(this.m_oCreateWoodyId),this.m_oCreateWoodyId=this.private_StartDrawingTimer()):r.putImageData(this.m_oImageData.Board,0,0)},CDrawingNavigator.prototype.private_CreateTrueColorBoard=function(){this.m_oCreateWoodyId=null;var t=this.m_oImageData.W,e=this.m_oImageData.H,o=this.HtmlElement.Board.Control.HtmlElement.getContext("2d");if(0!==t&&0!==e){for(var r=o.createImageData(t,e),i=this.private_GetSettings_BoardColor(),a=i.r,n=i.g,s=i.b,l=new Array(t),m=0;m<t;m++)l[m]=(Math.tan(300*m/t)+1)/2+(Math.tan(100*m/t)+1)/10;for(var _=new Array(e),h=0;h<e;h++)_[h]=.02*Math.tan(h/e);var d,p,u,C=this.private_GetSettings_LinesColor();if(!0===this.private_GetSettings_TrueColorBoard())for(var g=.9,h=0;h<e;h++)for(m=0;m<t;m++){g=40*(l[m]+_[h])+.5,g=(g-=Math.floor(g))<.2?1-g/2:g<.4?1-(.4-g)/2:1,(h==e-1||h==e-2&&m<t-2||m>=t-1||m==t-2&&h<e-1)&&(g/=2),0==h||1==h&&m>1||0==m||1==m&&h>1?(d=128+a*g/2,p=128+n*g/2,u=128+s*g/2):(d=a*g,p=n*g,u=s*g);f=4*(m+h*t);r.data[f+0]=d,r.data[f+1]=p,r.data[f+2]=u,r.data[f+3]=255}else for(var c=0;c<e;c++)for(var v=0;v<t;v++){0==c||0==v||c===e-1||v===t-1?(d=C.r,p=C.g,u=C.b):(d=a,p=n,u=s);var f=4*(v+c*t);r.data[f+0]=d,r.data[f+1]=p,r.data[f+2]=u,r.data[f+3]=255}this.m_oImageData.Board=r,o.putImageData(this.m_oImageData.Board,0,0)}},CDrawingNavigator.prototype.private_CreateTrueColorStones=function(){var t=this.HtmlElement.Nodes.Control.HtmlElement.getContext("2d"),e=20;this.m_oImageData.Black=t.createImageData(e,e),this.m_oImageData.White=t.createImageData(e,e),this.m_oImageData.BlackT=t.createImageData(e,e),this.m_oImageData.WhiteT=t.createImageData(e,e);var o=this.m_oImageData.Black.data,r=this.m_oImageData.White.data,i=this.m_oImageData.BlackT.data,a=this.m_oImageData.WhiteT.data,n=this.private_GetSettings_WhiteColor(),s=this.private_GetSettings_BlackColor(),l=this.private_GetSettings_DarkBoard();if(!0===this.private_GetSettings_TrueColorStones())for(var m=(S=9.5)-.2,_=Math.sqrt(3),h=0;h<e;h++)for(T=0;T<e;T++){var d=h-S,p=T-S,u=4*(h*e+e-T-1);if((y=m-Math.sqrt(d*d+p*p))>=0){var C=m*m-d*d-p*p;C=C>0?Math.sqrt(C)*_:0;var g=d,c=p,v=Math.sqrt(6*(g*g+c*c+C*C)),f=0;(v=(2*C-g+c)/v)>.9&&(f=10*(v-.9));D=255;if(y<=.8){y=(.8-y)/.8;B=.7;d-p<m/3&&(B=1),D=parseInt(255*(1-y*B))}var w=parseInt(10+10*v+140*f);o[u+0]=w,o[u+1]=w,o[u+2]=w,o[u+3]=D,i[u+0]=w,i[u+1]=w,i[u+2]=w,i[u+3]=parseInt(.5*D),w=parseInt(200+10*v+45*f),r[u+0]=w,r[u+1]=w,r[u+2]=w,r[u+3]=D,a[u+0]=w,a[u+1]=w,a[u+2]=w,a[u+3]=parseInt(.7*D)}else o[u+0]=0,o[u+1]=0,o[u+2]=0,o[u+3]=0,a[u+0]=0,a[u+1]=0,a[u+2]=0,a[u+3]=0}else for(var S=9.5,m=S-.2,h=0;h<e;h++)for(var T=0;T<e;T++){var d=h-S,p=T-S,y=m-Math.sqrt(d*d+p*p),u=4*(h*e+e-T-1);if(y>=0){var D=255;if(y<=.8){var E=(.8-y)/.8,B=.7;d-p<m/3&&(B=1),D=parseInt(255*(1-E*B))}else if(y<=1.6&&y>=.8&&!0===l){var E=(1.6-y)/.8,B=.7;d-p<m/3&&(B=1),D=parseInt(E*B*255)}var A=!1;if(y<=1.6&&(A=!0),!1===A||!1===l?(o[u+0]=s.r,o[u+1]=s.g,o[u+2]=s.b,o[u+3]=D,i[u+0]=s.r,i[u+1]=s.g,i[u+2]=s.b,i[u+3]=parseInt(.5*D)):(o[u+0]=n.r,o[u+1]=n.g,o[u+2]=n.b,o[u+3]=D,i[u+0]=n.r,i[u+1]=n.g,i[u+2]=n.b,i[u+3]=parseInt(.5*D)),D=255,y<=.8){var E=(.8-y)/.8,B=.7;d-p<m/3&&(B=1),D=parseInt(255*(1-E*B))}else if(y<=1.6&&y>=.8&&!1===l){var E=(1.6-y)/.8,B=.7;d-p<m/3&&(B=1),D=parseInt(E*B*255)}!1===A||!0===l?(r[u+0]=n.r,r[u+1]=n.g,r[u+2]=n.b,r[u+3]=D,a[u+0]=n.r,a[u+1]=n.g,a[u+2]=n.b,a[u+3]=parseInt(D/2)):(r[u+0]=s.r,r[u+1]=s.g,r[u+2]=s.b,r[u+3]=D,a[u+0]=s.r,a[u+1]=s.g,a[u+2]=s.b,a[u+3]=parseInt(D/2))}else o[u+0]=0,o[u+1]=0,o[u+2]=0,o[u+3]=0,i[u+0]=0,i[u+1]=0,i[u+2]=0,i[u+3]=0,r[u+0]=0,r[u+1]=0,r[u+2]=0,r[u+3]=0,a[u+0]=0,a[u+1]=0,a[u+2]=0,a[u+3]=0}},CDrawingNavigator.prototype.private_CreateLines=function(){var t=this.HtmlElement.Lines.Control.HtmlElement.getContext("2d");this.m_oImageData.Hor_Start=t.createImageData(24,24),this.m_oImageData.Hor_Start2=t.createImageData(24,24),this.m_oImageData.Hor=t.createImageData(24,24),this.m_oImageData.Hor2=t.createImageData(24,24),this.m_oImageData.Hor_End=t.createImageData(24,24),this.m_oImageData.Ver=t.createImageData(24,24),this.m_oImageData.Ver2=t.createImageData(24,24),this.m_oImageData.Ver3=t.createImageData(24,24),this.m_oImageData.Hor_Start_T=t.createImageData(24,24),this.m_oImageData.Hor_Start2_T=t.createImageData(24,24),this.m_oImageData.Hor_Start2_T_2=t.createImageData(24,24),this.m_oImageData.Hor_Start2_T_3=t.createImageData(24,24),this.m_oImageData.Hor_T=t.createImageData(24,24),this.m_oImageData.Hor2_T=t.createImageData(24,24),this.m_oImageData.Hor2_T_2=t.createImageData(24,24),this.m_oImageData.Hor2_T_3=t.createImageData(24,24),this.m_oImageData.Hor_End_T=t.createImageData(24,24),this.m_oImageData.Ver_T=t.createImageData(24,24),this.m_oImageData.Ver2_T=t.createImageData(24,24),this.m_oImageData.Ver2_T_2=t.createImageData(24,24),this.m_oImageData.Ver2_T_3=t.createImageData(24,24),this.m_oImageData.Ver3_T=t.createImageData(24,24);for(var e=this.m_oImageData.Hor_Start.data,o=this.m_oImageData.Hor_Start2.data,r=this.m_oImageData.Hor.data,i=this.m_oImageData.Hor2.data,a=this.m_oImageData.Hor_End.data,n=this.m_oImageData.Ver.data,s=this.m_oImageData.Ver2.data,l=this.m_oImageData.Ver3.data,m=this.m_oImageData.Hor_Start_T.data,_=this.m_oImageData.Hor_Start2_T.data,h=this.m_oImageData.Hor_Start2_T_2.data,d=this.m_oImageData.Hor_Start2_T_3.data,p=this.m_oImageData.Hor_T.data,u=this.m_oImageData.Hor2_T.data,C=this.m_oImageData.Hor2_T_2.data,g=this.m_oImageData.Hor2_T_3.data,c=this.m_oImageData.Hor_End_T.data,v=this.m_oImageData.Ver_T.data,f=this.m_oImageData.Ver2_T.data,w=this.m_oImageData.Ver2_T_2.data,S=this.m_oImageData.Ver2_T_3.data,T=this.m_oImageData.Ver3_T.data,y=!0===this.private_GetSettings_DarkBoard()?200:28,D=new CColor(y,y,y,255),E=0;E<24;E++)for(var B=0;B<24;B++){var A=4*(24*E+B);B>=12&&(11===E||12===E)?(e[A+0]=D.r,e[A+1]=D.b,e[A+2]=D.g,e[A+3]=255,m[A+0]=D.r,m[A+1]=D.b,m[A+2]=D.g,m[A+3]=96):(e[A+3]=0,m[A+3]=0),B>=11&&(11===E||12===E)||E>=12&&(11===B||12===B)?(o[A+0]=D.r,o[A+1]=D.b,o[A+2]=D.g,o[A+3]=255,d[A+0]=D.r,d[A+1]=D.b,d[A+2]=D.g,d[A+3]=96):(o[A+3]=0,d[A+3]=0),B>=11&&(11===E||12===E)?(_[A+0]=D.r,_[A+1]=D.b,_[A+2]=D.g,_[A+3]=255):E>=12&&(11===B||12===B)?(_[A+0]=D.r,_[A+1]=D.b,_[A+2]=D.g,_[A+3]=96):_[A+3]=0,E>=12&&(11===B||12===B)?(h[A+0]=D.r,h[A+1]=D.b,h[A+2]=D.g,h[A+3]=255):B>=11&&(11===E||12===E)?(h[A+0]=D.r,h[A+1]=D.b,h[A+2]=D.g,h[A+3]=96):h[A+3]=0,11===E||12===E?(r[A+0]=D.r,r[A+1]=D.b,r[A+2]=D.g,r[A+3]=255,p[A+0]=D.r,p[A+1]=D.b,p[A+2]=D.g,p[A+3]=96):(r[A+3]=0,p[A+3]=0),11===E||12===E||E>=12&&(11===B||12===B)?(i[A+0]=D.r,i[A+1]=D.b,i[A+2]=D.g,i[A+3]=255,g[A+0]=D.r,g[A+1]=D.b,g[A+2]=D.g,g[A+3]=96):(i[A+3]=0,g[A+3]=0),11===E||12===E?(u[A+0]=D.r,u[A+1]=D.b,u[A+2]=D.g,u[A+3]=255):E>=12&&(11===B||12===B)?(u[A+0]=D.r,u[A+1]=D.b,u[A+2]=D.g,u[A+3]=96):u[A+3]=0,(11===E||12===E)&&B<=12||E>=12&&(11===B||12===B)?(C[A+0]=D.r,C[A+1]=D.b,C[A+2]=D.g,C[A+3]=255):(11===E||12===E)&&B>12?(C[A+0]=D.r,C[A+1]=D.b,C[A+2]=D.g,C[A+3]=96):(i[A+3]=0,g[A+3]=0),B<=11&&(11===E||12===E)?(a[A+0]=D.r,a[A+1]=D.b,a[A+2]=D.g,a[A+3]=255,c[A+0]=D.r,c[A+1]=D.b,c[A+2]=D.g,c[A+3]=96):(a[A+3]=0,c[A+3]=0),11===B||12===B?(n[A+0]=D.r,n[A+1]=D.b,n[A+2]=D.g,n[A+3]=255,v[A+0]=D.r,v[A+1]=D.b,v[A+2]=D.g,v[A+3]=96):(n[A+3]=0,v[A+3]=0),11===B||12===B||B>=12&&(11===E||12===E)?(s[A+0]=D.r,s[A+1]=D.b,s[A+2]=D.g,s[A+3]=255,S[A+0]=D.r,S[A+1]=D.b,S[A+2]=D.g,S[A+3]=96):(s[A+3]=0,S[A+3]=0),(11===B||12===B)&&E<=12||B>=12&&(11===E||12===E)?(f[A+0]=D.r,f[A+1]=D.b,f[A+2]=D.g,f[A+3]=255):(11===B||12===B)&&E>12?(f[A+0]=D.r,f[A+1]=D.b,f[A+2]=D.g,f[A+3]=96):f[A+3]=0,11===B||12===B?(w[A+0]=D.r,w[A+1]=D.b,w[A+2]=D.g,w[A+3]=255):B>12&&(11===E||12===E)?(w[A+0]=D.r,w[A+1]=D.b,w[A+2]=D.g,w[A+3]=96):w[A+3]=0,E<=11&&(11===B||12===B)||B>=11&&(11===E||12===E)?(l[A+0]=D.r,l[A+1]=D.b,l[A+2]=D.g,l[A+3]=255,T[A+0]=D.r,T[A+1]=D.b,T[A+2]=D.g,T[A+3]=96):(l[A+3]=0,T[A+3]=0)}this.m_oImageData.Triangle=this.private_DrawTriangle(20,20,20*.07,D,1,null),this.m_oImageData.Triangle_T=this.private_DrawTriangle(20,20,20*.07,new CColor(y,y,y,96),1,null),this.m_oImageData.Triangle_B=this.private_DrawTriangle(20,20,1.2,new CColor(255,255,255,255),1,this.m_oImageData.Black),this.m_oImageData.Triangle_W=this.private_DrawTriangle(20,20,1.2,new CColor(0,0,0,255),1,this.m_oImageData.White),this.m_oImageData.Triangle_BT=this.private_DrawTriangle(20,20,1.2,new CColor(255,255,255,96),1,this.m_oImageData.BlackT),this.m_oImageData.Triangle_WT=this.private_DrawTriangle(20,20,1.2,new CColor(0,0,0,96),1,this.m_oImageData.WhiteT)},CDrawingNavigator.prototype.private_CreateTarget=function(){var t=this.HtmlElement.Selection.Control.HtmlElement.getContext("2d");this.m_oImageData.Target=t.createImageData(24,24),this.m_oImageData.Current=t.createImageData(24,24),this.m_oImageData.GameCurrent=t.createImageData(24,24);for(var e=this.m_oImageData.Target.data,o=this.m_oImageData.Current.data,r=this.m_oImageData.GameCurrent.data,i=0;i<24;i++)for(var a=0;a<24;a++){var n=4*(a+24*i);e[n+3]=255,o[n+3]=255,r[n+3]=255,0===a&&23===i||23===a&&0===i?(e[n+0]=135,e[n+1]=125,e[n+2]=135,o[n+0]=216,o[n+1]=0,o[n+2]=0,r[n+0]=35,r[n+1]=99,r[n+2]=205):23===a||23===i?(e[n+0]=89,e[n+1]=89,e[n+2]=89,o[n+0]=178,o[n+1]=0,o[n+2]=0,r[n+0]=29,r[n+1]=81,r[n+2]=169):0===i||0===a?(e[n+0]=182,e[n+1]=182,e[n+2]=182,o[n+0]=255,o[n+1]=0,o[n+2]=0,r[n+0]=42,r[n+1]=117,r[n+2]=243):(e[n+0]=128,e[n+1]=128,e[n+2]=128,o[n+0]=255,o[n+1]=0,o[n+2]=0,r[n+0]=42,r[n+1]=117,r[n+2]=243)}t.putImageData(this.m_oImageData.Target,0,0),t.putImageData(this.m_oImageData.Current,0,30),t.putImageData(this.m_oImageData.GameCurrent,0,60)},CDrawingNavigator.prototype.private_DrawTriangle=function(t,e,o,r,i,a){void 0===i&&(i=1);var n=this.HtmlElement.Lines.Control.HtmlElement.getContext("2d");n.clearRect(0,0,t,e),null!==a&&n.putImageData(a,0,0),n.globalAlpha=i,n.strokeStyle=r.ToString(),n.fillStyle=r.ToString(),n.lineWidth=o;var s=t/2,l=3*e/4,m=.1*t,_=Math.sqrt(s*s-(l-s)*(l-s))+s-m,h=-Math.sqrt(s*s-(l-s)*(l-s))+s+m,d=m,p=l;null!==a&&(_=Math.floor(_-.5),h=Math.ceil(h+.5),d=Math.ceil(d+.5),p=Math.floor(p-.5)),n.beginPath(),n.moveTo(t/2,d),n.lineTo(_,p),n.lineTo(h,p),n.closePath(),n.stroke();var u=n.getImageData(0,0,t,e);return n.putImageData(u,0,0),u},CDrawingNavigator.prototype.private_CreateShadows=function(){var t=this.HtmlElement.Shadows.Control.HtmlElement.getContext("2d"),e=20;this.m_oImageData.Shadow=t.createImageData(e,e);var o=this.m_oImageData.Shadow.data;this.m_oImageData.ShadowOff=Math.max(parseInt(3),3);for(var r=0;r<e;r++)for(var i=0;i<e;i++){var a=Math.abs(r-8.5),n=Math.abs(i-8.5),s=Math.sqrt(n*n+a*a)/8.5,l=s<1?.15+.75*(1-s):0,m=4*(e*r+i);o[m+0]=0,o[m+1]=0,o[m+2]=0,o[m+3]=parseInt(255*l)}},CDrawingNavigator.prototype.private_DrawMap=function(){this.m_bNeedRedrawMap=!0,this.Update_Current(!1)},CDrawingNavigator.prototype.private_UpdateMousePos=function(t,e){var o=Common_FindPosition(this.HtmlElement.Board.Control.HtmlElement);return{X:(t-o.X-10-this.m_oOffset.X)/24|0,Y:(e-o.Y-10-this.m_oOffset.Y)/24|0}},CDrawingNavigator.prototype.private_UpdateTarget=function(t,e){var o=this.m_oImageData.W,r=this.m_oImageData.H;if(!(o<=0||r<=0)){var i=this.HtmlElement.Selection.Control.HtmlElement.getContext("2d");if(i.clearRect(0,0,o,r),t>=0&&e>=0){var a=10+this.m_oOffset.X+24*t,n=10+this.m_oOffset.Y+24*e;this.m_oMap.Get(t,e).Is_Node()&&i.putImageData(this.m_oImageData.Target,a,n)}}},CDrawingNavigator.prototype.private_UpdateScrollsPos=function(){var t=-this.m_oOffset.X,e=this.m_oMap.Get_Width()+1,o=this.HtmlElement.ScrollW,r=this.m_oImageData.W,i=t/(20+24*e-r)*(r-4-o)+2,a=-this.m_oOffset.Y,n=this.m_oMap.Get_Height()+1,s=this.HtmlElement.ScrollH,l=this.m_oImageData.H,m=a/(20+24*n-l)*(l-4-s)+2;this.HtmlElement.HorScroll.style.left=i+"px",this.HtmlElement.VerScroll.style.top=m+"px"},CDrawingNavigator.prototype.private_DrawMapOnTimer=function(){var t=this.m_oImageData.W,e=this.m_oImageData.H;if(0!==t&&0!==e)if(this.m_oLastDrawMap.W===t&&this.m_oLastDrawMap.H===e&&Math.abs(this.m_oOffset.X-this.m_oLastDrawMap.X)<1&&Math.abs(this.m_oOffset.Y-this.m_oLastDrawMap.Y)<1)this.m_bNeedRedrawMap=!1;else{this.m_oLastDrawMap.W=t,this.m_oLastDrawMap.H=e,this.m_oLastDrawMap.X=this.m_oOffset.X,this.m_oLastDrawMap.Y=this.m_oOffset.Y;var o=this.HtmlElement.Lines.Control.HtmlElement.getContext("2d"),r=this.HtmlElement.Shadows.Control.HtmlElement.getContext("2d"),i=this.HtmlElement.Nodes.Control.HtmlElement.getContext("2d"),a=this.HtmlElement.Selection.Control.HtmlElement.getContext("2d");i.clearRect(0,0,t,e),r.clearRect(0,0,t,e),o.clearRect(0,0,t,e),a.clearRect(0,0,t,e);for(var n=10+this.m_oOffset.X,s=10+this.m_oOffset.Y,l=this.m_oMap.Get_Height(),m=this.private_GetSettings_Shadows(),_=0;_<=l-1;_++){var h=s+24*_;if(h>=-24&&h<=e+24)for(var d=this.m_oMap.Get_LineWidth(_),p=0;p<=d;p++){var u=n+24*p;if(u>=-24&&u<=t+24){var C=this.m_oMap.Get(p,_);if(!1===C.Is_Node()){var g=C.Get_Type(),c=C.Is_OnCurrentVariant();switch(g){case ENavigatorElementType.Empty:break;case ENavigatorElementType.Line_Ver:c.bResult?o.putImageData(this.m_oImageData.Ver,u,h):o.putImageData(this.m_oImageData.Ver_T,u,h);break;case ENavigatorElementType.Line_Ver_Con:c.bResult?1===c.Temp?o.putImageData(this.m_oImageData.Ver2_T,u,h):o.putImageData(this.m_oImageData.Ver2_T_2,u,h):o.putImageData(this.m_oImageData.Ver2_T_3,u,h);break;case ENavigatorElementType.Line_Ver_End:c.bResult?o.putImageData(this.m_oImageData.Ver3,u,h):o.putImageData(this.m_oImageData.Ver3_T,u,h)}}else{var v=C.Is_OnCurrentVariant(),f=C.Get_Move(),w=f.Get_Type(),S=C.Get_Comment(),T="",y=0;switch(g_oGlobalSettings.Get_NavigatorLabel()){case ESettingsNavigatorLabels.Empty:T="";break;case ESettingsNavigatorLabels.MoveNumbers:(T=""+C.Get_NavigatorInfo().Num).length<=2?i.font="bold 10px sans-serif":(i.font="bold 9px sans-serif",y=-1);break;case ESettingsNavigatorLabels.MoveNumbersCurrentVariant:(T=v?""+C.Get_NavigatorInfo().Num:"").length<=2?i.font="bold 10px sans-serif":(i.font="bold 9px sans-serif",y=-1);break;case ESettingsNavigatorLabels.MoveCoordinates:var D=this.m_oGameTree.Get_Board().Get_Size();(T=Common_PosValueToString(f.Get_Value(),D.X,D.Y)).length<=2?i.font="bold 10px sans-serif":i.font="bold 8px sans-serif"}var E=i.measureText(T).width;BOARD_BLACK===w?(v&&!0===m&&r.putImageData(this.m_oImageData.Shadow,u+2+this.m_oImageData.ShadowOff,h+2+this.m_oImageData.ShadowOff),i.putImageData(v?this.m_oImageData.Black:this.m_oImageData.BlackT,u+2,h+2),""===S?""!==T&&(i.fillStyle=v?"#CCC":"rgb(192, 192, 192)",i.fillText(T,u+12-E/2+y,h+12+3)):i.putImageData(v?this.m_oImageData.Triangle_B:this.m_oImageData.Triangle_BT,u+2,h+2)):BOARD_WHITE===w?(v&&!0===m&&r.putImageData(this.m_oImageData.Shadow,u+2+this.m_oImageData.ShadowOff,h+2+this.m_oImageData.ShadowOff),i.putImageData(v?this.m_oImageData.White:this.m_oImageData.WhiteT,u+2,h+2),""===S?""!==T&&(i.fillStyle=v?"#000":"rgb(56, 56, 56)",i.fillText(T,u+12-E/2+y,h+12+3)):i.putImageData(v?this.m_oImageData.Triangle_W:this.m_oImageData.Triangle_WT,u+2,h+2)):i.putImageData(v?this.m_oImageData.Triangle:this.m_oImageData.Triangle_T,u+2,h+2);var B=C.Get_NextsCount(),A=C.Get_NextCur();0===p?0===B||(1===B?v?o.putImageData(this.m_oImageData.Hor_Start,u,h):o.putImageData(this.m_oImageData.Hor_Start_T,u,h):v?0==A?o.putImageData(this.m_oImageData.Hor_Start2_T,u,h):o.putImageData(this.m_oImageData.Hor_Start2_T_2,u,h):o.putImageData(this.m_oImageData.Hor_Start2_T_3,u,h)):0===B?v?o.putImageData(this.m_oImageData.Hor_End,u,h):o.putImageData(this.m_oImageData.Hor_End_T,u,h):1===B?v?o.putImageData(this.m_oImageData.Hor,u,h):o.putImageData(this.m_oImageData.Hor_T,u,h):v?0===A?o.putImageData(this.m_oImageData.Hor2_T,u,h):o.putImageData(this.m_oImageData.Hor2_T_2,u,h):o.putImageData(this.m_oImageData.Hor2_T_3,u,h),BOARD_BLACK!==w&&BOARD_WHITE!==w||o.clearRect(u+3,h+3,18,18)}}}}this.m_bNeedRedrawMap=!1}},CDrawingNavigator.prototype.private_DrawCurrentOnTimer=function(){if(this.m_oGameTree){var t=this.m_oImageData.W,e=this.m_oImageData.H;if(!(t<=0||e<=0)){var o=this.m_oGameTree.Get_CurNode().Get_NavigatorInfo(),r=o.X,i=o.Y,a=10+this.m_oOffset.X+24*r,n=10+this.m_oOffset.Y+24*i,s=this.HtmlElement.Current.Control.HtmlElement.getContext("2d");s.clearRect(0,0,t,e),a>=-24&&a<=t+24&&n>=-24&&n<=e+24&&s.putImageData(this.m_oImageData.Current,a,n),this.private_DrawGameCurrentOnTimer(),this.m_bNeedRedrawCurrent=!1}}},CDrawingNavigator.prototype.private_DrawGameCurrentOnTimer=function(){if(this.m_oGameTree){var t=this.m_oImageData.W,e=this.m_oImageData.H;if(!(t<=0||e<=0)){this.m_bNeedRedrawGameCurrent=!1;var o=this.m_oGameTree.Get_CurNode(),r=this.m_oGameTree.Get_GameCurNode();if(null!==r&&r!==o){var i=r.Get_NavigatorInfo(),a=i.X,n=i.Y,s=10+this.m_oOffset.X+24*a,l=10+this.m_oOffset.Y+24*n,m=this.HtmlElement.Current.Control.HtmlElement.getContext("2d");s>=-24&&s<=t+24&&l>=-24&&l<=e+24&&m.putImageData(this.m_oImageData.GameCurrent,s,l)}}}},CDrawingNavigator.prototype.private_GetSettings_TrueColorBoard=function(){return this.m_oGameTree.Get_LocalSettings().Is_NavigatorTrueColorBoard()},CDrawingNavigator.prototype.private_GetSettings_TrueColorStones=function(){return this.m_oGameTree.Get_LocalSettings().Is_NavigatorTrueColorStones()},CDrawingNavigator.prototype.private_GetSettings_Shadows=function(){return this.m_oGameTree.Get_LocalSettings().Is_NavigatorShadows()},CDrawingNavigator.prototype.private_GetSettings_WhiteColor=function(){return this.m_oGameTree.Get_LocalSettings().Get_NavigatorWhiteColor()},CDrawingNavigator.prototype.private_GetSettings_BlackColor=function(){return this.m_oGameTree.Get_LocalSettings().Get_NavigatorBlackColor()},CDrawingNavigator.prototype.private_GetSettings_BoardColor=function(){return this.m_oGameTree.Get_LocalSettings().Get_NavigatorBoardColor()},CDrawingNavigator.prototype.private_GetSettings_LinesColor=function(){return this.m_oGameTree.Get_LocalSettings().Get_NavigatorLinesColor()},CDrawingNavigator.prototype.private_GetSettings_DarkBoard=function(){return this.m_oGameTree.Get_LocalSettings().Is_NavigatorDarkBoard()};var ENavigatorElementType={Empty:-10,Line_Ver:-9,Line_Ver_Con:-8,Line_Ver_End:-7};CNavigatorElement.prototype.Is_Node=function(){return!1},CNavigatorElement.prototype.Get_Type=function(){return this.m_nType},CNavigatorElement.prototype.Get_Next=function(){return this.m_oNext},CNavigatorElement.prototype.Get_Prev=function(){return this.m_oPrev},CNavigatorElement.prototype.Is_OnCurrentVariant=function(){if(ENavigatorElementType.Empty===this.m_nType)return{bResult:!1};if(ENavigatorElementType.Line_Ver===this.m_nType)return this.m_oPrev.Is_OnCurrentVariant()&&this.m_oPrev.Get_NextsCount()>0&&this.m_oPrev.Get_Next().Get_NavigatorInfo().Y>=this.m_oNext.Get_NavigatorInfo().Y?{bResult:!0}:{bResult:!1};if(ENavigatorElementType.Line_Ver_Con===this.m_nType){if(!this.m_oPrev.Is_OnCurrentVariant())return{bResult:!1};var t=this.m_oNext.Get_NavigatorInfo().Y,e=this.m_oPrev.Get_Next().Get_NavigatorInfo().Y;return t<e?{bResult:!0,Temp:0}:t===e?{bResult:!0,Temp:1}:{bResult:!1}}return ENavigatorElementType.Line_Ver_End===this.m_nType?{bResult:this.m_oNext.Is_OnCurrentVariant()}:{bResult:!1}},CNavigatorMap.prototype.Set_GameTree=function(t){this.m_oGameTree=t},CNavigatorMap.prototype.Clear=function(){this.m_oMap=[],this.m_nMove=0},CNavigatorMap.prototype.Create_FromGameTree=function(){this.m_oGameTree&&(this.Clear(),this.Create_FromCurNode(this.m_oGameTree.Get_FirstNode(),0,0))},CNavigatorMap.prototype.Create_FromCurNode=function(t,e,o){for(var r=t.Get_MainVariantLen();!this.private_CheckNodeMainVariant(e,o,r);)o++;this.private_FillNodeMainVariant(t,e,o);var i=t.Get_LastNodeInMainVariant();e+=r-1;for(var a={VY:o};;){for(var n=o,s=this.m_nMove,l=i.Get_NextsCount(),m=1;m<l;m++){this.m_nMove=s;var _=o,h=this.Create_FromCurNode(i.Get_Next(m),e+1,o+1);o=h.Y;for(var d=_+1;d<=o;d++)if(d===h.VY){if(l-1===m){this.Set(e,d,new CNavigatorElement(ENavigatorElementType.Line_Ver_End,i,i.Get_Next(m)));break}this.Set(e,d,new CNavigatorElement(ENavigatorElementType.Line_Ver_Con,i,i.Get_Next(m)))}else d<h.VY?this.Set(e,d,new CNavigatorElement(ENavigatorElementType.Line_Ver,i,i.Get_Next(m))):this.Set(e,d,new CNavigatorElement(ENavigatorElementType.Line_Ver,i,i.Get_Next(m+1)))}if(this.m_nMove=s,i===t)break;i.Have_Move()&&this.m_nMove--,i=i.Get_Prev(),e--,o=n}return a.Y=o,a},CNavigatorMap.prototype.Get=function(t,e){return void 0===this.m_oMap[e]||void 0===this.m_oMap[e][t]?new CNavigatorElement(ENavigatorElementType.Empty,null,null):this.m_oMap[e][t]},CNavigatorMap.prototype.Set=function(t,e,o){void 0===this.m_oMap[e]&&(this.m_oMap[e]=[]),o.Is_Node()&&(o.Have_Move()?(this.m_nMove++,o.Set_NavigatorInfo(t,e,this.m_nMove)):o.Set_NavigatorInfo(t,e,-1)),this.m_oMap[e][t]=o},CNavigatorMap.prototype.Is_Empty=function(t,e){return void 0===this.m_oMap[e]||void 0===this.m_oMap[e][t]||ENavigatorElementType.Empty===this.m_oMap[e][t].Get_Type()},CNavigatorMap.prototype.private_CheckNodeMainVariant=function(t,e,o){for(var r=0;r<o;r++)if(!1===this.Is_Empty(t+r,e))return!1;return!0},CNavigatorMap.prototype.private_FillNodeMainVariant=function(t,e,o){var r=t;for(this.Set(e,o,t);r.Get_NextsCount()>0;)e++,r=r.Get_Next(0),this.Set(e,o,r)},CNavigatorMap.prototype.Get_Height=function(){return this.m_oMap.length},CNavigatorMap.prototype.Get_Width=function(){for(var t=0,e=this.Get_Height(),o=0;o<e;o++){var r=this.Get_LineWidth(o);r>t&&(t=r)}return t},CNavigatorMap.prototype.Get_LineWidth=function(t){return this.m_oMap[t].length-1};var ESlideState={Message:0,Sgf:1};CPresentation.prototype.Init=function(t,e){this.private_LoadSlides(e);var o=this.m_oGameTree,r=CreateControlContainer(t),i=t+"_Board",a=t+"_Message",n=t+"_Next";this.private_CreateDiv(r.HtmlElement,i);var s=this.private_CreateDiv(r.HtmlElement,n),l=this.private_CreateDiv(r.HtmlElement,a);l.style.backgroundColor="rgb(255,255,255)",l.style["border-radius"]="6px",l.style["-webkit-border-radius"]="6px",l.style["-moz-border-radius"]="5px",l.style["-khtml-border-radius"]="10px",l.style.borderColor="#e3e3e3",l.style.borderWidth="5px",l.style.borderStyle="ridge",l.style.display="block";var m=CreateControlContainer(i);m.Bounds.SetParams(0,0,1e3,1e3,!1,!1,!1,!1,-1,-1),m.Anchor=g_anchor_top|g_anchor_left|g_anchor_right|g_anchor_bottom,r.AddControl(m);var _=i+"_Centred";this.private_CreateDiv(m.HtmlElement,_);var h=CreateControlContainer(i);m.Set_Type(2),m.AddControl(h);var d=CreateControlContainer(a);d.Bounds.SetParams(350,350,650,650,!1,!1,!1,!1,-1,-1),d.Anchor=g_anchor_top|g_anchor_left|g_anchor_right|g_anchor_bottom,r.AddControl(d);var p=new CDrawingBoard(this);p.Init(i,o),p.Set_Presentation(this);var u=CreateControlContainer(n);u.Bounds.SetParams(0,0,1e3,1e3,!1,!1,!1,!1,-1,-1),u.Anchor=g_anchor_top|g_anchor_left|g_anchor_right|g_anchor_bottom,r.AddControl(u);var C=n+"_Centred";this.private_CreateDiv(u.HtmlElement,C);var g=CreateControlContainer(C);u.Set_Type(2),u.AddControl(g);var c=C+"_Next",v=this.private_CreateButton(g.HtmlElement,c);v.value="Далее",v.style.display="none";var f=C+"_Prev",w=this.private_CreateButton(g.HtmlElement,f);w.value="Назад",w.style.display="none";var S=this;v.addEventListener("click",function(){S.HtmlElement.NextSgf.style.display="none",S.HtmlElement.PrevSgf.style.display="none",S.private_NextStep()},!1),w.addEventListener("click",function(){S.HtmlElement.NextSgf.style.display="none",S.HtmlElement.PrevSgf.style.display="none",S.private_PrevStep()},!1);var T=CreateControlContainer(c);T.Bounds.SetParams(501,0,2,2,!1,!1,!0,!0,-1,25),T.Anchor=g_anchor_left|g_anchor_right|g_anchor_bottom,g.AddControl(T);var y=CreateControlContainer(f);y.Bounds.SetParams(2,0,499,2,!0,!1,!1,!0,-1,25),y.Anchor=g_anchor_left|g_anchor_right|g_anchor_bottom,g.AddControl(y);var D=a+"_Text",E=a+"_Next",B=a+"_Prev",A=this.private_CreateDiv(l,D);A.style.fontFamily="verdana",A.style.textAlign="justify",A.style.alignItems="center",A.style.overflowY="scroll";var b=this.private_CreateButton(l,E),G=this.private_CreateButton(l,B);G.addEventListener("click",function(){S.private_PrevStep()},!1),b.addEventListener("click",function(){S.private_NextStep()},!1);var M=CreateControlContainer(D);M.Bounds.SetParams(0,0,1e3,35,!1,!1,!1,!0,-1,-1),M.Anchor=g_anchor_top|g_anchor_left|g_anchor_bottom|g_anchor_right,d.AddControl(M);var H=CreateControlContainer(E);H.Bounds.SetParams(0,0,5,5,!1,!1,!0,!0,100,25),H.Anchor=g_anchor_bottom|g_anchor_right,d.AddControl(H);var I=CreateControlContainer(B);I.Bounds.SetParams(5,0,0,5,!0,!1,!1,!0,100,25),I.Anchor=g_anchor_bottom|g_anchor_left,d.AddControl(I),this.HtmlElement.MessageElement=l,this.HtmlElement.TextElement=A,this.HtmlElement.PrevButton=G,this.HtmlElement.NextButton=b,this.HtmlElement.NextSgf=v,this.HtmlElement.PrevSgf=w,this.HtmlElement.BoardDisabler=s,this.m_aElements.push(p),this.m_oControl=r,this.Update_Size(),this.private_GoToStep(0,0)},CPresentation.prototype.Update_Size=function(t){if(this.m_oControl){var e=this.m_oControl.HtmlElement.clientWidth,o=this.m_oControl.HtmlElement.clientHeight;this.m_oControl.Resize(e,o)}for(var r=0,i=this.m_aElements.length;r<i;r++)this.m_aElements[r].Update_Size(t)},CPresentation.prototype.Get_NodesCountInSlide=function(){return null===this.m_aSlides[this.m_nCurSlide].SgfPr||void 0===this.m_aSlides[this.m_nCurSlide].SgfPr.Count?0:this.m_aSlides[this.m_nCurSlide].SgfPr.Count},CPresentation.prototype.On_EndSgfSlide=function(){null!==this.m_aSlides[this.m_nCurSlide].SgfPr&&!0===this.m_aSlides[this.m_nCurSlide].SgfPr.WaitOnEnd?(this.HtmlElement.BoardDisabler.style.display="block",this.HtmlElement.NextSgf.style.display="block",this.HtmlElement.PrevSgf.style.display="block"):this.private_GoToPresentationStep(this.m_nCurSlide,2)},CPresentation.prototype.Register_Board=function(t){},CPresentation.prototype.Update_Comments=function(t){},CPresentation.prototype.Update_InterfaceState=function(){},CPresentation.prototype.Update_BlackName=function(){},CPresentation.prototype.Update_WhiteName=function(){},CPresentation.prototype.Update_BlackRank=function(){},CPresentation.prototype.Update_WhiteRank=function(){},CPresentation.prototype.Update_PassCount=function(){},CPresentation.prototype.On_StopAutoPlay=function(){},CPresentation.prototype.On_StartAutoPlay=function(){},CPresentation.prototype.private_LoadSlides=function(t){var e=t.length;this.m_nSlidesCount=e,this.m_aSlides=[];for(var o=0;o<e;o++)this.m_aSlides[o]={},this.m_aSlides[o].Sgf=t[o].Sgf,this.m_aSlides[o].Before=t[o].Before,this.m_aSlides[o].After=t[o].After,this.m_aSlides[o].Message=t[o].Message,null===t[o].SgfPr?this.m_aSlides[o].SgfPr=null:(this.m_aSlides[o].SgfPr={},this.m_aSlides[o].SgfPr.Count=t[o].SgfPr.Count,this.m_aSlides[o].SgfPr.WaitOnEnd=t[o].SgfPr.WaitOnEnd,this.m_aSlides[o].SgfPr.Flags={},t[o].SgfPr.Flags&&(this.m_aSlides[o].SgfPr.Flags.NewNode=t[o].SgfPr.Flags.NewNode,this.m_aSlides[o].SgfPr.Flags.Move=t[o].SgfPr.Flags.Move,this.m_aSlides[o].SgfPr.Flags.ChangeBoardMode=t[o].SgfPr.Flags.ChangeBoardMode,this.m_aSlides[o].SgfPr.Flags.LoadFile=t[o].SgfPr.Flags.LoadFile))},CPresentation.prototype.private_NextStep=function(){var t=this.m_nCurSlide;if(ESlideState.Message===this.m_nSlideState)null!==this.m_aSlides[t].Sgf?this.private_GoToStep(t,ESlideState.Sgf):(this.m_nSlideState=ESlideState.Sgf,this.private_NextStep());else if(ESlideState.Sgf===this.m_nSlideState){if(t>=this.m_nSlidesCount-1)return;null!==this.m_aSlides[t+1].Message?this.private_GoToStep(t+1,ESlideState.Message):(this.m_nCurSlide++,this.m_nSlideState=ESlideState.Message,this.private_NextStep())}},CPresentation.prototype.private_PrevStep=function(){var t=this.m_nCurSlide;if(ESlideState.Message===this.m_nSlideState){if(t<=0)return;null!==this.m_aSlides[t-1].Sgf?this.private_GoToStep(t-1,ESlideState.Sgf):(this.m_nCurSlide--,this.m_nSlideState=ESlideState.Sgf,this.private_PrevStep())}else ESlideState.Sgf===this.m_nSlideState&&(null!==this.m_aSlides[t].Message?this.private_GoToStep(t,ESlideState.Message):(this.m_nSlideState=ESlideState.Message,this.private_PrevStep()))},CPresentation.prototype.private_GoToStep=function(t,e){if(!(t<0||t>=this.m_nSlidesCount)){this.m_nCurSlide=t,this.m_nSlideState=e;var o=this.m_aSlides[t].Sgf,r=this.m_aSlides[t].SgfPr,i=this.m_aSlides[t].Message;ESlideState.Message===e?(this.HtmlElement.BoardDisabler.style.display="block",null!==i?this.private_ShowMessage(i,0===t?null:"Назад",t===this.m_nSlidesCount-1&&null===o?null:"Далее"):this.private_NextStep()):ESlideState.Sgf===e&&(this.HtmlElement.BoardDisabler.style.display="none",null!==o?(this.private_HideMessage(),this.m_oGameTree.Reset_EditingFlags(),this.m_oGameTree.Load_Sgf(o),this.m_oGameTree.Set_EditingFlags(r.Flags),this.m_oGameTree.Focus()):this.private_NextStep())}},CPresentation.prototype.private_CreateDiv=function(t,e){var o=document.createElement("div");return o.setAttribute("id",e),o.setAttribute("style","position:absolute;padding:0;margin:0;"),o.setAttribute("oncontextmenu","return false;"),t.appendChild(o),o},CPresentation.prototype.private_CreateButton=function(t,e){var o=document.createElement("input");return o.setAttribute("id",e),o.setAttribute("style","position:absolute;padding:0;margin:0;"),o.setAttribute("type","button"),t.appendChild(o),o},CPresentation.prototype.private_ShowMessage=function(t,e,o){var r=this.HtmlElement.PrevButton,i=this.HtmlElement.NextButton;for(this.HtmlElement.MessageElement.style.display="block";this.HtmlElement.TextElement.firstChild;)this.HtmlElement.TextElement.removeChild(this.HtmlElement.TextElement.firstChild);Common.Set_InnerTextToElement(this.HtmlElement.TextElement,""),"string"==typeof t?Common.Set_InnerTextToElement(this.HtmlElement.TextElement,t):this.HtmlElement.TextElement.appendChild(t),null===e?r.style.display="none":(r.style.display="block",r.value=e),null===o?i.style.display="none":(i.style.display="block",i.value=o)},CPresentation.prototype.private_HideMessage=function(){this.HtmlElement.MessageElement.style.display="none"};var EDrawingSliderType={Unknown:0,AutoPlaySpeed:0,Timeline:1};CDrawingSlider.prototype.Init=function(t){switch(this.m_oGameTree=this.m_oDrawing?this.m_oDrawing.Get_GameTree():null,this.m_nType){case EDrawingSliderType.AutoPlaySpeed:this.m_oDrawing.Register_AutoPlaySpeed(this);break;case EDrawingSliderType.Timeline:this.m_oDrawing.Register_TimeLine(this)}this.HtmlElement.Control=CreateControlContainer(t);var e=this.HtmlElement.Control.HtmlElement;e.style.backgroundColor=this.m_oBackColor.ToString(),e.style.textDecorationColor=new CColor(255,255,255,255).ToString();var o=t+"_Left",r=t+"_Right",i=t+"_Slider";this.HtmlElement.Right=this.private_CreateDivElement(e,r),this.HtmlElement.Left=this.private_CreateDivElement(e,o),this.HtmlElement.Slider=this.private_CreateDivElement(e,i);var a=this;this.HtmlElement.Slider.onmouseover=function(){this.style.backgroundColor=a.m_oSliderFocusColor.ToString()},this.HtmlElement.Slider.onmouseout=function(){this.style.backgroundColor=a.m_oSliderColor.ToString()};var n=CreateControlContainer(r);n.Bounds.SetParams(this.m_nOffsetX,this.m_nOffsetY-1,this.m_nOffsetX,this.m_nOffsetY-1,!0,!0,!0,!0,-1,-1),n.Anchor=g_anchor_top|g_anchor_left|g_anchor_bottom|g_anchor_right,this.HtmlElement.Control.AddControl(n),n.HtmlElement.style.background=this.m_oRightColor.ToString();var s=CreateControlContainer(o);s.Bounds.SetParams(this.m_nOffsetX,this.m_nOffsetY,500,this.m_nOffsetY,!0,!0,!1,!0,-1,-1),s.Anchor=g_anchor_top|g_anchor_left|g_anchor_bottom|g_anchor_right,this.HtmlElement.Control.AddControl(s),s.HtmlElement.style.background=this.m_oLeftColor.ToString(),this.Update_Size(),this.private_UpdatePos(0)},CDrawingSlider.prototype.Update_Size=function(){var t=this.HtmlElement.Control.HtmlElement.clientWidth,e=this.HtmlElement.Control.HtmlElement.clientHeight;this.m_nW=t-2*this.m_nOffsetX,this.HtmlElement.Control.Resize(t,e),this.private_OnResize(t,e),this.private_UpdatePos(this.m_dPos,!0)},CDrawingSlider.prototype.Update_Pos=function(t){!0!==this.m_bPosLock&&this.private_UpdatePos(t,!0)},CDrawingSlider.prototype.private_OnResize=function(t,e){var o=32;switch(this.m_nType){case EDrawingSliderType.AutoPlaySpeed:o=45;break;case EDrawingSliderType.Timeline:o=32}this.m_nSize=o;var r=this.HtmlElement.Slider;r.style.width=o+"px",r.style.height="12px",r.style.display="block",r.style.position="absolute",r.style.backgroundColor=this.m_oSliderColor.ToString(),r.style.top=this.m_nOffsetY-5+"px",r.style.left=this.m_nOffsetX+"px",r.style.borderRadius="5px",Common_DragHandler.Init(r,null,this.m_nOffsetX,t-this.m_nOffsetX-o,this.m_nOffsetY-5,this.m_nOffsetY-5),r.onDrag=this.private_OnDrag,r.onDragStart=this.private_OnDragStart,r.onDragEnd=this.private_OnDragEnd,r.style.fontSize="12px",r.style.lineHeight="12px",r.style.color="rgb(255,255,255)",r.style.textOverflow="clip",r.style.overflow="hidden",r.style.textAlign="center",r.style.cursor="default",r.style.transitionProperty="background",r.style.transitionDuration="0.25s",r.style.fontFamily='"Times New Roman", Times, serif'},CDrawingSlider.prototype.private_CreateDivElement=function(t,e){var o=document.createElement("div");return o.setAttribute("id",e),o.setAttribute("style","position:absolute;padding:0;margin:0;"),o.setAttribute("oncontextmenu","return false;"),t.appendChild(o),o},CDrawingSlider.prototype.private_UpdatePos=function(t,e){this.m_dPos=Math.min(1,Math.max(t,0));var o=this.m_dPos*this.m_nW;if(this.HtmlElement.Left.style.width=o+"px",!1!==e){var r=this.m_dPos*(this.m_nW-this.m_nSize);this.HtmlElement.Slider.style.left=r+this.m_nOffsetX+"px"}},CDrawingSlider.prototype.private_HandleOnChange=function(t){if(this.m_oGameTree)switch(this.m_nType){case EDrawingSliderType.AutoPlaySpeed:if(this.m_oGameTree.Set_AutoPlaySpeed(this.m_dPos),t)Common.Set_InnerTextToElement(this.HtmlElement.Slider,"");else{var e=(this.m_oGameTree.Get_AutoPlayInterval()/1e3*1e3|0)/1e3;Common.Set_InnerTextToElement(this.HtmlElement.Slider,e+" s")}break;case EDrawingSliderType.Timeline:this.m_oGameTree.GoTo_NodeByTimeLine(this.m_dPos)}},CBoardSound.prototype.Init=function(t,e){var o=document.getElementsByTagName("body");if(!(o.length<=0)){this.m_bOn=!0,"IE"===Common.Get_Browser()&&(this.m_bIE=!0);var r=o[0];this.PlaceStone=this.private_AddSound(r,"RenjuBoardApiSoundPlaceStone",t+"/Stone.mp3"),this.NewMessage=this.private_AddSound(r,"RenjuBoardApiSoundNewMessage",t+"/NewMessage.mp3"),this.Tick=this.private_AddSound(r,"RenjuBoardApiSoundTick","/Src/Files/Tick.ogg"),this.TickLast3=this.private_AddSound(r,"RenjuBoardApiSoundTickLast3","/Src/Files/TickLast3.ogg"),this.Beep=this.private_AddSound(r,"RenjuBoardApiSoundBeep","/Src/Files/Beep.wav"),this.BeepBeep=this.private_AddSound(r,"RenjuBoardApiSoundBeepBeep","/Src/Files/BeepBeep.wav"),this.Challenger=this.private_AddSound(r,"RenjuBoardApiSoundChallenger","/Src/Files/Challenger.wav")}},CBoardSound.prototype.Play_PlaceStone=function(){this.private_PlaySound(this.PlaceStone)},CBoardSound.prototype.Play_NewMessage=function(){this.private_PlaySound(this.NewMessage)},CBoardSound.prototype.On=function(){this.m_bOn=!0},CBoardSound.prototype.Off=function(){this.m_bOn=!1},CBoardSound.prototype.private_AddSound=function(t,e,o){var r=document.getElementById(e);return r||((r=document.createElement("audio")).id=e,r.preload="preload",r.src=o,t.appendChild(r)),r},CBoardSound.prototype.private_PlaySound=function(t){if(t&&this.m_bOn&&g_oGlobalSettings.Is_SoundOn())try{this.m_bIE?(t.setActive(),t.click(),t.autoplay="",t.autoplay="autoplay"):t.play()}catch(t){}},CBoardSound.prototype.private_PlayCountDown=function(t){t>3?this.private_PlaySound(this.Tick):3===t&&this.private_PlaySound(this.TickLast3)},CBoardSound.prototype.PlayCountDown=function(t,e){null===this.PrevCountDownTime&&Math.abs(t-parseInt(t))>.1||t<e+1.05&&(null===this.PrevCountDownTime||t>this.PrevCountDownTime||Math.abs(this.PrevCountDownTime-t)>.99)&&(this.PrevCountDownTime=t,this.private_PlayCountDown(parseInt(t+.5)))},CBoardSound.prototype.ResetCountDown=function(){this.PrevCountDownTime=null},CBoardSound.prototype.StopCountDown=function(){this.Tick.pause(),this.Tick.currentTime=0,this.TickLast3.pause(),this.TickLast3.currentTime=0},CBoardSound.prototype.PlayBeep=function(){this.private_PlaySound(this.Beep)},CBoardSound.prototype.PlayBeepBeep=function(){this.private_PlaySound(this.BeepBeep)},CBoardSound.prototype.PlayChallenger=function(){this.private_PlaySound(this.Challenger)},CDrawingToolbar.prototype.Add_Control=function(t,e,o,r){this.m_aDrawingControls.push(new CDrawingToolbarItem(t,e,o,r))},CDrawingToolbar.prototype.Init=function(t,e){this.m_oGameTree=e,this.HtmlElement.Control=CreateControlContainer(t);var o=this.HtmlElement.Control.HtmlElement,r=this.HtmlElement.Control;o.style.backgroundColor=this.m_oBColor.ToString();for(var i=0,a=0,n=0,s=this.m_aDrawingControls.length;n<s;++n){var l=this.m_aDrawingControls[n],m=l.Get_Control();if(null!==m){var _=t+n;this.private_CreateDivElement(o,_),EToolbarFloat.Left===l.Get_Align()?(this.private_FillHtmlElement(r,_,i,l.Get_W(),!0),i+=l.Get_W()+l.Get_Space()):(this.private_FillHtmlElement(r,_,a,l.Get_W(),!1),a+=l.Get_W()+l.Get_Space()),m.Init(_,e),this.m_aControls.push(m)}}this.Update_Size()},CDrawingToolbar.prototype.Update_Size=function(){var t=this.HtmlElement.Control.HtmlElement.clientWidth,e=this.HtmlElement.Control.HtmlElement.clientHeight;this.HtmlElement.Control.Resize(t,e);for(var o=0,r=this.m_aControls.length;o<r;o++)this.m_aControls[o].Update_Size()},CDrawingToolbar.prototype.Get_MinWidth=function(){for(var t=0,e=0,o=this.m_aDrawingControls.length;e<o;++e){var r=this.m_aDrawingControls[e],i=r.Get_W();-1===i&&(i=16777215),t+=i+r.Get_Space()}return t},CDrawingToolbar.prototype.private_CreateDivElement=function(t,e){var o=document.createElement("div");return o.setAttribute("id",e),o.setAttribute("style","position:absolute;padding:0;margin:0;"),o.setAttribute("oncontextmenu","return false;"),t.appendChild(o),o},CDrawingToolbar.prototype.private_FillHtmlElement=function(t,e,o,r,i){var a=CreateControlContainer(e);i?(a.Bounds.SetParams(o,0,1e3,1e3,!0,!1,!1,!1,r,-1),a.Anchor=g_anchor_top|g_anchor_left|g_anchor_bottom):(a.Bounds.SetParams(0,0,o,1e3,!1,!1,!0,!1,r,-1),a.Anchor=g_anchor_top|g_anchor_right|g_anchor_bottom),t.AddControl(a)},CDrawingNavigatorCommentsTabs.prototype.Init=function(t,e,o,r){this.m_oGameTree=e,this.HtmlElement.Control=CreateControlContainer(t);var i=this.HtmlElement.Control.HtmlElement,a=this.HtmlElement.Control;i.style.backgroundColor=this.m_oBColor.ToString();var n=new CDrawingButtonTabComments(this.m_oDrawing),s=t+"C";this.private_CreateDivElement(i,s),this.private_FillHtmlElement(a,s,0),n.Init(s,e),this.m_oCommentsButton=n;var l=new CDrawingButtonTabNavigator(this.m_oDrawing),m=t+"N";this.private_CreateDivElement(i,m),this.private_FillHtmlElement(a,m,1),l.Init(m,e),this.m_oNavigatorButton=l,this.m_oNavigatorButton.m_oParent=this,this.m_oCommentsButton.m_oParent=this,this.m_oNavigatorDiv=document.getElementById(o),this.m_oCommentsDiv=document.getElementById(r),this.Select(this.m_oCommentsButton),this.Update_Size()},CDrawingNavigatorCommentsTabs.prototype.Update_Size=function(){var t=this.HtmlElement.Control.HtmlElement.clientWidth,e=this.HtmlElement.Control.HtmlElement.clientHeight;this.HtmlElement.Control.Resize(t,e),this.m_oNavigatorButton.Update_Size(),this.m_oCommentsButton.Update_Size()},CDrawingNavigatorCommentsTabs.prototype.private_CreateDivElement=function(t,e){var o=document.createElement("div");return o.setAttribute("id",e),o.setAttribute("style","position:absolute;padding:0;margin:0;"),o.setAttribute("oncontextmenu","return false;"),t.appendChild(o),o},CDrawingNavigatorCommentsTabs.prototype.private_FillHtmlElement=function(t,e,o){var r=CreateControlContainer(e);r.Bounds.SetParams(0,36*o+o,1e3,0,!1,!0,!1,!1,-1,36),r.Anchor=g_anchor_top|g_anchor_left|g_anchor_right,t.AddControl(r)},CDrawingNavigatorCommentsTabs.prototype.Select=function(t){t===this.m_oNavigatorButton?(this.m_oNavigatorButton.Set_Selected(!0),this.m_oCommentsButton.Set_Selected(!1),this.m_oNavigatorDiv.style.visibility="visible",this.m_oCommentsDiv.style.visibility="hidden"):t===this.m_oCommentsButton?(this.m_oNavigatorButton.Set_Selected(!1),this.m_oCommentsButton.Set_Selected(!0),this.m_oNavigatorDiv.style.visibility="hidden",this.m_oCommentsDiv.style.visibility="visible"):(this.m_oNavigatorButton.Set_Selected(!1),this.m_oCommentsButton.Set_Selected(!1),this.m_oNavigatorDiv.style.visibility="hidden",this.m_oCommentsDiv.style.visibility="hidden")};var EToolbarFloat={Left:1,Right:2};CDrawingToolbarItem.prototype.Get_Control=function(){return this.m_oControl},CDrawingToolbarItem.prototype.Get_W=function(){return this.m_nW},CDrawingToolbarItem.prototype.Get_Space=function(){return this.m_nSpace},CDrawingToolbarItem.prototype.Get_Align=function(){return this.m_eAlign},CDrawingMultiLevelToolbar.prototype.Init=function(t){this.HtmlElement.Control=CreateControlContainer(t);var e=this.HtmlElement.Control.HtmlElement,o=this.HtmlElement.Control,r=t+"SS",i=t+"GN",a=t+"TN",n=t+"GL",s=t+"AP",l=t+"TL",m=t+"KF";this.HtmlElement.SettingsElement=Common.Create_DivElement(e,r),this.HtmlElement.GeneralNavigationElement=Common.Create_DivElement(e,i),this.HtmlElement.TreeNavigationElement=Common.Create_DivElement(e,a),this.HtmlElement.GeneralElement=Common.Create_DivElement(e,n),this.HtmlElement.AutoPlayElement=Common.Create_DivElement(e,s),this.HtmlElement.TimelineElement=Common.Create_DivElement(e,l),this.HtmlElement.KifuModeElement=Common.Create_DivElement(e,m),this.HtmlElement.SettingsControl=CreateControlContainer(r),o.AddControl(this.HtmlElement.SettingsControl),this.m_oSettingsToolbar.Init(r,this.m_oDrawing.Get_GameTree()),this.HtmlElement.GeneralNavigationControl=CreateControlContainer(i),o.AddControl(this.HtmlElement.GeneralNavigationControl),this.m_oGeneralNavigation.Init(i,this.m_oDrawing.Get_GameTree()),this.HtmlElement.TreeNavigationControl=CreateControlContainer(a),o.AddControl(this.HtmlElement.TreeNavigationControl),this.m_oTreeNavigation.Init(a,this.m_oDrawing.Get_GameTree()),this.HtmlElement.GeneralControl=CreateControlContainer(n),o.AddControl(this.HtmlElement.GeneralControl),this.m_oGeneralToolbar.Init(n,this.m_oDrawing.Get_GameTree()),this.HtmlElement.AutoPlayControl=CreateControlContainer(s),o.AddControl(this.HtmlElement.AutoPlayControl),this.m_oAutoPlayToolbar.Init(s,this.m_oDrawing.Get_GameTree()),this.HtmlElement.TimelineControl=CreateControlContainer(l),o.AddControl(this.HtmlElement.TimelineControl),this.m_oTimelineToolbar.Init(l,this.m_oDrawing.Get_GameTree()),this.HtmlElement.KifuModeControl=CreateControlContainer(m),o.AddControl(this.HtmlElement.KifuModeControl),this.m_oKifuToolbar.Init(m,this.m_oDrawing.Get_GameTree()),this.private_UpdateElements(),this.private_UpdateControls()},CDrawingMultiLevelToolbar.prototype.Get_Height=function(){var t=Math.max(this.m_nLevelsCount,1);return t*this.m_nLineHeight+(t-1)*this.m_nLineSpace},CDrawingMultiLevelToolbar.prototype.Update_Size=function(t){var e=this.HtmlElement.Control.HtmlElement.clientWidth,o=this.HtmlElement.Control.HtmlElement.clientHeight;if(e!==this.m_nW||o!==this.m_nH||!0===t){this.m_nW=e,this.m_nH=o,this.private_Update(),this.HtmlElement.Control.Resize(e,o),this.m_oSettingsToolbar.Update_Size();for(var r=0,i=this.m_aElements.length;r<i;++r)this.m_aElements[r].Update_Size()}},CDrawingMultiLevelToolbar.prototype.Set_OnChangeCallback=function(t){this.m_pOnChangeCallback=t},CDrawingMultiLevelToolbar.prototype.Set_MainNavigation=function(t){this.m_bGeneralNavigation=t,this.private_Update(),this.Update_Size(!0)},CDrawingMultiLevelToolbar.prototype.Set_TreeNavigation=function(t){this.m_bTreeNavigation=t,this.private_Update(),this.Update_Size(!0)},CDrawingMultiLevelToolbar.prototype.Set_General=function(t){this.m_bGeneralToolbar=t,this.private_Update(),this.Update_Size(!0)},CDrawingMultiLevelToolbar.prototype.Set_AutoPlay=function(t){this.m_bAutoPlayToolbar=t,this.private_Update(),this.Update_Size(!0)},CDrawingMultiLevelToolbar.prototype.Set_Timeline=function(t){this.m_bTimelimeToolbar=t,this.private_Update(),this.Update_Size(!0)},CDrawingMultiLevelToolbar.prototype.Set_KifuMode=function(t){this.m_bKifuModeToolbar=t,this.private_Update(),this.Update_Size(!0)},CDrawingMultiLevelToolbar.prototype.private_Update=function(){this.private_UpdateElements(),this.private_UpdateControls(),this.m_pOnChangeCallback&&this.m_pOnChangeCallback()},CDrawingMultiLevelToolbar.prototype.private_UpdateElements=function(){this.m_aElements=[],this.private_UpdateElement(this.m_bGeneralNavigation,this.m_oGeneralNavigation,this.HtmlElement.GeneralNavigationElement),this.private_UpdateElement(this.m_bTreeNavigation,this.m_oTreeNavigation,this.HtmlElement.TreeNavigationElement),this.private_UpdateElement(this.m_bGeneralToolbar,this.m_oGeneralToolbar,this.HtmlElement.GeneralElement),this.private_UpdateElement(this.m_bAutoPlayToolbar,this.m_oAutoPlayToolbar,this.HtmlElement.AutoPlayElement),this.private_UpdateElement(this.m_bTimelimeToolbar,this.m_oTimelineToolbar,this.HtmlElement.TimelineElement),this.private_UpdateElement(this.m_bKifuModeToolbar,this.m_oKifuToolbar,this.HtmlElement.KifuModeElement)},CDrawingMultiLevelToolbar.prototype.private_UpdateElement=function(t,e,o){!0===t?(this.m_aElements.push(e),o.style.display="block"):o.style.display="none"},CDrawingMultiLevelToolbar.prototype.private_UpdateControls=function(){var t=this.HtmlElement.Control.HtmlElement.clientWidth;this.m_nLevelsCount=1;var e=this.HtmlElement.SettingsControl;e.Bounds.SetParams(0,0,0,1e3,!1,!0,!0,!1,this.m_nSettingsWidth,this.m_nLineHeight),e.Anchor=g_anchor_top|g_anchor_right;for(var o=t-this.m_oSettingsToolbar.Get_MinWidth(),r=0,i=0,a=0,n=this.m_aElements.length;a<n;++a){var s=this.m_aElements[a],l=s.Get_MinWidth(),m=this.private_GetHtmlControlByControl(s);m&&(r<=.1||r+l<o?(m.Bounds.SetParams(r,i,1e3,1e3,!0,!0,!0,!1,Math.min(l,o),this.m_nLineHeight),m.Anchor=g_anchor_top|g_anchor_left,r+=l):(o=t,this.m_nLevelsCount++,r=0,i+=this.m_nLineHeight+this.m_nLineSpace,m.Bounds.SetParams(r,i,1e3,1e3,!0,!0,!0,!1,Math.min(l,o-r),this.m_nLineHeight),m.Anchor=g_anchor_top|g_anchor_left,r+=l))}},CDrawingMultiLevelToolbar.prototype.private_GetHtmlControlByControl=function(t){var e=null;return t===this.m_oGeneralNavigation?e=this.HtmlElement.GeneralNavigationControl:t===this.m_oTreeNavigation?e=this.HtmlElement.TreeNavigationControl:t===this.m_oGeneralToolbar?e=this.HtmlElement.GeneralControl:t===this.m_oAutoPlayToolbar?e=this.HtmlElement.AutoPlayControl:t===this.m_oTimelineToolbar?e=this.HtmlElement.TimelineControl:t===this.m_oKifuToolbar&&(e=this.HtmlElement.KifuModeControl),e},CDrawingVerticalTabs.prototype.Init=function(t,e,o,r){var i=r||200,a=document.getElementById(t),n=document.createElement("div");n.style.position="absolute",n.style.left="0px",n.style.top="0px",n.style.bottom="0px",n.style.width=i-1+"px",n.style.borderRight="1px solid #cbcbcb",a.appendChild(n);var s=document.createElement("div");s.style.position="absolute",s.style.left=i+"px",s.style.top="0px",s.style.bottom="0px",s.style.right="0px",a.appendChild(s);for(var l=0,m=e.length;l<m;l++)this.private_CreateTabHeader(n,e[l],s);var _=this.m_aTabs[o||0];_&&this.private_SelectTab(_)},CDrawingVerticalTabs.prototype.Get_TabContent=function(t){return this.m_aContens[t]},CDrawingVerticalTabs.prototype.private_CreateTabHeader=function(t,e,o){var r=document.createElement("div");t.appendChild(r),r.style.color="rgb(68, 68, 68)";var i=this;r.addEventListener("mouseenter",function(){i.m_oCurTab!==this&&(this.style.backgroundColor="rgb(241, 241, 241)")},!1),r.addEventListener("mouseleave",function(){i.m_oCurTab!==this&&(this.style.backgroundColor="")},!1),r.addEventListener("click",function(){i.private_SelectTab(this)},!1);var a=document.createElement("div");r.appendChild(a),a.style.padding="7px 2px 7px 20px";var n=document.createElement("div");a.appendChild(n),n.style["-webkit-user-select"]="none",n.style.borderCollapse="collapse",n.style.boxSizing="border-box",n.style.cursor="pointer",n.style.display="block",n.style.fontFamily="Helvetica Neue', Helvetica, Arial, sans-serif",n.style.fontSize="16px",n.style.height="17px",n.style.lineHeight="17.142858505249px",n.style.width="177px",Common.Set_InnerTextToElement(n,e),(n=document.createElement("div")).style.display="none",n.style.width="100%",n.style.height="100%",o.appendChild(n),this.m_aContens.push(n),this.m_aTabs.push(r)},CDrawingVerticalTabs.prototype.private_SelectTab=function(t){if(this.m_oCurTab!==t){if(null!==this.m_oCurTab){this.m_oCurTab.style.backgroundColor="",this.m_oCurTab.style.color="rgb(68, 68, 68)";var e=this.private_GetTabIndex(this.m_oCurTab);this.m_aContens[e]&&(this.m_aContens[e].style.display="none")}this.m_oCurTab=t,t.style.backgroundColor="#7d858c",t.style.color="#fff";var o=this.private_GetTabIndex(this.m_oCurTab);this.m_aContens[o]&&(this.m_aContens[o].style.display="block")}},CDrawingVerticalTabs.prototype.private_GetTabIndex=function(t){for(var e=0,o=this.m_aTabs.length;e<o;e++)if(t===this.m_aTabs[e])return e;return-1},CDrawingWindow.prototype.Init=function(t,e){function o(){global_mouseEvent.LockMouse()}function r(){global_mouseEvent.UnLockMouse()}var i=this;this.m_bVisible=!0,this.m_sWindowId=t,this.HtmlElement.Control=CreateControlContainer(t);var a=this.HtmlElement.Control.HtmlElement,n=this.HtmlElement.Control;a.style.border="1px solid "+this.m_oOuterBorderColor.ToString(),a.style.backgroundColor=this.m_oBackColor.ToString(),a.style.boxSizing="content-box",a.style.boxShadow="0px 1px 15px rgba(0,0,0,0.8)",a.addEventListener("mousedown",function(){i.private_OnFocus()},!1);var s=t+"_Inner",l=this.protected_CreateDivElement(a,s),m=CreateControlContainer(s);m.Bounds.SetParams(6,29,8,8,!0,!0,!0,!0,-1,-1),m.Anchor=g_anchor_top|g_anchor_left|g_anchor_bottom|g_anchor_right,n.AddControl(m),l.style.border="1px solid "+this.m_oInnerBorderColor.ToString(),l.style.backgroundColor=new CColor(255,255,255,255).ToString(),l.style.overflow="hidden",this.HtmlElement.InnerDiv=l,this.HtmlElement.InnerControl=m;var _=t+"_Caption",h=(this.protected_CreateDivElement(a,_),CreateControlContainer(_));h.Bounds.SetParams(0,0,1e3,1e3,!1,!1,!1,!1,-1,30),h.Anchor=g_anchor_top|g_anchor_left|g_anchor_right,n.AddControl(h);var d=_+"_Text",p=this.protected_CreateDivElement(a,d),u=CreateControlContainer(d);u.Bounds.SetParams(15,0,55,1e3,!0,!1,!0,!1,-1,30),u.Anchor=g_anchor_top|g_anchor_left|g_anchor_right|g_anchor_bottom,h.AddControl(u),p.style.fontFamily="Tahoma, Sans serif",p.style.fontSize="13pt",p.style.textAlign="center",p.style.height="29px",p.style.lineHeight="29px",p.style.overflow="hidden",p.style.textOverflow="ellipsis",p.style["-o-text-overflow"]="ellipsis",p.style.cursor="default",Common.Set_InnerTextToElement(p,"Caption"),this.HtmlElement.CaptionText=p,this.HtmlElement.CaptionTextControl=u;var C=t+"_Caption2",g=this.protected_CreateDivElement(a,C),c=CreateControlContainer(C);if(c.Bounds.SetParams(0,0,1e3,1e3,!1,!1,!1,!1,-1,30),c.Anchor=g_anchor_top|g_anchor_left|g_anchor_right,n.AddControl(c),this.HtmlElement.Caption=g,Common_DragHandler.Init(g,null),g.onDrag=function(t,e){var o=parseInt(i.HtmlElement.Control.HtmlElement.style.left),r=parseInt(i.HtmlElement.Control.HtmlElement.style.top),a=parseInt(i.HtmlElement.Caption.style.left),n=parseInt(i.HtmlElement.Caption.style.top);i.HtmlElement.Control.HtmlElement.style.left=o+a+"px",i.HtmlElement.Control.HtmlElement.style.top=r+n+"px",i.HtmlElement.Caption.style.left="0px",i.HtmlElement.Caption.style.top="0px",i.Update_Size()},g.onDragStart=o,g.onDragEnd=r,!1!==e){var v=t+"_LeftHandler",f=this.protected_CreateDivElement(a,v),w=CreateControlContainer(v);w.Bounds.SetParams(0,6,1e3,6,!1,!0,!1,!0,6,-1),w.Anchor=g_anchor_top|g_anchor_left|g_anchor_bottom,n.AddControl(w),f.style.cursor="w-resize",this.HtmlElement.HandlerL=f;var S=t+"_RightHandler",T=this.protected_CreateDivElement(a,S),y=CreateControlContainer(S);y.Bounds.SetParams(0,6,0,6,!1,!0,!0,!0,6,-1),y.Anchor=g_anchor_top|g_anchor_right|g_anchor_bottom,n.AddControl(y),T.style.cursor="w-resize",this.HtmlElement.HandlerR=T;var D=t+"_BottomHandler",E=this.protected_CreateDivElement(a,D),B=CreateControlContainer(D);B.Bounds.SetParams(6,0,6,0,!0,!1,!0,!0,-1,6),B.Anchor=g_anchor_bottom|g_anchor_right|g_anchor_left,n.AddControl(B),E.style.cursor="s-resize",this.HtmlElement.HandlerB=E;var A=t+"_TopHandler",b=this.protected_CreateDivElement(a,A),G=CreateControlContainer(A);G.Bounds.SetParams(6,0,6,1e3,!0,!0,!0,!1,-1,6),G.Anchor=g_anchor_top|g_anchor_right|g_anchor_left,n.AddControl(G),b.style.cursor="s-resize",this.HtmlElement.HandlerT=b;var M=t+"_LeftTopHandler",H=this.protected_CreateDivElement(a,M),I=CreateControlContainer(M);I.Bounds.SetParams(0,0,1e3,1e3,!1,!1,!1,!1,6,6),I.Anchor=g_anchor_top|g_anchor_left,n.AddControl(I),H.style.cursor="se-resize",this.HtmlElement.HandlerLT=H;var N=t+"_RightTopHandler",P=this.protected_CreateDivElement(a,N),k=CreateControlContainer(N);k.Bounds.SetParams(0,0,0,1e3,!1,!1,!0,!1,6,6),k.Anchor=g_anchor_top|g_anchor_right,n.AddControl(k),P.style.cursor="ne-resize",this.HtmlElement.HandlerRT=P;var x=t+"_LeftBottomHandler",R=this.protected_CreateDivElement(a,x),L=CreateControlContainer(x);L.Bounds.SetParams(0,0,0,1e3,!1,!1,!1,!1,6,6),L.Anchor=g_anchor_bottom|g_anchor_left,n.AddControl(L),R.style.cursor="ne-resize",this.HtmlElement.HandlerLB=R;var W=t+"_RightBottomHandler",V=this.protected_CreateDivElement(a,W),O=CreateControlContainer(W);O.Bounds.SetParams(0,0,0,1e3,!1,!1,!0,!1,6,6),O.Anchor=g_anchor_bottom|g_anchor_right,n.AddControl(O),V.style.cursor="se-resize",this.HtmlElement.HandlerRB=V,Common_DragHandler.Init(this.HtmlElement.HandlerL,null,null,null,null,null),this.HtmlElement.HandlerL.onDrag=this.private_OnDragLeftHandler,this.HtmlElement.HandlerL.onDragStart=o,this.HtmlElement.HandlerL.onDragEnd=r,Common_DragHandler.Init(this.HtmlElement.HandlerR,null,null,null,null,null),this.HtmlElement.HandlerR.onDrag=this.private_OnDragRightHandler,this.HtmlElement.HandlerR.onDragStart=o,this.HtmlElement.HandlerR.onDragEnd=r,Common_DragHandler.Init(this.HtmlElement.HandlerT,null,null,null,null,null),this.HtmlElement.HandlerT.onDrag=this.private_OnDragTopHandler,this.HtmlElement.HandlerT.onDragStart=o,this.HtmlElement.HandlerT.onDragEnd=r,Common_DragHandler.Init(this.HtmlElement.HandlerB,null,null,null,null,null),this.HtmlElement.HandlerB.onDrag=this.private_OnDragBottomHandler,this.HtmlElement.HandlerB.onDragStart=o,this.HtmlElement.HandlerB.onDragEnd=r,Common_DragHandler.Init(this.HtmlElement.HandlerLT,null,null,null,null,null),this.HtmlElement.HandlerLT.onDrag=this.private_OnDragLeftTopHandler,this.HtmlElement.HandlerLT.onDragStart=o,this.HtmlElement.HandlerLT.onDragEnd=r,Common_DragHandler.Init(this.HtmlElement.HandlerRT,null,null,null,null,null),this.HtmlElement.HandlerRT.onDrag=this.private_OnDragRightTopHandler,this.HtmlElement.HandlerRT.onDragStart=o,this.HtmlElement.HandlerRT.onDragEnd=r,Common_DragHandler.Init(this.HtmlElement.HandlerLB,null,null,null,null,null),this.HtmlElement.HandlerLB.onDrag=this.private_OnDragLeftBottomHandler,this.HtmlElement.HandlerLB.onDragStart=o,this.HtmlElement.HandlerLB.onDragEnd=r,Common_DragHandler.Init(this.HtmlElement.HandlerRB,null,null,null,null,null),this.HtmlElement.HandlerRB.onDrag=this.private_OnDragRightBottomHandler,this.HtmlElement.HandlerRB.onDragStart=o,this.HtmlElement.HandlerRB.onDragEnd=r}var F=t+"_Close",X=this.protected_CreateDivElement(a,F),Y=CreateControlContainer(F);Y.Bounds.SetParams(0,0,6,1e3,!1,!0,!0,!1,45,20),Y.Anchor=g_anchor_top|g_anchor_right,n.AddControl(Y),X.style.backgroundColor=new CColor(255,0,0,255).ToString();var U=new CDrawingButtonClose(this.m_oDrawing);U.Init(F,this),U.m_oNormaFColor=new CColor(199,80,80,255),U.m_oHoverFColor=new CColor(224,67,67,255),U.m_oActiveFColor=new CColor(153,61,61,255),this.HtmlElement.CloseButton=U,this.private_UpdateSize()},CDrawingWindow.prototype.Get_Id=function(){return this.m_sWindowId},CDrawingWindow.prototype.Update_Size=function(t){var e=this.HtmlElement.Control.HtmlElement.clientWidth,o=this.HtmlElement.Control.HtmlElement.clientHeight;e===this.m_nW&&o===this.m_nH&&!0!==t||(this.m_nW=e,this.m_nH=o,this.HtmlElement.Control.Resize(e,o),this.HtmlElement.CloseButton.Update_Size()),this.private_CheckPosition()},CDrawingWindow.prototype.Close=function(){this.m_bVisible=!1,this.HtmlElement.Control.HtmlElement.style.display="none",this.m_oGameTree&&this.m_oGameTree.Focus()},CDrawingWindow.prototype.Show=function(t){this.m_bVisible=!0;var e=this.HtmlElement.Control.HtmlElement;e.style.display="block";var o=parseInt(e.style.left),r=parseInt(e.style.top);if(t&&t.Drawing){var i=t.Drawing,a=i.Get_Width(),n=i.Get_Height();r>n-100&&(e.style.top=n-100+"px"),o>a-100&&(e.style.left=a-100+"px")}o<0&&(e.style.left="0px"),r<0&&(e.style.top="0px")},CDrawingWindow.prototype.Focus=function(){},CDrawingWindow.prototype.Set_Caption=function(t){Common.Set_InnerTextToElement(this.HtmlElement.CaptionText,t)},CDrawingWindow.prototype.protected_CreateDivElement=function(t,e,o){var r=document.createElement(o||"div");return e&&r.setAttribute("id",e),r.setAttribute("style","position:absolute;padding:0;margin:0;"),r.setAttribute("oncontextmenu","return false;"),t.appendChild(r),r},CDrawingWindow.prototype.protected_UpdateSizeAndPosition=function(t){if(t){this.m_oDrawing=t;var e=this.HtmlElement.Control.HtmlElement,o=parseInt(e.style.width),r=parseInt(e.style.height),i=Math.max(0,(this.m_oDrawing.Get_Width()-o)/2),a=Math.max(0,(this.m_oDrawing.Get_Height()-r)/2);e.style.left=i+"px",e.style.top=a+"px"}},CDrawingWindow.prototype.private_UpdateSize=function(){var t=this.HtmlElement.Control.HtmlElement,e=this.Get_DefaultWindowSize();null!==e&&void 0!==e&&(t.style.width=e.W+"px",t.style.height=e.H+"px")},CDrawingWindow.prototype.Get_DefaultWindowSize=function(){return null},CDrawingWindow.prototype.Is_Visible=function(){return this.m_bVisible},CDrawingWindow.prototype.Update=function(){},CDrawingWindow.prototype.private_OnFocus=function(){},CDrawingWindow.prototype.private_CheckPosition=function(){var t=this.HtmlElement.Control.HtmlElement.parentNode;if(t){var e=parseInt(t.clientWidth),o=parseInt(t.clientHeight),r=parseInt(this.HtmlElement.Control.HtmlElement.style.left),i=parseInt(this.HtmlElement.Control.HtmlElement.style.top),a=parseInt(this.HtmlElement.Control.HtmlElement.style.width),n=parseInt(this.HtmlElement.Control.HtmlElement.style.height);if(a>e+1||n>o+1)return a>e+1&&(this.HtmlElement.Control.HtmlElement.style.width=e+"px"),n>o+1&&(this.HtmlElement.Control.HtmlElement.style.height=o+"px"),void this.Update_Size();r+a>e&&(this.HtmlElement.Control.HtmlElement.style.left=e-a+"px"),r<=0&&(this.HtmlElement.Control.HtmlElement.style.left="0px"),i+n>o&&(this.HtmlElement.Control.HtmlElement.style.top=o-n+"px"),i<=0&&(this.HtmlElement.Control.HtmlElement.style.top="0px")}},CommonExtend(CDrawingConfirmWindow,CDrawingWindow),CDrawingConfirmWindow.prototype.Init=function(t,e){CDrawingConfirmWindow.superclass.Init.call(this,t,e);var o=this.HtmlElement.InnerDiv,r=this.HtmlElement.InnerControl,i=o.id,a=i+"Content",n=i+"Buttons",s=this.protected_CreateDivElement(o,a),l=this.protected_CreateDivElement(o,n),m=CreateControlContainer(a);m.Bounds.SetParams(0,0,0,40,!0,!0,!0,!0,-1,-1),m.Anchor=g_anchor_left|g_anchor_top|g_anchor_bottom|g_anchor_right,r.AddControl(m);var _=CreateControlContainer(n);_.Bounds.SetParams(0,0,0,0,!0,!1,!0,!0,-1,40),_.Anchor=g_anchor_left|g_anchor_bottom|g_anchor_right,r.AddControl(_),this.HtmlElement.ConfirmInnerControl=m,this.HtmlElement.ConfirmInnerDiv=s,l.style.borderTop="1px solid rgb(172,172,172)",l.style.backgroundColor="rgb(240,240,240)",this.HtmlElement.OkCancelDiv=l;var h=n+"OK",d=(this.protected_CreateDivElement(l,h),CreateControlContainer(h));d.Bounds.SetParams(0,9,85,1e3,!1,!0,!0,!1,66,21),d.Anchor=g_anchor_top|g_anchor_right,r.AddControl(d);var p=new CDrawingButtonOK(this.m_oDrawing);p.Init(h,this),this.HtmlElement.OKButton=p,this.HtmlElement.OkButtonControl=d,p.m_oNormaBColor=new CColor(234,234,234,255),p.m_oNormaFColor=new CColor(172,172,172,255),p.m_oHoverBColor=new CColor(227,240,252,255),p.m_oHoverFColor=new CColor(126,180,234,255),p.m_oActiveBColor=new CColor(207,230,252,255),p.m_oActiveFColor=new CColor(86,157,229,255),p.m_oDisabledBColor=new CColor(239,239,239,255),p.m_oDisabledFColor=new CColor(217,217,217,255);var u=n+"Cancel",C=(this.protected_CreateDivElement(l,u),CreateControlContainer(u));C.Bounds.SetParams(0,9,11,1e3,!1,!0,!0,!1,66,21),C.Anchor=g_anchor_top|g_anchor_right,r.AddControl(C);var g=new CDrawingButtonCancel(this.m_oDrawing);g.Init(u,this),this.HtmlElement.CancelButton=g,this.HtmlElement.CancelButtonControl=C,g.m_oNormaBColor=new CColor(234,234,234,255),g.m_oNormaFColor=new CColor(172,172,172,255),g.m_oHoverBColor=new CColor(227,240,252,255),g.m_oHoverFColor=new CColor(126,180,234,255),g.m_oActiveBColor=new CColor(207,230,252,255),g.m_oActiveFColor=new CColor(86,157,229,255),g.m_oDisabledBColor=new CColor(239,239,239,255),g.m_oDisabledFColor=new CColor(217,217,217,255)},CDrawingConfirmWindow.prototype.Update_Size=function(t){CDrawingConfirmWindow.superclass.Update_Size.call(this,t),this.HtmlElement.OKButton&&this.HtmlElement.OKButton.Update_Size(),this.HtmlElement.CancelButton&&this.HtmlElement.CancelButton.Update_Size()},CDrawingConfirmWindow.prototype.Handle_Cancel=function(){this.Close()},CDrawingConfirmWindow.prototype.Handle_OK=function(){this.Close()},CommonExtend(CDrawingInfoWindow,CDrawingConfirmWindow),CDrawingInfoWindow.prototype.Init=function(t,e){CDrawingInfoWindow.superclass.Init.call(this,t);var o=window.g_oLocalization?window.g_oLocalization.gameRoom.window.gameInfo.caption:"Game info",r=window.g_oLocalization?window.g_oLocalization.gameRoom.window.gameInfo.gameName:"Game name",i=window.g_oLocalization?window.g_oLocalization.gameRoom.window.gameInfo.result:"Result",a=window.g_oLocalization?window.g_oLocalization.gameRoom.window.gameInfo.rules:"Rules",n=window.g_oLocalization?window.g_oLocalization.gameRoom.window.gameInfo.timeSettings:"Time settings",s=window.g_oLocalization?window.g_oLocalization.gameRoom.window.gameInfo.black:"Black",l=window.g_oLocalization?window.g_oLocalization.gameRoom.window.gameInfo.blackRank:"Black rank",m=window.g_oLocalization?window.g_oLocalization.gameRoom.window.gameInfo.white:"White",_=window.g_oLocalization?window.g_oLocalization.gameRoom.window.gameInfo.whiteRank:"White rank",h=window.g_oLocalization?window.g_oLocalization.gameRoom.window.gameInfo.copyright:"Copyright",d=window.g_oLocalization?window.g_oLocalization.gameRoom.window.gameInfo.date:"Date",p=window.g_oLocalization?window.g_oLocalization.gameRoom.window.gameInfo.event:"Event",u=window.g_oLocalization?window.g_oLocalization.gameRoom.window.gameInfo.round:"Round",C=window.g_oLocalization?window.g_oLocalization.gameRoom.window.gameInfo.place:"Place",g=window.g_oLocalization?window.g_oLocalization.gameRoom.window.gameInfo.annotator:"Annotator",c=window.g_oLocalization?window.g_oLocalization.gameRoom.window.gameInfo.source:"Source",v=window.g_oLocalization?window.g_oLocalization.gameRoom.window.gameInfo.transcriber:"Transcriber",f=window.g_oLocalization?window.g_oLocalization.gameRoom.window.gameInfo.gameInfo:"Game info";window.g_oTextMeasurer&&(window.g_oTextMeasurer.SetFont("15px Tahoma, 'Sans serif'"),this.m_nLeftWidth=Math.max(window.g_oTextMeasurer.Measure(r),window.g_oTextMeasurer.Measure(i),window.g_oTextMeasurer.Measure(a),window.g_oTextMeasurer.Measure(n),window.g_oTextMeasurer.Measure(s),window.g_oTextMeasurer.Measure(l),window.g_oTextMeasurer.Measure(m),window.g_oTextMeasurer.Measure(_),window.g_oTextMeasurer.Measure(h),window.g_oTextMeasurer.Measure(d),window.g_oTextMeasurer.Measure(p),window.g_oTextMeasurer.Measure(u),window.g_oTextMeasurer.Measure(C),window.g_oTextMeasurer.Measure(g),window.g_oTextMeasurer.Measure(c),window.g_oTextMeasurer.Measure(v),window.g_oTextMeasurer.Measure(f))+12),this.protected_UpdateSizeAndPosition(e.Drawing);var w=e.GameTree;this.m_oGameTree=w,!0!==w.Can_EditGameInfo()&&this.HtmlElement.OKButton.Set_Enabled(!1),this.Set_Caption(o);var S=this.HtmlElement.ConfirmInnerControl,T=this.HtmlElement.ConfirmInnerDiv,y=this.HtmlElement.ConfirmInnerDiv.id;T.style.overflowX="hidden",T.style.overflowY="scroll";var D=this.m_nRowHeight,E=10,B=this.m_nLineSpacing,A=this.m_nBottomOffset,b=w.Can_EditGameInfo();this.HtmlElement2.GameName=this.private_CreateInfoElement(T,S,y,r,w.Get_GameName(),E,D,b),E+=D+B,this.HtmlElement2.Result=this.private_CreateInfoElement(T,S,y,i,w.Get_Result(),E,D,b),E+=D+B,this.HtmlElement2.Rules=this.private_CreateInfoElement(T,S,y,a,w.Get_Rules(),E,D,b),E+=D+B,this.HtmlElement2.TimeSettings=this.private_CreateInfoElement(T,S,y,n,w.Get_TimeLimit()+(""===w.Get_OverTime()?"":" + "+w.Get_OverTime()),E,D,b),E+=D+B,this.HtmlElement2.BlackName=this.private_CreateInfoElement(T,S,y,s,w.Get_BlackName(),E,D,b),E+=D+B,this.HtmlElement2.BlackRank=this.private_CreateInfoElement(T,S,y,l,w.Get_BlackRating(),E,D,b),E+=D+B,this.HtmlElement2.WhiteName=this.private_CreateInfoElement(T,S,y,m,w.Get_WhiteName(),E,D,b),E+=D+B,this.HtmlElement2.WhiteRank=this.private_CreateInfoElement(T,S,y,_,w.Get_WhiteRating(),E,D,b),E+=D+B,this.HtmlElement2.Copyright=this.private_CreateInfoElement(T,S,y,h,w.Get_Copyright(),E,D,b),E+=D+B,this.HtmlElement2.Date=this.private_CreateInfoElement(T,S,y,d,w.Get_DateTime(),E,D,b),E+=D+B,this.HtmlElement2.Event=this.private_CreateInfoElement(T,S,y,p,w.Get_GameEvent(),E,D,b),E+=D+B,this.HtmlElement2.Round=this.private_CreateInfoElement(T,S,y,u,w.Get_GameRound(),E,D,b),E+=D+B,this.HtmlElement2.Place=this.private_CreateInfoElement(T,S,y,C,w.Get_GamePlace(),E,D,b),E+=D+B,this.HtmlElement2.Annotator=this.private_CreateInfoElement(T,S,y,g,w.Get_GameAnnotator(),E,D,b),E+=D+B,this.HtmlElement2.Source=this.private_CreateInfoElement(T,S,y,c,w.Get_GameSource(),E,D,b),E+=D+B,this.HtmlElement2.Transcriber=this.private_CreateInfoElement(T,S,y,v,w.Get_GameTranscriber(),E,D,b),E+=D+B,this.HtmlElement2.GameInfo=this.private_CreateInfoAreaElement(T,S,y,f,w.Get_GameInfo(),E,D,b),E+=3*D,this.protected_CreateDivElement(T,y+"Bottom");var G=CreateControlContainer(y+"Bottom");G.Bounds.SetParams(0,E,1e3,1e3,!0,!0,!1,!1,0,A),G.Anchor=g_anchor_left|g_anchor_top|g_anchor_right,S.AddControl(G)},CDrawingInfoWindow.prototype.Update_Size=function(t){CDrawingInfoWindow.superclass.Update_Size.call(this,t),this.HtmlElement.OKButton&&this.HtmlElement.OKButton.Update_Size(),this.HtmlElement.CancelButton&&this.HtmlElement.CancelButton.Update_Size();var e=0|parseInt(this.HtmlElement.ConfirmInnerDiv.style.height),o=0|parseInt(this.HtmlElement2.GameInfo.style.top),r=e-this.m_nBottomOffset;r-o<3*this.m_nRowHeight?this.HtmlElement2.GameInfo.style.height=3*this.m_nRowHeight+"px":this.HtmlElement2.GameInfo.style.height=r-o+"px"},CDrawingInfoWindow.prototype.Handle_Cancel=function(){this.Close()},CDrawingInfoWindow.prototype.Handle_OK=function(){this.m_oGameTree&&(this.m_oGameTree.Set_GameName(this.HtmlElement2.GameName.value),this.m_oGameTree.Set_Result(this.HtmlElement2.Result.value),this.m_oGameTree.Set_Rules(this.HtmlElement2.Rules.value),this.m_oGameTree.Set_TimeLimit(this.HtmlElement2.TimeSettings.value),this.m_oGameTree.Set_Black(this.HtmlElement2.BlackName.value),this.m_oGameTree.Set_BlackRating(this.HtmlElement2.BlackRank.value),this.m_oGameTree.Set_White(this.HtmlElement2.WhiteName.value),this.m_oGameTree.Set_WhiteRating(this.HtmlElement2.WhiteRank.value),this.m_oGameTree.Set_Copyright(this.HtmlElement2.Copyright.value),this.m_oGameTree.Set_GameInfo(this.HtmlElement2.GameInfo.value),this.m_oGameTree.Set_DateTime(this.HtmlElement2.Date.value),this.m_oGameTree.Set_GameEvent(this.HtmlElement2.Event.value),this.m_oGameTree.Set_GameRound(this.HtmlElement2.Round.value),this.m_oGameTree.Set_GamePlace(this.HtmlElement2.Place.value),this.m_oGameTree.Set_GameAnnotator(this.HtmlElement2.Annotator.value),this.m_oGameTree.Set_GameSource(this.HtmlElement2.Source.value),this.m_oGameTree.Set_GameTranscriber(this.HtmlElement2.Transcriber.value)),this.Close()},CDrawingInfoWindow.prototype.private_CreateDivElement=function(t,e,o){var r=document.createElement("div");return r.setAttribute("id",e),r.setAttribute("style","position:absolute;padding:0;margin:0;"),r.setAttribute("oncontextmenu","return false;"),r.style.fontFamily="Tahoma, Sans serif",r.style.fontSize=15*o/20+"px",r.style.lineHeight=o+"px",r.style.height=o+"px",t.appendChild(r),r},CDrawingInfoWindow.prototype.private_CreateInputElement=function(t,e,o){var r=document.createElement("input");return r.setAttribute("id",e),r.setAttribute("style","position:absolute;padding:0;margin:0;"),r.setAttribute("oncontextmenu","return false;"),r.setAttribute("type","text"),r.style.fontFamily="Tahoma, Sans serif",r.style.fontSize="10pt",r.style.outline="none",r.style.border="1px solid rgb(169,169,169)",!1===o&&(r.disabled="disabled"),t.appendChild(r),r},CDrawingInfoWindow.prototype.private_CreateInfoElement=function(t,e,o,r,i,a,n,s){var l=this.m_nLeftWidth,m=10;m+=20;var _=o+r,h=this.private_CreateDivElement(t,_,n),d=CreateControlContainer(_);d.Bounds.SetParams(10,a,1e3,1e3,!0,!0,!1,!1,l,n),d.Anchor=g_anchor_left|g_anchor_top,e.AddControl(d),Common.Set_InnerTextToElement(h,r);var p=_+"Value",u=this.private_CreateInputElement(t,p,s),C=CreateControlContainer(p);return C.Bounds.SetParams(10+l,a+1,m,1e3,!0,!0,!0,!1,-1,n-2),C.Anchor=g_anchor_left|g_anchor_top|g_anchor_right,e.AddControl(C),u.value=i,u},CDrawingInfoWindow.prototype.private_CreateInfoAreaElement=function(t,e,o,r,i,a,n,s){var l=this.m_nLeftWidth,m=10;m+=20;var _=o+r,h=this.private_CreateDivElement(t,_,n),d=CreateControlContainer(_);d.Bounds.SetParams(10,a,1e3,1e3,!0,!0,!1,!1,l,n),d.Anchor=g_anchor_left|g_anchor_top,e.AddControl(d),Common.Set_InnerTextToElement(h,r);var p=_+"Value",u=document.createElement("textarea");u.setAttribute("id",p),u.setAttribute("style","position:absolute;padding:0;margin:0;"),u.setAttribute("oncontextmenu","return false;"),u.style.fontFamily="Tahoma, Sans serif",u.style.fontSize="10pt",u.style.resize="none",u.style.outline="none",u.style.border="1px solid rgb(169,169,169)",u.style.height=3*n+"px",this.HtmlElement2.GameInfo=u,!1===s&&(u.disabled="disabled"),t.appendChild(u);var C=CreateControlContainer(p);return C.Bounds.SetParams(10+l,a+1,m,1e3,!0,!0,!0,!1,-1,3*n),C.Anchor=g_anchor_left|g_anchor_top|g_anchor_right,e.AddControl(C),u.value=i,u},CDrawingInfoWindow.prototype.Show=function(t){CDrawingInfoWindow.superclass.Show.call(this,t);var e=this.m_oGameTree;this.HtmlElement2.GameName.value=e.Get_GameName(),this.HtmlElement2.Result.value=e.Get_Result(),this.HtmlElement2.Rules.value=e.Get_Rules(),this.HtmlElement2.TimeSettings.value=e.Get_TimeLimit()+(""===e.Get_OverTime()?"":" + "+e.Get_OverTime()),this.HtmlElement2.BlackName.value=e.Get_BlackName(),this.HtmlElement2.BlackRank.value=e.Get_BlackRating(),this.HtmlElement2.WhiteName.value=e.Get_WhiteName(),this.HtmlElement2.WhiteRank.value=e.Get_WhiteRating(),this.HtmlElement2.Copyright.value=e.Get_Copyright(),this.HtmlElement2.Date.value=e.Get_DateTime(),this.HtmlElement2.Event.value=e.Get_GameEvent(),this.HtmlElement2.Round.value=e.Get_GameRound(),this.HtmlElement2.Place.value=e.Get_GamePlace(),this.HtmlElement2.Annotator.value=e.Get_GameAnnotator(),this.HtmlElement2.Source.value=e.Get_GameSource(),this.HtmlElement2.Transcriber.value=e.Get_GameTranscriber(),this.HtmlElement2.GameInfo.value=e.Get_GameInfo()},CommonExtend(CDrawingErrorWindow,CDrawingWindow),CDrawingErrorWindow.prototype.Init=function(t,e){CDrawingErrorWindow.superclass.Init.call(this,t,!1),this.protected_UpdateSizeAndPosition(e.Drawing);e.ErrorText;var o=window.g_oLocalization?window.g_oLocalization.gameRoom.window.error.caption:"Error";this.Set_Caption(e.Caption?e.Caption:o),this.m_oGameTree=e.GameTree,this.m_oDrawing=e.Drawing;var r=this.HtmlElement.InnerDiv,i=this.HtmlElement.InnerControl,a=t+"E",n=this.private_CreateDivElement(r,a,20),s=CreateControlContainer(a);s.Bounds.SetParams(10,5,10,5,!0,!0,!0,!0,-1,-1),s.Anchor=g_anchor_left|g_anchor_top|g_anchor_bottom|g_anchor_right,i.AddControl(s),this.m_oMainElement=n,this.Show(e)},CDrawingErrorWindow.prototype.Close=function(){this.m_oDrawing&&this.m_oDrawing.Enable(),CDrawingInfoWindow.superclass.Close.call(this)},CDrawingErrorWindow.prototype.Show=function(t){if(CDrawingErrorWindow.superclass.Show.call(this,t),this.m_nW=t.W,this.m_nH=t.H,Common.Set_InnerTextToElement(this.m_oMainElement,t.ErrorText),window.g_oTextMeasurer&&this.m_nW-14>0){window.g_oTextMeasurer.SetFont("15px Tahoma, 'Sans serif'");var e=window.g_oTextMeasurer.Measure(t.ErrorText),o=this.m_nW-14,r=20*Math.ceil(e/o+.5)+10+30+7;this.m_nH<r&&(this.m_nH=r),this.Update_Size(!0)}this.m_oDrawing&&(this.m_oDrawing.Disable(),this.protected_UpdateSizeAndPosition(this.m_oDrawing),this.Update_Size(!0))},CDrawingErrorWindow.prototype.private_CreateDivElement=function(t,e,o){var r=document.createElement("div");return r.setAttribute("id",e),r.setAttribute("style","position:absolute;padding:0;margin:0;"),r.setAttribute("oncontextmenu","return false;"),r.style.fontFamily="Tahoma, Sans serif",r.style.fontSize=15*o/20+"px",r.style.lineHeight=o+"px",r.style.height=o+"px",t.appendChild(r),r},CDrawingErrorWindow.prototype.Get_DefaultWindowSize=function(){return{W:this.m_nW,H:this.m_nH}},CommonExtend(CDrawingSettingsWindow,CDrawingConfirmWindow),CDrawingSettingsWindow.prototype.Init=function(t,e){CDrawingSettingsWindow.superclass.Init.call(this,t,!1),this.protected_UpdateSizeAndPosition(e.Drawing),this.m_oGameTree=e.GameTree,this.Set_Caption("Settings");var o=new CDrawingVerticalTabs;o.Init(this.HtmlElement.ConfirmInnerDiv.id,["Appearance","Color Scheme","Loading Settings"],0,150),this.private_CreateAppearancePage(o.Get_TabContent(0),e),this.private_CreateColorSchemePage(o.Get_TabContent(1),e),this.private_CreateLoadingSettingsPage(o.Get_TabContent(2),e)},CDrawingSettingsWindow.prototype.Get_DefaultWindowSize=function(){return{W:400,H:210}},CDrawingSettingsWindow.prototype.Show=function(t){CDrawingSettingsWindow.superclass.Show.call(this,t),this.HtmlElement2.CycleThroughVariants.checked=this.m_oGameTree.Is_CycleThroughVariants(),this.HtmlElement2.Sound.checked=this.m_oGameTree.Is_SoundOn(),this.HtmlElement2.NavigatorLabel.selectedIndex=this.m_oGameTree.Get_NavigatorLabel(),this.private_CheckColorTheme(),this.HtmlElement2.LoadUnfinishedSgf.checked=this.m_oGameTree.Is_LoadUnfinishedFilesOnLastNode(),this.HtmlElement2.LoadShowVariants.selectedIndex=this.m_oGameTree.Get_LoadShowVariants()},CDrawingSettingsWindow.prototype.private_CreatePage=function(t){var e=document.createElement("div");return t.appendChild(e),e.style.margin="0",e.style.padding="10px 20px",e.style.fontFamily="Tahoma, Arial, Verdana",e.style.fontSize="10px",e.style.color="#666",e.style.background="#fff",e},CDrawingSettingsWindow.prototype.private_CreateAppearancePage=function(t,e){var o=this.private_CreatePage(t),r=this.HtmlElement.ConfirmInnerDiv.id+"A";this.HtmlElement2.ShowTarget=this.private_CreateCheckBox(o,r+"T",this.m_oGameTree.Is_ShowTarget(),"Show target"),this.HtmlElement2.CycleThroughVariants=this.private_CreateCheckBox(o,r+"C",this.m_oGameTree.Is_CycleThroughVariants(),"Cycle through variants"),this.HtmlElement2.Sound=this.private_CreateCheckBox(o,r+"S",this.m_oGameTree.Is_SoundOn(),"Sound"),this.HtmlElement2.NavigatorLabel=this.private_CreateSelect(o,r+"N",this.m_oGameTree.Get_NavigatorLabel(),["No labels","Move numbers","Move numbers current variant only","Move coordinates"],"Labels in navigator")},CDrawingSettingsWindow.prototype.private_CreateColorSchemePage=function(t,e){var o=this.private_CreatePage(t),r=this.HtmlElement.ConfirmInnerDiv.id+"CS";this.HtmlElement2.Theme.TrueColor=this.private_CreateRadioButton(o,r+"TC","ThemeId","TrueColor"),this.HtmlElement2.Theme.SimpleColor=this.private_CreateRadioButton(o,r+"SC","ThemeId","SimpleColor"),this.HtmlElement2.Theme.BookStyle=this.private_CreateRadioButton(o,r+"BS","ThemeId","BookStyle"),this.HtmlElement2.Theme.Dark=this.private_CreateRadioButton(o,r+"D","ThemeId","Dark"),this.private_CheckColorTheme()},CDrawingSettingsWindow.prototype.private_CreateLoadingSettingsPage=function(t,e){var o=this.private_CreatePage(t),r=this.HtmlElement.ConfirmInnerDiv.id+"LS";this.HtmlElement2.LoadUnfinishedSgf=this.private_CreateCheckBox(o,r+"U",this.m_oGameTree.Is_LoadUnfinishedFilesOnLastNode(),"Load unfinished files on the last node"),this.HtmlElement2.LoadShowVariants=this.private_CreateSelect(o,r+"V",this.m_oGameTree.Get_LoadShowVariants(),["Don't show variants","Show variations of current node   (siblings)","Show variations of successor node (children)","Load option from file"],"Show variants")},CDrawingSettingsWindow.prototype.Handle_OK=function(){var t=EColorScheme.TrueColor;t=this.HtmlElement2.Theme.SimpleColor.checked?EColorScheme.SimpleColor:this.HtmlElement2.Theme.BookStyle.checked?EColorScheme.BookStyle:this.HtmlElement2.Theme.Dark.checked?EColorScheme.Dark:EColorScheme.TrueColor;var e=g_oGlobalSettings.Set_ColorScheme(t);this.m_oGameTree.Toggle_Sound(!!this.HtmlElement2.Sound.checked,!1),this.m_oGameTree.Set_ShowTarget(!!this.HtmlElement2.ShowTarget.checked),this.m_oGameTree.Set_LoadUnfinishedFilesOnLastNode(!!this.HtmlElement2.LoadUnfinishedSgf.checked),this.m_oGameTree.Set_NavigatorLabel(this.HtmlElement2.NavigatorLabel.selectedIndex),this.m_oGameTree.Set_CycleThroughVariants(!!this.HtmlElement2.CycleThroughVariants.checked),this.m_oGameTree.Set_LoadShowVariants(this.HtmlElement2.LoadShowVariants.selectedIndex);var o=this.m_oGameTree.Get_DrawingBoard(),r=this.m_oGameTree.Get_DrawingNavigator();o&&!0===e.Board&&o.Update_Size(!0),r&&!0===e.Navigator&&r.Update_All(),this.Close()},CDrawingSettingsWindow.prototype.private_CreateRadioButton=function(t,e,o,r){var i=document.createElement("div");i.style.paddingLeft="10px",i.style.paddingBottom="5px",t.appendChild(i);var a=document.createElement("input");a.type="radio",a.name=o,a.value=r,a.setAttribute("id",e),i.appendChild(a);var n=document.createElement("span");return n.setAttribute("oncontextmenu","return false;"),n.style.fontFamily="Tahoma, Sans serif",Common.Set_InnerTextToElement(n,r),n.style.fontFamily="Tahoma, Sans serif",n.style.fontSize="12pt",n.style.height="15px",n.style.lineHeight="15px",n.style.cursor="default",i.appendChild(n),n.addEventListener("click",function(){a.checked=!0},!1),a},CDrawingSettingsWindow.prototype.private_CreateCheckBox=function(t,e,o,r){var i=document.createElement("div");i.style.paddingLeft="10px",i.style.paddingBottom="5px",t.appendChild(i);var a=document.createElement("input");a.type="checkbox",a.checked=o,a.setAttribute("id",e),i.appendChild(a);var n=document.createElement("span");return n.setAttribute("oncontextmenu","return false;"),n.style.fontFamily="Tahoma, Sans serif",Common.Set_InnerTextToElement(n,r),n.style.fontFamily="Tahoma, Sans serif",n.style.fontSize="12pt",n.style.height="15px",n.style.lineHeight="15px",n.style.cursor="default",i.appendChild(n),n.addEventListener("click",function(){a.checked=!a.checked},!1),a},CDrawingSettingsWindow.prototype.private_CreateSelect=function(t,e,o,r,i){var a=document.createElement("div");a.style.paddingLeft="10px",a.style.paddingBottom="5px",a.style.fontFamily="Tahoma, Sans serif",a.style.fontSize="9pt",a.style.height="12px",a.style.lineHeight="12px",t.appendChild(a);var n=document.createElement("div");Common.Set_InnerTextToElement(n,i),n.style.paddingBottom="5px",a.appendChild(n);var s=document.createElement("select");s.style.width="170px";for(var l=0,m=r.length;l<m;l++){var _=document.createElement("option");_.value=r[l],Common.Set_InnerTextToElement(_,r[l]),s.appendChild(_)}return s.selectedIndex=o,a.appendChild(s),s},CDrawingSettingsWindow.prototype.private_CheckColorTheme=function(){var t=g_oGlobalSettings.m_oBoardPr.oBoardColor.r;231===t?g_oGlobalSettings.m_oBoardPr.bTrueColorBoard?this.HtmlElement2.Theme.TrueColor.checked=!0:this.HtmlElement2.Theme.SimpleColor.checked=!0:255===t?this.HtmlElement2.Theme.BookStyle.checked=!0:30===t?this.HtmlElement2.Theme.Dark.checked=!0:this.HtmlElement2.Theme.TrueColor.checked=!0},CommonExtend(CDrawingCountColorsWindow,CDrawingWindow),CDrawingCountColorsWindow.prototype.Init=function(t,e){CDrawingCountColorsWindow.superclass.Init.call(this,t,!1);var o=window.g_oLocalization?window.g_oLocalization.gameRoom.window.colorsCounter.caption:"Counter of colors",r=window.g_oLocalization?window.g_oLocalization.gameRoom.window.colorsCounter.red:"Red",i=window.g_oLocalization?window.g_oLocalization.gameRoom.window.colorsCounter.blue:"Blue",a=window.g_oLocalization?window.g_oLocalization.gameRoom.window.colorsCounter.green:"Green",n=window.g_oLocalization?window.g_oLocalization.gameRoom.window.colorsCounter.gray:"Gray";window.g_oTextMeasurer&&(window.g_oTextMeasurer.SetFont("15px Tahoma, 'Sans serif'"),this.m_nLeftWidth=Math.max(window.g_oTextMeasurer.Measure(r),window.g_oTextMeasurer.Measure(i),window.g_oTextMeasurer.Measure(a),window.g_oTextMeasurer.Measure(n))+12),this.m_oGameTree=e.GameTree,this.m_oDrawingBoard=e.DrawingBoard,this.protected_UpdateSizeAndPosition(e.Drawing),this.Set_Caption(o);var s=this.HtmlElement.InnerDiv,l=this.HtmlElement.InnerControl,m=this.HtmlElement.InnerDiv.id;s.style.overflowX="hidden",s.style.overflowY="hidden";var _=10,h=e.DrawingBoard.m_oColorMarks,d=[0,0,0,0],p=[0,0,0,0],u=[0,0,0,0],C=[0,0,0,0];for(var g in h){var c=h[g],v=-1;0!==c.r&&0!==c.g&&0!==c.b?(!0,v=3):0!==c.r?(!0,v=0):0!==c.g?(!0,v=1):0!==c.b&&(!0,v=2);var f=0;switch(f=c.a<=50?0:c.a<=100?1:c.a<=150?2:3,v){case 0:d[f]++;break;case 1:p[f]++;break;case 2:u[f]++;break;case 3:C[f]++}}this.Red=this.private_CreateInfoElement(s,l,m,r,"4 x "+d[3]+"+ 3 x "+d[2]+" + 2 x "+d[1]+" + 1 x "+d[0]+" ="+(4*d[3]+3*d[2]+2*d[1]+d[0]),_,20),_+=25,this.Green=this.private_CreateInfoElement(s,l,m,a,"4 x "+p[3]+"+ 3 x "+p[2]+" + 2 x "+p[1]+" + 1 x "+p[0]+" ="+(4*p[3]+3*p[2]+2*p[1]+p[0]),_,20),_+=25,this.Blue=this.private_CreateInfoElement(s,l,m,i,"4 x "+u[3]+"+ 3 x "+u[2]+" + 2 x "+u[1]+" + 1 x "+u[0]+" ="+(4*u[3]+3*u[2]+2*u[1]+u[0]),_,20),_+=25,this.Gray=this.private_CreateInfoElement(s,l,m,n,"4 x "+C[3]+"+ 3 x "+C[2]+" + 2 x "+C[1]+" + 1 x "+C[0]+" ="+(4*C[3]+3*C[2]+2*C[1]+C[0]),_,20),_+=25,this.protected_CreateDivElement(s,m+"Bottom");var w=CreateControlContainer(m+"Bottom");w.Bounds.SetParams(0,_,1e3,1e3,!0,!0,!1,!1,0,10),w.Anchor=g_anchor_left|g_anchor_top|g_anchor_right,l.AddControl(w)},CDrawingCountColorsWindow.prototype.private_CreateDivElement=function(t,e,o){var r=document.createElement("div");return r.setAttribute("id",e),r.setAttribute("style","position:absolute;padding:0;margin:0;"),r.setAttribute("oncontextmenu","return false;"),r.style.fontFamily="Tahoma, Sans serif",r.style.fontSize=15*o/20+"px",r.style.lineHeight=o+"px",r.style.height=o+"px",t.appendChild(r),r},CDrawingCountColorsWindow.prototype.private_CreateInputElement=function(t,e){var o=document.createElement("input");return o.setAttribute("id",e),o.setAttribute("style","position:absolute;padding:0;margin:0;"),o.setAttribute("oncontextmenu","return false;"),o.setAttribute("type","text"),o.style.fontFamily="Tahoma, Sans serif",o.style.fontSize="10pt",o.style.outline="none",o.disabled="disabled",t.appendChild(o),o},CDrawingCountColorsWindow.prototype.private_CreateInfoElement=function(t,e,o,r,i,a,n,s){var l=this.m_nLeftWidth,m=10;m+=20;var _=o+r,h=this.private_CreateDivElement(t,_,n),d=CreateControlContainer(_);d.Bounds.SetParams(10,a,1e3,1e3,!0,!0,!1,!1,l,n),d.Anchor=g_anchor_left|g_anchor_top,e.AddControl(d),Common.Set_InnerTextToElement(h,r);var p=_+"Value",u=this.private_CreateInputElement(t,p,s),C=CreateControlContainer(p);return C.Bounds.SetParams(10+l,a+1,m,1e3,!0,!0,!0,!1,-1,n-2),C.Anchor=g_anchor_left|g_anchor_top|g_anchor_right,e.AddControl(C),u.value=i,u},CDrawingCountColorsWindow.prototype.Show=function(t){CDrawingCountColorsWindow.superclass.Show.call(this,t),this.m_oGameTree=t.GameTree,this.m_oDrawingBoard=t.DrawingBoard,this.Update()},CDrawingCountColorsWindow.prototype.Update=function(t){if(this.Is_Visible()&&this.m_oDrawingBoard){var e=this.m_oDrawingBoard.m_oColorMarks,o=[0,0,0,0],r=[0,0,0,0],i=[0,0,0,0],a=[0,0,0,0];for(var n in e){var s=e[n],l=-1;0!==s.r&&0!==s.g&&0!==s.b?(!0,l=3):0!==s.r?(!0,l=0):0!==s.g?(!0,l=1):0!==s.b&&(!0,l=2);var m=0;switch(m=s.a<=50?0:s.a<=100?1:s.a<=150?2:3,l){case 0:o[m]++;break;case 1:r[m]++;break;case 2:i[m]++;break;case 3:a[m]++}}this.Red.value="4 x "+o[3]+"+ 3 x "+o[2]+" + 2 x "+o[1]+" + 1 x "+o[0]+" ="+(4*o[3]+3*o[2]+2*o[1]+o[0]),this.Green.value="4 x "+r[3]+"+ 3 x "+r[2]+" + 2 x "+r[1]+" + 1 x "+r[0]+" ="+(4*r[3]+3*r[2]+2*r[1]+r[0]),this.Blue.value="4 x "+i[3]+"+ 3 x "+i[2]+" + 2 x "+i[1]+" + 1 x "+i[0]+" ="+(4*i[3]+3*i[2]+2*i[1]+i[0]),this.Gray.value="4 x "+a[3]+"+ 3 x "+a[2]+" + 2 x "+a[1]+" + 1 x "+a[0]+" ="+(4*a[3]+3*a[2]+2*a[1]+a[0])}},CDrawingCountColorsWindow.prototype.Get_DefaultWindowSize=function(){return{W:410,H:160}},CommonExtend(CDrawingGifWriterWindow,CDrawingWindow),CDrawingGifWriterWindow.prototype.Init=function(t,e){CDrawingGifWriterWindow.superclass.Init.call(this,t,!1),this.protected_UpdateSizeAndPosition(e.Drawing);var o=window.g_oLocalization?window.g_oLocalization.gameRoom.window.creatingGIF.caption:"Creating Gif file...";this.Set_Caption(o),e.GameTree&&(this.m_oGameTree=e.GameTree);var r=this.HtmlElement.InnerDiv,i=this.HtmlElement.InnerControl,a=this.HtmlElement.InnerDiv.id,n=a+"PB",s=this.protected_CreateDivElement(r,n),l=CreateControlContainer(n);l.Bounds.SetParams(6,30,8,8,!0,!0,!0,!0,-1,-1),l.Anchor=g_anchor_top|g_anchor_left|g_anchor_bottom|g_anchor_right,i.AddControl(l),s.style.border="1px solid rgb(221,221,221)",s.style.backgroundColor="rgb(140, 140, 140)";var m=a+"P",_=this.protected_CreateDivElement(r,m),h=CreateControlContainer(m);h.Bounds.SetParams(7,31,0,7,!0,!0,!1,!0,10,-1),h.Anchor=g_anchor_top|g_anchor_left|g_anchor_bottom,i.AddControl(h),_.style.backgroundColor="rgb(54, 101, 179)",this.m_oProgressSliderElement=_;var d=a+"PV",p=this.protected_CreateDivElement(r,d),u=CreateControlContainer(d);u.Bounds.SetParams(0,7,1e3,32,!1,!1,!1,!0,-1,-1),u.Anchor=g_anchor_top|g_anchor_left|g_anchor_bottom,i.AddControl(u),p.style.fontFamily="Tahoma, Sans serif",p.style.fontSize="15px",p.style.lineHeight="20px",p.style.height="20px",p.style.color="rgb(0, 0, 0)",p.style.textAlign="center",this.m_oProgressValueElement=p},CDrawingGifWriterWindow.prototype.Get_DefaultWindowSize=function(){return{W:240,H:100}},CDrawingGifWriterWindow.prototype.On_Progress=function(t){this.m_oProgressSliderElement.style.width=t/100*214+"px";var e=(100*t|0)/100;Common.Set_InnerTextToElement(this.m_oProgressValueElement,e+"%")},CDrawingGifWriterWindow.prototype.On_Start=function(){this.On_Progress(0),this.m_oDrawing&&this.m_oDrawing.Disable()},CDrawingGifWriterWindow.prototype.On_End=function(){function t(){e.Close(!0)}this.On_Progress(100);var e=this;setTimeout(t,300)},CDrawingGifWriterWindow.prototype.Close=function(t){!0!==t&&this.m_oGameTree&&this.m_oGameTree.Abort_DownloadGid(),this.m_oDrawing&&this.m_oDrawing.Enable(),CDrawingGifWriterWindow.superclass.Close.apply(this)},CommonExtend(CDrawingAboutWindow,CDrawingWindow),CDrawingAboutWindow.prototype.Init=function(t,e){CDrawingGifWriterWindow.superclass.Init.call(this,t,!0),this.protected_UpdateSizeAndPosition(e.Drawing),this.Set_Caption("About"),this.m_oGameTree=e.GameTree;var o=new CDrawingVerticalTabs;o.Init(this.HtmlElement.InnerDiv.id,["Web Renju Board","Keyboard Shortcuts"],0),this.private_InitAboutPage(o.Get_TabContent(0)),this.private_InitKeyBoardShortcutsPage(o.Get_TabContent(1),e)},CDrawingAboutWindow.prototype.Get_DefaultWindowSize=function(){if(this.m_oDrawing){var t=this.m_oDrawing.Get_Width(),e=this.m_oDrawing.Get_Height();return{W:Math.max(100,Math.min(700,.9*t)),H:Math.max(100,Math.min(600,.9*e))}}return null},CDrawingAboutWindow.prototype.private_InitAboutPage=function(t){var e=document.createElement("div");t.appendChild(e),t.style.overflowX="hidden",t.style.overflowY="scroll",e.style.margin="0",e.style.padding="10px 20px",e.style.fontFamily="Tahoma, Arial, Verdana",e.style.fontSize="12px",e.style.color="#666",e.style.background="#fff";var o=document.createElement("div");o.style.width="10px",o.style.height="100px",o.style.float="left",e.appendChild(o);var r=document.createElement("h1");e.appendChild(r),Common.Set_InnerTextToElement(r,"Web Renju Board");var i=document.createElement("div");e.appendChild(i),Common.Set_InnerTextToElement(i,"Version "+RenjuBoardApi.Get_Version());var a=document.createElement("div");a.style.paddingTop="40px",e.appendChild(a),Common.Set_InnerTextToElement(a,"Visit our GitHub project for feedback and issue reports:"),(a=document.createElement("a")).target="_blank",a.href="https://github.com/starpentagon/web_renju_board",e.appendChild(a),Common.Set_InnerTextToElement(a,"https://github.com/starpentagon/web_renju_board"),(a=document.createElement("div")).style.paddingTop="20px",e.appendChild(a),Common.Set_InnerTextToElement(a,"Our site:"),(a=document.createElement("a")).target="_blank",a.href="http://quinstella.net/",e.appendChild(a),Common.Set_InnerTextToElement(a,"http://quinstella.net/"),(a=document.createElement("div")).style.paddingTop="40px",e.appendChild(a),Common.Set_InnerTextToElement(a,"Web Renju Board is developed by modifying the Web Go/Baduk Board and GoProject libraries:"),(a=document.createElement("a")).target="_blank",a.href="https://github.com/IlyaKirillov/GoProject",e.appendChild(a),Common.Set_InnerTextToElement(a,"https://github.com/IlyaKirillov/GoProject"),(a=document.createElement("div")).style.paddingTop="20px",e.appendChild(a),Common.Set_InnerTextToElement(a,"Web Go/Baduk Board authors' site:"),(a=document.createElement("a")).target="_blank",a.href="http://webgoboard.com/",e.appendChild(a),Common.Set_InnerTextToElement(a,"http://webgoboard.com/"),(a=document.createElement("div")).style.paddingTop="30px",e.appendChild(a),Common.Set_InnerTextToElement(a,"Web Go/Baduk Board: © Ilya Kirillov, 2014-2016. All rights reserved."),(a=document.createElement("div")).style.paddingTop="10px",e.appendChild(a),Common.Set_InnerTextToElement(a,"Web Renju Board: © Koichi Nabetani, 2017. All rights reserved.")},CDrawingAboutWindow.prototype.private_InitKeyBoardShortcutsPage=function(t,e){var o=t;o.style.overflowX="hidden",o.style.overflowY="scroll";var r=document.createElement("div");o.appendChild(r),r.style.margin="0",r.style.padding="10px 20px",r.style.fontFamily="Tahoma, Arial, Verdana",r.style.fontSize="12px",r.style.color="#666",r.style.background="#fff";var i=document.createElement("h1");r.appendChild(i),Common.Set_InnerTextToElement(i,"Keyboard Shortcuts"),i.style.fontSize="16px",i.style.fontWeight="bold";var a=document.createElement("table");r.appendChild(a),a.style.margin="20px 0",a.style.width="100%";var n=document.createElement("tbody");a.appendChild(n),this.m_oDrawingBoard=null,e.GameTree&&(this.m_oDrawingBoard=e.GameTree.Get_DrawingBoard()),this.private_AppendTableHeading1(n,"Working with Files"),this.private_AppendTableCommonString(n,{CtrlKey:!0,KeyCode:79,ShiftKey:!1},"Open Sgf","Ctrl+O","Open the Sgf file from disk. (Not in color mode, see below)"),this.private_AppendTableCommonString(n,{CtrlKey:!0,KeyCode:79,ShiftKey:!0},"Open Sgf","Ctrl+Shift+O","Open the Sgf file from source. (Not in color mode, see below)"),this.private_AppendTableCommonString(n,{CtrlKey:!0,KeyCode:67,ShiftKey:!1},"Create new","Ctrl+C","Create new empty board. (not in color mode see below)"),this.private_AppendTableCommonString(n,{CtrlKey:!0,KeyCode:83,ShiftKey:!1},"Save Sgf","Ctrl+S","Save Sgf file."),this.private_AppendTableCommonString(n,{CtrlKey:!0,KeyCode:72,ShiftKey:!1},"Save png shot","Ctrl+H","Save board shot in png format."),this.private_AppendTableCommonString(n,{CtrlKey:!0,KeyCode:72,ShiftKey:!0},"Save gif shot","Ctrl+Shift+H","Save board shot in gif format."),this.private_AppendTableCommonString(n,{CtrlKey:!0,KeyCode:73,ShiftKey:!1},"Save multipage gif file.","Ctrl+I","Save gif file for current variant."),this.private_AppendTableCommonString(n,{CtrlKey:!0,KeyCode:73,ShiftKey:!0},"Save multipage gif file.","Ctrl+Shift+I","Save gif file for all branches with comment RIGHT (for problem mode)."),this.private_AppendTableHeading1(n,"Navigation"),this.private_AppendTableCommonString(n,{CtrlKey:!1,KeyCode:39,ShiftKey:!1},"Next node","Right arrow","Jump to next node."),this.private_AppendTableCommonString(n,{CtrlKey:!0,KeyCode:39,ShiftKey:!1},"Next 5 node","Ctrl+Right arrow","Jump over 5 nodes."),this.private_AppendTableCommonString(n,{CtrlKey:!0,KeyCode:39,ShiftKey:!0},"End of the variant","Ctrl+Shift+Right arrow","Jump to the end of the current variant."),this.private_AppendTableCommonString(n,{CtrlKey:!1,KeyCode:37,ShiftKey:!1},"Previous node","Left arrow","Jump to previous node."),this.private_AppendTableCommonString(n,{CtrlKey:!0,KeyCode:37,ShiftKey:!1},"Previous 5 node","Shift+Left arrow","Jump back over 5 nodes."),this.private_AppendTableCommonString(n,{CtrlKey:!0,KeyCode:37,ShiftKey:!0},"Start of the file","Ctrl+Shift+Right arrow","Jump to the start of the file."),this.private_AppendTableCommonString(n,{CtrlKey:!1,KeyCode:38,ShiftKey:!1},"Previous variant","Up arrow","Jump to previous variant."),this.private_AppendTableCommonString(n,{CtrlKey:!1,KeyCode:40,ShiftKey:!1},"Next variant","Down arrow","Jump to next variant."),this.private_AppendTableCommonString(n,{CtrlKey:!0,KeyCode:36,ShiftKey:!0},"Start node","Ctrl+Shift+Home",'Jump to the start node of the file. This node can be different from the first node. See "load unfinished files" checkbox in settings.'),this.private_AppendTableHeading2(n,{CtrlKey:!1,KeyCode:112,ShiftKey:!1},"Play mode","F1"),this.private_AppendTableCommonString(n,{},"Add move","Left mouse click","Set sequentially stones."),this.private_AppendTableCommonString(n,{},"Add alternative move","Right mouse click","Create new brunch and add alternative move."),this.private_AppendTableCommonString(n,{},"Go to the point","Shift+Left mouse click onto a board position","Teleports you to the moment of the game forth or back, when the stone on this position has been played."),this.private_AppendTableCommonString(n,{},"Change move order","Ctrl+Shift+Left mouse click","When sequentially stones are entered: changes the colour of the next stone to be set. What stone will appear on the board is shown by the tools field (useful e.g. after a problem has been set up)."),this.private_AppendTableCommonString(n,{},"Add comment with coordinates","Ctrl+Left mouse click","Add comment with coordinates."),this.private_AppendTableHeading2(n,{CtrlKey:!1,KeyCode:114,ShiftKey:!1},"Set up a board position","F3"),this.private_AppendTableCommonString(n,{},"Add black stone or remove stone","Left mouse click","Add black stone or remove stone."),this.private_AppendTableCommonString(n,{},"Add white stone or remove stone","Shift+Left mouse click","Add white stone or remove stone."),this.private_AppendTableHeading3(n,{CtrlKey:!1,KeyCode:115,ShiftKey:!1},"Triangles","F4","Add triangles."),this.private_AppendTableHeading3(n,{CtrlKey:!1,KeyCode:116,ShiftKey:!1},"Squares","F5","Add squares."),this.private_AppendTableHeading3(n,{CtrlKey:!1,KeyCode:117,ShiftKey:!1},"Circles","F6","Add circles."),this.private_AppendTableHeading3(n,{CtrlKey:!1,KeyCode:118,ShiftKey:!1},"X mark","F7",'Add "X" mark.'),this.private_AppendTableHeading2(n,{CtrlKey:!1,KeyCode:119,ShiftKey:!1},"Text label","F8"),this.private_AppendTableCommonString(n,{},"Letter","Left mouse click","Add letter."),this.private_AppendTableCommonString(n,{},"Text","Shift+Left mouse click","Add text entered by the user."),this.private_AppendTableHeading2(n,{CtrlKey:!1,KeyCode:120,ShiftKey:!1},"Numeric label","F9"),this.private_AppendTableCommonString(n,{},"Number","Left mouse click","Add the smallest positive number."),this.private_AppendTableCommonString(n,{},"Move number","Shift+Left mouse click","Add number of the first move which was played here."),this.private_AppendTableHeading2(n,{CtrlKey:!1,KeyCode:121,ShiftKey:!1},"Color mode","F10"),this.private_AppendTableCommonString(n,{},"Blue region","Left mouse click","Add blue region."),this.private_AppendTableCommonString(n,{},"Green region","Shift+Left mouse click","Add green region."),this.private_AppendTableCommonString(n,{},"Red region","Ctrl+Left mouse click","Add red region."),this.private_AppendTableCommonString(n,{},"Gray region","Ctrl+Shift+Left mouse click","Add gray region."),this.private_AppendTableCommonString(n,{},"Clear region","Right mouse click","Clear region."),this.private_AppendTableCommonString(n,{CtrlKey:!0,KeyCode:67,ShiftKey:!1},"Continue","Ctrl+C","Copy all colors from previous node."),this.private_AppendTableCommonString(n,{CtrlKey:!0,KeyCode:79,ShiftKey:!1},"Count colors","Ctrl+O","Count all colors with depth."),this.private_AppendTableCommonString(n,{CtrlKey:!0,KeyCode:82,ShiftKey:!1},"Clear colors","Ctrl+R","Clear all colors in the current node."),this.private_AppendTableHeading1(n,"Miscellaneous"),this.private_AppendTableCommonString(n,{CtrlKey:!1,KeyCode:8,ShiftKey:!1},"Remove node","Backspace/Delete","Deletes the current node and all of the following brunches."),this.private_AppendTableCommonString(n,{CtrlKey:!0,KeyCode:86,ShiftKey:!1},"View mode change of the next move","Ctrl+V","There are 3 mods: Show all next move variants, show all alternative variants of the current move, show nothing."),this.private_AppendTableCommonString(n,{CtrlKey:!0,KeyCode:82,ShiftKey:!1},"Show/Hide coordinates","Ctrl+R","Show/Hide coordinates. (Not in color mode, see above)"),this.private_AppendTableCommonString(n,{CtrlKey:!0,KeyCode:77,ShiftKey:!0},"Make the current variant mainly","Ctrl+Shift+M","Make the current variant mainly by uplifting it to the root of the game tree."),this.private_AppendTableCommonString(n,{CtrlKey:!0,KeyCode:85,ShiftKey:!0},"Lift up the current variant","Ctrl+Shift+U","Lift up the current variant."),this.private_AppendTableCommonString(n,{CtrlKey:!0,KeyCode:68,ShiftKey:!0},"Lower down the current variant","Ctrl+Shift+D","Lower down the current variant."),this.private_AppendTableCommonString(n,{CtrlKey:!0,KeyCode:86,ShiftKey:!0},"Setting up view port","Ctrl+Shift+V","Setting up visible part of the board."),this.private_AppendTableCommonString(n,{CtrlKey:!0,KeyCode:68,ShiftKey:!1},"Ascii Diagram","Ctrl+D","Make ascii diagram by current position.")},CDrawingAboutWindow.prototype.private_AppendTR=function(t){var e=document.createElement("tr");return t.appendChild(e),e.style.borderLeft="0",e.style.borderRight="0",e.style.borderBottom="solid 1px #E4E4E4",e.style.borderCollapse="collapse",e.style.padding="8px",e.style.fontSize="12px",e.style.textAlign="left",e.style.cursor="default",e},CDrawingAboutWindow.prototype.private_AppendTD=function(t,e){var o=document.createElement("td");return t.appendChild(o),Common.Set_InnerTextToElement(o,e),o.style.borderLeft="0",o.style.borderRight="0",o.style.borderBottom="solid 1px #E4E4E4",o.style.borderCollapse="collapse",o.style.padding="8px",o.style.fontSize="12px",o.style.textAlign="left",o.style.cursor="default",o},CDrawingAboutWindow.prototype.private_SetEventListener=function(t,e){var o=this.m_oDrawingBoard;o&&e.KeyCode&&(t.title="Click to do it",t.style.cursor="pointer",t.style.textDecoration="underline",t.addEventListener("click",function(){o.private_HandleKeyDown(e)},!1))},CDrawingAboutWindow.prototype.private_AppendTableHeading1=function(t,e){var o=this.private_AppendTR(t),r=this.private_AppendTD(o,e);r.colSpan="3",r.style.fontSize="14px",r.style.fontWeight="bold",r.style.paddingTop="20px"},CDrawingAboutWindow.prototype.private_AppendTableHeading2=function(t,e,o,r){var i=this.private_AppendTR(t);this.private_AppendTD(i,o).style.fontWeight="bold";var a=this.private_AppendTD(i,r);this.private_SetEventListener(a,e),a.colSpan="2"},CDrawingAboutWindow.prototype.private_AppendTableHeading3=function(t,e,o,r,i){var a=this.private_AppendTR(t);this.private_AppendTD(a,o).style.fontWeight="bold";var n=this.private_AppendTD(a,r);this.private_SetEventListener(n,e),this.private_AppendTD(a,i)},CDrawingAboutWindow.prototype.private_AppendTableCommonString=function(t,e,o,r,i){var a=this.private_AppendTR(t);this.private_AppendTD(a,o).style.width="35%";var n=this.private_AppendTD(a,r);n.style.width="15%",this.private_SetEventListener(n,e),this.private_AppendTD(a,i).style.width="50%"},CommonExtend(CDrawingDiagramSLWindow,CDrawingWindow),CDrawingDiagramSLWindow.prototype.Init=function(t,e){CDrawingDiagramSLWindow.superclass.Init.call(this,t,!0);var o=window.g_oLocalization?window.g_oLocalization.gameRoom.window.asciiDiagram.caption:"ASCII diagram";this.Set_Caption(o);var r=this.HtmlElement.InnerDiv,i=this.HtmlElement.InnerControl,a=this.HtmlElement.InnerDiv.id;this.m_oGameTree=e.GameTree,this.private_CreateInfoAreaElement(r,i,a),this.private_FillTextArea(e.GameTree),this.m_oTextArea.select()},CDrawingDiagramSLWindow.prototype.Show=function(t){CDrawingDiagramSLWindow.superclass.Show.call(this,t),this.private_FillTextArea(t.GameTree),this.m_oTextArea.select()},CDrawingDiagramSLWindow.prototype.private_CreateInfoAreaElement=function(t,e,o){var r=document.createElement("textarea"),i=o+"TA";r.setAttribute("id",i),r.setAttribute("style","position:absolute;padding:0;margin:0;"),r.setAttribute("oncontextmenu","return false;"),r.style.fontFamily="Courier New, monospacef",r.style.fontSize="10pt",r.style.resize="none",r.style.outline="none",r.style.border="1px solid rgb(169,169,169)",r.style.height="100%",r.style.width="100%",this.m_oTextArea=r,t.appendChild(r);var a=CreateControlContainer(i);return a.Bounds.SetParams(0,0,1e3,1e3,!1,!1,!1,!1,-1,-1),a.Anchor=g_anchor_left|g_anchor_top|g_anchor_right|g_anchor_bottom,e.AddControl(a),r},CDrawingDiagramSLWindow.prototype.private_FillTextArea=function(t){if(this.m_oTextArea.value="",void 0!==t){var e=t.Get_DrawingBoard(),o=t.Get_Board();if(e&&o){for(var r="",i=o.Get_Size().X,a=o.Get_Size().Y,n=e.Get_ViewPort(),s=n.X0,l=n.Y0,m=n.X1,_=n.Y1,h=0==s,d=i-1==m,p=0==l,u=a-1==_,C=[],g=l;g<_;g++)for(H=s;H<m;H++){var c=null!=(P=e.Get_Mark(H+1,g+1))?P.Get_Type():EDrawingMark.Lm,v=null!=P?P.Get_Text():"";if(c==EDrawingMark.Tx&&Common_IsInt(v)){A={Number:x=parseInt(v),Value:o.Get(H+1,g+1)};BOARD_EMPTY!=A.Value&&C.push(A)}}var f=!0,w=e.Get_Rulers(),S=-1;if(C.length>0){for(var T=-1,y=BOARD_EMPTY,D=-1,E=0,B=C.length;E<B;E++){var A=C[E];(-1==T||A.Number<T)&&(T=A.Number,y=A.Value),(-1==D||A.Number>D)&&(D=A.Number)}if(D-T<10){for(var b=!0,E=0,B=C.length;E<B;E++){var G=((A=C[E]).Number-T)%2;if(0==G&&y!=A.Value||1==G&&y==A.Value){b=!1;break}}!0===b&&(S=T,f=BOARD_BLACK===y)}}for(var M=h?"$$  --":"$$ -",H=s+1;H<=m;H++)M+="--";M+=d?"- \n":"\n";var I=h?"$$ |":"$$",N=d?" |\n":"\n";r+=f?"$$B":"$$W",w&&(r+="c"),-1!=S&&(r+="m"+S),r+="\n",p&&(r+=M);for(g=l;g<=_;g++){r+=I;for(H=s;H<=m;H++){var P=e.Get_Mark(H+1,g+1),c=null!=P?P.Get_Type():EDrawingMark.Lm,v=null!=P?P.Get_Text():"",k=o.Get(H+1,g+1);if(BOARD_EMPTY==k)EDrawingMark.Tr===c?r+=" T":EDrawingMark.Cr===c?r+=" C":EDrawingMark.Sq===c?r+=" S":EDrawingMark.X===c?r+=" M":EDrawingMark.Tx===c&&1===v.length&&97<=v.charCodeAt(0)&&v.charCodeAt(0)<=122?r+=String.fromCharCode(32,v.charCodeAt(0)):EDrawingMark.Tx===c&&1===v.length&&65<=v.charCodeAt(0)&&v.charCodeAt(0)<=90?r+=String.fromCharCode(32,v.charCodeAt(0)+32):o.Is_HandiPoint(H+1,g+1)?r+=" ,":r+=" .";else if(-1!==S&&c==EDrawingMark.Tx&&Common_IsInt(v)){var x=parseInt(v)-S+1;r+=10==x?" 0":" "+x}else BOARD_BLACK==k?EDrawingMark.Tr===c?r+=" Y":EDrawingMark.Cr===c?r+=" B":EDrawingMark.Sq===c?r+=" #":EDrawingMark.X===c?r+=" Z":r+=" X":BOARD_WHITE==k&&(EDrawingMark.Tr===c?r+=" Q":EDrawingMark.Cr===c?r+=" W":EDrawingMark.Sq===c?r+=" @":EDrawingMark.X===c?r+=" P":r+=" O")}r+=N}u&&(r+=M),this.m_oTextArea.value=r}}},CommonExtend(CDrawingViewPortWindow,CDrawingConfirmWindow),CDrawingViewPortWindow.prototype.Init=function(t,e){CDrawingViewPortWindow.superclass.Init.call(this,t,!0),this.protected_UpdateSizeAndPosition(e.Drawing),this.m_oGameTree=e.GameTree,this.m_oDrawing=e.Drawing;var o=window.g_oLocalization?window.g_oLocalization.gameRoom.window.boardCropping.caption:"Crop the board...";this.Set_Caption(o);var r=this.HtmlElement.ConfirmInnerDiv,i=this.HtmlElement.ConfirmInnerControl,a=this.HtmlElement.ConfirmInnerDiv.id;r.style.background="url('"+g_sBackground+"')";var n=new CDrawingBoard;i.Set_Type(2,n);var s=a+"B",l=this.protected_CreateDivElement(r,s),m=CreateControlContainer(s);m.Bounds.SetParams(0,0,1e3,1e3,!0,!0,!1,!1,-1,-1),m.Anchor=g_anchor_top|g_anchor_left|g_anchor_bottom|g_anchor_right,i.AddControl(m),this.m_oBoardDiv=l,this.m_oBoardControl=m,n.Init(s,this.m_oGameTree.Copy_ForScoreEstimate()),n.Set_ViewPortMode(this),this.m_oDrawingBoard=n;var _=this.HtmlElement.OkCancelDiv,h=window.g_oLocalization?window.g_oLocalization.gameRoom.window.boardCropping.buttonReset:"Reset",d=100;window.g_oTextMeasurer&&(window.g_oTextMeasurer.SetFont("16px 'Segoe UI', Helvetica, Tahoma, Geneva, Verdana, sans-serif"),d=window.g_oTextMeasurer.Measure(h)+10);var p=a+"R",u=CreateControlContainerByElement(this.protected_CreateDivElement(_,p));u.Bounds.SetParams(0,9,159,1e3,!1,!0,!0,!1,d+10,21),u.Anchor=g_anchor_top|g_anchor_right,this.HtmlElement.InnerControl.AddControl(u);var C=this,g=new CDrawingButtonSimpleText(h,function(){var t=C.m_oGameTree.Get_DrawingBoard();t&&(t.Reset_ViewPort(),C.m_oDrawing.Update_Size(!0),C.Close())},"");g.Init(p,this),this.m_oButtonReset=g,this.private_UpdateSelectionOnShow()},CDrawingViewPortWindow.prototype.Update_Size=function(t){CDrawingViewPortWindow.superclass.Update_Size.call(this,t),this.m_oDrawingBoard&&this.m_oDrawingBoard.Update_Size(t),this.m_oButtonReset&&this.m_oButtonReset.Update_Size(t)},CDrawingViewPortWindow.prototype.Show=function(t){for(;this.m_oBoardDiv.firstChild;)this.m_oBoardDiv.removeChild(this.m_oBoardDiv.firstChild);this.m_oBoardControl&&this.m_oBoardControl.Clear();var e=new CDrawingBoard;e.Init(this.m_oBoardDiv.id,t.GameTree.Copy_ForScoreEstimate()),e.Set_ViewPortMode(this),this.m_oDrawingBoard=e,CDrawingViewPortWindow.superclass.Show.apply(this,arguments),this.Update_Size(!0),this.private_UpdateSelectionOnShow()},CDrawingViewPortWindow.prototype.Handle_OK=function(){if(this.m_oGameTree){var t=this.m_oGameTree.Get_DrawingBoard();if(t){var e=this.m_oDrawingBoard.Get_SelectedViewPort();if(e.X1===e.X0&&e.Y1===e.Y0)t.Reset_ViewPort();else{if(e.X1-e.X0<3||e.Y1-e.Y0<3){var o=this.m_oGameTree,r=this.m_oDrawing;if(r){var i=window.g_oLocalization?window.g_oLocalization.gameRoom.window.boardCropping.errorMessage:"Sorry, the cropped part can't be so small.";CreateWindow(r.Get_MainDiv().id,EWindowType.Error,{GameTree:o,Drawing:r,ErrorText:i,W:270,H:80})}return}t.Set_ViewPort(e.X0-1,e.Y0-1,e.X1-1,e.Y1-1)}this.m_oDrawing.Update_Size(!0)}}this.Close()},CDrawingViewPortWindow.prototype.private_UpdateSelectionOnShow=function(){var t=this.m_oGameTree.Get_DrawingBoard();if(t&&this.m_oDrawingBoard){var e=t.Get_ViewPort(),o=this.m_oGameTree.Get_Board().Get_Size();0!==e.X0||0!==e.Y0||o.X-1!==e.X1||o.Y-1!==e.Y1?this.m_oDrawingBoard.Set_ViewPortSelection(e.X0,e.Y0,e.X1,e.Y1):this.m_oDrawingBoard.Set_ViewPortSelection(-1,-1,-1,-1)}},CommonExtend(CDrawingCreateNewWindow,CDrawingConfirmWindow),CDrawingCreateNewWindow.prototype.Init=function(t,e){CDrawingViewPortWindow.superclass.Init.call(this,t,!1),this.protected_UpdateSizeAndPosition(e.Drawing),this.m_oGameTree=e.GameTree,this.m_oDrawing=e.Drawing,this.Set_Caption("Create new");var o=this.HtmlElement.ConfirmInnerDiv,r=this.HtmlElement.ConfirmInnerControl,i=this.HtmlElement.ConfirmInnerDiv.id,a=5;this.BlackPlayer=this.private_CreateInfoElement(o,r,i,"Black","Black",a,20),a+=50,this.WhitePlayer=this.private_CreateInfoElement(o,r,i,"White","White",a,20),a+=50,this.BoardSize=this.private_CreateInfoElement(o,r,i,"Board size","15",a,20),a+=50},CDrawingCreateNewWindow.prototype.private_CreateDivElement=function(t,e,o){var r=document.createElement("div");return r.setAttribute("id",e),r.setAttribute("style","position:absolute;padding:0;margin:0;"),r.setAttribute("oncontextmenu","return false;"),r.style.fontFamily="Tahoma, Sans serif",r.style.fontSize=15*o/20+"px",r.style.lineHeight=o+"px",r.style.height=o+"px",r.style.fontWeight=550,t.appendChild(r),r},CDrawingCreateNewWindow.prototype.private_CreateInputElement=function(t,e){var o=document.createElement("input");return o.setAttribute("id",e),o.setAttribute("style","position:absolute;padding:0;margin:0;"),o.setAttribute("oncontextmenu","return false;"),o.setAttribute("type","text"),o.style.fontFamily="Tahoma, Sans serif",o.style.fontSize="10pt",o.style.outline="none",o.style.border="1px solid rgb(169,169,169)",t.appendChild(o),o},CDrawingCreateNewWindow.prototype.private_CreateInfoElement=function(t,e,o,r,i,a,n){var s=o+r,l=this.private_CreateDivElement(t,s,n),m=CreateControlContainer(s);m.Bounds.SetParams(20,a,10,1e3,!0,!0,!1,!1,-1,n),m.Anchor=g_anchor_left|g_anchor_top|g_anchor_right,e.AddControl(m),Common.Set_InnerTextToElement(l,r),a+=n;var _=s+"Value",h=this.private_CreateInputElement(t,_),d=CreateControlContainer(_);return d.Bounds.SetParams(10,a+1,10,1e3,!0,!0,!0,!1,-1,n-2),d.Anchor=g_anchor_left|g_anchor_top|g_anchor_right,e.AddControl(d),h.value=i,h},CDrawingCreateNewWindow.prototype.Get_DefaultWindowSize=function(){return{W:195,H:340}},CDrawingCreateNewWindow.prototype.Handle_OK=function(){var t=this.BoardSize.value,e=19,o=19,r=-1;if(-1==(r=t.indexOf(":"))?o=e=Math.min(52,Math.max(parseInt(t),2)):(e=parseInt(t.substr(0,r)),o=parseInt(t.substr(r+1,t.length-r-1))),isNaN(e)||e<2||e>52||isNaN(o)||o<2||o>52)CreateWindow(this.m_oDrawing.Get_MainDiv().id,EWindowType.Error,{GameTree:this.m_oGameTree,Drawing:this.m_oDrawing,ErrorText:"Size value must be an integer number from 2 to 52, or pair of such numbers separated by ':' character.",W:300,H:115});else{if(this.m_oGameTree){var i="(;FF[4]";i+="SZ["+(e===o?e:e+":"+o)+"]",i+="PB["+this.BlackPlayer.value+"]",i+="PW["+this.WhitePlayer.value+"]",i+=")",this.m_oGameTree.Load_Sgf(i,null,null,"sgf")}this.Close()}},CommonExtend(CDrawingClipboardWindow,CDrawingConfirmWindow),CDrawingClipboardWindow.prototype.Init=function(t,e){CDrawingClipboardWindow.superclass.Init.call(this,t,!0),this.protected_UpdateSizeAndPosition(e.Drawing),this.Set_Caption("Load file from clipboard");var o=this.HtmlElement.ConfirmInnerDiv,r=this.HtmlElement.ConfirmInnerControl,i=this.HtmlElement.ConfirmInnerDiv.id;this.m_oGameTree=e.GameTree,this.private_CreateInfoAreaElement(o,r,i),this.private_FillTextArea(e.GameTree),this.m_oTextArea.select()},CDrawingClipboardWindow.prototype.Show=function(t){CDrawingClipboardWindow.superclass.Show.call(this,t),this.private_FillTextArea(),this.m_oTextArea.select()},CDrawingClipboardWindow.prototype.private_CreateInfoAreaElement=function(t,e,o){var r=document.createElement("textarea"),i=o+"TA";r.setAttribute("id",i),r.setAttribute("style","position:absolute;padding:0;margin:0;"),r.setAttribute("oncontextmenu","return false;"),r.style.fontFamily="Courier New, monospacef",r.style.fontSize="10pt",r.style.resize="none",r.style.outline="none",r.style.border="1px solid rgb(169,169,169)",r.style.height="100%",r.style.width="100%",this.m_oTextArea=r,t.appendChild(r);var a=CreateControlContainer(i);return a.Bounds.SetParams(0,0,1e3,1e3,!1,!1,!1,!1,-1,-1),a.Anchor=g_anchor_left|g_anchor_top|g_anchor_right|g_anchor_bottom,e.AddControl(a),r},CDrawingClipboardWindow.prototype.private_FillTextArea=function(t){this.m_oTextArea.value="",window.clipboardData&&(this.m_oTextArea.value=window.clipboardData.getData("Text"))},CDrawingClipboardWindow.prototype.Handle_OK=function(){var t=this.m_oTextArea.value;t&&""!==t&&this.m_oGameTree.Load_Sgf(t,null,null,null),this.Close()},CDrawingClipboardWindow.prototype.Get_DefaultWindowSize=function(){return{W:300,H:200}},CommonExtend(CDrawingKifuWindow,CDrawingWindow),CDrawingKifuWindow.prototype.Init=function(t,e){CDrawingKifuWindow.superclass.Init.call(this,t,e),this.protected_UpdateSizeAndPosition(e.Drawing);var o=window.g_oLocalization?window.g_oLocalization.gameRoom.window.kifu.caption:"Kifu";this.Set_Caption(o);var r=this.HtmlElement.InnerDiv,i=this.HtmlElement.InnerControl;this.HtmlElement.Canvas=this.private_CreateCanvasElement(r,i,t),this.m_oGameTree=e.GameTree,this.m_oDrawing=e.Drawing,this.m_oDrawing&&this.m_oDrawing.Register_KifuWindow&&this.m_oDrawing.Register_KifuWindow(this)},CDrawingKifuWindow.prototype.Get_DefaultWindowSize=function(){return{W:650,H:730}},CDrawingKifuWindow.prototype.private_CreateCanvasElement=function(t,e,o){var r=document.createElement("canvas"),i=o+"C";r.setAttribute("style","position:absolute;padding:0;margin:0;"),r.id=i,t.appendChild(r);var a=CreateControlContainer(i);return a.Bounds.SetParams(0,0,1e3,1e3,!1,!1,!1,!1,-1,-1),a.Anchor=g_anchor_left|g_anchor_top|g_anchor_right|g_anchor_bottom,e.AddControl(a),r},CDrawingKifuWindow.prototype.private_DrawLogicBoard=function(t,e,o,r){t.clearRect(0,0,e,o),t.strokeStyle="rgba(0, 0, 0, 1)",t.fillStyle="rgba(0, 0, 0, 1)";var i=this.private_DrawRepetitions(t,0,e,r,30,!1),a=Math.max(50,Math.min(e,o-30-i)),n=(e-a)/2|0,s=this.private_DrawBoard(t,r,n,30,a);this.private_DrawKifuCaption(t,e,"("+s.Min+" ~ "+s.Max+")"),this.private_DrawRepetitions(t,o-i,e,r,30,!0),this.private_DrawNextMove(t,25)},CDrawingKifuWindow.prototype.Show=function(t){CDrawingKifuWindow.superclass.Show.call(this,t);var e=this.HtmlElement.InnerDiv.clientWidth,o=this.HtmlElement.InnerDiv.clientHeight;this.private_DrawLogicBoard(this.HtmlElement.Canvas.getContext("2d"),e,o,this.m_oGameTree.Get_LogicBoardForKifu())},CDrawingKifuWindow.prototype.Update_Size=function(t){CDrawingKifuWindow.superclass.Update_Size.call(this,t);var e=this.HtmlElement.InnerDiv.clientWidth,o=this.HtmlElement.InnerDiv.clientHeight;(!0===t||Math.abs(e-this.m_nKifuW)>.001||Math.abs(o-this.m_nKifuH)>.001)&&(this.m_nKifuW=e,this.m_nKifuH=o,this.private_DrawLogicBoard(this.HtmlElement.Canvas.getContext("2d"),e,o,this.m_oGameTree.Get_LogicBoardForKifu()))},CDrawingKifuWindow.prototype.private_DrawStone=function(t,e,o,r,i){BOARD_BLACK===e?(t.fillStyle="rgb(0, 0, 0)",t.beginPath(),t.arc(o,r,i,0,2*Math.PI),t.fill()):BOARD_WHITE===e&&(t.fillStyle="rgb(255, 255, 255)",t.beginPath(),t.arc(o,r,i,0,2*Math.PI),t.fill(),t.stroke())},CDrawingKifuWindow.prototype.private_DrawMoveNumber=function(t,e,o,r,i,a){if(-1!==a){var n=""+a,s=i,l=s+"px "+(Common_IsInt(n)?"Arial":"Helvetica, Arial, Verdana");t.fillStyle=e===BOARD_WHITE?"rgb(0,0,0)":"rgb(255,255,255)",t.font=l;var m=s/3+.15*s,_=n.length>2?(2*i-t.measureText(n).width)/2-i:(2*i-1.4*t.measureText(n).width)/2-i;n.length>2?t.setTransform(1,0,0,1.4,o+_,r+m):t.setTransform(1.4,0,0,1.4,o+_,r+m),t.fillText(n,0,0),t.setTransform(1,0,0,1,0,0)}},CDrawingKifuWindow.prototype.private_DrawBoard=function(t,e,o,r,i){var a=e.Get_Size(),n=(a.X-1)*g_dBoardCellW+2*g_dBoardHorOffset,s=i/n*g_dBoardHorOffset|0,l=i/n*g_dBoardCellW|0,m=s+o,_=s+r;t.lineWidth=2,t.beginPath(),t.moveTo(m,_),t.lineTo(m+(a.X-1)*l,_),t.lineTo(m+(a.X-1)*l,_+(a.Y-1)*l),t.lineTo(m,_+(a.Y-1)*l),t.closePath(),t.stroke(),t.lineWidth=1,t.beginPath();for(w=0;w<a.X;++w)t.moveTo(m+w*l+.5,_+.5),t.lineTo(m+w*l+.5,_+(a.Y-1)*l+.5);for(f=0;f<a.Y;++f)t.moveTo(m+.5,_+f*l+.5),t.lineTo(m+(a.X-1)*l+.5,_+f*l+.5);t.stroke(),t.beginPath();for(var h=e.Get_HandiPoints(),d=0,p=h.length;d<p;++d){var u=h[d][0]*l+m,C=h[d][1]*l+_;t.rect(u-3,C-3,7,7)}t.fill();for(var g=l/2|0,c=-1,v=-1,f=0;f<a.Y;++f)for(var w=0;w<a.X;++w){var S=e.Get(w+1,f+1),T=e.Get_Num(w+1,f+1),y=w*l+m,D=f*l+_;this.private_DrawStone(t,S,y,D,g),-1!==T&&(this.private_DrawMoveNumber(t,S,y,D,g,T),(-1===c||c>T)&&(c=T),(-1===v||v<T)&&(v=T))}return this.m_nMoveMin=c,this.m_nMoveMax=v,{Min:c,Max:v}},CDrawingKifuWindow.prototype.private_DrawKifuCaption=function(t,e,o){t.fillStyle="rgb(0,0,0)",t.font="16px Arial";var r=(e-t.measureText(o).width)/2;t.fillText(o,r,20)},CDrawingKifuWindow.prototype.private_DrawRepetitions=function(t,e,o,r,i,a){function n(t){return u+t<h||!0===C?(C=!1,!0):(u=s,C=!1,d+=i+l,!1)}var s=i/2|0,l=5,m=i/2|0,_=0|i,h=o-s,d=5+e,p=i/2|0,u=s;if(r.m_aRepetitions){d+=i/2|0;for(var C=!0,g=0,c=r.m_aRepetitions.length;g<c;++g){var v=r.m_aRepetitions[g];if(!(v.aReps.length<=0)){for(var f=0,w=v.aReps.length;f<w;++f){var S=v.aReps[f];n(i),!0===a&&(this.private_DrawStone(t,S.nValue,u+p,d,p),this.private_DrawMoveNumber(t,S.nValue,u+p,d,p,S.nMoveNumber)),u+=i}n(_),!0===a&&this.private_DrawDots(t,u+p,d,i),u+=_,n(i),!0===a&&(this.private_DrawStone(t,v.nValue,u+p,d,p),this.private_DrawMoveNumber(t,v.nValue,u+p,d,p,v.nMoveNumber)),u+=i+m}}d+=i/2|0}return d+=5},CDrawingKifuWindow.prototype.private_DrawDots=function(t,e,o,r){var i=e-r/2|0,a=r/15|0,n=r/10*3|0,s=r/5|0;t.fillStyle="rgb(0,0,0)",t.beginPath(),t.arc(i+s,o,a,0,2*Math.PI),t.arc(i+s+n,o,a,0,2*Math.PI),t.arc(i+s+2*n,o,a,0,2*Math.PI),t.fill()},CDrawingKifuWindow.prototype.private_DrawNextMove=function(t,e){if(this.m_oGameTree){var o=this.m_oGameTree.Get_MovesCount()+1,r=this.m_oGameTree.Get_NextMove(),i=e/2|0;if(t.clearRect(0,0,this.m_nNextW,30),o>0&&o<=this.m_nMoveMax){l=window.g_oLocalization?window.g_oLocalization.gameRoom.window.kifu.next:"Next";t.fillStyle="rgb(0,0,0)",t.font="16px Arial";var a=20,n=20;t.fillText(l,n,a);var s=20;window.g_oTextMeasurer?(window.g_oTextMeasurer.SetFont("16px Arial"),s+=window.g_oTextMeasurer.Measure(l)+5):s+=50,this.private_DrawStone(t,r,s+i,28-i,i),this.private_DrawMoveNumber(t,r,s+i,28-i,i,o),this.m_nNextW=s+2*i+2}else if(o>0){var l=window.g_oLocalization?window.g_oLocalization.gameRoom.window.kifu.end:"End";t.fillStyle="rgb(0,0,0)",t.font="16px Arial";var a=20,n=20;t.fillText(l,n,a),this.m_nNextW=100}}},CDrawingKifuWindow.prototype.Update_NextMove=function(){this.private_DrawNextMove(this.HtmlElement.Canvas.getContext("2d"),25)};var EWindowType={Common:0,Confirm:1,Error:2,GameInfo:3,Settings:4,CountColors:6,GifWriter:7,About:8,DiagramSL:9,ViewPort:10,CreateNew:11,Clipboard:12,Kifu:13},g_aWindows={};